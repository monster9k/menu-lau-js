const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/commandline.Bc0p9Q-9.js","js/vendor.CqWMOzj5.js","js/firebase.DegswMic.js","js/misc.DfCJYWHz.js","css/vendor.CM4dUC2J.css","css/index.BEu6JETE.css","js/howler.BBEjZEGN.js"])))=>i.map(i=>d[i]);
import{s as Ja,d as Ma,t as xo,a as Q,b as Hs,c as de,h as Z,e as H1,f as ae,p as Ms,g as Be,i as Ee,j as yc,k as Jm,m as py,n as an,r as Do,o as Jl,q as id,u as Vt,v as ec,w as gy,x as Ya,y as Ct,z as Qi,A as j1,B as Gn,C as N1,D as hy,E as yy,F as Qr,G as G1,H as Go,I as Zi,J as by,K as rd,L as Un,M as U1,N as K1,O as mu,P as Gt,Q as V1,R as Q1,S as Jp,T as ef,U as tf,V as Z1,W as eg,X as Y1}from"./misc.DfCJYWHz.js";/* empty css               *//* empty css              */import{z as o,i as xt,l as pa,a as X1,g as J1,t as eS,$ as n,d as Pt,U as uo,b as tS,c as aS,e as Tn,f as oS,s as sS,h as Yu,j as nS,k as iS,m as rS,n as lS,o as cS,p as oe,q as tg,r as dS,u as ag,Z as vy,v as uS,w as mS,x as fS,A as pS,y as it,H as bc,C as ga,B as gS,D as hS,E as yS,F as bS,L as vS,G as wS,I as kS,P as CS,S as SS,T as xS,J as TS,K as $S,M as LS,N as AS,O as og,Q as wy,R as nt,V as ky,W as Cy,X as sg,Y as MS,_ as ES,a0 as PS,a1 as IS,a2 as qS,a3 as BS,a4 as Sy,a5 as DS,a6 as FS,a7 as xy,a8 as WS,a9 as ng,aa as zS,ab as RS,ac as OS,ad as _S,ae as Ty,af as $y,ag as Ly,ah as HS,ai as Ay,aj as jS,ak as My,al as NS,am as af,an as GS,ao as of,ap as Ey,aq as US,ar as KS,as as VS,at as QS,au as ZS}from"./vendor.CqWMOzj5.js";import{i as j,g as ld,a as YS,b as Bn,c as g,d as XS,e as Kn,s as JS,A as xe,f as vc,h as ex,j as tx,n as fu,k as ig}from"./firebase.DegswMic.js";const ax="https://api.monkeytype.com",ox="2025.04.18_21.53_a910ddab4",sx="6Lc-V8McAAAAAJ7s6LGNe7MBZnRiwbsbiWts87aj",Zr={backendUrl:ax,clientVersion:ox,recaptchaSiteKey:sx},nx="modulepreload",ix=function(e){return"/"+e},rg={},sf=function(t,a,s){let i=Promise.resolve();if(a&&a.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));i=Promise.allSettled(a.map(u=>{if(u=ix(u),u in rg)return;rg[u]=!0;const m=u.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${f}`))return;const p=document.createElement("link");if(p.rel=m?"stylesheet":nx,m||(p.as="script"),p.crossOrigin="",p.href=u,d&&p.setAttribute("nonce",d),document.head.appendChild(p),m)return new Promise((h,y)=>{p.addEventListener("load",h),p.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function l(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return i.then(c=>{for(const d of c||[])d.status==="rejected"&&l(d.reason);return t().catch(l)})};let Py=!0;function js(e){Py=e}function mr(){return Py}var X=o.object({message:o.string()}),rx=X.extend({validationErrors:o.array(o.string())}),$n=X,lg=$n.extend({errorId:o.string(),uid:o.string().optional()});function Fo(e){return X.extend({data:e.nullable()})}function ue(e){return X.extend({data:e})}var Yt={400:$n.describe("Generic client error"),401:$n.describe("Authentication required but not provided or invalid"),403:$n.describe("Operation not permitted"),422:rx.describe("Request validation failed"),429:$n.describe("Rate limit exceeded"),500:lg.describe("Generic server error"),503:lg.describe("Endpoint disabled or server is under maintenance")},Xa=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),Vn=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),pe=Vn(),lx=Vn().max(50),Ye=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]"),cg=o.string().nullable().optional().transform(e=>e??void 0),Yi=o.number().nonnegative().max(100),dg=o.number().nonnegative().max(420),cx=o.enum(["repeat","random","shuffle"]),dx=o.enum(["word","time","section"]),ux=o.object({uid:pe}).strict(),mx=ue(o.object({banned:o.boolean()})).strict(),fx=o.object({reports:o.array(o.object({reportId:o.string()}).strict()).nonempty()}).strict(),px=o.object({reports:o.array(o.object({reportId:o.string(),reason:o.string().optional()}).strict()).nonempty()}).strict(),gx=o.object({email:o.string().email()}).strict(),hx=xt(),yx=hx.router({test:{summary:"test permission",description:"Check for admin permission for the current user",method:"GET",path:"",responses:{200:X}},toggleBan:{summary:"toggle user ban",description:"Ban an unbanned user or unban a banned user.",method:"POST",path:"/toggleBan",body:ux,responses:{200:mx}},acceptReports:{summary:"accept reports",description:"Accept one or many reports",method:"POST",path:"/report/accept",body:fx,responses:{200:X}},rejectReports:{summary:"reject reports",description:"Reject one or many reports",method:"POST",path:"/report/reject",body:px,responses:{200:X}},sendForgotPasswordEmail:{summary:"send forgot password email",description:"Send a forgot password email to the given user email",method:"POST",path:"/sendForgotPasswordEmail",body:gx,responses:{200:X}}},{pathPrefix:"/admin",strictStatusCodes:!0,metadata:{openApiTags:"admin",authenticationOptions:{noCache:!0},rateLimit:"adminLimit",requirePermission:"admin",requireConfiguration:{path:"admin.endpointsEnabled",invalidMessage:"Admin endpoints are currently disabled."}},commonResponses:Yt}),Iy=o.object({name:o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(20),enabled:o.boolean()}),qy=Iy.extend({createdOn:o.number().min(0),modifiedOn:o.number().min(0),lastUsedOn:o.number().min(0).or(o.literal(-1))}),bx=o.record(pe,qy),vx=ue(bx),By=Iy,wx=ue(o.object({apeKeyId:pe,apeKey:o.string().base64(),apeKeyDetails:qy})),kx=By.partial(),ug=o.object({apeKeyId:pe}),mg=xt(),Cx=mg.router({get:{summary:"get ape keys",description:"Get ape keys of the current user.",method:"GET",path:"",responses:{200:vx},metadata:{rateLimit:"apeKeysGet"}},add:{summary:"add ape key",description:"Add an ape key for the current user.",method:"POST",path:"",body:By.strict(),responses:{200:wx},metadata:{rateLimit:"apeKeysGenerate"}},save:{summary:"update ape key",description:"Update an existing ape key for the current user.",method:"PATCH",path:"/:apeKeyId",pathParams:ug,body:kx.strict(),responses:{200:X},metadata:{rateLimit:"apeKeysGenerate"}},delete:{summary:"delete ape key",description:"Delete ape key by id.",method:"DELETE",path:"/:apeKeyId",pathParams:ug,body:mg.noBody(),responses:{200:X},metadata:{rateLimit:"apeKeysGenerate"}}},{pathPrefix:"/ape-keys",strictStatusCodes:!0,metadata:{openApiTags:"ape-keys",requirePermission:"canManageApeKeys",requireConfiguration:{path:"apeKeys.endpointsEnabled",invalidMessage:"ApeKeys are currently disabled."}},commonResponses:Yt}),nf=o.enum(["normal","expert","master"]),kn=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:nf,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),cd=o.object({time:o.record(Xa.describe("Number of seconds as string"),o.array(kn)),words:o.record(Xa.describe("Number of words as string"),o.array(kn)),quote:o.record(Xa,o.array(kn)),custom:o.record(o.literal("custom"),o.array(kn)),zen:o.record(o.literal("zen"),o.array(kn))}),Sx=o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]),xx=o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]),Tx=o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]),ms=cd.keyof(),on=o.union([Xa,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})}),$x=o.enum(["off","slow","medium","fast"]),Lx=o.enum(["off","esc","tab","enter"]),Ax=o.union([o.literal(-3),o.literal(-2),o.literal(-1),o.literal(0),o.literal(1),o.literal(2),o.literal(3)]),Mx=o.array(Ax),fg=o.enum(["off","default","block","outline","underline","carrot","banana"]),Ex=o.enum(["off","on","max"]),Px=o.enum(["off","below","replace"]),Ix=o.enum(["off","bar","text","mini"]),pu=o.enum(["off","text","mini"]),qx=o.enum(["off","on","fav","light","dark","custom"]),Bx=o.enum(["black","sub","text","main"]),Dx=o.enum(["0.25","0.5","0.75","1"]),Fx=o.enum(["off","word","letter"]),Wx=o.enum(["off","static","react","next"]),zx=o.enum(["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]),Rx=o.enum(["lowercase","uppercase","blank","dynamic"]),Ox=o.enum(["always","layout","never"]),_x=o.number().min(.5).max(3.5).step(.1),Hx=o.enum(["manual","on"]),jx=o.enum(["off","1","2","3","4"]),Nx=o.enum(["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]),Gx=o.number().min(0).max(1),Ux=o.enum(["off","average","pb","tagPb","last","custom","daily"]),Kx=o.tuple([o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"])]),Vx=o.enum(["off","custom"]),Qx=o.enum(["off","letter","word","next_word","next_two_words","next_three_words"]),Zx=o.enum(["off","letter","word"]),Yx=o.number().min(10).max(90),Xx=o.enum(["wpm","cpm","wps","cps","wph"]),Jx=o.enum(["off","result","on","sellout"]),eT=o.enum(["off","custom"]),tT=o.enum(["off","typing"]),aT=o.enum(["off","on","keymap"]),oT=o.enum(["cover","contain","max"]),sT=o.tuple([o.number(),o.number(),o.number(),o.number()]),nT=o.string().regex(/^[0-9a-zA-Z_#]+$/),iT=o.array(Ye).min(1),rT=o.enum(["off","1","2","3","4"]),lT=o.enum(["off","fixed","flex"]),cT=o.enum(["off","speed","acc","both"]),qa=o.string().regex(/^#([\da-f]{3}){1,2}$/i),Dy=nf,rf=o.tuple([qa,qa,qa,qa,qa,qa,qa,qa,qa,qa]),dT=o.array(Vn().max(50)),Fy=o.string().max(100).regex(/[\w#]+/),uT=o.number().nonnegative(),mT=o.number().nonnegative(),fT=o.number().nonnegative().max(100),pT=o.number().nonnegative(),gT=o.number().int().nonnegative(),hT=o.number().int().nonnegative(),yT=o.string().max(50).regex(/^[a-zA-Z0-9_\-+.]+$/),gu=Vn().max(50),bT=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),vT=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),wT=o.number().positive(),kT=o.number().min(20).max(1e3).or(o.literal(0)),CT=o.string().url("Needs to be an URI.").regex(/^(https|http):\/\/.*/,"Unsupported protocol.").regex(/^[^`'"]*$/,"May not contain quotes.").regex(/.+(\.png|\.gif|\.jpeg|\.jpg)/gi,"Unsupported image format.").max(2048,"URL is too long.").or(o.literal("")),ST=o.object({theme:gu,themeLight:gu,themeDark:gu,autoSwitchTheme:o.boolean(),customTheme:o.boolean(),customThemeColors:rf,favThemes:dT,showKeyTips:o.boolean(),smoothCaret:$x,codeUnindentOnBackspace:o.boolean(),quickRestart:Lx,punctuation:o.boolean(),numbers:o.boolean(),words:hT,time:gT,mode:ms,quoteLength:Mx,language:Ye,fontSize:wT,freedomMode:o.boolean(),difficulty:Dy,blindMode:o.boolean(),quickEnd:o.boolean(),caretStyle:fg,paceCaretStyle:fg,flipTestColors:o.boolean(),layout:vT,funbox:Fy,confidenceMode:Ex,indicateTypos:Px,timerStyle:Ix,liveSpeedStyle:pu,liveAccStyle:pu,liveBurstStyle:pu,colorfulMode:o.boolean(),randomTheme:qx,timerColor:Bx,timerOpacity:Dx,stopOnError:Fx,showAllLines:o.boolean(),keymapMode:Wx,keymapStyle:zx,keymapLegendStyle:Rx,keymapLayout:bT,keymapShowTopRow:Ox,keymapSize:_x,fontFamily:yT,smoothLineScroll:o.boolean(),alwaysShowDecimalPlaces:o.boolean(),alwaysShowWordsHistory:o.boolean(),singleListCommandLine:Hx,capsLockWarning:o.boolean(),playSoundOnError:jx,playSoundOnClick:Nx,soundVolume:Gx,startGraphsAtZero:o.boolean(),showOutOfFocusWarning:o.boolean(),paceCaret:Ux,paceCaretCustomSpeed:uT,repeatedPace:o.boolean(),accountChart:Kx,minWpm:Vx,minWpmCustomSpeed:mT,highlightMode:Qx,tapeMode:Zx,tapeMargin:Yx,typingSpeedUnit:Xx,ads:Jx,hideExtraLetters:o.boolean(),strictSpace:o.boolean(),minAcc:eT,minAccCustom:fT,monkey:o.boolean(),repeatQuotes:tT,oppositeShiftMode:aT,customBackground:CT,customBackgroundSize:oT,customBackgroundFilter:sT,customLayoutfluid:nT,monkeyPowerLevel:rT,minBurst:lT,minBurstCustomSpeed:pT,burstHeatmap:o.boolean(),britishEnglish:o.boolean(),lazyMode:o.boolean(),showAverage:cT,maxLineWidth:kT,customPolyglot:iT}).strict(),lf=ST.partial(),pg=o.enum(["test","behavior","input","sound","caret","appearance","theme","hideElements","ads","hidden"]),xT=Fo(lf),gg=xt(),TT=gg.router({get:{summary:"get config",description:"Get config of the current user.",method:"GET",path:"",responses:{200:xT},metadata:{rateLimit:"configGet"}},save:{summary:"update config",description:"Update the config of the current user. Only provided values will be updated while the missing values will be unchanged.",method:"PATCH",path:"",body:lf.strict(),responses:{200:X},metadata:{rateLimit:"configUpdate"}},delete:{summary:"delete config",description:"Delete/reset the config for the current user.",method:"DELETE",path:"",body:gg.noBody(),responses:{200:X},metadata:{rateLimit:"configDelete"}}},{pathPrefix:"/configs",strictStatusCodes:!0,metadata:{openApiTags:"configs"},commonResponses:Yt}),$T=o.string().regex(/^[0-9a-zA-Z_-]+$/).max(16);o.enum(["full","partial"]);var LT=o.array(pg).min(1).superRefine((e,t)=>{pg.options.forEach(a=>{e.filter(s=>s===a).length>1&&t.addIssue({code:o.ZodIssueCode.custom,message:"No duplicates allowed."})})}),cf=o.object({_id:pe,name:$T,settingGroups:LT.nullable().optional(),config:lf.extend({tags:o.array(lx).optional()})}),AT=cf.partial({config:!0,settingGroups:!0}),MT=ue(o.array(cf)),ET=cf.omit({_id:!0}),PT=ue(o.object({presetId:pe})),IT=o.object({presetId:pe}),hg=xt(),qT=hg.router({get:{summary:"get presets",description:"Get presets of the current user.",method:"GET",path:"",responses:{200:MT},metadata:{rateLimit:"presetsGet"}},add:{summary:"add preset",description:"Add a new preset for the current user.",method:"POST",path:"",body:ET.strict(),responses:{200:PT},metadata:{rateLimit:"presetsAdd"}},save:{summary:"update preset",description:"Update an existing preset for the current user.",method:"PATCH",path:"",body:AT.strict(),responses:{200:X},metadata:{rateLimit:"presetsEdit"}},delete:{summary:"delete preset",description:"Delete preset by id.",method:"DELETE",path:"/:presetId",pathParams:IT,body:hg.noBody(),responses:{200:X},metadata:{rateLimit:"presetsRemove"}}},{pathPrefix:"/presets",strictStatusCodes:!0,metadata:{openApiTags:"presets"},commonResponses:Yt}),Wy=o.object({_id:pe,message:o.string(),date:o.number().int().min(0).optional(),level:o.number().int().optional(),sticky:o.boolean().optional()}),BT=ue(o.array(Wy)),DT=xt(),FT=DT.router({get:{summary:"get psas",description:"Get list of public service announcements",method:"GET",path:"",responses:{200:BT}}},{pathPrefix:"/psas",strictStatusCodes:!0,metadata:{openApiTags:"psas",authenticationOptions:{isPublic:!0},rateLimit:"psaGet"},commonResponses:Yt}),WT=o.record(Xa,o.number().int()),zT=o.object({timeTyping:o.number().nonnegative(),testsCompleted:o.number().int().nonnegative(),testsStarted:o.number().int().nonnegative()}),RT=o.object({language:Ye,mode:ms,mode2:on}).strict(),OT=ue(WT),_T=ue(zT),HT=xt(),jT=HT.router({getSpeedHistogram:{summary:"get speed histogram",description:"get number of users personal bests grouped by wpm level (multiples of ten)",method:"GET",path:"/speedHistogram",query:RT,responses:{200:OT}},getTypingStats:{summary:"get typing stats",description:"get number of tests and time users spend typing.",method:"GET",path:"/typingStats",responses:{200:_T}}},{pathPrefix:"/public",strictStatusCodes:!0,metadata:{openApiTags:"public",authenticationOptions:{isPublic:!0},rateLimit:"publicStatsGet"},commonResponses:Yt}),dd=o.object({wpm:o.number().nonnegative(),acc:o.number().nonnegative().min(0).max(100),timestamp:o.number().int().nonnegative(),raw:o.number().nonnegative(),consistency:o.number().nonnegative().optional(),uid:o.string(),name:o.string(),discordId:o.string().optional(),discordAvatar:o.string().optional(),rank:o.number().nonnegative().int(),badgeId:o.number().int().optional(),isPremium:o.boolean().optional()}),zy=o.object({uid:o.string(),name:o.string(),discordId:o.string().optional(),discordAvatar:o.string().optional(),badgeId:o.number().int().optional(),lastActivityTimestamp:o.number().int().nonnegative(),timeTypedSeconds:o.number().nonnegative(),rank:o.number().nonnegative().int(),totalXp:o.number().nonnegative().int(),isPremium:o.boolean().optional()}),df=o.object({language:Ye,mode:ms,mode2:on}),uf=o.object({page:o.number().int().safe().nonnegative().default(0),pageSize:o.number().int().safe().positive().min(10).max(200).default(50)}),mf=o.object({count:o.number().int().nonnegative(),pageSize:o.number().int().positive()}),NT=df.merge(uf),GT=ue(mf.extend({entries:o.array(dd)})),UT=df,KT=Fo(dd),Ry=df.extend({daysBefore:o.literal(1).optional()}),VT=Ry.merge(uf),QT=ue(mf.extend({entries:o.array(dd),minWpm:o.number().nonnegative()})),ZT=Ry,YT=Fo(dd),Oy=o.object({weeksBefore:o.literal(1).optional()}),XT=Oy.merge(uf),JT=ue(mf.extend({entries:o.array(zy)})),e$=Oy,t$=Fo(zy),a$=xt(),o$=a$.router({get:{summary:"get leaderboard",description:"Get all-time leaderboard.",method:"GET",path:"",query:NT.strict(),responses:{200:GT},metadata:{authenticationOptions:{isPublic:!0}}},getRank:{summary:"get leaderboard rank",description:"Get the rank of the current user on the all-time leaderboard",method:"GET",path:"/rank",query:UT.strict(),responses:{200:KT},metadata:{authenticationOptions:{acceptApeKeys:!0}}},getDaily:{summary:"get daily leaderboard",description:"Get daily leaderboard.",method:"GET",path:"/daily",query:VT.strict(),responses:{200:QT},metadata:{authenticationOptions:{isPublic:!0},requireConfiguration:{path:"dailyLeaderboards.enabled",invalidMessage:"Daily leaderboards are not available at this time."}}},getDailyRank:{summary:"get daily leaderboard rank",description:"Get the rank of the current user on the daily leaderboard",method:"GET",path:"/daily/rank",query:ZT.strict(),responses:{200:YT},metadata:{requireConfiguration:{path:"dailyLeaderboards.enabled",invalidMessage:"Daily leaderboards are not available at this time."}}},getWeeklyXp:{summary:"get weekly xp leaderboard",description:"Get weekly xp leaderboard",method:"GET",path:"/xp/weekly",query:XT.strict(),responses:{200:JT},metadata:{authenticationOptions:{isPublic:!0},requireConfiguration:{path:"leaderboards.weeklyXp.enabled",invalidMessage:"Weekly XP leaderboards are not available at this time."}}},getWeeklyXpRank:{summary:"get weekly xp leaderboard rank",description:"Get the rank of the current user on the weekly xp leaderboard",method:"GET",path:"/xp/weekly/rank",query:e$.strict(),responses:{200:t$},metadata:{requireConfiguration:{path:"leaderboards.weeklyXp.enabled",invalidMessage:"Weekly XP leaderboards are not available at this time."}}}},{pathPrefix:"/leaderboards",strictStatusCodes:!0,metadata:{openApiTags:"leaderboards",rateLimit:"leaderboardsGet"},commonResponses:Yt}),s$=o.object({acc:Yi,seconds:o.number().nonnegative()}),n$=o.object({wpm:o.array(o.number().nonnegative()).max(122),raw:o.array(o.number().nonnegative()).max(122),err:o.array(o.number().nonnegative()).max(122)}),yg=o.object({average:o.number().nonnegative(),sd:o.number().nonnegative()}),i$=o.object({textLen:o.number().int().nonnegative(),mode:cx,pipeDelimiter:o.boolean(),limit:o.object({mode:dx,value:o.number().nonnegative()})}),r$=o.tuple([o.number().int().nonnegative(),o.number().int().nonnegative(),o.number().int().nonnegative(),o.number().int().nonnegative()]),_y=o.object({wpm:dg,rawWpm:dg,charStats:r$,acc:Yi.min(50),mode:ms,mode2:on,quoteLength:o.number().int().nonnegative().max(3).optional(),timestamp:o.number().int().nonnegative(),testDuration:o.number().min(1),consistency:Yi,keyConsistency:Yi,chartData:n$.or(o.literal("toolong")),uid:pe,restartCount:o.number().int().nonnegative().optional(),incompleteTestSeconds:o.number().nonnegative().optional(),afkDuration:o.number().nonnegative().optional(),tags:o.array(pe).optional(),bailedOut:o.boolean().optional(),blindMode:o.boolean().optional(),lazyMode:o.boolean().optional(),funbox:Fy.optional(),language:Ye.optional(),difficulty:Dy.optional(),numbers:o.boolean().optional(),punctuation:o.boolean().optional()}),ff=_y.extend({_id:pe,keySpacingStats:yg.optional(),keyDurationStats:yg.optional(),name:o.string(),isPb:o.boolean().optional()}),l$=ff.omit({name:!0,keySpacingStats:!0,keyDurationStats:!0,chartData:!0}),c$=_y.required({restartCount:!0,incompleteTestSeconds:!0,afkDuration:!0,tags:!0,bailedOut:!0,blindMode:!0,lazyMode:!0,funbox:!0,language:!0,difficulty:!0,numbers:!0,punctuation:!0}).extend({charTotal:o.number().int().nonnegative(),challenge:Vn().max(100).optional(),customText:i$.optional(),hash:Vn().max(100),keyDuration:o.array(o.number().nonnegative()).or(o.literal("toolong")),keySpacing:o.array(o.number().nonnegative()).or(o.literal("toolong")),keyOverlap:o.number().nonnegative(),lastKeyToEnd:o.number().nonnegative(),startToFirstKey:o.number().nonnegative(),wpmConsistency:Yi,stopOnLetter:o.boolean(),incompleteTests:o.array(s$)}).strict(),d$=o.object({base:o.number().int().optional(),fullAccuracy:o.number().int().optional(),quote:o.number().int().optional(),corrected:o.number().int().optional(),punctuation:o.number().int().optional(),numbers:o.number().int().optional(),funbox:o.number().int().optional(),streak:o.number().int().optional(),incomplete:o.number().int().optional(),daily:o.number().int().optional(),accPenalty:o.number().int().optional(),configMultiplier:o.number().int().optional()}),u$=o.object({insertedId:pe,isPb:o.boolean(),tagPbs:o.array(pe),dailyLeaderboardRank:o.number().int().nonnegative().optional(),weeklyXpLeaderboardRank:o.number().int().nonnegative().optional(),xp:o.number().int().nonnegative(),dailyXpBonus:o.boolean(),xpBreakdown:d$,streak:o.number().int().nonnegative()}),m$=o.object({onOrAfterTimestamp:o.number().int().min(15894288e5).optional().describe("Timestamp of the earliest result to fetch. If omitted the most recent results are fetched."),offset:o.number().int().nonnegative().optional().describe("Offset of the item at which to begin the response."),limit:o.number().int().nonnegative().max(1e3).optional().describe("Limit results to the given amount.")}),f$=ue(o.array(l$)),p$=o.object({resultId:pe}),g$=ue(ff),h$=o.object({result:c$}),y$=ue(u$),b$=o.object({tagIds:o.array(pe),resultId:pe}),v$=ue(o.object({tagPbs:o.array(pe)})),w$=ue(ff),bg=xt(),k$=bg.router({get:{summary:"get results",description:"Gets up to 1000 results",method:"GET",path:"",query:m$.strict(),responses:{200:f$},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:{normal:"resultsGet",apeKey:"resultsGetApe"}}},getById:{summary:"get result by id",description:"Get result by id",method:"GET",path:"/id/:resultId",pathParams:p$,responses:{200:g$},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:{normal:"resultByIdGet",apeKey:"resultByIdGetApe"}}},add:{summary:"add result",description:"Add a test result for the current user",method:"POST",path:"",body:h$.strict(),responses:{200:y$},metadata:{rateLimit:"resultsAdd",requireConfiguration:{path:"results.savingEnabled",invalidMessage:"Results are not being saved at this time."}}},updateTags:{summary:"update result tags",description:"Labels a result with the specified tags",method:"PATCH",path:"/tags",body:b$.strict(),responses:{200:v$},metadata:{rateLimit:"resultsTagsUpdate"}},deleteAll:{summary:"delete all results",description:"Delete all results for the current user",method:"DELETE",path:"",body:bg.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"resultsDeleteAll"}},getLast:{summary:"get last result",description:"Gets a user's last saved result",path:"/last",method:"GET",responses:{200:w$},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"resultsGet"}}},{pathPrefix:"/results",strictStatusCodes:!0,metadata:{openApiTags:"results"},commonResponses:Yt}),vg=o.object({language:o.string(),mode:o.string(),mode2:o.string()}).strict(),wg=o.object({minRank:o.number().int().nonnegative(),maxRank:o.number().int().nonnegative(),minReward:o.number().int().nonnegative(),maxReward:o.number().int().nonnegative()}).strict(),Hy=o.object({maintenance:o.boolean(),dev:o.object({responseSlowdownMs:o.number().int().nonnegative()}),quotes:o.object({reporting:o.object({enabled:o.boolean(),maxReports:o.number().int().nonnegative(),contentReportLimit:o.number().int().nonnegative()}),submissionsEnabled:o.boolean(),maxFavorites:o.number().int().nonnegative()}),results:o.object({savingEnabled:o.boolean(),objectHashCheckEnabled:o.boolean(),filterPresets:o.object({enabled:o.boolean(),maxPresetsPerUser:o.number().int().nonnegative()}),limits:o.object({regularUser:o.number().int().nonnegative(),premiumUser:o.number().int().nonnegative()}),maxBatchSize:o.number().int().nonnegative()}),users:o.object({signUp:o.boolean(),lastHashesCheck:o.object({enabled:o.boolean(),maxHashes:o.number().int().nonnegative()}),autoBan:o.object({enabled:o.boolean(),maxCount:o.number().int().nonnegative(),maxHours:o.number().int().nonnegative()}),profiles:o.object({enabled:o.boolean()}),discordIntegration:o.object({enabled:o.boolean()}),xp:o.object({enabled:o.boolean(),funboxBonus:o.number(),gainMultiplier:o.number(),maxDailyBonus:o.number(),minDailyBonus:o.number(),streak:o.object({enabled:o.boolean(),maxStreakDays:o.number().nonnegative(),maxStreakMultiplier:o.number()})}),inbox:o.object({enabled:o.boolean(),maxMail:o.number().int().nonnegative()}),premium:o.object({enabled:o.boolean()})}),admin:o.object({endpointsEnabled:o.boolean()}),apeKeys:o.object({endpointsEnabled:o.boolean(),acceptKeys:o.boolean(),maxKeysPerUser:o.number().int().nonnegative(),apeKeyBytes:o.number().int().nonnegative(),apeKeySaltRounds:o.number().int().nonnegative()}),rateLimiting:o.object({badAuthentication:o.object({enabled:o.boolean(),penalty:o.number(),flaggedStatusCodes:o.array(o.number().int().nonnegative())})}),dailyLeaderboards:o.object({enabled:o.boolean(),leaderboardExpirationTimeInDays:o.number().nonnegative(),maxResults:o.number().int().nonnegative(),validModeRules:o.array(vg),scheduleRewardsModeRules:o.array(vg),topResultsToAnnounce:o.number().int().positive(),xpRewardBrackets:o.array(wg)}),leaderboards:o.object({minTimeTyping:o.number().min(0).describe("Minimum typing time (in seconds) the user needs to get on a leaderboard"),weeklyXp:o.object({enabled:o.boolean(),expirationTimeInDays:o.number().nonnegative(),xpRewardBrackets:o.array(wg)})})}),C$=ue(Hy),S$=Hy.deepPartial(),x$=o.object({configuration:S$.strict()}).strict(),T$=ue(o.object({})),$$=xt(),L$=$$.router({get:{summary:"get configuration",description:"Get server configuration",method:"GET",path:"",responses:{200:C$},metadata:{authenticationOptions:{isPublic:!0}}},update:{summary:"update configuration",description:"Update the server configuration. Only provided values will be updated while the missing values will be unchanged.",method:"PATCH",path:"",body:x$,responses:{200:X},metadata:{authenticationOptions:{noCache:!0,isPublicOnDev:!0},rateLimit:"adminLimit",requirePermission:"admin"}},getSchema:{summary:"get configuration schema",description:"Get schema definition of the server configuration.",method:"GET",path:"/schema",responses:{200:T$},metadata:{authenticationOptions:{isPublicOnDev:!0,noCache:!0},rateLimit:"adminLimit",requirePermission:"admin"}}},{pathPrefix:"/configuration",strictStatusCodes:!0,metadata:{openApiTags:"configuration"},commonResponses:Yt}),A$=o.object({username:o.string(),createUser:o.boolean().optional().describe("If `true` create user with <username>@example.com and password `password`. If false user has to exist."),firstTestTimestamp:o.number().int().nonnegative().optional(),lastTestTimestamp:o.number().int().nonnegative().optional(),minTestsPerDay:o.number().int().nonnegative().optional(),maxTestsPerDay:o.number().int().nonnegative().optional()}),M$=ue(o.object({uid:pe,email:o.string().email()})),E$=xt(),P$=E$.router({generateData:{summary:"generate data",description:"Generate test results for the given user.",method:"POST",path:"/generateData",body:A$.strict(),responses:{200:M$}}},{pathPrefix:"/dev",strictStatusCodes:!0,metadata:{openApiTags:"development",authenticationOptions:{isPublicOnDev:!0}},commonResponses:Yt}),kg={a:["а","à","á","ạ","ą"],c:["с","ƈ","ċ"],d:["ԁ","ɗ"],e:["е","ẹ","ė","ė","é","è"],g:["ġ"],h:["һ"],i:["і","í","ì","ï"],j:["ј","ʝ"],k:["κ"],l:["ӏ","ḷ"],n:["ո"],o:["о","ο","օ","ȯ","ọ","ỏ","ơ","ö","ó","ò"],p:["р"],q:["զ"],s:["ʂ"],u:["υ","ս","ü","ú","ù"],v:["ν","ѵ"],x:["х","ҳ"],y:["у","ý"],z:["ʐ","ż"]};function I$(e){for(let t in kg)kg[t].forEach(a=>{e=e.replace(a,t)});return e}function q$(e,t){let a=e.toLowerCase().split(/[.,"/#!?$%^&*;:{}=\-_`~()\s\n]+/g).map(s=>{var i;return I$((i=B$(s))!=null?i:"")});return D$.some(s=>a.some(i=>t==="word"?i.startsWith(s):i.includes(s)))}function B$(e){return e===void 0||e===""?e:e.replace(/[\u0300-\u036F]/g,"").trim().replace(/\n{3,}/g,`

`).replace(/\s{3,}/g,"  ")}function jy(e,t){return t.refine(a=>!q$(a,e),a=>({message:`Profanity detected. Please remove it. If you believe this is a mistake, please contact us. (${a})`}))}var D$=["miodec","bitly","niqqa","niqqer","ni99a","ni99er","niggas","niga","niger","retard","ahole","anus","ash0le","asholes","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","biatch","bitch","bitches","blow job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","carpet muncher","cawk","cawks","clit","cnts","cntz","cock","cockhead","cock-head","cocks","cocksucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagit","fags","fagz","faigs","flipping the bird","fudge packer","fukah","fuken","fuker","fukin","fukk","fukkah","fukken","fukker","fukkin","g00k","gayboy","gaygirl","gayz","god-damned","h00r","h0ar","h0re","jackoff","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","lezzian","lipshits","lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","phuc","phuck","phuk","phuker","phukker","poonani","pr1c","pr1ck","pr1k","puss","pussee","pussy","puuke","puuker","qweers","qweerz","qweir","recktum","rectum","retard","sadist","scank","schlong","semen","sex","sexy","sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","shitty","shity","shitz","shyt","shyte","shytty","shyty","skanck","skank","skankee","skankey","skanks","skanky","slut","sluts","slutty","slutz","son-of-a-bitch","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","wh00r","wh0re","whore","xrated","b!+ch","bitch","blowjob","clit","arschloch","shit","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","dyke","fuck","shit","amcik","andskota","arse","assrammer","ayir","bi7ch","bitch","bollock","breasts","butt-pirate","cabron","cazzo","chraa","chuj","cunt","daygo","dego","dick","dike","dupa","dziwka","ejackulate","ekrem","enculer","fag","fanculo","fanny","feces","felcher","ficken","flikker","foreskin","fotze","futkretzn","gook","guiena","h4x0r","helvete","hoer","honkey","huevon","injun","jizz","kanker","klootzak","kraut","knulle","kuksuger","kurac","kurwa","kusi","kyrpa","lesbo","mamhoon","masturbat","merd","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger","orospu","paska","perse","picka","pierdol","pillu","pimmel","piss","pizda","poontsee","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef","rautenberg","schaffer","scheiss","schlampe","schmuck","sh!t","sharmuta","sharmute","skurwysyn","sphencter","spierdalaj","splooge","suka","b00b","testicle","titt","twat","vittu","wank","wetback","wichser","zabourah"],Ny=o.object({_id:pe,name:o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),pb:o.object({no:o.boolean(),yes:o.boolean()}).strict(),difficulty:o.record(nf,o.boolean()),mode:o.record(ms,o.boolean()),words:o.record(Sx.or(o.literal("custom")),o.boolean()),time:o.record(xx.or(o.literal("custom")),o.boolean()),quoteLength:o.record(Tx,o.boolean()),punctuation:o.object({on:o.boolean(),off:o.boolean()}).strict(),numbers:o.object({on:o.boolean(),off:o.boolean()}).strict(),date:o.object({last_day:o.boolean(),last_week:o.boolean(),last_month:o.boolean(),last_3months:o.boolean(),all:o.boolean()}).strict(),tags:o.record(o.string(),o.boolean()),language:o.record(Ye,o.boolean()),funbox:o.record(o.string(),o.boolean())}),Gy=o.number().int().min(-11).max(12),Uy=o.object({lastResultTimestamp:o.number().int().nonnegative(),length:o.number().int().nonnegative(),maxLength:o.number().int().nonnegative(),hourOffset:Gy.optional()}).strict(),pf=o.object({_id:pe,name:o.string(),personalBests:cd}).strict();function Ti(e){return jy("word",e).optional().transform(t=>t===null?void 0:t)}var ud=o.object({bio:Ti(o.string().max(250)).or(o.literal("")),keyboard:Ti(o.string().max(75)).or(o.literal("")),socialProfiles:o.object({twitter:Ti(o.string().max(20).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),github:Ti(o.string().max(39).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),website:Ti(o.string().url().max(200).startsWith("https://")).or(o.literal(""))}).strict().optional()}).strict(),Ky=o.string().regex(/^[0-9a-zA-Z_-]+$/).max(16),md=o.object({_id:pe,name:Ky,colors:rf}).strict(),F$=o.object({startTimestamp:o.number().int().nonnegative(),expirationTimestamp:o.number().int().nonnegative().or(o.literal(-1).describe("lifetime premium"))}),W$=o.record(Ye,o.record(Xa.describe("quoteId as string"),o.number().nonnegative())),z$=o.record(ms,o.record(on,o.record(Ye,o.number().int().nonnegative()))),R$=o.object({rank:o.number().int().nonnegative().optional(),count:o.number().int().nonnegative()}),O$=o.object({time:o.record(on,o.record(Ye,R$.optional()))}),Vy=o.object({id:o.number().int().nonnegative(),selected:o.boolean().optional()}).strict(),_$=o.object({badges:o.array(Vy)}).strict(),H$=o.boolean().describe("Admin for all languages if true").or(Ye.describe("Admin for the given language")),Qy=o.object({testsByDays:o.array(o.number().int().nonnegative().or(o.null())).describe("Number of tests by day. Last element of the array is on the date `lastDay`. `null` means no tests on that day."),lastDay:o.number().int().nonnegative().describe("Timestamp of the last day included in the test activity")}).strict(),j$=o.record(Xa.describe("year"),o.array(o.number().int().nonnegative().nullable().describe("number of tests, position in the array is the day of the year"))),Zy=o.record(Ye,o.array(Xa)),fd=o.object({name:o.string(),email:o.string().email(),uid:o.string(),addedAt:o.number().int().nonnegative(),personalBests:cd,lastReultHashes:o.array(o.string()).optional(),completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().nonnegative().optional().describe("time typing in seconds"),streak:Uy.optional(),xp:o.number().int().nonnegative().optional(),discordId:o.string().optional(),discordAvatar:o.string().optional(),tags:o.array(pf).optional(),profileDetails:ud.optional(),customThemes:o.array(md).optional(),premium:F$.optional(),isPremium:o.boolean().optional(),quoteRatings:W$.optional(),favoriteQuotes:Zy.optional(),lbMemory:z$.optional(),allTimeLbs:O$,inventory:_$.optional(),banned:o.boolean().optional(),lbOptOut:o.boolean().optional(),verified:o.boolean().optional(),needsToChangeName:o.boolean().optional(),quoteMod:H$.optional(),resultFilterPresets:o.array(Ny).optional(),testActivity:Qy.optional()}),Yy=o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),N$=o.object({completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().int().nonnegative().optional()}),G$=fd.pick({uid:!0,name:!0,banned:!0,addedAt:!0,discordId:!0,discordAvatar:!0,xp:!0,lbOptOut:!0,isPremium:!0,inventory:!0,allTimeLbs:!0}).extend({typingStats:N$,personalBests:cd.pick({time:!0,words:!0}),streak:o.number().int().nonnegative(),maxStreak:o.number().int().nonnegative(),details:ud}).partial({inventory:!0,details:!0,allTimeLbs:!0,uid:!0}),Xy=o.enum(["xp","badge"]),U$=o.object({type:o.literal(Xy.enum.xp),item:o.number().int()}),K$=o.object({type:o.literal(Xy.enum.badge),item:Vy}),V$=U$.or(K$),Q$=o.object({id:pe,subject:o.string(),body:o.string(),timestamp:o.number().int().nonnegative(),read:o.boolean(),rewards:o.array(V$)}),Z$=o.enum(["Inappropriate name","Inappropriate bio","Inappropriate social links","Suspected cheating"]),wc=o.string().email(),Y$=ue(fd.extend({inboxUnreadSize:o.number().int().nonnegative()})),gf=jy("substring",o.string().min(1).max(16).regex(/^[\da-zA-Z_-]+$/,"Can only contain lower/uppercase letters, underscore and minus.")),X$=o.object({email:wc.optional(),name:gf,uid:o.string().optional(),captcha:o.string()}),J$=o.object({name:gf}),eL=o.object({name:gf}),tL=o.object({mode:ms,mode2:on,language:Ye,rank:o.number().int().nonnegative()}),aL=o.object({newEmail:wc,previousEmail:wc}),oL=o.object({newPassword:o.string().min(6)}),sL=o.object({mode:ms,mode2:on.optional()}),nL=Fo(kn),iL=Ny,rL=ue(pe.describe("Id of the created result filter preset")),lL=o.object({presetId:pe}),cL=ue(o.array(pf)),dL=o.object({tagName:Yy}),uL=ue(pf),mL=o.object({tagId:pe,newName:Yy}),Cg=o.object({tagId:pe}),fL=ue(o.array(md)),pL=o.object({name:Ky,colors:rf}),gL=ue(md.pick({_id:!0,name:!0})),hL=o.object({themeId:pe}),yL=o.object({themeId:pe,theme:md.pick({name:!0,colors:!0})}),bL=ue(o.object({url:o.string().url()})),vL=o.object({tokenType:o.string(),accessToken:o.string(),state:o.string().length(20)}),wL=ue(fd.pick({discordId:!0,discordAvatar:!0})),kL=ue(fd.pick({completedTests:!0,startedTests:!0,timeTyping:!0})),CL=o.object({hourOffset:Gy}),SL=ue(Zy),xL=o.object({language:Ye,quoteId:Xa}),TL=o.object({language:Ye,quoteId:Xa}),$L=o.object({uidOrName:o.string()}),LL=o.object({isUid:o.string().length(0).transform(e=>e==="").or(o.boolean()).default(!1)}),AL=ue(G$),ML=ud.extend({selectedBadgeId:o.number().int().nonnegative().optional().or(o.literal(-1).describe("no badge selected"))}),EL=ue(ud),PL=ue(o.object({inbox:o.array(Q$),maxMail:o.number().int()})),IL=o.object({mailIdsToDelete:o.array(o.string().uuid()).min(1).optional(),mailIdsToMarkRead:o.array(o.string().uuid()).min(1).optional()}),qL=o.object({uid:o.string(),reason:Z$,comment:o.string().regex(/^([.]|[^/<>])+$/).max(250).optional().or(o.string().length(0)),captcha:o.string()}),BL=o.object({captcha:o.string(),email:wc}),DL=Fo(j$),FL=Fo(Qy),WL=Fo(Uy),Ba=xt(),zL=Ba.router({get:{summary:"get user",description:"Get a user's data.",method:"GET",path:"",responses:{200:Y$},metadata:{rateLimit:"userGet"}},create:{summary:"create user",description:"Creates a new user",method:"POST",path:"/signup",body:X$.strict(),responses:{200:X},metadata:{rateLimit:"userSignup",requireConfiguration:{path:"users.signUp",invalidMessage:"Sign up is temporarily disabled"}}},getNameAvailability:{summary:"check name",description:"Checks to see if a username is available",method:"GET",path:"/checkName/:name",pathParams:J$.strict(),responses:{200:X.describe("Name is available"),409:X.describe("Name is not available")},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userCheckName"}},delete:{summary:"delete user",description:"Deletes a user's account",method:"DELETE",path:"",body:Ba.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userDelete"}},reset:{summary:"reset user",description:"Completely resets a user's account to a blank state",method:"PATCH",path:"/reset",body:Ba.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userReset"}},updateName:{summary:"update username",description:"Updates a user's name",method:"PATCH",path:"/name",body:eL.strict(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateName"}},updateLeaderboardMemory:{summary:"update lbMemory",description:"Updates a user's cached leaderboard state",method:"PATCH",path:"/leaderboardMemory",body:tL.strict(),responses:{200:X},metadata:{rateLimit:"userUpdateLBMemory"}},updateEmail:{summary:"update email",description:"Updates a user's email",method:"PATCH",path:"/email",body:aL.strict(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateEmail"}},updatePassword:{summary:"update password",description:"Updates a user's email",method:"PATCH",path:"/password",body:oL.strict(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateEmail"}},getPersonalBests:{summary:"get personal bests",description:"Get user's personal bests",method:"GET",path:"/personalBests",query:sL.strict(),responses:{200:nL},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userGet"}},deletePersonalBests:{summary:"delete personal bests",description:"Deletes a user's personal bests",method:"DELETE",path:"/personalBests",body:Ba.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userClearPB"}},optOutOfLeaderboards:{summary:"leaderboards opt out",description:"Opt out of the leaderboards",method:"POST",path:"/optOutOfLeaderboards",body:Ba.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userOptOutOfLeaderboards"}},addResultFilterPreset:{summary:"add result filter preset",description:"Add a result filter preset",method:"POST",path:"/resultFilterPresets",body:iL.strict(),responses:{200:rL},metadata:{rateLimit:"userCustomFilterAdd",requireConfiguration:{path:"results.filterPresets.enabled",invalidMessage:"Result filter presets are not available at this time."}}},removeResultFilterPreset:{summary:"remove result filter preset",description:"Remove a result filter preset",method:"DELETE",path:"/resultFilterPresets/:presetId",pathParams:lL.strict(),body:Ba.noBody(),responses:{200:X},metadata:{rateLimit:"userCustomFilterRemove",requireConfiguration:{path:"results.filterPresets.enabled",invalidMessage:"Result filter presets are not available at this time."}}},getTags:{summary:"get tags",description:"Get the users tags",method:"GET",path:"/tags",responses:{200:cL},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userTagsGet"}},createTag:{summary:"add tag",description:"Add a tag for the current user",method:"POST",path:"/tags",body:dL.strict(),responses:{200:uL},metadata:{rateLimit:"userTagsAdd"}},editTag:{summary:"edit tag",description:"Edit a tag",method:"PATCH",path:"/tags",body:mL.strict(),responses:{200:X},metadata:{rateLimit:"userTagsEdit"}},deleteTag:{summary:"delete tag",description:"Delete a tag",method:"DELETE",path:"/tags/:tagId",pathParams:Cg.strict(),body:Ba.noBody(),responses:{200:X},metadata:{rateLimit:"userTagsRemove"}},deleteTagPersonalBest:{summary:"delete tag PBs",description:"Delete personal bests of a tag",method:"DELETE",path:"/tags/:tagId/personalBest",pathParams:Cg.strict(),body:Ba.noBody(),responses:{200:X},metadata:{rateLimit:"userTagsClearPB"}},getCustomThemes:{summary:"get custom themes",description:"Get custom themes for the current user",method:"GET",path:"/customThemes",responses:{200:fL},metadata:{rateLimit:"userCustomThemeGet"}},addCustomTheme:{summary:"add custom themes",description:"Add a custom theme for the current user",method:"POST",path:"/customThemes",body:pL.strict(),responses:{200:gL},metadata:{rateLimit:"userCustomThemeAdd"}},deleteCustomTheme:{summary:"delete custom themes",description:"Delete a custom theme",method:"DELETE",path:"/customThemes",body:hL.strict(),responses:{200:X},metadata:{rateLimit:"userCustomThemeRemove"}},editCustomTheme:{summary:"edit custom themes",description:"Edit a custom theme",method:"PATCH",path:"/customThemes",body:yL.strict(),responses:{200:X},metadata:{rateLimit:"userCustomThemeEdit"}},getDiscordOAuth:{summary:"discord oauth",description:"Start OAuth authentication with discord",method:"GET",path:"/discord/oauth",responses:{200:bL},metadata:{rateLimit:"userDiscordLink",requireConfiguration:{path:"users.discordIntegration.enabled",invalidMessage:"Discord integration is not available at this time"}}},linkDiscord:{summary:"link with discord",description:"Links a user's account with a discord account",method:"POST",path:"/discord/link",body:vL.strict(),responses:{200:wL},metadata:{rateLimit:"userDiscordLink",requireConfiguration:{path:"users.discordIntegration.enabled",invalidMessage:"Discord integration is not available at this time"}}},unlinkDiscord:{summary:"unlink discord",description:"Unlinks a user's account with a discord account",method:"POST",path:"/discord/unlink",body:Ba.noBody(),responses:{200:X},metadata:{rateLimit:"userDiscordUnlink"}},getStats:{summary:"get stats",description:"Gets a user's typing stats data",method:"GET",path:"/stats",responses:{200:kL},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userGet"}},setStreakHourOffset:{summary:"set streak hour offset",description:"Sets a user's streak hour offset",method:"POST",path:"/setStreakHourOffset",body:CL.strict(),responses:{200:X},metadata:{rateLimit:"setStreakHourOffset"}},getFavoriteQuotes:{summary:"get favorite quotes",description:"Gets a user's favorite quotes",method:"GET",path:"/favoriteQuotes",responses:{200:SL},metadata:{rateLimit:"quoteFavoriteGet"}},addQuoteToFavorites:{summary:"add favorite quotes",description:"Add a quote to the user's favorite quotes",method:"POST",path:"/favoriteQuotes",body:xL.strict(),responses:{200:X},metadata:{rateLimit:"quoteFavoritePost"}},removeQuoteFromFavorites:{summary:"remove favorite quotes",description:"Remove a quote to the user's favorite quotes",method:"DELETE",path:"/favoriteQuotes",body:TL.strict(),responses:{200:X},metadata:{rateLimit:"quoteFavoriteDelete"}},getProfile:{summary:"get profile",description:"Gets a user's profile",method:"GET",path:"/:uidOrName/profile",pathParams:$L.strict(),query:LL.strict(),responses:{200:AL,404:$n.describe("User not found")},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userProfileGet",requireConfiguration:{path:"users.profiles.enabled",invalidMessage:"Profiles are not available at this time"}}},updateProfile:{summary:"update profile",description:"Update a user's profile",method:"PATCH",path:"/profile",body:ML.strict(),responses:{200:EL},metadata:{rateLimit:"userProfileUpdate",requireConfiguration:{path:"users.profiles.enabled",invalidMessage:"Profiles are not available at this time"}}},getInbox:{summary:"get inbox",description:"Gets the user's inbox",method:"GET",path:"/inbox",responses:{200:PL},metadata:{rateLimit:"userMailGet",requireConfiguration:{path:"users.inbox.enabled",invalidMessage:"Your inbox is not available at this time."}}},updateInbox:{summary:"update inbox",description:"Updates the user's inbox",method:"PATCH",body:IL.strict(),path:"/inbox",responses:{200:X},metadata:{rateLimit:"userMailUpdate",requireConfiguration:{path:"users.inbox.enabled",invalidMessage:"Your inbox is not available at this time."}}},report:{summary:"report user",description:"Report a user",method:"POST",path:"/report",body:qL.strict(),responses:{200:X},metadata:{rateLimit:"quoteReportSubmit",requirePermission:"canReport",requireConfiguration:{path:"quotes.reporting.enabled",invalidMessage:"User reporting is unavailable."}}},verificationEmail:{summary:"send verification email",description:"Send a verification email",method:"GET",path:"/verificationEmail",responses:{200:X},metadata:{authenticationOptions:{noCache:!0},rateLimit:"userRequestVerificationEmail"}},forgotPasswordEmail:{summary:"send forgot password email",description:"Send a forgot password email",method:"POST",path:"/forgotPasswordEmail",body:BL.strict(),responses:{200:X},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userForgotPasswordEmail"}},revokeAllTokens:{summary:"revoke all tokens",description:"Revoke all tokens for the current user.",method:"POST",path:"/revokeAllTokens",body:Ba.noBody(),responses:{200:X},metadata:{authenticationOptions:{requireFreshToken:!0,noCache:!0},rateLimit:"userRevokeAllTokens"}},getTestActivity:{summary:"get test activity",description:"Get user's test activity",method:"GET",path:"/testActivity",responses:{200:DL},metadata:{rateLimit:"userTestActivity"}},getCurrentTestActivity:{summary:"get current test activity",description:"Get test activity for the last up to 372 days for the current user ",method:"GET",path:"/currentTestActivity",responses:{200:FL},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userCurrentTestActivity"}},getStreak:{summary:"get streak",description:"Get user's streak data",method:"GET",path:"/streak",responses:{200:WL},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userStreak"}}},{pathPrefix:"/users",strictStatusCodes:!0,metadata:{openApiTags:"users"},commonResponses:Yt}),Yr=o.number().int().nonnegative().or(o.string().regex(/^\d+$/).transform(Number)),RL=o.object({id:Yr.optional(),text:o.string(),source:o.string(),length:o.number().int().positive(),approvedBy:o.string().describe("The approvers name")}),OL=o.object({_id:pe,text:o.string(),source:o.string(),language:Ye,submittedBy:pe.describe("uid of the submitter"),timestamp:o.number().int().nonnegative(),approved:o.boolean()}),_L=o.object({_id:pe,language:Ye,quoteId:Yr,average:o.number().nonnegative(),ratings:o.number().int().nonnegative(),totalRating:o.number().nonnegative()}),HL=o.enum(["Grammatical error","Duplicate quote","Inappropriate content","Low quality content","Incorrect source"]),jL=ue(o.array(OL)),NL=ue(o.object({isEnabled:o.boolean()})),GL=o.object({text:o.string().min(60),source:o.string(),language:Ye,captcha:o.string()}),UL=o.object({quoteId:pe,editText:cg,editSource:cg}),KL=ue(RL),VL=o.object({quoteId:pe}),QL=o.object({quoteId:Yr,language:Ye}),ZL=Fo(_L),YL=o.object({quoteId:Yr,language:Ye,rating:o.number().int().min(1).max(5)}),XL=o.object({quoteId:Yr,quoteLanguage:Ye,reason:HL,comment:o.string().regex(/^([.]|[^/<>])+$/).max(250).optional().or(o.string().length(0)),captcha:o.string()}),JL=xt(),eA=JL.router({get:{summary:"get quote submissions",description:"Get list of quote submissions",method:"GET",path:"",responses:{200:jL},metadata:{rateLimit:"newQuotesGet",requirePermission:"quoteMod"}},isSubmissionEnabled:{summary:"is submission enabled",description:"Check if submissions are enabled.",method:"GET",path:"/isSubmissionEnabled",responses:{200:NL},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"newQuotesIsSubmissionEnabled"}},add:{summary:"submit quote",description:"Add a quote submission",method:"POST",path:"",body:GL.strict(),responses:{200:X},metadata:{rateLimit:"newQuotesAdd",requireConfiguration:{path:"quotes.submissionsEnabled",invalidMessage:"Quote submission is disabled temporarily. The queue is quite long and we need some time to catch up."}}},approveSubmission:{summary:"submit quote",description:"Add a quote submission",method:"POST",path:"/approve",body:UL.strict(),responses:{200:KL},metadata:{rateLimit:"newQuotesAction",requirePermission:"quoteMod"}},rejectSubmission:{summary:"reject quote",description:"Reject a quote submission",method:"POST",path:"/reject",body:VL.strict(),responses:{200:X},metadata:{rateLimit:"newQuotesAction",requirePermission:"quoteMod"}},getRating:{summary:"get rating",description:"Get quote rating",method:"GET",path:"/rating",query:QL.strict(),responses:{200:ZL},metadata:{rateLimit:"quoteRatingsGet"}},addRating:{summary:"add rating",description:"Add a quote rating",method:"POST",path:"/rating",body:YL.strict(),responses:{200:X},metadata:{rateLimit:"quoteRatingsSubmit"}},report:{summary:"report quote",description:"Report a quote",method:"POST",path:"/report",body:XL.strict(),responses:{200:X},metadata:{rateLimit:"quoteReportSubmit",requirePermission:"canReport",requireConfiguration:{path:"quotes.reporting.enabled",invalidMessage:"Quote reporting is unavailable."}}}},{pathPrefix:"/quotes",strictStatusCodes:!0,metadata:{openApiTags:"quotes"},commonResponses:Yt}),tA=o.object({action:o.literal("published").or(o.string()),release:o.object({id:o.string().or(o.number().transform(String))}).optional()});ue(o.array(Wy));var aA=xt(),oA=aA.router({postGithubRelease:{summary:"Github release",description:"Announce github release.",method:"POST",path:"/githubRelease",body:tA,headers:o.object({"x-hub-signature-256":o.string()}),responses:{200:X}}},{pathPrefix:"/webhooks",strictStatusCodes:!0,metadata:{openApiTags:"webhooks",authenticationOptions:{isGithubWebhook:!0},rateLimit:"webhookLimit"},commonResponses:Yt}),sA=xt(),nA=sA.router({admin:yx,apeKeys:Cx,configs:TT,presets:qT,psas:FT,public:jT,leaderboards:o$,results:k$,configuration:L$,dev:P$,users:zL,quotes:eA,webhooks:oA}),Sg=1,iA="X-Compatibility-Check";let xg=!1;function rA(e){const t=new AbortController;return setTimeout(()=>t.abort(new Error("request timed out")),e),t.signal}function lA(e){return async t=>{try{if(j()){const l=await J1(ld());t.headers.Authorization=`Bearer ${l}`}const a=(AbortSignal==null?void 0:AbortSignal.timeout)===void 0;t.fetchOptions={...t.fetchOptions,signal:a?rA(e):AbortSignal.timeout(e)};const s=await eS(t);s.status>=400&&console.error(`${t.method} ${t.path} failed`,{status:s.status,...s.body});const i=s.headers.get(iA);if(i!==null&&!xg){const l=parseInt(i);if(l!==Sg){const c=l>Sg?'Looks like the client and server versions are mismatched (backend is newer). Please <a onClick="location.reload(true)">refresh</a> the page.':"Looks like our monkeys didn't deploy the new server version correctly. If this message persists contact support.";YS(c,1,void 0,!1,void 0,!0),xg=!0}}return s}catch(a){let s="Unknown error";return a instanceof Error&&(a.message.includes("timed out")?s="request took too long to complete":s=a.message),{status:500,body:{message:s},headers:new Headers}}}}function Jy(e,t,a=1e4){return X1(e,{baseUrl:t,jsonQuery:!0,api:lA(a),baseHeaders:{Accept:"application/json","X-Client-Version":Zr.clientVersion}})}var hf=o.object({message:o.string()}),cA=hf.extend({validationErrors:o.array(o.string())}),zi=hf,Tg=zi.extend({errorId:o.string(),uid:o.string().optional()});function dA(e){return hf.extend({data:e})}var uA={400:zi.describe("Generic client error"),401:zi.describe("Authentication required but not provided or invalid"),403:zi.describe("Operation not permitted"),422:cA.describe("Request validation failed"),429:zi.describe("Rate limit exceeded"),500:Tg.describe("Generic server error"),503:Tg.describe("Endpoint disabled or server is under maintenance")};o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String));var eb=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),mA=eb();eb().max(50);o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var fA=o.object({username:o.string(),createUser:o.boolean().optional().describe("If `true` create user with <username>@example.com and password `password`. If false user has to exist."),firstTestTimestamp:o.number().int().nonnegative().optional(),lastTestTimestamp:o.number().int().nonnegative().optional(),minTestsPerDay:o.number().int().nonnegative().optional(),maxTestsPerDay:o.number().int().nonnegative().optional()}),pA=dA(o.object({uid:mA,email:o.string().email()})),gA=xt(),hA=gA.router({generateData:{summary:"generate data",description:"Generate test results for the given user.",method:"POST",path:"/generateData",body:fA.strict(),responses:{200:pA}}},{pathPrefix:"/dev",strictStatusCodes:!0,metadata:{openApiTags:"development",authenticationOptions:{isPublicOnDev:!0}},commonResponses:uA});const tb=Zr.backendUrl,yA=Jy(nA,tb,1e4),bA=Jy(hA,tb,24e4),F={...yA,dev:bA};async function Ll(){}class Pa{constructor(t){this.id=t.id,this.display=t.display,this.element=t.element,this.pathname=t.path,this.beforeHide=t.beforeHide??Ll,this.afterHide=t.afterHide??Ll,this.beforeShow=t.beforeShow??Ll,this.afterShow=t.afterShow??Ll}}const pd=new Map;function Ht(e,t=!0){const a=document.getElementById(e)??void 0;if(a===void 0)throw new Error(`Element with id ${e} not found`);pd.set(e,a),t&&Et(e)}function Et(e){const t=pd.get(e);t?t.remove():Ht(e,!0)}const vA={popups:document.getElementById("popups"),main:document.querySelector("main")};function Zt(e,t){const a=pd.get(e);vA[t].append(a)}function wA(e){return pd.has(e)}function Ha(e,t=!1){const a=t?100:1e3;n(".pageLoading .fill, .pageAccount .preloader .fill").stop(!0,t).animate({width:e+"%"},a)}function kc(e){n(".pageLoading .text, .pageAccount .preloader .text").text(e)}async function ab(){return new Promise(e=>{Ja(n(".pageLoading .preloader .icon"),n(".pageLoading .preloader .barWrapper"),125,async()=>{e()}),Ja(n(".pageAccount .preloader .icon"),n(".pageAccount .preloader .barWrapper"),125,async()=>{e()})})}const kA=new Pa({id:"loading",element:n(".page.pageLoading"),path:"/",afterHide:async()=>{Et("pageLoading")},beforeShow:async()=>{Zt("pageLoading","main")}}),ob=[];function CA(e){ob.push(e)}window.addEventListener("load",()=>{window.addEventListener("online",()=>{$g(!0)}),window.addEventListener("offline",()=>{$g(!1)})});function $g(e){ob.forEach(t=>{try{t(e)}catch(a){console.error("Connection event subscriber threw an error"),console.error(a)}})}let Ca=!1,Ns=!1,Ge=!1,Dt=null,Xr=!0,xs=!1,Xu=1,te=0;function sb(e){Ca=e}function SA(e){Ns=e}function yf(e){Ge=e}function nb(e){Dt=e}function K3(e){Xr=e}function ib(e){xs=e}function bf(e){Xu=e}function xA(e){te=e}function Lg(){te++}function TA(){te--}let fr=navigator.onLine;function Xe(){return fr}let Xi,Ju=!1;function gd(){Ju||Xi===void 0&&(Xi=Bn("No internet connection",0,"exclamation-triangle",!1,()=>{Ju=!0,Xi=void 0}))}const $A=Pt(5e3,()=>{fr?(Xi!==void 0&&(g("You're back online",1,{customTitle:"Connection"}),n(`#bannerCenter .psa.notice[id="${Xi}"] .closeButton`).trigger("click")),Ju=!1):Ge||gd()});CA(e=>{fr=e,$A()});window.addEventListener("load",()=>{fr=navigator.onLine,fr||gd()});const LA={theme:"serika_dark",themeLight:"serika",themeDark:"serika_dark",autoSwitchTheme:!1,customTheme:!1,customThemeColors:["#323437","#e2b714","#e2b714","#646669","#2c2e31","#d1d0c5","#ca4754","#7e2a33","#ca4754","#7e2a33"],favThemes:[],showKeyTips:!0,smoothCaret:"medium",codeUnindentOnBackspace:!1,quickRestart:"off",punctuation:!1,numbers:!1,words:50,time:30,mode:"time",quoteLength:[1],language:"english",fontSize:2,freedomMode:!1,difficulty:"normal",blindMode:!1,quickEnd:!1,caretStyle:"default",paceCaretStyle:"default",flipTestColors:!1,layout:"default",funbox:"none",confidenceMode:"off",indicateTypos:"off",timerStyle:"mini",liveSpeedStyle:"off",liveAccStyle:"off",liveBurstStyle:"off",colorfulMode:!1,randomTheme:"off",timerColor:"main",timerOpacity:"1",stopOnError:"off",showAllLines:!1,keymapMode:"off",keymapStyle:"staggered",keymapLegendStyle:"lowercase",keymapLayout:"overrideSync",keymapShowTopRow:"layout",keymapSize:1,fontFamily:"Roboto_Mono",smoothLineScroll:!1,alwaysShowDecimalPlaces:!1,alwaysShowWordsHistory:!1,singleListCommandLine:"on",capsLockWarning:!0,playSoundOnError:"off",playSoundOnClick:"off",soundVolume:.5,startGraphsAtZero:!0,showOutOfFocusWarning:!0,paceCaret:"off",paceCaretCustomSpeed:100,repeatedPace:!0,accountChart:["on","on","on","on"],minWpm:"off",minWpmCustomSpeed:100,highlightMode:"letter",typingSpeedUnit:"wpm",ads:"result",hideExtraLetters:!1,strictSpace:!1,minAcc:"off",minAccCustom:90,monkey:!1,repeatQuotes:"off",oppositeShiftMode:"off",customBackground:"",customBackgroundSize:"cover",customBackgroundFilter:[0,1,1,1],customLayoutfluid:"qwerty#dvorak#colemak",customPolyglot:["english","spanish","french","german"],monkeyPowerLevel:"off",minBurst:"off",minBurstCustomSpeed:100,burstHeatmap:!1,britishEnglish:!1,lazyMode:!1,showAverage:"off",tapeMode:"off",tapeMargin:50,maxLineWidth:0};function Ot(){return Ma(LA)}function pr(e){return AA(rb(e))}function AA(e){const t=Ot(),a={};for(const s of xo(t)){const i=e[s]??t[s];a[s]=i}return a}function rb(e){if(e.quickTab===!0&&e.quickRestart===void 0&&(e.quickRestart="tab"),typeof e.smoothCaret=="boolean"&&(e.smoothCaret=e.smoothCaret?"medium":"off"),e.swapEscAndTab===!0&&e.quickRestart===void 0&&(e.quickRestart="esc"),e.alwaysShowCPM===!0&&e.typingSpeedUnit===void 0&&(e.typingSpeedUnit="cpm"),e.showAverage==="wpm"&&(e.showAverage="speed"),typeof e.playSoundOnError=="boolean"&&(e.playSoundOnError=e.playSoundOnError?"1":"off"),e.showTimerProgress===!1&&e.timerStyle===void 0&&(e.timerStyle="off"),e.showLiveWpm===!0&&e.liveSpeedStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveSpeedStyle=t}if(e.showLiveBurst===!0&&e.liveBurstStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveBurstStyle=t}if(e.showLiveAcc===!0&&e.liveAccStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveAccStyle=t}return typeof e.soundVolume=="string"&&(e.soundVolume=parseFloat(e.soundVolume)),e}class tc{constructor(t,a,s,i=!1){this.firstDayOfWeek=s;const l=new uo(a),c=this.getInterval(l,i);this.startDay=c.start,this.endDay=c.end,this.data=this.buildData(t,l),this.isFullYear=i}getInterval(t,a=!1){const s=a?oS(t):new Date;let i=sS(t);return a||(i=Yu(nS(s),1),this.isFirstDayOfWeek(i)||(i=this.previousFirstDayOfWeek(i))),{start:i,end:s}}buildData(t,a){const s=new Array(Math.max(0,386-t.length)).fill(void 0);s.push(...t);const i=Tn(this.endDay,this.startDay)+1,l=s.length-i+Tn(this.endDay,a);return s.slice(l)}getMonths(){const t=iS({start:this.startDay,end:this.endDay}),a=[];for(let s=0;s<t.length;s++){const i=t[s];let l=s===0?this.startDay:rS(i),c=s===t.length-1?this.endDay:lS(l);this.isFirstDayOfWeek(l)||(l=s===0?this.previousFirstDayOfWeek(l):this.nextFirstDayOfWeek(l)),this.isLastDayOfWeek(c)||(c=this.nextLastDayOfWeek(c));const d=cS(c,l,{roundingMethod:"ceil"});d>2?a.push({text:oe(i,"MMM").toLowerCase(),weeks:d}):s===0&&a.push({text:"",weeks:d})}return a}getDays(){const t=[],a=this.getBuckets(),s=c=>{if(c===void 0||c===null||c===0)return"0";for(let d=0;d<4;d++)if(c<=(a[d]??0))return(1+d).toString();return"4"};for(let c=0;c<this.startDay.getDay()-this.firstDayOfWeek;c++)t.push({level:"filler"});const i=Tn(this.endDay,this.startDay);let l=this.startDay;for(let c=0;c<=i;c++){const d=this.data[c],u=oe(l,"EEEE dd MMM yyyy");t.push({level:s(d),label:d!=null?`${d} ${d===1?"test":"tests"} on ${u}`:`no activity on ${u}`}),l=Yu(l,1)}for(let c=this.endDay.getDay()-this.firstDayOfWeek;c<6;c++)t.push({level:"filler"});return t}getTotalTests(){const t=Tn(this.endDay,this.startDay);return this.data.slice(0,t+1).reduce((a,s)=>(a??0)+(s??0),0)??0}getBuckets(){const a=this.data.filter(c=>c!=null).sort((c,d)=>c-d),s=a.slice(Math.round(a.length*.1),a.length-Math.round(a.length*.1)),l=s.reduce((c,d)=>c+d,0)/s.length;return[Math.floor(l/2),Math.round(l),Math.round(l*1.5)]}isFirstDayOfWeek(t){return tg(t).getDay()===this.firstDayOfWeek}previousFirstDayOfWeek(t){return dS(t,this.firstDayOfWeek)}nextFirstDayOfWeek(t){return ag(t,this.firstDayOfWeek)}isLastDayOfWeek(t){return tg(t).getDay()===(this.firstDayOfWeek+6)%7}nextLastDayOfWeek(t){return ag(t,(this.firstDayOfWeek+6)%7)}}class MA extends tc{constructor(t,a,s){super(t,a,s),this.lastDay=new uo(a)}increment(t){const a=new uo(t),s=new uo(this.lastDay);if(tS(a,s)){const i=this.data.length-1;this.data[i]=(this.data[i]||0)+1}else{if(aS(a,s))throw new Error("cannot alter data in the past.");{const i=Tn(a,s)-1;for(let c=0;c<i;c++)this.data.push(void 0);this.data.push(1);const l=this.getInterval(a);this.startDay=l.start,this.endDay=l.end,this.lastDay=a}}this.data=this.buildData(this.data,this.lastDay)}getFullYearCalendar(){const t=new Date;return this.lastDay.getFullYear()!==new uo(t).getFullYear()?new tc([],t,this.firstDayOfWeek,!0):new tc(this.data,this.lastDay,this.firstDayOfWeek,!0)}}const EA={results:void 0,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}},name:"",email:"",uid:"",isPremium:!1,config:Ot(),customThemes:[],presets:[],tags:[],banned:void 0,verified:void 0,lbMemory:{time:{15:{english:0},60:{english:0}}},typingStats:{timeTyping:0,startedTests:0,completedTests:0},quoteRatings:void 0,quoteMod:!1,favoriteQuotes:{},addedAt:0,filterPresets:[],xp:0,inboxUnreadSize:0,streak:0,maxStreak:0,streakHourOffset:void 0,allTimeLbs:{time:{15:{english:{count:0,rank:0}},60:{english:{count:0,rank:0}}}}};function Ag(){return Ma(EA)}function rt(e,t=!1,a=!1,s=":",i=!0,l=!1){e=Math.abs(e);let c=0,d;l?(c=Math.floor(e/86400),d=Math.floor(e%86400/3600)):d=Math.floor(e/3600);const u=Math.floor(e%3600/60),m=Q(e%3600%60);let f,p,h,y;l&&(c<10&&s!=="text"?f="0"+c:f=c),d<10&&s!=="text"?p="0"+d:p=d,u<10&&s!=="text"?h="0"+u:h=u,m<10&&(u>0||d>0||t)&&s!=="text"?y="0"+m:y=m;let b="";return c>0&&l&&(b+=f,s==="text"?c===1?b+=" day ":b+=" days ":b+=s),(d>0||a)&&(b+=p,s==="text"?d===1?b+=" hour ":b+=" hours ":b+=s),(u>0||d>0||t)&&(b+=h,s==="text"?u===1?b+=" minute ":b+=" minutes ":i&&(b+=s)),i&&(b+=y,s==="text"&&(m===1?b+=" second":b+=" seconds")),d===0&&u===0&&!i&&s==="text"&&(b="less than 1 minute"),b.trim()}const Mg={af:0,ar:6,arDZ:0,arEG:0,arMA:1,arSA:0,arTN:1,az:1,be:1,beTarask:1,bg:1,bn:0,bs:1,ca:1,ckb:0,cs:1,cy:0,da:1,de:1,deAT:1,el:1,enAU:1,enCA:0,enGB:1,enIE:1,enIN:1,enNZ:1,enUS:0,enZA:0,eo:1,es:1,et:1,eu:1,faIR:6,fi:1,fr:1,frCA:0,frCH:1,fy:1,gd:0,gl:1,gu:1,he:0,hi:0,hr:1,ht:1,hu:1,hy:1,id:1,is:1,it:1,itCH:1,ja:0,jaHira:0,ka:1,kk:1,km:0,kn:1,ko:0,lb:1,lt:1,lv:1,mk:1,mn:1,ms:1,mt:1,nb:1,nl:1,nlBE:1,nn:1,oc:1,pl:1,pt:1,ptBR:0,ro:1,ru:1,se:1,sk:1,sl:1,sq:1,sr:1,srLatn:1,sv:1,ta:1,te:0,th:0,tr:1,ug:0,uk:1,uz:1,uzCyrl:1,vi:1,zhCN:1,zhHK:0,zhTW:1};function PA(){if(navigator.language===void 0||navigator.language===null)return 0;const e=new Intl.Locale(navigator.language);if(e==null)return 0;if("weekInfo"in e)return e.weekInfo.firstDay%7;if("getWeekInfo"in e)return e.getWeekInfo().firstDay%7;let t=Mg[navigator.language.replaceAll("-","")];return t!==void 0||(t=Mg[navigator.language.split("-")[0]],t!==void 0)?t:0}let O;const lb=PA();class Ri extends Error{constructor(t,a){super(t),this.responseCode=a,this.name="SnapshotInitError",this.responseCode=a}}function $(){return O}function gt(e){const t=O==null?void 0:O.banned,a=O==null?void 0:O.verified,s=O==null?void 0:O.lbOptOut;try{e==null||delete e.banned}catch{}try{e==null||delete e.verified}catch{}try{e==null||delete e.lbOptOut}catch{}O=e,O&&(O.banned=t,O.verified=a,O.lbOptOut=s)}async function IA(){var t,a,s,i,l,c,d;const e=Ag();try{if(!j())return!1;const[u,m,f]=await Promise.all([F.users.get(),F.configs.get(),F.presets.get()]);if(u.status!==200)throw new Ri(`${u.body.message} (user)`,u.status);if(m.status!==200)throw new Ri(`${m.body.message} (config)`,m.status);if(f.status!==200)throw new Ri(`${f.body.message} (presets)`,f.status);const p=u.body.data,h=m.body.data,y=f.body.data;if(p===null)throw new Ri("Request was successful but user data is null",200);if(h!==null&&"config"in h)throw new Error("Config data is not in the correct format. Please refresh the page or contact support.");e.name=p.name,e.personalBests=p.personalBests,e.personalBests??(e.personalBests={time:{},words:{},quote:{},zen:{},custom:{}});for(const v of["time","words","quote","zen","custom"])(t=e.personalBests)[v]??(t[v]={});e.banned=p.banned,e.lbOptOut=p.lbOptOut,e.verified=p.verified,e.discordId=p.discordId,e.discordAvatar=p.discordAvatar,e.needsToChangeName=p.needsToChangeName,e.typingStats={timeTyping:p.timeTyping??0,startedTests:p.startedTests??0,completedTests:p.completedTests??0},e.quoteMod=p.quoteMod,e.favoriteQuotes=p.favoriteQuotes??{},e.quoteRatings=p.quoteRatings,e.details=p.profileDetails,e.addedAt=p.addedAt,e.inventory=p.inventory,e.xp=p.xp??0,e.inboxUnreadSize=p.inboxUnreadSize??0,e.streak=((a=p==null?void 0:p.streak)==null?void 0:a.length)??0,e.maxStreak=((s=p==null?void 0:p.streak)==null?void 0:s.maxLength)??0,e.filterPresets=p.resultFilterPresets??[],e.isPremium=(p==null?void 0:p.isPremium)??!1,e.allTimeLbs=p.allTimeLbs,p.testActivity!==void 0&&(e.testActivity=new MA(p.testActivity.testsByDays,new Date(p.testActivity.lastDay),lb));const b=(i=p==null?void 0:p.streak)==null?void 0:i.hourOffset;if(e.streakHourOffset=b??void 0,p.lbMemory!==void 0&&(e.lbMemory=p.lbMemory),h==null?e.config={...Ot()}:e.config=pr(h),e.customThemes=p.customThemes??[],e.tags=((l=p.tags)==null?void 0:l.map(v=>({...v,display:v.name.replaceAll("_"," ")})))??[],e.tags=(c=e.tags)==null?void 0:c.sort((v,C)=>v.name>C.name?1:v.name<C.name?-1:0),y!=null){const v=y.map(C=>({...C,display:C.name.replace(/_/gi," ")}));e.presets=v,e.presets=(d=e.presets)==null?void 0:d.sort((C,E)=>C.name>E.name?1:C.name<E.name?-1:0)}return O=e,O}catch(u){throw O=Ag(),u}}async function vf(e){var s;if(!j()||!O||O.results!==void 0&&(e===void 0||O.results.length>e)||!Xe())return!1;O.results===void 0&&(kc("Downloading results..."),Ha(90));const t=await F.results.get({query:{offset:e}});if(t.status!==200)return g("Error getting results: "+t.body.message,-1),!1;if(!j())return!1;const a=t.body.data.map(i=>(i.bailedOut===void 0&&(i.bailedOut=!1),i.blindMode===void 0&&(i.blindMode=!1),i.lazyMode===void 0&&(i.lazyMode=!1),i.difficulty===void 0&&(i.difficulty="normal"),i.funbox===void 0&&(i.funbox="none"),(i.language===void 0||i.language===null)&&(i.language="english"),i.numbers===void 0&&(i.numbers=!1),i.punctuation===void 0&&(i.punctuation=!1),i.numbers===void 0&&(i.numbers=!1),i.quoteLength===void 0&&(i.quoteLength=-1),i.restartCount===void 0&&(i.restartCount=0),i.incompleteTestSeconds===void 0&&(i.incompleteTestSeconds=0),i.afkDuration===void 0&&(i.afkDuration=0),i.tags===void 0&&(i.tags=[]),i));if(a==null||a.sort((i,l)=>l.timestamp-i.timestamp),O.results!==void 0&&O.results.length>0){const i=(s=Hs(O.results))==null?void 0:s.timestamp,l=a.filter(c=>c.timestamp<i);O.results.push(...l)}else O.results=a;return!0}async function qA(e){if(!O)return!1;if(O.customThemes===void 0&&(O.customThemes=[]),O.customThemes.length>=20)return g("Too many custom themes!",0),!1;const t=await F.users.addCustomTheme({body:{...e}});if(t.status!==200)return g("Error adding custom theme: "+t.body.message,-1),!1;if(t.body.data===null)return g("Error adding custom theme: No data returned",-1),!1;const a={...e,_id:t.body.data._id};return O.customThemes.push(a),!0}async function BA(e,t){var l;if(!j()||!O)return!1;O.customThemes===void 0&&(O.customThemes=[]);const a=(l=O.customThemes)==null?void 0:l.find(c=>c._id===e);if(!a)return g("Editing failed: Custom theme with id: "+e+" does not exist",-1),!1;const s=await F.users.editCustomTheme({body:{themeId:e,theme:t}});if(s.status!==200)return g("Error editing custom theme: "+s.body.message,-1),!1;const i={...t,_id:e};return O.customThemes[O.customThemes.indexOf(a)]=i,!0}async function DA(e){var s,i;if(!j()||!O||!((s=O.customThemes)==null?void 0:s.find(l=>l._id===e)))return!1;const a=await F.users.deleteCustomTheme({body:{themeId:e}});return a.status!==200?(g("Error deleting custom theme: "+a.body.message,-1),!1):(O.customThemes=(i=O.customThemes)==null?void 0:i.filter(l=>l._id!==e),!0)}async function cb(e,t,a,s,i,l,c){const d=$();if(!d)return[0,0];function u(){var E;const f=[];(E=d==null?void 0:d.tags)==null||E.forEach(k=>{k.active===!0&&f.push(k._id)});let p=0,h=0,y=0,b=0,v=0,C=0;if((d==null?void 0:d.results)!==void 0){for(const k of d.results)if(k.mode===e&&(k.punctuation??!1)===a&&(k.numbers??!1)===s&&k.language===i&&k.difficulty===l&&(k.lazyMode===c||k.lazyMode===void 0&&!c)&&(f.length===0||f.some(M=>{var q;return(q=k.tags)==null?void 0:q.includes(M)}))){if(`${k.mode2}`!=`${t}`&&e!=="quote")continue;if(C<10&&(y+=k.wpm,b+=k.acc,C++),`${k.mode2}`==`${t}`&&(p+=k.wpm,h+=k.acc,v++,v>=10))break}}return v===0&&e==="quote"?[y/C,b/C]:[p/v,h/v]}return d===null||await vf()===null?[0,0]:u()}async function FA(e,t,a,s,i,l,c){const d=$();if(!d)return 0;function u(){var h;const f=[];(h=d==null?void 0:d.tags)==null||h.forEach(y=>{y.active===!0&&f.push(y._id)});let p=0;if((d==null?void 0:d.results)!==void 0){for(const y of d.results)if(y.mode===e&&(y.punctuation??!1)===a&&(y.numbers??!1)===s&&y.language===i&&y.difficulty===l&&(y.lazyMode===c||y.lazyMode===void 0&&!c)&&(f.length===0||f.some(b=>{var v;return(v=y.tags)==null?void 0:v.includes(b)}))){if(y.timestamp<Date.now()-864e5||`${y.mode2}`!=`${t}`&&e!=="quote")continue;y.wpm>p&&(p=y.wpm)}}return p}return d===null||await vf()===null?0:u()}async function WA(e,t,a,s,i,l,c){const d=$();if(!d)return 0;let u=0;for(const m of d.tags){if(!m.active)continue;const f=await db(m._id,e,t,a,s,i,l,c);f>u&&(u=f)}return u}async function gr(e,t,a,s,i,l,c,d){var m,f;if(!d.every(p=>p.canGetPb))return;const u=(f=(m=O==null?void 0:O.personalBests)==null?void 0:m[e])==null?void 0:f[t];return u==null?void 0:u.find(p=>(p.punctuation??!1)===a&&(p.numbers??!1)===s&&p.difficulty===l&&p.language===i&&(p.lazyMode??!1)===c)}async function zA(e,t,a,s,i,l,c,d,u,m,f){if(e==="quote"||!O)return;function p(){var y,b;if(!O)return;let h=!1;O.personalBests??(O.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(y=O.personalBests)[e]??(y[e]={[t]:[]}),(b=O.personalBests[e])[t]??(b[t]=[]),O.personalBests[e][t].forEach(v=>{(v.punctuation??!1)===a&&(v.numbers??!1)===s&&v.difficulty===l&&v.language===i&&(v.lazyMode??!1)===c&&(h=!0,v.wpm=d,v.acc=u,v.raw=m,v.timestamp=Date.now(),v.consistency=f,v.lazyMode=c)}),h||O.personalBests[e][t].push({language:i,difficulty:l,lazyMode:c,punctuation:a,numbers:s,wpm:d,acc:u,raw:m,timestamp:Date.now(),consistency:f})}O!==null&&p()}async function db(e,t,a,s,i,l,c,d){var p,h,y,b;if(O===null)return 0;let u=0;const m=(((p=$())==null?void 0:p.tags)??[]).filter(v=>v._id===e)[0];return m===void 0||(m.personalBests??(m.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(h=m.personalBests)[t]??(h[t]={[a]:[]}),(y=m.personalBests[t])[a]??(y[a]=[]),u=((b=(m.personalBests[t][a]??[]).find(v=>(v.punctuation??!1)===s&&(v.numbers??!1)===i&&v.difficulty===c&&v.language===l&&(v.lazyMode===d||v.lazyMode===void 0&&!d)))==null?void 0:b.wpm)??0),u}async function RA(e,t,a,s,i,l,c,d,u,m,f,p){if(!O||t==="quote")return;function h(){var b,v,C;const y=(b=O==null?void 0:O.tags)==null?void 0:b.filter(E=>E._id===e)[0];y.personalBests??(y.personalBests={time:{},words:{},quote:{},zen:{},custom:{}}),(v=y.personalBests)[t]??(v[t]={[a]:[]}),(C=y.personalBests[t])[a]??(C[a]=[]);try{let E=!1;y.personalBests[t][a].forEach(k=>{(k.punctuation??!1)===s&&(k.numbers??!1)===i&&k.difficulty===c&&k.language===l&&(k.lazyMode===d||k.lazyMode===void 0&&!d)&&(E=!0,k.wpm=u,k.acc=m,k.raw=f,k.timestamp=Date.now(),k.consistency=p,k.lazyMode=d)}),E||y.personalBests[t][a].push({language:l,difficulty:c,lazyMode:d,punctuation:s,numbers:i,wpm:u,acc:m,raw:f,timestamp:Date.now(),consistency:p})}catch{y.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},y.personalBests[t][a]=[{language:l,difficulty:c,lazyMode:d,punctuation:s,numbers:i,wpm:u,acc:m,raw:f,timestamp:Date.now(),consistency:p}]}}O!==null&&h()}async function OA(e,t,a,s,i=!1){var l,c,d;{const u=e,m=t,f=$();if(!f)return;f.lbMemory===void 0&&(f.lbMemory={time:{15:{english:0},60:{english:0}}}),f.lbMemory[u]===void 0&&(f.lbMemory[u]={15:{english:0},60:{english:0}}),f.lbMemory[u][m]===void 0&&(f.lbMemory[u][m]={});const p=(d=(c=(l=f.lbMemory)==null?void 0:l[u])==null?void 0:c[m])==null?void 0:d[a],h=f.lbMemory[u][m];h[a]=s,i&&p!==s&&await F.users.updateLeaderboardMemory({body:{mode:e,mode2:t,language:a,rank:s}}),gt(f)}}async function ub(e){if(j()){const t=await F.configs.save({body:e});t.status!==200&&g("Failed to save config: "+t.body.message,-1)}}async function _A(){if(j()){const e=await F.configs.delete();e.status!==200&&g("Failed to reset config: "+e.body.message,-1)}}function mb(e){const t=$();t&&((t==null?void 0:t.results)!==void 0&&(t.results.unshift(e),gt(t)),t.testActivity!==void 0&&(t.testActivity.increment(new Date(e.timestamp)),gt(t)))}function fb(e,t){const a=$();a&&(a.typingStats===void 0&&(a.typingStats={timeTyping:0,startedTests:0,completedTests:0}),a.typingStats.timeTyping+=t,a.typingStats.startedTests+=e,a.typingStats.completedTests+=1,gt(a))}function pb(e){const t=$();t&&(t.xp===void 0&&(t.xp=0),t.xp+=e,gt(t))}function HA(e){const t=$();t&&(t.inventory===void 0&&(t.inventory={badges:[]}),t.inventory.badges.push(e),gt(t))}function jA(e){const t=$();t&&(t.streak=e,t.streak>t.maxStreak&&(t.maxStreak=t.streak),gt(t))}async function NA(e){var a;if(!j()||O===void 0)return;if(e==="current")return O.testActivity;const t=new Date().getFullYear().toString();if(e===t)return(a=O.testActivity)==null?void 0:a.getFullYearCalendar();if(O.testActivityByYear===void 0){if(!Xe())return;de();const s=await F.users.getTestActivity();if(s.status!==200){g("Error getting test activities: "+s.body.message,-1),Z();return}O.testActivityByYear={};for(const i in s.body.data){if(i===t)continue;const l=s.body.data[i]??[],c=Yu(new Date(parseInt(i),0,1),l.length);O.testActivityByYear[i]=new tc(l,c,lb,!0)}Z()}return O.testActivityByYear[e]}const gb=[];function Jr(){n("#words, #koInputVisualContainer").css("transition","none").removeClass("blurred"),n(".outOfFocusWarning").addClass("hidden"),H1(gb)}function GA(){gb.push(setTimeout(()=>{n("#words, #koInputVisualContainer").css("transition","0.25s").addClass("blurred"),n(".outOfFocusWarning").removeClass("hidden")},1e3))}function hb(e,t,a){a===void 0?g(`Invalid value for ${e} (${t}). Please try to change this setting again.`,-1):g(`Invalid value for ${e} (${t}). ${a}`,-1),console.error(`Invalid value key ${e} value ${t} type ${typeof t}`)}function _(e,t,a){const s=a.safeParse(t).success;return s||hb(e,t,void 0),s}function Pe(e,t){return _(e,t,o.boolean())}const yb=[];function Te(e){yb.push(e)}function P(e,t,a,s,i){yb.forEach(l=>{try{l(e,t,a,s,i)}catch(c){console.error("Config event subscriber threw an error"),console.error(c)}})}function UA(e){return e instanceof Error?e instanceof vy||e.constructor.name==="ZodError"||"issues"in e&&e.issues instanceof Array:!1}function ri(e,t){try{let a=JSON.parse(e);return t.parse(a)}catch(a){throw UA(a)?new Error(a.issues.map(KA).join(`
`)):a}}function KA(e){return e===void 0?"":`${e.path.length>0?`"${e.path.join(".")}" `:""}${e.message}`}let em;const VA=o.object({security:o.boolean(),analytics:o.boolean()});async function To(e,t){try{fS(em,e,t)}catch{console.log("Analytics unavailable")}}const Al=localStorage.getItem("acceptedCookies");let Ji;if(Al!=null&&Al!=="")try{Ji=ri(Al,VA)}catch(e){console.error("Failed to parse accepted cookies:",e),Ji=null}else Ji=null;Ji!==null&&Ji.analytics&&tm();function tm(){try{em=uS(XS),mS(em,!0),n("body").append(`
    <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-165993088-1"
  ><\/script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-165993088-1");
  <\/script>`)}catch(e){console.error(ae(e,"Failed to activate analytics"))}}const QA=[{name:"Prime Ape",description:"Paying for a monthly subscription",icon:"fa-dollar-sign",test:e=>e.isPremium===!0},{name:"Banned",description:"This account is banned",icon:"fa-gavel",color:"var(--error-color)",test:e=>e.banned===!0},{name:"LbOptOut",description:"This account has opted out of leaderboards",icon:"fa-crown",color:"var(--error-color)",test:e=>e.lbOptOut===!0}],ZA={iconsOnly:!1};function YA(e){return QA.filter(a=>a.test(e))}function XA(e,t){const a=`<i class="fas ${e.icon}"></i>`;if(t.iconsOnly)return a;const s=[];return e.background!==void 0&&s.push(`background: ${e.background};`),(e==null?void 0:e.color)!==void 0&&s.push(`color: ${e.color};`),(e==null?void 0:e.customStyle)!==void 0&&s.push(e.customStyle),`<div class="flag" ${`aria-label="${e.description}" data-balloon-pos="right"`} style="${s.join("")}">${a}</div>`}function el(e,t){const a={...ZA,...t};return YA(e).map(s=>XA(s,a)).join("")}function Cc(e){return Math.floor((Math.sqrt(392*e+22801)-53)/98)}function JA(e){return 49*(e-1)+100}function eM(e){return(49*Math.pow(e,2)+53*e-102)/2}function hr(e){const t=Cc(e);return{level:t,levelCurrentXp:e-eM(t),levelMaxXp:JA(t)}}let $t={bg:"#323437",main:"#e2b714",caret:"#e2b714",sub:"#646669",subAlt:"#2c2e31",text:"#d1d0c5",error:"#ca4754",errorExtra:"#7e2a33",colorfulError:"#ca4754",colorfulErrorExtra:"#7e2a33"};async function Ut(e){return $t[e]||tl(),$t[e]}async function fs(){return $t.bg||tl(),$t}function tM(){$t={bg:"",main:"",caret:"",sub:"",subAlt:"",text:"",error:"",errorExtra:"",colorfulError:"",colorfulErrorExtra:""}}function tl(){const e=getComputedStyle(document.body);$t.bg=e.getPropertyValue("--bg-color").replace(" ",""),$t.main=e.getPropertyValue("--main-color").replace(" ",""),$t.caret=e.getPropertyValue("--caret-color").replace(" ",""),$t.sub=e.getPropertyValue("--sub-color").replace(" ",""),$t.subAlt=e.getPropertyValue("--sub-alt-color").replace(" ",""),$t.text=e.getPropertyValue("--text-color").replace(" ",""),$t.error=e.getPropertyValue("--error-color").replace(" ",""),$t.errorExtra=e.getPropertyValue("--error-extra-color").replace(" ",""),$t.colorfulError=e.getPropertyValue("--colorful-error-color").replace(" ",""),$t.colorfulErrorExtra=e.getPropertyValue("--colorful-error-extra-color").replace(" ","")}let Sc=!1;function aM(){Sc||(Sc=!0,console.error("Slow timer, disabling animations"))}function yr(){Sc=!1}function He(){return Sc}let xc=!1,Ke=!1,bb=!1,Cs={currentXp:0,addedXp:0};const mo=n("nav .xpBar .xpBreakdown .total"),Sa=n("nav .xpBar .xpBreakdown .list"),io=n("nav .level"),Oa=n("nav .xpBar .bar"),ac=n("nav .xpBar");async function oM(){if(Ke=!0,!xc)return;bb?mo.text(`+${Cs.addedXp}`):oa(Cs.addedXp,!0),Sa.stop(!0,!0).empty().addClass("hidden"),io.text(Cc(Cs.currentXp+Cs.addedXp));const e=hr(Cs.currentXp+Cs.addedXp),t=e.level+e.levelCurrentXp/e.levelMaxXp;Oa.css("width",`${t%1*100}%`),await Ee(2e3),xc=!1,ac.stop(!0,!0).css("opacity",1).animate({opacity:0},He()?0:Be(250))}function Eg(e){const t=hr(e),a=t.levelCurrentXp/t.levelMaxXp;io.text(t.level),Oa.css({width:a*100+"%"})}async function vb(e,t,a){Ke=!1,xc=!0,Cs={currentXp:e,addedXp:t,breakdown:a},io.text(Cc(e));const s=hr(e),i=hr(e+t),l=s.level+s.levelCurrentXp/s.levelMaxXp,c=i.level+i.levelCurrentXp/i.levelMaxXp,d=Sa;Sa.stop(!0,!0).css("opacity",0).empty(),ac.stop(!0,!0).css("opacity",0),mo.text("");const u=Ms(ac,{opacity:"1"},He()?0:Be(125),"linear"),m=Ms(Sa,{opacity:"1"},He()?0:Be(125),"linear");if(a!==void 0?(d.removeClass("hidden"),Promise.all([u,m])):d.addClass("hidden"),Ke)return;const f=nM(l,c),p=sM(t,a);await Promise.all([f,p]),!Ke&&(await Ee(5e3),!Ke&&(xc=!1,io.text(Cc(e+t)),ac.stop(!0,!0).css("opacity",1).animate({opacity:0},He()?0:Be(250))))}async function oa(e,t=!1){if(!t&&Ke)return;mo.text(`+${e}`);const a=(Math.random()*2-1)/4,s=(Math.random()+1)/2;mo.stop(!0,!0).css({transition:"initial",borderSpacing:100}).animate({borderSpacing:0},{step(i){mo.css("transform",`scale(${1+i/200*s}) rotate(${i/10*a}deg)`)},duration:Be(2e3),easing:"easeOutCubic",complete:()=>{mo.css({backgroundColor:"",transition:""})}})}async function aa(e,t,a){if(Ke)return;if(t===void 0)Sa.append(`<div class="line" data-string='${e}'><div>${e}</div><div></div></div>`);else if(typeof t=="string")Sa.append(`
      <div class="line" data-string='${e}'>
      <div class="${a==null?void 0:a.extraClass}">${e}</div>
      <div class="${a==null?void 0:a.extraClass}">${t}</div>
      </div>`);else{const i=t===void 0?void 0:t>=0;Sa.append(`
      <div class="line" data-string='${e}'>

        <div class="${a==null?void 0:a.extraClass}">${e}</div>
        <div class="${i?"positive":"negative"} ${a==null?void 0:a.extraClass}">${i?"+":"-"}${Math.abs(t)}</div>
      </div>`)}if(a!=null&&a.noAnimation)return;const s=Sa.find(`.line[data-string='${e}']`);s.css("opacity",0),await Ms(s,{opacity:"1"},Be(250),"swing")}async function sM(e,t){if(Ke)return;if(Sa.css("opacity",1),!t){mo.text(`+${e}`);return}const a=Be(250);let s=0;Sa.empty(),Sa.removeClass("hidden"),mo.text("+0"),s+=t.base??0,mo.text(`+${s}`),await aa("time typing",t.base,{noAnimation:!0}),await Ee(a),t.fullAccuracy?(await Ee(a),s+=t.fullAccuracy,oa(s),await aa("perfect",t.fullAccuracy)):t.corrected&&(await Ee(a),s+=t.corrected,oa(s),await aa("clean",t.corrected)),!Ke&&(t.quote?(await Ee(a),s+=t.quote,oa(s),await aa("quote",t.quote)):(t.punctuation&&(await Ee(a),s+=t.punctuation,oa(s),await aa("punctuation",t.punctuation)),t.numbers&&(await Ee(a),s+=t.numbers,oa(s),await aa("numbers",t.numbers))),!Ke&&(t.funbox&&(await Ee(a),s+=t.funbox,oa(s),await aa("funbox",t.funbox)),!Ke&&(t.streak&&(await Ee(a),s+=t.streak,oa(s),await aa("streak",t.streak)),!Ke&&(t.accPenalty&&(await Ee(a),s-=t.accPenalty,oa(s),await aa("accuracy penalty",t.accPenalty*-1)),!Ke&&(t.incomplete&&(await Ee(a),s+=t.incomplete,oa(s),await aa("incomplete tests",t.incomplete)),!Ke&&(t.configMultiplier&&(await Ee(a),s*=t.configMultiplier,oa(s),await aa("global multiplier",`x${t.configMultiplier}`)),!Ke&&(t.daily&&(await Ee(a),s+=t.daily,oa(s),await aa("daily bonus",t.daily)),bb=!0,!Ke&&await Ee(a))))))))}async function nM(e,t){if(Ke)return;const a=t-e;if(Oa.css("width",`${e%1*100}%`),t%1===0){if(await Ms(Oa,{width:"100%"},He()?0:Be(1e3),"easeOutExpo"),Ke)return;hu(),Oa.css("width","0%")}else if(Math.floor(e)===Math.floor(t))await Ms(Oa,{width:`${t%1*100}%`},He()?0:Be(1e3),"easeOutExpo");else{const s=Math.min(1e3/a,200);let i=a,l=!1,c=s,d="linear",u=1-e%1;do{if(Ke)return;i-1<1&&(c=yc(i-1,0,.5,1e3,200),d="easeOutQuad"),l&&(hu(),Oa.css("width","0%"),u=1),await Ms(Oa,{width:"100%"},He()?0:Be(c),d),i-=u,l=!0}while(i>1);if(Ke||(hu(),Oa.css("width","0%"),Ke))return;await Ms(Oa,{width:`${i%1*100}%`},He()?0:Be(1e3),"easeOutExpo")}}async function hu(){const e=await fs();io.text(parseInt(io.text())+1);const t=Math.random()*2-1,a=Math.random()+1;io.stop(!0,!0).css({backgroundColor:e.main,borderSpacing:100,transition:"initial"}).animate({backgroundColor:e.sub,borderSpacing:0},{step(s){io.css("transform",`scale(${1+s/200*a}) rotate(${s/10*t}deg)`)},duration:Be(2e3),easing:"easeOutCubic",complete:()=>{io.css({backgroundColor:"",transition:""})}})}let Tc=!1;function iM(){n("nav .accountButtonAndMenu").addClass("hidden"),n("nav .textButton.view-login").addClass("hidden")}function ua(e){e?(n("header nav .account").css("opacity",1).css("pointer-events","none"),Tc?(n("header nav .view-account .loading").css("opacity",1).removeClass("hidden"),n("header nav .view-account .avatar").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{n("header nav .view-account .avatar").addClass("hidden")})):(n("header nav .view-account .loading").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100),n("header nav .view-account .user").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{n("header nav .view-account .user").addClass("hidden")}))):(n("header nav .account").css("opacity",1).css("pointer-events","auto"),Tc?(n("header nav .view-account .loading").css("opacity",1).addClass("hidden"),n("header nav .view-account .avatar").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100)):(n("header nav .view-account .loading").stop(!0,!0).css({opacity:1}).animate({opacity:0},100,()=>{n("header nav .view-account .loading").addClass("hidden")}),n("header nav .view-account .user").stop(!0,!0).removeClass("hidden").css({opacity:0}).animate({opacity:1},100)))}function Pg(e){n("header nav .view-account > .text").text(e)}function Ig(e){n("nav .textButton.view-account > .text").append(el(e,{iconsOnly:!0}))}function $c(e,t){(t??"")&&(e??"")?Jm(e,t).then(a=>{a!==null&&(n("header nav .view-account .avatar").css("background-image",`url(${a})`),Tc=!0,n("header nav .view-account .user").addClass("hidden"),n("header nav .view-account .avatar").removeClass("hidden"))}):(n("header nav .view-account .avatar").addClass("hidden"),n("header nav .view-account .user").removeClass("hidden"),n("header nav .view-account .avatar").css("background-image",""),Tc=!1)}function wf(e){if(j()){const{xp:t,discordId:a,discordAvatar:s,name:i}=e;Pg(i),Ig(e??{}),Eg(t),$c(a??"",s??""),n("nav .accountButtonAndMenu .menu .items .goToProfile").attr("href",`/profile/${i}`),Ja(n("nav .textButton.view-login"),n("nav .accountButtonAndMenu"),250)}else Ja(n("nav .accountButtonAndMenu"),n("nav .textButton.view-login"),250,async()=>{Pg(""),Ig({}),Eg(0),$c(void 0,void 0)})}var Yh;const rM=(Yh=window.matchMedia("(pointer:coarse)"))==null?void 0:Yh.matches;rM&&n("nav .accountButtonAndMenu .textButton.view-account").attr("href","");function lM(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function wb(e){return e.replace(/([A-Z])/g," $1").trim().toLowerCase()}function kb(e){try{return e.charAt(e.length-1)}catch{return""}}function qg(e,t,a){return t>e.length-1?e:e.substring(0,t)+a+e.substring(t+1)}function al(e){return e.split(/ +/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Gs(e){return e.charAt(0).toUpperCase()+e.slice(1)}function cM(e,t){const a=[];let s=[];const i=new Set(t);for(const l of e)i.has(l)?(s.length>0&&a.push(s.join("")),a.push(l),s=[]):s.push(l);return s.length>0&&a.push(s.join("")),a}function $o(e,t=!1){let a="";return t?a=ja(e):a=e,a.replace(/_/g," ")}function ja(e){return e.replace(/_\d*k$/g,"")}function Cb(e){const t={"“":'"',"”":'"',"„":'"',"’":"'","‘":"'",",":",","—":"-","…":"...","«":"<<","»":">>","–":"-"," ":" "," ":" "," ":" ","᾽":"'"};return e.replace(/[“”’‘—,…«»–\u2007\u202F\u00A0]/g,a=>t[a]||"")}function go(e){const t=[];for(const a of e)t.push(a);return t}function Sb(e,t,a=!1){t.length>e.length&&([e,t]=[t,e]);let s=e.filter(function(i){return t.includes(i)});return a?[...new Set(s)]:s}var kf={58008:{description:"A special mode for accountants.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters"],frontendForcedConfig:{numbers:[!1]},frontendFunctions:["getWord","punctuateWord","rememberSettings","handleChar"],name:"58008",alias:"numbers"},mirror:{name:"mirror",description:"Everything is mirrored!",properties:["hasCssFile"],canGetPb:!0,difficultyLevel:3,cssModifications:["main"]},upside_down:{name:"upside_down",description:"Everything is upside down!",properties:["hasCssFile"],canGetPb:!0,difficultyLevel:3,cssModifications:["main"]},nausea:{name:"nausea",description:"I think I'm gonna be sick.",canGetPb:!0,difficultyLevel:2,properties:["hasCssFile","ignoreReducedMotion"],cssModifications:["typingTest"]},round_round_baby:{name:"round_round_baby",description:"...right round, like a record baby. Right, round round round.",canGetPb:!0,difficultyLevel:3,properties:["hasCssFile","ignoreReducedMotion"],cssModifications:["typingTest"]},simon_says:{name:"simon_says",description:"Type what simon says.",canGetPb:!0,difficultyLevel:1,properties:["hasCssFile","changesWordsVisibility","usesLayout"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["applyConfig","rememberSettings"]},tts:{canGetPb:!0,difficultyLevel:1,properties:["hasCssFile","changesWordsVisibility","speaks"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["applyConfig","rememberSettings","toggleScript"],name:"tts",description:"Listen closely.",cssModifications:["words"]},choo_choo:{canGetPb:!0,difficultyLevel:2,properties:["hasCssFile","noLigatures","conflictsWithSymmetricChars","ignoreReducedMotion"],name:"choo_choo",description:"All the letters are spinning!",cssModifications:["words"]},arrows:{description:"Play it on a pad!",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","nospace","noLetters","symmetricChars"],frontendForcedConfig:{punctuation:[!1],numbers:[!1],highlightMode:["letter","off"]},frontendFunctions:["getWord","rememberSettings","handleChar","isCharCorrect","preventDefaultEvent","getWordHtml"],name:"arrows"},rAnDoMcAsE:{description:"I kInDa LiKe HoW iNeFfIcIeNt QwErTy Is.",canGetPb:!1,difficultyLevel:2,properties:["changesCapitalisation"],frontendFunctions:["alterText"],name:"rAnDoMcAsE"},capitals:{description:"Capitalize Every Word.",canGetPb:!1,difficultyLevel:1,properties:["changesCapitalisation"],frontendFunctions:["alterText"],name:"capitals"},layout_mirror:{description:"Mirror the keyboard layout",canGetPb:!0,difficultyLevel:1,properties:["changesLayout"],frontendFunctions:["applyConfig","rememberSettings"],name:"layout_mirror"},layoutfluid:{description:"Switch between layouts specified below proportionately to the length of the test.",canGetPb:!0,difficultyLevel:1,properties:["changesLayout","noInfiniteDuration"],frontendFunctions:["applyConfig","rememberSettings","handleSpace","getResultContent","restart"],name:"layoutfluid"},earthquake:{description:"Everybody get down! The words are shaking!",canGetPb:!0,difficultyLevel:1,properties:["hasCssFile","noLigatures","ignoreReducedMotion"],name:"earthquake",cssModifications:["words"]},space_balls:{description:"In a galaxy far far away.",canGetPb:!0,difficultyLevel:0,properties:["hasCssFile","ignoreReducedMotion"],name:"space_balls",cssModifications:["body"]},gibberish:{description:"Anvbuefl dizzs eoos alsb?",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","unspeakable"],frontendFunctions:["getWord"],name:"gibberish"},ascii:{description:"Where was the ampersand again?. Only ASCII characters.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","noLetters","unspeakable"],frontendForcedConfig:{punctuation:[!1],numbers:[!1]},frontendFunctions:["getWord"],name:"ascii"},specials:{description:"!@#$%^&*. Only special characters.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","noLetters","unspeakable"],frontendForcedConfig:{punctuation:[!1],numbers:[!1]},frontendFunctions:["getWord"],name:"specials"},plus_one:{description:"Only one future word is visible.",canGetPb:!0,difficultyLevel:0,properties:["changesWordsVisibility","toPush:2","noInfiniteDuration"],name:"plus_one"},plus_zero:{description:"React quickly! Only the current word is visible.",canGetPb:!0,difficultyLevel:1,properties:["changesWordsVisibility","toPush:1","noInfiniteDuration"],name:"plus_zero"},plus_two:{description:"Only two future words are visible.",canGetPb:!0,difficultyLevel:0,properties:["changesWordsVisibility","toPush:3","noInfiniteDuration"],name:"plus_two"},plus_three:{description:"Only three future words are visible.",canGetPb:!0,difficultyLevel:0,properties:["changesWordsVisibility","toPush:4","noInfiniteDuration"],name:"plus_three"},read_ahead_easy:{description:"Only the current word is invisible.",canGetPb:!0,difficultyLevel:1,properties:["changesWordsVisibility","hasCssFile"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["rememberSettings","handleKeydown"],name:"read_ahead_easy"},read_ahead:{description:"Current and the next word are invisible!",canGetPb:!0,difficultyLevel:2,properties:["changesWordsVisibility","hasCssFile"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["rememberSettings","handleKeydown"],name:"read_ahead"},read_ahead_hard:{description:"Current and the next two words are invisible!",canGetPb:!0,difficultyLevel:3,properties:["changesWordsVisibility","hasCssFile"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["rememberSettings","handleKeydown"],name:"read_ahead_hard"},memory:{description:"Test your memory. Remember the words and type them blind.",canGetPb:!0,difficultyLevel:3,properties:["changesWordsVisibility","noInfiniteDuration"],frontendForcedConfig:{mode:["words","quote","custom"]},frontendFunctions:["applyConfig","rememberSettings","start","restart"],name:"memory"},nospace:{description:"Whoneedsspacesanyway?",canGetPb:!1,difficultyLevel:0,properties:["nospace"],frontendForcedConfig:{highlightMode:["letter","off"]},frontendFunctions:["rememberSettings"],name:"nospace"},poetry:{description:"Practice typing some beautiful prose.",canGetPb:!1,difficultyLevel:0,properties:["noInfiniteDuration","ignoresLanguage"],frontendForcedConfig:{punctuation:[!1],numbers:[!1]},frontendFunctions:["pullSection"],name:"poetry"},wikipedia:{description:"Practice typing wikipedia sections.",canGetPb:!1,difficultyLevel:0,properties:["noInfiniteDuration","ignoresLanguage"],frontendForcedConfig:{punctuation:[!1],numbers:[!1]},frontendFunctions:["pullSection"],name:"wikipedia"},weakspot:{description:"Focus on slow and mistyped letters.",canGetPb:!1,difficultyLevel:0,properties:["changesWordsFrequency"],frontendFunctions:["getWord"],name:"weakspot"},pseudolang:{description:"Nonsense words that look like the current language.",canGetPb:!1,difficultyLevel:0,properties:["unspeakable","ignoresLanguage"],frontendFunctions:["withWords"],name:"pseudolang"},IPv4:{alias:"network",description:"For sysadmins.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters"],frontendForcedConfig:{numbers:[!1]},frontendFunctions:["getWord","punctuateWord","rememberSettings"],name:"IPv4"},IPv6:{alias:"network",description:"For sysadmins with a long beard.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters"],frontendForcedConfig:{numbers:[!1]},frontendFunctions:["getWord","punctuateWord","rememberSettings"],name:"IPv6"},binary:{description:"01000010 01100101 01100101 01110000 00100000 01100010 01101111 01101111 01110000 00101110",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters"],frontendForcedConfig:{numbers:[!1],punctuation:[!1]},frontendFunctions:["getWord"],name:"binary"},hexadecimal:{description:"0x38 0x20 0x74 0x69 0x6D 0x65 0x73 0x20 0x6D 0x6F 0x72 0x65 0x20 0x62 0x6F 0x6F 0x70 0x21",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters"],frontendForcedConfig:{numbers:[!1]},frontendFunctions:["getWord","punctuateWord","rememberSettings"],name:"hexadecimal"},zipf:{description:"Words are generated according to Zipf's law. (not all languages will produce Zipfy results, use with caution)",canGetPb:!1,difficultyLevel:0,properties:["changesWordsFrequency"],frontendFunctions:["getWordsFrequencyMode"],name:"zipf"},morse:{description:"-.../././.--./ -.../---/---/.--./-.-.--/ ",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage","ignoresLayout","noLetters","nospace"],frontendFunctions:["alterText"],name:"morse"},crt:{description:"Go back to the 1980s",canGetPb:!0,difficultyLevel:0,properties:["hasCssFile","noLigatures"],frontendFunctions:["applyGlobalCSS","clearGlobal"],name:"crt",cssModifications:["body"]},backwards:{description:"...sdrawkcab epyt ot yrt woN",name:"backwards",properties:["hasCssFile","noLigatures","conflictsWithSymmetricChars","wordOrder:reverse"],canGetPb:!0,frontendFunctions:["alterText"],difficultyLevel:3,cssModifications:["words"]},ddoouubblleedd:{description:"TTyyppee eevveerryytthhiinngg ttwwiiccee..",canGetPb:!0,difficultyLevel:1,properties:["noLigatures"],frontendFunctions:["alterText"],name:"ddoouubblleedd"},instant_messaging:{description:"Who needs shift anyway?",canGetPb:!1,difficultyLevel:1,properties:["changesCapitalisation"],frontendFunctions:["alterText"],name:"instant_messaging"},underscore_spaces:{description:"Underscores_are_better.",canGetPb:!1,difficultyLevel:0,properties:["ignoresLanguage","ignoresLayout","nospace"],frontendFunctions:["alterText"],name:"underscore_spaces"},ALL_CAPS:{description:"WHY ARE WE SHOUTING?",canGetPb:!1,difficultyLevel:1,properties:["changesCapitalisation"],frontendFunctions:["alterText"],name:"ALL_CAPS"},polyglot:{description:"Use words from multiple languages in a single test.",canGetPb:!1,difficultyLevel:1,properties:["ignoresLanguage"],frontendFunctions:["withWords"],name:"polyglot"}};function am(e){if(Array.isArray(e)){let t=e.map(a=>om()[a]);if(t.includes(void 0))throw new Error("One of the funboxes is invalid: "+e);return t}else{let t=om()[e];if(t===void 0)throw new Error("Invalid funbox name: "+e);return t}}function om(){return kf}function xb(){let e=[];for(let t of dM())e.push(kf[t]);return e}function dM(){return Object.keys(kf)}function hd(e){if(e==="none"||e==="")return[];let t=e.split("#").map(i=>i.trim()),a=[],s=new Set(xb().map(i=>i.name));for(let i of t)if(s.has(i))a.push(i);else throw new Error("Invalid funbox name: "+i);return a}function Cf(e,t){if(e.length===0)return!0;let a=am(e);if(t!==void 0&&(a=a.concat(am(t))),!a.every(x=>x!==void 0))return!1;let s=a.filter(x=>{var L,D,K;return((L=x.frontendFunctions)==null?void 0:L.includes("getWord"))||((D=x.frontendFunctions)==null?void 0:D.includes("pullSection"))||((K=x.frontendFunctions)==null?void 0:K.includes("withWords"))}).length<=1,i=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D.startsWith("wordOrder"))}).length<=1,l=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesLayout")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="ignoresLayout"||D==="usesLayout")}).length===0,c=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="nospace"||D.startsWith("toPush"))}).length<=1,d=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesWordsVisibility")}).length<=1,u=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesWordsFrequency")}).length<=1,m=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesWordsFrequency")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="ignoresLanguage")}).length===0,f=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="noLetters")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesCapitalisation")}).length===0,p=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="conflictsWithSymmetricChars")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="symmetricChars")}).length===0,h=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="speaks")}).length<=1,y=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="speaks")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="speaks")}).length===1&&a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="unspeakable")}).length===0||a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="ignoresLanguage")}).length===0,b=a.filter(x=>{var L,D,K;return((D=(L=x.properties)==null?void 0:L.find(J=>J.startsWith("toPush:")))!=null?D:"")||((K=x.frontendFunctions)==null?void 0:K.includes("pullSection"))}).length<=1,v=a.filter(x=>{var L;return(L=x.frontendFunctions)==null?void 0:L.includes("punctuateWord")}).length<=1,C=a.filter(x=>{var L;return(L=x.frontendFunctions)==null?void 0:L.includes("isCharCorrect")}).length<=1,E=a.filter(x=>{var L;return(L=x.frontendFunctions)==null?void 0:L.includes("getWordHtml")}).length<=1,k=a.filter(x=>{var L;return(L=x.properties)==null?void 0:L.find(D=>D==="changesCapitalisation")}).length<=1,M=Object.values(a.map(x=>x.cssModifications).filter(x=>x!==void 0).flat().reduce((x,L)=>(x[L]=(x[L]||0)+1,x),{})).every(x=>x<=1),q={},W=!0;for(let x of a)if(x.frontendForcedConfig)for(let L in x.frontendForcedConfig)if(q[L]){if(Sb(q[L],x.frontendForcedConfig[L],!0).length===0){W=!1;break}}else q[L]=x.frontendForcedConfig[L];return s&&l&&c&&d&&u&&m&&f&&p&&h&&y&&b&&v&&C&&E&&k&&M&&W&&i}function Ts(e){return am(hd(e))}function yd(){return xb()}function uM(){return om()}function sm(e,t,a){var s;if(a.length===0)return{result:!0};if(e==="words"||e==="time")return t===0?a.filter(l=>{var c;return(c=l.properties)==null?void 0:c.includes("noInfiniteDuration")}).length>0?{result:!1,forcedConfigs:[e==="words"?10:15]}:{result:!0}:{result:!0};{const i={};for(const l of a)if(l.frontendForcedConfig)for(const c in l.frontendForcedConfig)i[c]===void 0?i[c]=l.frontendForcedConfig[c]:i[c]=Sb(i[c],l.frontendForcedConfig[c],!0);if(i[e]===void 0)return{result:!0};if(((s=i[e])==null?void 0:s.length)===0)throw new Error("No intersection of forced configs");return{result:(i[e]??[]).includes(t),forcedConfigs:i[e]}}}function sn(e,t,a,s=!1){let i=0;if(e==="mode"){let l=Ts(a).filter(c=>{var d;return((d=c.frontendForcedConfig)==null?void 0:d.mode)!==void 0&&!c.frontendForcedConfig.mode.includes(t)});t==="zen"&&(l=l.concat(Ts(a).filter(c=>{var d,u,m,f,p,h,y,b,v,C,E;return((d=c.frontendFunctions)==null?void 0:d.includes("getWord"))??((u=c.frontendFunctions)==null?void 0:u.includes("pullSection"))??((m=c.frontendFunctions)==null?void 0:m.includes("alterText"))??((f=c.frontendFunctions)==null?void 0:f.includes("withWords"))??((p=c.properties)==null?void 0:p.includes("changesCapitalisation"))??((h=c.properties)==null?void 0:h.includes("nospace"))??((y=c.properties)==null?void 0:y.find(k=>k.startsWith("toPush:")))??((b=c.properties)==null?void 0:b.includes("changesWordsVisibility"))??((v=c.properties)==null?void 0:v.includes("speaks"))??((C=c.properties)==null?void 0:C.includes("changesLayout"))??((E=c.properties)==null?void 0:E.includes("changesWordsFrequency"))}))),(t==="quote"||t==="custom")&&(l=l.concat(Ts(a).filter(c=>{var d,u,m,f;return((d=c.frontendFunctions)==null?void 0:d.includes("getWord"))??((u=c.frontendFunctions)==null?void 0:u.includes("pullSection"))??((m=c.frontendFunctions)==null?void 0:m.includes("withWords"))??((f=c.properties)==null?void 0:f.includes("changesWordsFrequency"))}))),l.length>0&&(i+=1)}if(e==="words"||e==="time"){if(!sm(e,t,Ts(a)).result)if(s)i+=1;else return g("Active funboxes do not support infinite tests",0),!1}else sm(e,t,Ts(a)).result||(i+=1);return i>0?(s||g(`You can't set ${wb(e)} to ${t.toString()} with currently active funboxes.`,0,{duration:5}),!1):!0}function Tb(e,t){console.log("cansetfunboxwithconfig",e,t.mode);let a=t.funbox;a==="none"?a=e:a+="#"+e;const s=[];for(const[i,l]of Object.entries(t))sn(i,l,a,!0)||s.push({key:i,value:l});if(s.length>0){const i=[];for(const l of s)i.push(`${Gs(wb(l.key))} cannot be set to ${l.value.toString()}.`);return g(`You can't enable ${e.replace(/_/g," ")}:<br>${i.join("<br>")}`,0,{duration:5,allowHTML:!0}),!1}else return!0}var oc=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),bd=()=>o.string().regex(/^[a-zA-Z0-9_]+$/);bd();bd().max(50);var $b=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var Lb=o.enum(["normal","expert","master"]),$i=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:Lb,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),mM=o.object({time:o.record(oc.describe("Number of seconds as string"),o.array($i)),words:o.record(oc.describe("Number of words as string"),o.array($i)),quote:o.record(oc,o.array($i)),custom:o.record(o.literal("custom"),o.array($i)),zen:o.record(o.literal("zen"),o.array($i))});o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]);o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]);o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]);var fM=mM.keyof();o.union([oc,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})});var Ab=o.enum(["off","slow","medium","fast"]),Mb=o.enum(["off","esc","tab","enter"]),Eb=o.union([o.literal(-3),o.literal(-2),o.literal(-1),o.literal(0),o.literal(1),o.literal(2),o.literal(3)]),Pb=o.array(Eb),Lc=o.enum(["off","default","block","outline","underline","carrot","banana"]),Ib=o.enum(["off","on","max"]),qb=o.enum(["off","below","replace"]),Bb=o.enum(["off","bar","text","mini"]),Dn=o.enum(["off","text","mini"]),Db=o.enum(["off","on","fav","light","dark","custom"]),Fb=o.enum(["black","sub","text","main"]),Wb=o.enum(["0.25","0.5","0.75","1"]),zb=o.enum(["off","word","letter"]),Rb=o.enum(["off","static","react","next"]),Ob=o.enum(["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]),_b=o.enum(["lowercase","uppercase","blank","dynamic"]),Hb=o.enum(["always","layout","never"]),jb=o.number().min(.5).max(3.5).step(.1),Nb=o.enum(["manual","on"]),Gb=o.enum(["off","1","2","3","4"]),Ub=o.enum(["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]),Kb=o.number().min(0).max(1),Vb=o.enum(["off","average","pb","tagPb","last","custom","daily"]),Qb=o.tuple([o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"])]),Zb=o.enum(["off","custom"]),Yb=o.enum(["off","letter","word","next_word","next_two_words","next_three_words"]),Xb=o.enum(["off","letter","word"]),Jb=o.number().min(10).max(90),ev=o.enum(["wpm","cpm","wps","cps","wph"]),tv=o.enum(["off","result","on","sellout"]),av=o.enum(["off","custom"]),ov=o.enum(["off","typing"]),sv=o.enum(["off","on","keymap"]),Sf=o.enum(["cover","contain","max"]),xf=o.tuple([o.number(),o.number(),o.number(),o.number()]),pM=o.string().regex(/^[0-9a-zA-Z_#]+$/),nv=o.array($b).min(1),iv=o.enum(["off","1","2","3","4"]),rv=o.enum(["off","fixed","flex"]),lv=o.enum(["off","speed","acc","both"]),Da=o.string().regex(/^#([\da-f]{3}){1,2}$/i),cv=Lb,Tf=o.tuple([Da,Da,Da,Da,Da,Da,Da,Da,Da,Da]),dv=o.array(bd().max(50)),$f=o.string().max(100).regex(/[\w#]+/),uv=o.number().nonnegative(),mv=o.number().nonnegative(),fv=o.number().nonnegative().max(100),pv=o.number().nonnegative(),gv=o.number().int().nonnegative(),hv=o.number().int().nonnegative(),yv=o.string().max(50).regex(/^[a-zA-Z0-9_\-+.]+$/),Bs=bd().max(50),bv=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),vv=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),wv=o.number().positive(),kv=o.number().min(20).max(1e3).or(o.literal(0)),vd=o.string().url("Needs to be an URI.").regex(/^(https|http):\/\/.*/,"Unsupported protocol.").regex(/^[^`'"]*$/,"May not contain quotes.").regex(/.+(\.png|\.gif|\.jpeg|\.jpg)/gi,"Unsupported image format.").max(2048,"URL is too long.").or(o.literal("")),Cv=o.object({theme:Bs,themeLight:Bs,themeDark:Bs,autoSwitchTheme:o.boolean(),customTheme:o.boolean(),customThemeColors:Tf,favThemes:dv,showKeyTips:o.boolean(),smoothCaret:Ab,codeUnindentOnBackspace:o.boolean(),quickRestart:Mb,punctuation:o.boolean(),numbers:o.boolean(),words:hv,time:gv,mode:fM,quoteLength:Pb,language:$b,fontSize:wv,freedomMode:o.boolean(),difficulty:cv,blindMode:o.boolean(),quickEnd:o.boolean(),caretStyle:Lc,paceCaretStyle:Lc,flipTestColors:o.boolean(),layout:vv,funbox:$f,confidenceMode:Ib,indicateTypos:qb,timerStyle:Bb,liveSpeedStyle:Dn,liveAccStyle:Dn,liveBurstStyle:Dn,colorfulMode:o.boolean(),randomTheme:Db,timerColor:Fb,timerOpacity:Wb,stopOnError:zb,showAllLines:o.boolean(),keymapMode:Rb,keymapStyle:Ob,keymapLegendStyle:_b,keymapLayout:bv,keymapShowTopRow:Hb,keymapSize:jb,fontFamily:yv,smoothLineScroll:o.boolean(),alwaysShowDecimalPlaces:o.boolean(),alwaysShowWordsHistory:o.boolean(),singleListCommandLine:Nb,capsLockWarning:o.boolean(),playSoundOnError:Gb,playSoundOnClick:Ub,soundVolume:Kb,startGraphsAtZero:o.boolean(),showOutOfFocusWarning:o.boolean(),paceCaret:Vb,paceCaretCustomSpeed:uv,repeatedPace:o.boolean(),accountChart:Qb,minWpm:Zb,minWpmCustomSpeed:mv,highlightMode:Yb,tapeMode:Xb,tapeMargin:Jb,typingSpeedUnit:ev,ads:tv,hideExtraLetters:o.boolean(),strictSpace:o.boolean(),minAcc:av,minAccCustom:fv,monkey:o.boolean(),repeatQuotes:ov,oppositeShiftMode:sv,customBackground:vd,customBackgroundSize:Sf,customBackgroundFilter:xf,customLayoutfluid:pM,monkeyPowerLevel:iv,minBurst:rv,minBurstCustomSpeed:pv,burstHeatmap:o.boolean(),britishEnglish:o.boolean(),lazyMode:o.boolean(),showAverage:lv,maxLineWidth:kv,customPolyglot:nv}).strict(),gM=Cv.partial(),wd=o.enum(["test","behavior","input","sound","caret","appearance","theme","hideElements","ads","hidden"]),hM={theme:"theme",themeLight:"theme",themeDark:"theme",autoSwitchTheme:"theme",customTheme:"theme",customThemeColors:"theme",favThemes:"theme",showKeyTips:"hideElements",smoothCaret:"caret",codeUnindentOnBackspace:"input",quickRestart:"behavior",punctuation:"test",numbers:"test",words:"test",time:"test",mode:"test",quoteLength:"test",language:"test",fontSize:"appearance",freedomMode:"input",difficulty:"behavior",blindMode:"behavior",quickEnd:"input",caretStyle:"caret",paceCaretStyle:"caret",flipTestColors:"theme",layout:"input",funbox:"behavior",confidenceMode:"input",indicateTypos:"input",timerStyle:"appearance",liveSpeedStyle:"appearance",liveAccStyle:"appearance",liveBurstStyle:"appearance",colorfulMode:"theme",randomTheme:"theme",timerColor:"appearance",timerOpacity:"appearance",stopOnError:"input",showAllLines:"appearance",keymapMode:"appearance",keymapStyle:"appearance",keymapLegendStyle:"appearance",keymapLayout:"appearance",keymapShowTopRow:"appearance",keymapSize:"appearance",fontFamily:"appearance",smoothLineScroll:"appearance",alwaysShowDecimalPlaces:"appearance",alwaysShowWordsHistory:"behavior",singleListCommandLine:"behavior",capsLockWarning:"hideElements",playSoundOnError:"sound",playSoundOnClick:"sound",soundVolume:"sound",startGraphsAtZero:"appearance",showOutOfFocusWarning:"hideElements",paceCaret:"caret",paceCaretCustomSpeed:"caret",repeatedPace:"caret",accountChart:"hidden",minWpm:"behavior",minWpmCustomSpeed:"behavior",highlightMode:"appearance",tapeMode:"appearance",tapeMargin:"appearance",typingSpeedUnit:"appearance",ads:"ads",hideExtraLetters:"input",strictSpace:"input",minAcc:"behavior",minAccCustom:"behavior",monkey:"hidden",repeatQuotes:"behavior",oppositeShiftMode:"input",customBackground:"theme",customBackgroundSize:"theme",customBackgroundFilter:"theme",customLayoutfluid:"behavior",monkeyPowerLevel:"hidden",minBurst:"behavior",minBurstCustomSpeed:"behavior",burstHeatmap:"test",britishEnglish:"behavior",lazyMode:"input",showAverage:"hideElements",maxLineWidth:"appearance",customPolyglot:"behavior"},sc=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),Sv=()=>o.string().regex(/^[a-zA-Z0-9_]+$/);Sv();Sv().max(50);o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var xv=o.enum(["normal","expert","master"]),Li=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:xv,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),yM=o.object({time:o.record(sc.describe("Number of seconds as string"),o.array(Li)),words:o.record(sc.describe("Number of words as string"),o.array(Li)),quote:o.record(sc,o.array(Li)),custom:o.record(o.literal("custom"),o.array(Li)),zen:o.record(o.literal("zen"),o.array(Li))});o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]);o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]);o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]);var Tv=yM.keyof(),bM=o.union([sc,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})});o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String));var $v=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),Lv=$v();$v().max(50);var vM=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);var wM=o.enum(["repeat","random","shuffle"]),kM=o.enum(["word","time","section"]);function CM(e){return e instanceof Error?e instanceof vy||e.constructor.name==="ZodError"||"issues"in e&&e.issues instanceof Array:!1}class jt{constructor(t){this.key=t.key,this.schema=t.schema,this.fallback=t.fallback,this.migrate=t.migrate}get(){const t=window.localStorage.getItem(this.key);if(t===null)return this.fallback;let a;try{a=JSON.parse(t)}catch(l){return console.log(`Value from localStorage ${this.key} was not a valid JSON, using fallback`,l),window.localStorage.removeItem(this.key),this.fallback}const s=this.schema.safeParse(a);if(s.success)return s.data;console.log(`Value from localStorage ${this.key} failed schema validation, migrating`,s.error.issues);let i=this.fallback;if(this.migrate){const l=this.migrate(a,s.error.issues,Ma(this.fallback)),c=this.schema.safeParse(l);c.success?i=l:console.error(`Value from localStorage ${this.key} failed schema validation after migration! This is very bad!`,c.error.issues)}return window.localStorage.setItem(this.key,JSON.stringify(i)),i}set(t){try{const a=this.schema.parse(t);return window.localStorage.setItem(this.key,JSON.stringify(a)),!0}catch(a){let s="Unknown error occurred";CM(a)?(console.error(a),s="Schema validation failed"):a.message.includes("exceeded the quota")&&(s="Local storage is full. Please clear some space and try again.");const i=`Failed to set ${this.key} in localStorage: ${s}`;return console.error(i),g(i,-1),!1}}}const kd=["qwerty","dvorak","colemak","colemak_wide","colemak_dh","colemak_dh_iso","colemak_dh_wide","colemak_dh_iso_wide","colemak_dhk","colemak_dh_matrix","colemak_dhk_iso","colemak_dhv","qwertz","swiss_german","swiss_french","workman","prog_workman","turkish_q","turkish_f","turkish_e","MTGAP_ASRT","norman","halmak","QGMLWB","QGMLWY","qwpr","uk_qwerty","spanish_qwerty","italian_qwerty","latam_qwerty","prog_dvorak","prog_dvorak_prime","german_dvorak","german_dvorak_imp","spanish_dvorak","swedish_colemak","swedish_dvorak","dvorak_L","dvorak_R","dvorak_fr","azerty","bepo","bepo_AFNOR","alpha","handsdown","hungarian","handsdown_alt","handsdown_promethium","typehack","MTGAP","MTGAP_full","ina","soul","niro","mongolian","JCUKEN","Diktor","Diktor_VoronovMod","Redaktor","JUIYAF","Zubachev","ISRT","ISRT_Angle","colemak_Qix","colemak_Qi","colemaQ","colemaQ_F","engram","engrammer","semimak","semimak_jq","semimak_jqc","canary","canary_matrix","japanese_hiragana","boo","boo_mangle","APT","APT_angle","middlemak","middlemak-nh","hindi_inscript","thai_kedmanee","thai_pattachote","thai_manoonchai","persian_standard","persian_farsi","arabic_101","arabic_102","arabic_mac","hebrew","urdu_phonetic","brasileiro_nativo","Foalmak","quartz","arensito","ARTS","beakl_15","beakl_19","beakl_19_bis","capewell_dvorak","colman","heart","klauser","oneproduct","pine","real","rolll","stndc","three","uciea","asset","dwarf","flaw","whorf","whorf6","whorfmax","whorfmax_ortho","sertain","ctgap","octa8","polish_programmers","bulgarian","bulgarian_phonetic_traditional","belarusian","ukrainian","russian","neo","bone","AdNW","mine","noted","koy","3l","korean","ekverto_b","nerps","sturdy_angle_ansi","sturdy_angle_iso","sturdy_ortho","ABNT2","HiYou","xenia","xenia_alt","burmese","gallium","gallium_angle","gallium_v2","gallium_v2_matrix","maya","gallaya_angle_ansi","gallaya_angle_iso","gallaya_matrix","nila","minimak_4k","minimak_8k","minimak_12k","optimot","norwegian_qwerty","portuguese_pt_qwerty_iso","portuguese_pt_qwerty_ansi","swedish_qwerty","danish_qwerty","noctum","graphite","graphite_angle","graphite_angle_vc","graphite_angle_kp","graphite_matrix","macedonian","UGJRMV","pashto","ORNATE","estonian","stronk","dhorf","recurva","seht-drai","ints","rollla","wreathy","saiga","saiga-e","krai","mir","ergol","cascade","vylet","hyperroll","romak","scythe","inqwerted","rain","night","whix2","haruka","kuntum","anishtro","Kuntem","BEAKL_Zi","snorkle","MALTRON","PRSTEN","RSTHD","dusk","zenith","focal","panini","panini_wide","ergopti","sword"],Lf=new jt({key:"config",schema:Cv,fallback:Ot(),migrate:(e,t)=>py(e)?pr(e):Ot()}),r={...Ot()};let nc={};const SM=Pt(1e3,()=>{Object.keys(nc).length>0&&(ua(!0),ub(nc).then(()=>{ua(!1)})),nc={}});function I(e,t=!1,a=!1){if(t)return;Lf.set(r),a||(nc[e]=r[e],SM());const s=JSON.stringify(r);P("saveToLocalStorage",s)}function li(e=!1){console.log("saving full config to localStorage"),Lf.set(r),e||(ua(!0),ub(r),ua(!1));const t=JSON.stringify(r);P("saveToLocalStorage",t)}function ma(e,t){return!Pe("numbers",e)||!sn("numbers",e,r.funbox)?!1:(r.mode==="quote"&&(e=!1),r.numbers=e,I("numbers",t),P("numbers",r.numbers),!0)}function Ea(e,t){return!Pe("punctuation",e)||!sn("punctuation",e,r.funbox)?!1:(r.mode==="quote"&&(e=!1),r.punctuation=e,I("punctuation",t),P("punctuation",r.punctuation),!0)}function dt(e,t){if(!_("mode",e,Tv)||!sn("mode",e,r.funbox))return!1;const a=r.mode;return r.mode=e,r.mode==="custom"||r.mode==="quote"?(Ea(!1,!0),ma(!1,!0)):r.mode==="zen"&&r.paceCaret!=="off"&&g("Pace caret will not work with zen mode.",0),I("mode",t),P("mode",r.mode,t,a),!0}function Av(e,t){return _("play sound on error",e,Gb)?(r.playSoundOnError=e,I("playSoundOnError",t),P("playSoundOnError",r.playSoundOnError),!0):!1}function Mv(e,t){return _("play sound on click",e,Ub)?(r.playSoundOnClick=e,I("playSoundOnClick",t),P("playSoundOnClick",r.playSoundOnClick),!0):!1}function Ev(e,t){return(e<0||e>1)&&(g("Sound volume must be between 0 and 1",0),e=.5),_("sound volume",e,Kb)?(r.soundVolume=e,I("soundVolume",t),P("soundVolume",r.soundVolume),!0):!1}function _a(e,t){return _("difficulty",e,cv)?(r.difficulty=e,I("difficulty",t),P("difficulty",r.difficulty,t),!0):!1}function nm(e,t){return _("favorite themes",e,dv)?(r.favThemes=e,I("favThemes",t),P("favThemes",r.favThemes),!0):!1}function fo(e,t){if(!_("funbox",e,$f))return!1;for(const s of r.funbox.split("#"))if(!Tb(s,r))return!1;const a=e||"none";return r.funbox=a,I("funbox",t),P("funbox",r.funbox),!0}function Fn(e,t){if(!_("funbox",e,$f))return!1;let a;const s=r.funbox.split("#");if(s[0]==="none"&&s.splice(0,1),s.includes(e))a=s.indexOf(e),s.splice(a,1),s.length===0?r.funbox="none":r.funbox=s.join("#"),a=-a-1;else{if(!Tb(e,r))return!1;s.push(e),r.funbox=s.sort().join("#"),a=s.indexOf(e)}return I("funbox",t),P("funbox",r.funbox),a}function Pv(e,t){return Pe("blind mode",e)?(r.blindMode=e,I("blindMode",t),P("blindMode",r.blindMode,t),!0):!1}function ol(e,t){return e.length!==4&&(e=["on","on","on","on"]),_("account chart",e,Qb)?(e[0]==="off"&&e[1]==="off"&&(e[0]="on"),r.accountChart=e,I("accountChart",t),P("accountChart",r.accountChart),!0):!1}function Af(e,t){return _("stop on error",e,zb)?(r.stopOnError=e,r.stopOnError!=="off"&&(r.confidenceMode="off",I("confidenceMode",t)),I("stopOnError",t),P("stopOnError",r.stopOnError,t),!0):!1}function Iv(e,t){return Pe("always show decimal places",e)?(r.alwaysShowDecimalPlaces=e,I("alwaysShowDecimalPlaces",t),P("alwaysShowDecimalPlaces",r.alwaysShowDecimalPlaces),!0):!1}function qv(e,t){return _("typing speed unit",e,ev)?(r.typingSpeedUnit=e,I("typingSpeedUnit",t),P("typingSpeedUnit",r.typingSpeedUnit,t),!0):!1}function Bv(e,t){return Pe("show out of focus warning",e)?(r.showOutOfFocusWarning=e,r.showOutOfFocusWarning||Jr(),I("showOutOfFocusWarning",t),P("showOutOfFocusWarning",r.showOutOfFocusWarning),!0):!1}function Dv(e,t){return _("pace caret",e,Vb)?document.readyState==="complete"&&(e==="pb"||e==="tagPb")&&!j()?(g('Pace caret "pb" and "tag pb" are unavailable without an account',0),!1):(r.paceCaret=e,I("paceCaret",t),P("paceCaret",r.paceCaret,t),!0):!1}function Mf(e,t){return _("pace caret custom speed",e,uv)?(r.paceCaretCustomSpeed=e,I("paceCaretCustomSpeed",t),P("paceCaretCustomSpeed",r.paceCaretCustomSpeed),!0):!1}function Fv(e,t){return Pe("repeated pace",e)?(r.repeatedPace=e,I("repeatedPace",t),P("repeatedPace",r.repeatedPace),!0):!1}function Wv(e,t){return _("min speed",e,Zb)?(r.minWpm=e,I("minWpm",t),P("minWpm",r.minWpm,t),!0):!1}function Ef(e,t){return _("min speed custom",e,mv)?(r.minWpmCustomSpeed=e,I("minWpmCustomSpeed",t),P("minWpmCustomSpeed",r.minWpmCustomSpeed),!0):!1}function zv(e,t){return _("min acc",e,av)?(r.minAcc=e,I("minAcc",t),P("minAcc",r.minAcc,t),!0):!1}function Pf(e,t){return e>100&&(e=100),_("min acc custom",e,fv)?(r.minAccCustom=e,I("minAccCustom",t),P("minAccCustom",r.minAccCustom),!0):!1}function Rv(e,t){return _("min burst",e,rv)?(r.minBurst=e,I("minBurst",t),P("minBurst",r.minBurst,t),!0):!1}function If(e,t){return _("min burst custom speed",e,pv)?(r.minBurstCustomSpeed=e,I("minBurstCustomSpeed",t),P("minBurstCustomSpeed",r.minBurstCustomSpeed),!0):!1}function Ov(e,t){return Pe("always show words history",e)?(r.alwaysShowWordsHistory=e,I("alwaysShowWordsHistory",t),P("alwaysShowWordsHistory",r.alwaysShowWordsHistory),!0):!1}function _v(e,t){return _("single list command line",e,Nb)?(r.singleListCommandLine=e,I("singleListCommandLine",t),P("singleListCommandLine",r.singleListCommandLine),!0):!1}function Hv(e,t){return Pe("caps lock warning",e)?(r.capsLockWarning=e,I("capsLockWarning",t),P("capsLockWarning",r.capsLockWarning),!0):!1}function br(e,t){return Pe("show all lines",e)?e&&r.tapeMode!=="off"?(g("Show all lines doesn't support tape mode",0),!1):(r.showAllLines=e,I("showAllLines",t),P("showAllLines",r.showAllLines,t),!0):!1}function jv(e,t){return Pe("quick end",e)?(r.quickEnd=e,I("quickEnd",t),P("quickEnd",r.quickEnd),!0):!1}function Nv(e,t){return _("ads",e,tv)?(r.ads=e,I("ads",t),t||(Do(3),g("Ad settings changed. Refreshing...",0)),P("ads",r.ads),!0):!1}function Gv(e,t){return _("repeat quotes",e,ov)?(r.repeatQuotes=e,I("repeatQuotes",t),P("repeatQuotes",r.repeatQuotes),!0):!1}function Uv(e,t){return Pe("flip test colors",e)?(r.flipTestColors=e,I("flipTestColors",t),P("flipTestColors",r.flipTestColors),!0):!1}function Kv(e,t){return Pe("colorful mode",e)?(r.colorfulMode=e,I("colorfulMode",t),P("colorfulMode",r.colorfulMode),!0):!1}function Vv(e,t){return Pe("strict space",e)?(r.strictSpace=e,I("strictSpace",t),P("strictSpace",r.strictSpace),!0):!1}function Qv(e,t){return _("opposite shift mode",e,sv)?(r.oppositeShiftMode=e,I("oppositeShiftMode",t),P("oppositeShiftMode",r.oppositeShiftMode),!0):!1}function Zv(e,t){return _("caret style",e,Lc)?(r.caretStyle=e,n("#caret").removeClass("off"),n("#caret").removeClass("default"),n("#caret").removeClass("underline"),n("#caret").removeClass("outline"),n("#caret").removeClass("block"),n("#caret").removeClass("carrot"),n("#caret").removeClass("banana"),e==="off"?n("#caret").addClass("off"):e==="default"?n("#caret").addClass("default"):e==="block"?n("#caret").addClass("block"):e==="outline"?n("#caret").addClass("outline"):e==="underline"?n("#caret").addClass("underline"):e==="carrot"?n("#caret").addClass("carrot"):e==="banana"&&n("#caret").addClass("banana"),I("caretStyle",t),P("caretStyle",r.caretStyle),!0):!1}function Yv(e,t){return _("pace caret style",e,Lc)?(r.paceCaretStyle=e,n("#paceCaret").removeClass("off"),n("#paceCaret").removeClass("default"),n("#paceCaret").removeClass("underline"),n("#paceCaret").removeClass("outline"),n("#paceCaret").removeClass("block"),n("#paceCaret").removeClass("carrot"),n("#paceCaret").removeClass("banana"),e==="default"?n("#paceCaret").addClass("default"):e==="block"?n("#paceCaret").addClass("block"):e==="outline"?n("#paceCaret").addClass("outline"):e==="underline"?n("#paceCaret").addClass("underline"):e==="carrot"?n("#paceCaret").addClass("carrot"):e==="banana"&&n("#paceCaret").addClass("banana"),I("paceCaretStyle",t),P("paceCaretStyle",r.paceCaretStyle),!0):!1}function Xv(e,t){return _("show average",e,lv)?(r.showAverage=e,I("showAverage",t),P("showAverage",r.showAverage,t),!0):!1}function Ko(e,t){return!_("highlight mode",e,Yb)||!sn("highlightMode",e,r.funbox)?!1:(r.highlightMode=e,I("highlightMode",t),P("highlightMode",r.highlightMode),!0)}function qf(e,t){return _("tape mode",e,Xb)?(e!=="off"&&r.showAllLines&&br(!1,!0),r.tapeMode=e,I("tapeMode",t),P("tapeMode",r.tapeMode),!0):!1}function Cd(e,t){return e<10&&(e=10),e>90&&(e=90),_("tape margin",e,Jb)?(r.tapeMargin=e,I("tapeMargin",t),P("tapeMargin",r.tapeMargin,t),n(window).trigger("resize"),!0):!1}function Jv(e,t){return Pe("hide extra letters",e)?(r.hideExtraLetters=e,I("hideExtraLetters",t),P("hideExtraLetters",r.hideExtraLetters),!0):!1}function ew(e,t){return _("timer style",e,Bb)?(r.timerStyle=e,I("timerStyle",t),P("timerStyle",r.timerStyle),!0):!1}function tw(e,t){return _("live speed style",e,Dn)?(r.liveSpeedStyle=e,I("liveSpeedStyle",t),P("liveSpeedStyle",r.timerStyle),!0):!1}function aw(e,t){return _("live acc style",e,Dn)?(r.liveAccStyle=e,I("liveAccStyle",t),P("liveAccStyle",r.timerStyle),!0):!1}function ow(e,t){return _("live burst style",e,Dn)?(r.liveBurstStyle=e,I("liveBurstStyle",t),P("liveBurstStyle",r.timerStyle),!0):!1}function sw(e,t){return _("timer color",e,Fb)?(r.timerColor=e,I("timerColor",t),P("timerColor",r.timerColor),!0):!1}function nw(e,t){return _("timer opacity",e,Wb)?(r.timerOpacity=e,I("timerOpacity",t),P("timerOpacity",r.timerOpacity),!0):!1}function iw(e,t){return Pe("key tips",e)?(r.showKeyTips=e,r.showKeyTips?n("footer .keyTips").removeClass("hidden"):n("footer .keyTips").addClass("hidden"),I("showKeyTips",t),P("showKeyTips",r.showKeyTips),!0):!1}function Ga(e,t){return e=isNaN(e)||e<0?Ot().time:e,!_("time",e,gv)||!sn("words",e,r.funbox)?!1:(r.time=e,I("time",t),P("time",r.time),!0)}function ho(e,t,a){if(Array.isArray(e)){if(!_("quote length",e,Pb))return!1;e.length===1&&e[0]===-1&&(e=[1]),r.quoteLength=e}else{if(!_("quote length",e,Eb))return!1;Array.isArray(r.quoteLength)||(r.quoteLength=[]),(e===null||isNaN(e)||e<-3||e>3)&&(e=1),e=parseInt(e.toString()),e===-1?r.quoteLength=[0,1,2,3]:a&&e>=0?r.quoteLength.includes(e)?r.quoteLength.length>1&&(r.quoteLength=r.quoteLength.filter(s=>s!==e)):r.quoteLength.push(e):r.quoteLength=[e]}return I("quoteLength",t),P("quoteLength",r.quoteLength),!0}function ns(e,t){return e=e<0||e>1e5?Ot().words:e,!_("words",e,hv)||!sn("words",e,r.funbox)?!1:(r.words=e,I("words",t),P("words",r.words),!0)}function rw(e,t){return _("smooth caret",e,Ab)?(r.smoothCaret=e,e==="off"?n("#caret").css("animation-name","caretFlashHard"):n("#caret").css("animation-name","caretFlashSmooth"),I("smoothCaret",t),P("smoothCaret",r.smoothCaret),!0):!1}function lw(e,t){return Pe("code unindent on backspace",e)?(r.codeUnindentOnBackspace=e,I("codeUnindentOnBackspace",t),P("codeUnindentOnBackspace",r.codeUnindentOnBackspace,t),!0):!1}function cw(e,t){return Pe("start graphs at zero",e)?(r.startGraphsAtZero=e,I("startGraphsAtZero",t),P("startGraphsAtZero",r.startGraphsAtZero),!0):!1}function dw(e,t){return Pe("smooth line scroll",e)?(r.smoothLineScroll=e,I("smoothLineScroll",t),P("smoothLineScroll",r.smoothLineScroll),!0):!1}function uw(e,t){return _("quick restart mode",e,Mb)?(r.quickRestart=e,I("quickRestart",t),P("quickRestart",r.quickRestart),!0):!1}function mw(e,t){return _("font family",e,yv)?(e===""&&(e="roboto_mono",g("Empty input received, reverted to the default font.",0,{customTitle:"Custom font"})),!e||!/^[0-9a-zA-Z_.\-#+()]+$/.test(e)?(g(`Invalid font name value: "${e}".`,-1,{customTitle:"Custom font",duration:3}),!1):(r.fontFamily=e,document.documentElement.style.setProperty("--font",`"${e.replace(/_/g," ")}", "Roboto Mono", "Vazirmatn", monospace`),I("fontFamily",t),P("fontFamily",r.fontFamily),!0)):!1}function fw(e,t){return Pe("freedom mode",e)?(e==null&&(e=!1),r.freedomMode=e,r.freedomMode&&r.confidenceMode!=="off"&&(r.confidenceMode="off"),I("freedomMode",t),P("freedomMode",r.freedomMode),!0):!1}function pw(e,t){return _("confidence mode",e,Ib)?(r.confidenceMode=e,r.confidenceMode!=="off"&&(r.freedomMode=!1,r.stopOnError="off",I("freedomMode",t),I("stopOnError",t)),I("confidenceMode",t),P("confidenceMode",r.confidenceMode,t),!0):!1}function gw(e,t){return _("indicate typos",e,qb)?(r.indicateTypos=e,I("indicateTypos",t),P("indicateTypos",r.indicateTypos),!0):!1}function hw(e,t){return Pe("auto switch theme",e)?(e=e??Ot().autoSwitchTheme,r.autoSwitchTheme=e,I("autoSwitchTheme",t),P("autoSwitchTheme",r.autoSwitchTheme),!0):!1}function yo(e,t){return Pe("custom theme",e)?(r.customTheme=e,I("customTheme",t),P("customTheme",r.customTheme),!0):!1}function yw(e,t){return _("theme",e,Bs)?(r.theme=e,r.customTheme&&yo(!1),I("theme",t),P("theme",r.theme),!0):!1}function bw(e,t){return _("theme light",e,Bs)?(r.themeLight=e,I("themeLight",t),P("themeLight",r.themeLight,t),!0):!1}function vw(e,t){return _("theme dark",e,Bs)?(r.themeDark=e,I("themeDark",t),P("themeDark",r.themeDark,t),!0):!1}function xM(e,t,a,s,i){return _("themes",e,Bs)?(a.length===9&&(t&&g("Missing sub alt color. Please edit it in the custom theme settings and save your changes.",0,{duration:7}),a.splice(4,0,"#000000")),r.customThemeColors=a,r.theme=e,r.customTheme=t,r.autoSwitchTheme=s,I("theme",i),P("setThemes",t),!0):!1}function ww(e,t){var a,s;if(!_("random theme",e,Db))return!1;if(e==="custom"){if(!j())return r.randomTheme=e,!1;if(!$())return!0;if(((s=(a=$())==null?void 0:a.customThemes)==null?void 0:s.length)===0)return g("You need to create a custom theme first",0),r.randomTheme="off",!1}return r.randomTheme=e,I("randomTheme",t),P("randomTheme",r.randomTheme),!0}function kw(e,t){return Pe("british english",e)?(e||(e=!1),r.britishEnglish=e,I("britishEnglish",t),P("britishEnglish",r.britishEnglish),!0):!1}function vr(e,t){return Pe("lazy mode",e)?(e||(e=!1),r.lazyMode=e,I("lazyMode",t),P("lazyMode",r.lazyMode,t),!0):!1}function wr(e,t){return e.length===9&&(g("Missing sub alt color. Please edit it in the custom theme settings and save your changes.",0,{duration:7}),e.splice(4,0,"#000000")),_("custom theme colors",e,Tf)?(e!==void 0&&(r.customThemeColors=e),I("customThemeColors",t),P("customThemeColors",r.customThemeColors,t),!0):!1}function Us(e,t){return _("language",e,vM)?(r.language=e,To("changedLanguage",{language:e}),I("language",t),P("language",r.language),!0):!1}function TM(e,t){return Pe("monkey",e)?(r.monkey=e,I("monkey",t),P("monkey",r.monkey),!0):!1}function na(e,t){return _("keymap mode",e,Rb)?(n(".activeKey").removeClass("activeKey"),n(".keymapKey").attr("style",""),r.keymapMode=e,I("keymapMode",t),P("keymapMode",r.keymapMode,t),!0):!1}function Cw(e,t){return _("keymap legend style",e,_b)?(["lowercase","uppercase","blank","dynamic"].forEach(s=>{n(".keymapLegendStyle").removeClass(s)}),e=e||"lowercase",n(".keymapKey > .letter").css("display",""),n(".keymapKey > .letter").css("text-transform",""),e==="uppercase"&&n(".keymapKey > .letter").css("text-transform","capitalize"),e==="blank"&&n(".keymapKey > .letter").css("display","none"),n(".keymapLegendStyle").addClass(e),r.keymapLegendStyle=e,I("keymapLegendStyle",t),P("keymapLegendStyle",r.keymapLegendStyle),!0):!1}function Sw(e,t){return _("keymap style",e,Ob)?(e=e||"staggered",r.keymapStyle=e,I("keymapStyle",t),P("keymapStyle",r.keymapStyle),!0):!1}function Qo(e,t){return _("keymap layout",e,bv)?(r.keymapLayout=e,I("keymapLayout",t),P("keymapLayout",r.keymapLayout),!0):!1}function xw(e,t){return _("keymapShowTopRow",e,Hb)?(r.keymapShowTopRow=e,I("keymapShowTopRow",t),P("keymapShowTopRow",r.keymapShowTopRow),!0):!1}function sl(e,t){return e<.5&&(e=.5),e>3.5&&(e=3.5),e=Jl(e),_("keymap size",e,jb)?(r.keymapSize=e,n("#keymap").css("zoom",e),I("keymapSize",t),P("keymapSize",r.keymapSize,t),n(window).trigger("resize"),!0):!1}function ro(e,t){return _("layout",e,vv)?(r.layout=e,I("layout",t),P("layout",r.layout,t),!0):!1}function Sd(e,t){return e<0&&(e=1),typeof e=="string"&&["1","125","15","2","3","4"].includes(e)&&(e==="125"?e=1.25:e==="15"?e=1.5:e=parseInt(e)),_("font size",e,wv)?(e===15&&(e=1.5),r.fontSize=e,n("#caret, #paceCaret, #liveStatsMini, #typingTest, #wordsInput").css("fontSize",e+"rem"),I("fontSize",t),P("fontSize",r.fontSize,t),t||n(window).trigger("resize"),!0):!1}function nl(e,t){return e<20&&e!==0&&(e=20),e>1e3&&(e=1e3),_("max line width",e,kv)?(r.maxLineWidth=e,I("maxLineWidth",t),P("maxLineWidth",r.maxLineWidth,t),n(window).trigger("resize"),!0):!1}function il(e,t){return e=e.trim(),_("custom background",e,vd)?(r.customBackground=e,I("customBackground",t),P("customBackground",r.customBackground),!0):!1}function Tw(e,t){const a=e.trim(),s=a.split(/[# ]+/).filter(l=>!kd.includes(l));if(s.length!==0)return hb("layoutfluid",a,`The following inputted layouts do not exist: ${s.join(", ")}`),!1;const i=a.replace(/ /g,"#");return r.customLayoutfluid=i,I("customLayoutfluid",t),P("customLayoutfluid",r.customLayoutfluid),!0}function $w(e,t){return _("customPolyglot",e,nv)?(r.customPolyglot=e,I("customPolyglot",t),P("customPolyglot",r.customPolyglot),!0):!1}function Bf(e,t){return _("custom background size",e,Sf)?(r.customBackgroundSize=e,I("customBackgroundSize",t),P("customBackgroundSize",r.customBackgroundSize),!0):!1}function Df(e,t){return e.length===5&&(e=[e[0],e[1],e[2],e[3]]),_("custom background filter",e,xf)?(r.customBackgroundFilter=e,I("customBackgroundFilter",t),P("customBackgroundFilter",r.customBackgroundFilter),!0):!1}function $M(e,t){return _("monkey power level",e,iv)?(r.monkeyPowerLevel=e,I("monkeyPowerLevel",t),P("monkeyPowerLevel",r.monkeyPowerLevel),!0):!1}function Lw(e,t){return Pe("burst heatmap",e)?(e||(e=!1),r.burstHeatmap=e,I("burstHeatmap",t),P("burstHeatmap",r.burstHeatmap),!0):!1}async function Qn(e){if(e===void 0)return;P("fullConfigChange");const t=e;Object.keys(Ot()).forEach(a=>{if(t[a]===void 0){const s=Ot()[a];t[a]=s}}),t!=null&&(Nv(t.ads,!0),bw(t.themeLight,!0),vw(t.themeDark,!0),xM(t.theme,t.customTheme,t.customThemeColors,t.autoSwitchTheme,!0),Tw(t.customLayoutfluid,!0),$w(t.customPolyglot,!0),il(t.customBackground,!0),Bf(t.customBackgroundSize,!0),Df(t.customBackgroundFilter,!0),uw(t.quickRestart,!0),iw(t.showKeyTips,!0),Ga(t.time,!0),ho(t.quoteLength,!0),ns(t.words,!0),Us(t.language,!0),ro(t.layout,!0),Sd(t.fontSize,!0),nl(t.maxLineWidth,!0),fw(t.freedomMode,!0),Zv(t.caretStyle,!0),Yv(t.paceCaretStyle,!0),_a(t.difficulty,!0),Pv(t.blindMode,!0),jv(t.quickEnd,!0),Uv(t.flipTestColors,!0),Kv(t.colorfulMode,!0),pw(t.confidenceMode,!0),gw(t.indicateTypos,!0),ew(t.timerStyle,!0),tw(t.liveSpeedStyle,!0),aw(t.liveAccStyle,!0),ow(t.liveBurstStyle,!0),sw(t.timerColor,!0),nw(t.timerOpacity,!0),na(t.keymapMode,!0),Sw(t.keymapStyle,!0),Cw(t.keymapLegendStyle,!0),Qo(t.keymapLayout,!0),xw(t.keymapShowTopRow,!0),sl(t.keymapSize,!0),mw(t.fontFamily,!0),rw(t.smoothCaret,!0),lw(t.codeUnindentOnBackspace,!0),dw(t.smoothLineScroll,!0),Iv(t.alwaysShowDecimalPlaces,!0),Ov(t.alwaysShowWordsHistory,!0),_v(t.singleListCommandLine,!0),Hv(t.capsLockWarning,!0),Av(t.playSoundOnError,!0),Mv(t.playSoundOnClick,!0),Ev(t.soundVolume,!0),Af(t.stopOnError,!0),nm(t.favThemes,!0),fo(t.funbox,!0),ww(t.randomTheme,!0),br(t.showAllLines,!0),Bv(t.showOutOfFocusWarning,!0),Dv(t.paceCaret,!0),Mf(t.paceCaretCustomSpeed,!0),Fv(t.repeatedPace,!0),ol(t.accountChart,!0),Rv(t.minBurst,!0),If(t.minBurstCustomSpeed,!0),Wv(t.minWpm,!0),Ef(t.minWpmCustomSpeed,!0),zv(t.minAcc,!0),Pf(t.minAccCustom,!0),Ko(t.highlightMode,!0),qv(t.typingSpeedUnit,!0),Jv(t.hideExtraLetters,!0),cw(t.startGraphsAtZero,!0),Vv(t.strictSpace,!0),Qv(t.oppositeShiftMode,!0),dt(t.mode,!0),ma(t.numbers,!0),Ea(t.punctuation,!0),TM(t.monkey,!0),Gv(t.repeatQuotes,!0),$M(t.monkeyPowerLevel,!0),Lw(t.burstHeatmap,!0),kw(t.britishEnglish,!0),vr(t.lazyMode,!0),Xv(t.showAverage,!0),qf(t.tapeMode,!0),Cd(t.tapeMargin,!0),P("configApplied",void 0,void 0,void 0,r)),P("fullConfigChangeFinished")}async function Ff(){await Qn(Ot()),await _A(),li(!0)}async function LM(){console.log("loading localStorage config");const e=Lf.get();e===void 0?await Ff():(await Qn(e),li(!0)),AM()}function im(){const e={};return xo(r).filter(t=>r[t]!==Ot()[t]).forEach(t=>{e[t]=r[t]}),e}const{promise:Wf,resolve:AM}=an();class MM{constructor(){this.list=[],this.sectionIndexList=[],this.length=0}get(t,a=!1){var s,i;return t===void 0?this.list:a?(i=(s=this.list[t])==null?void 0:s.replace(/[.?!":\-,]/g,""))==null?void 0:i.toLowerCase():this.list[t]}getCurrent(){return this.list[te]??""}getLast(){return this.list[this.list.length-1]}push(t,a){this.list.push(t),this.sectionIndexList.push(a),this.length=this.list.length}reset(){this.list=[],this.sectionIndexList=[],this.length=this.list.length}clean(){for(const t of this.list)if(/ +/.test(t)){const a=this.list.indexOf(t),s=t.split(" ");this.list.splice(a,1);for(let i=0;i<s.length;i++)this.list.splice(a+i,0,s[i])}}}const R=new MM;let kr=!1,Cr=!1,zf=!1,re=null;function rm(e){re=e}function EM(e){kr=e}function PM(e){Cr=e}function IM(e){zf=e}Ht("commandLine");async function nn(){try{de();const e=await sf(()=>import("./commandline.Bc0p9Q-9.js"),__vite__mapDeps([0,1,2,3,4,5]));return Z(),e}catch(e){if(Z(),e instanceof Error&&e.message.includes("Failed to fetch dynamically imported module"))g("Failed to load commandline module: could not fetch",-1);else{const t=ae(e,"Failed to load commandline module");g(t,-1)}throw e}}Ht("devOptionsModal");document.addEventListener("keydown",async e=>{mr()||e.key!==void 0&&(e.key==="Escape"&&r.quickRestart!=="esc"||e.key==="Tab"&&r.quickRestart==="esc"&&!kr&&!e.shiftKey||e.key==="Tab"&&r.quickRestart==="esc"&&kr&&e.shiftKey||e.key.toLowerCase()==="p"&&(e.metaKey||e.ctrlKey)&&e.shiftKey)&&(e.preventDefault(),id()||(await nn()).show())});window.onerror=function(e,t,a,s,i){To("error",{error:(i==null?void 0:i.stack)??""})};window.onunhandledrejection=function(e){To("error",{error:e.reason.stack??""})};const Ml=125,El=.75;class fe{constructor(t){var i,l;this.open=!1,this.setupRan=!1,t.dialogId.startsWith("#")&&(t.dialogId=t.dialogId.slice(1)),this.skeletonAppendParent=t.appendTo??"popups",wA(t.dialogId)&&Zt(t.dialogId,this.skeletonAppendParent);const a=document.getElementById(t.dialogId),s=document.querySelector(`#${t.dialogId} > .modal`);if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(!(a instanceof HTMLDialogElement))throw new Error("Animated dialog must be an HTMLDialogElement");if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(s===null)throw new Error(`Div element inside #${t.dialogId} with class 'modal' not found`);this.dialogId=t.dialogId,this.wrapperEl=a,this.modalEl=s,this.customShowAnimations=(i=t.customAnimations)==null?void 0:i.show,this.customHideAnimations=(l=t.customAnimations)==null?void 0:l.hide,this.previousModalInChain=void 0,this.showOptionsWhenInChain=t.showOptionsWhenInChain,this.customEscapeHandler=t==null?void 0:t.customEscapeHandler,this.customWrapperClickHandler=t==null?void 0:t.customWrapperClickHandler,this.setup=t==null?void 0:t.setup,this.cleanup=t==null?void 0:t.cleanup,Ht(this.dialogId)}getPreviousModalInChain(){return this.previousModalInChain}async runSetup(){this.wrapperEl.addEventListener("keydown",async t=>{var a;t.key==="Escape"&&Vt(this.dialogId)&&(t.preventDefault(),t.stopPropagation(),this.customEscapeHandler!==void 0?(this.customEscapeHandler(t),(a=this.cleanup)==null||a.call(this)):await this.hide())}),this.wrapperEl.addEventListener("mousedown",async t=>{var a;t.target===this.wrapperEl&&(this.customWrapperClickHandler!==void 0?(this.customWrapperClickHandler(t),(a=this.cleanup)==null||a.call(this)):await this.hide())}),this.setup!==void 0&&await this.setup(this.modalEl)}getDialogId(){return this.dialogId}getWrapper(){return this.wrapperEl}getModal(){return this.modalEl}isOpen(){return this.open}focusFirstInput(t){const s=[...this.modalEl.querySelectorAll("input")].filter(i=>!i.classList.contains("hidden"))[0];s!=null?t===!0?s.focus():t==="focusAndSelect"?(s.focus(),s.select()):this.wrapperEl.focus():this.wrapperEl.focus()}async show(t){return new Promise(async a=>{var u,m,f,p,h,y,b,v,C,E,k,M,q;if(this.open){a();return}if(Zt(this.dialogId,this.skeletonAppendParent),this.setupRan||(await this.runSetup(),this.setupRan=!0),Vt(this.dialogId)){a();return}const s=Be((((m=(u=t==null?void 0:t.customAnimation)==null?void 0:u.modal)==null?void 0:m.durationMs)??(t==null?void 0:t.animationDurationMs)??((p=(f=this.customShowAnimations)==null?void 0:f.modal)==null?void 0:p.durationMs)??Ml)*((t==null?void 0:t.modalChain)!==void 0?El:1));(t==null?void 0:t.modalChain)!==void 0&&(this.previousModalInChain=t.modalChain,await this.previousModalInChain.hide({animationMode:"modalOnly",animationDurationMs:s,dontShowPreviousModalInchain:t.modalChain.previousModalInChain!==void 0})),this.open=!0,(t==null?void 0:t.mode)==="dialog"?this.wrapperEl.show():((t==null?void 0:t.mode)==="modal"||(t==null?void 0:t.mode)===void 0)&&this.wrapperEl.showModal(),await((h=t==null?void 0:t.beforeAnimation)==null?void 0:h.call(t,this.modalEl,t==null?void 0:t.modalChainData)),setTimeout(async()=>{this.focusFirstInput(t==null?void 0:t.focusFirstInput)},1);const i=((y=t==null?void 0:t.customAnimation)==null?void 0:y.modal)??((b=this.customShowAnimations)==null?void 0:b.modal),l=((v=t==null?void 0:t.customAnimation)==null?void 0:v.wrapper)??((C=this.customShowAnimations)==null?void 0:C.wrapper)??{from:{opacity:"0"},to:{opacity:"1"},easing:"swing"},c=Be(((k=(E=t==null?void 0:t.customAnimation)==null?void 0:E.wrapper)==null?void 0:k.durationMs)??((q=(M=this.customShowAnimations)==null?void 0:M.wrapper)==null?void 0:q.durationMs)??Ml),d=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";n(this.modalEl).stop(!0,!1),n(this.wrapperEl).stop(!0,!1),d==="both"||d==="none"?(i!=null&&i.from?(n(this.modalEl).css(i.from),n(this.modalEl).animate(i.to,d==="none"?0:s,i.easing??"swing")):n(this.modalEl).css("opacity","1"),n(this.wrapperEl).css(l.from),n(this.wrapperEl).removeClass("hidden").css("opacity","0").animate(l.to??{opacity:1},d==="none"?0:c,l.easing??"swing",async()=>{var W;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((W=t==null?void 0:t.afterAnimation)==null?void 0:W.call(t,this.modalEl,t==null?void 0:t.modalChainData)),a()})):d==="modalOnly"&&(n(this.wrapperEl).removeClass("hidden").css("opacity","1"),i!=null&&i.from?n(this.modalEl).css(i.from):n(this.modalEl).css("opacity","0"),n(this.modalEl).animate((i==null?void 0:i.to)??{opacity:1},s,(i==null?void 0:i.easing)??"swing",async()=>{var W;this.focusFirstInput(t==null?void 0:t.focusFirstInput),await((W=t==null?void 0:t.afterAnimation)==null?void 0:W.call(t,this.modalEl,t==null?void 0:t.modalChainData)),a()}))})}async hide(t){return new Promise(async a=>{var u,m,f,p,h,y,b,v,C,E,k,M,q;if(!Vt(this.dialogId)){a();return}t!=null&&t.clearModalChain&&(this.previousModalInChain=void 0),await((u=t==null?void 0:t.beforeAnimation)==null?void 0:u.call(t,this.modalEl));const s=((m=t==null?void 0:t.customAnimation)==null?void 0:m.modal)??((f=this.customHideAnimations)==null?void 0:f.modal),i=Be((((h=(p=t==null?void 0:t.customAnimation)==null?void 0:p.modal)==null?void 0:h.durationMs)??(t==null?void 0:t.animationDurationMs)??((b=(y=this.customHideAnimations)==null?void 0:y.modal)==null?void 0:b.durationMs)??Ml)*(this.previousModalInChain!==void 0?El:1)),l=((v=t==null?void 0:t.customAnimation)==null?void 0:v.wrapper)??((C=this.customHideAnimations)==null?void 0:C.wrapper)??{from:{opacity:"1"},to:{opacity:"0"},easing:"swing"},c=Be(((k=(E=t==null?void 0:t.customAnimation)==null?void 0:E.wrapper)==null?void 0:k.durationMs)??((q=(M=this.customHideAnimations)==null?void 0:M.wrapper)==null?void 0:q.durationMs)??Ml),d=this.previousModalInChain!==void 0?"modalOnly":(t==null?void 0:t.animationMode)??"both";n(this.modalEl).stop(!0,!1),n(this.wrapperEl).stop(!0,!1),d==="both"||d==="none"?(s!=null&&s.from?(n(this.modalEl).css(s.from),n(this.modalEl).animate(s.to,d==="none"?0:i,s.easing??"swing")):n(this.modalEl).css("opacity","1"),n(this.wrapperEl).css(l.from),n(this.wrapperEl).css("opacity","1").animate((l==null?void 0:l.to)??{opacity:0},d==="none"?0:c,(l==null?void 0:l.easing)??"swing",async()=>{var W,x;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Et(this.dialogId),this.open=!1,await((W=t==null?void 0:t.afterAnimation)==null?void 0:W.call(t,this.modalEl)),(x=this.cleanup)==null||x.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:i*El,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()})):d==="modalOnly"&&(n(this.wrapperEl).removeClass("hidden").css("opacity","1"),s!=null&&s.from?n(this.modalEl).css(s.from):n(this.modalEl).css("opacity","1"),n(this.modalEl).animate((s==null?void 0:s.to)??{opacity:0},i,(s==null?void 0:s.easing)??"swing",async()=>{var W,x;this.wrapperEl.close(),n(this.wrapperEl).addClass("hidden").css("opacity","0"),Et(this.dialogId),this.open=!1,await((W=t==null?void 0:t.afterAnimation)==null?void 0:W.call(t,this.modalEl)),(x=this.cleanup)==null||x.call(this),this.previousModalInChain!==void 0&&!(t!=null&&t.dontShowPreviousModalInchain)&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t==null?void 0:t.modalChainData,animationDurationMs:i*El,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()}))})}destroy(){var t;this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),(t=this.cleanup)==null||t.call(this),Et(this.dialogId),this.open=!1}}function Aw(){Mw.show()}const Mw=new fe({dialogId:"supportModal",setup:async e=>{var t;(t=e.querySelector("button.ads"))==null||t.addEventListener("click",async()=>{(await nn()).show({subgroupOverride:"enableAds"},{modalChain:Mw})})}});function Ew(){qM.show()}const qM=new fe({dialogId:"contactModal"});function wa(e,t,a){const s=Bg(e),i=Bg(t);if(s&&i){const l={r:s.r,g:s.g,b:s.b,a:1},c={r:i.r,g:i.g,b:i.b,a},d=pS(l,c);return BM(d.r,d.g,d.b)}else return"#000000"}function Bg(e){if(e.length!==4&&e.length!==7||!e.startsWith("#"))return;let t,a,s;if(e.length===4)t=+("0x"+e[1]+e[1]),a=+("0x"+e[2]+e[2]),s=+("0x"+e[3]+e[3]);else if(e.length===7)t=+("0x"+e[1]+e[2]),a=+("0x"+e[3]+e[4]),s=+("0x"+e[5]+e[6]);else return;return{r:t,g:a,b:s}}function BM(e,t,a){return"#"+((1<<24)+(e<<16)+(t<<8)+a).toString(16).slice(1)}function Ac(e){let t,a,s;e.length===4?(t="0x"+e[1]+e[1],a="0x"+e[2]+e[2],s="0x"+e[3]+e[3]):e.length===7?(t="0x"+e[1]+e[2],a="0x"+e[3]+e[4],s="0x"+e[5]+e[6]):(t=0,a=0,s=0),t/=255,a/=255,s/=255;const i=Math.min(t,a,s),l=Math.max(t,a,s),c=l-i;let d=0,u=0,m=0;return c===0?d=0:l===t?d=(a-s)/c%6:l===a?d=(s-t)/c+2:d=(t-a)/c+4,d=Math.round(d*60),d<0&&(d+=360),m=(l+i)/2,u=c===0?0:c/(1-Math.abs(2*m-1)),u=+(u*100).toFixed(1),m=+(m*100).toFixed(1),{hue:d,sat:u,lgt:m,string:"hsl("+d+","+u+"%,"+m+"%)"}}function DM(e){return Ac(e).lgt>=50}function Pw(e){return Ac(e).lgt<50}function FM(e){const t=e.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);if(t===null||t.length<3)return;function a(s){return("0"+parseInt(s).toString(16)).slice(-2)}return"#"+a(t[1])+a(t[2])+a(t[3])}async function WM(e){var t;try{if(!e)throw new Error("No URL");const a=await fetch(e);if(a.ok){if(!((t=a.headers.get("content-type"))!=null&&t.startsWith("application/json")))throw new Error("Content is not JSON");return await a.json()}else throw new Error(`${a.status} ${a.statusText}`)}catch(a){throw console.error("Error fetching JSON: "+e,a),a}}function zM(e,t){const a=new Map;return async(...s)=>{const i=s[0];if(a.has(i)){const c=await a.get(i);if(c!==void 0)return c}const l=e.apply(null,s);return a.set(i,l),l}}const ha=zM(WM);async function Ds(e){try{return await ha(`/layouts/${e}.json`)}catch{throw new Error(`Layout ${e} JSON fetch failed`)}}let Es;async function Rf(){if(Es)return Es;{let e=await ha("/themes/_list.json");return e=e.sort((t,a)=>{const s=t.name.toLowerCase(),i=a.name.toLowerCase();return s<i?-1:s>i?1:0}),Es=e,Es}}let Pl;async function RM(){if(Pl)return Pl;{if(Es||await Rf(),!Es)throw new Error("Themes list is undefined");let e=[...Es];return e=e.sort((t,a)=>{const s=Ac(t.bgColor);return Ac(a.bgColor).lgt-s.lgt}),Pl=e,Pl}}async function Of(){try{return await ha("/languages/_list.json")}catch{throw new Error("Language list JSON fetch failed")}}async function _f(){try{return await ha("/languages/_groups.json")}catch{throw new Error("Language groups JSON fetch failed")}}let Il;async function ci(e){return(Il===void 0||Il.name!==e)&&(Il=await ha(`/languages/${e}.json`)),Il}async function OM(e){const t=await ci(e);return t.orderedByFrequency===!0?"yes":t.orderedByFrequency===!1?"no":"unknown"}async function ps(e){return await ci(e)}async function _M(e){let t;return(await _f()).forEach(s=>{t===void 0&&s.languages.includes(e)&&(t=s)}),t}class Iw{constructor(t,a,s){this.title=t,this.author=a,this.words=s}}let ql;async function HM(){if(ql)return ql;{let e=await ha("/fonts/_list.json");return e=e.sort((t,a)=>{const s=t.name.toLowerCase(),i=a.name.toLowerCase();return s<i?-1:s>i?1:0}),ql=e,ql}}async function jM(){try{return await ha("/challenges/_list.json")}catch{throw new Error("Challenge list JSON fetch failed")}}async function NM(){try{return await ha("/about/supporters.json")}catch{throw new Error("Supporters list JSON fetch failed")}}async function GM(){try{return await ha("/about/contributors.json")}catch{throw new Error("Contributors list JSON fetch failed")}}async function UM(){const e=await ha("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=1");if(e[0]===void 0||e[0].name===void 0)throw new Error("No release found");return e[0].name}async function KM(){return ha("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=5")}function VM(){QM.show({beforeAnimation:async()=>{n("#versionHistoryModal .modal").html(`
    <div class="preloader">
      <i class="fas fa-fw fa-spin fa-circle-notch"></i>
    </div
  `),KM().then(e=>{n("#versionHistoryModal .modal").html('<div class="releases"></div'),e.forEach(t=>{if(!t.draft&&!t.prerelease){let a=t.body;a=a.replace(/\r\n/g,"<br>"),a=a.replace(/### (.*?)<br>/g,"<h3>$1</h3>"),a=a.replace(/<\/h3><br>/gi,"</h3>"),a=a.replace(/^- /gm,""),a=a.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),a=a.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),n("#versionHistoryModal .modal .releases").append(`
        <div class="release">
          <div class="title">${t.name}</div>
          <div class="date">${oe(new Date(t.published_at),"dd MMM yyyy")}</div>
          <div class="body">${a}</div>
        </div>
      `)}})}).catch(e=>{const t=ae(e,"Failed to fetch version history");n("#versionHistoryModal .modal").html(`<div class="releases">Failed to fetch version history:<br>${t}</div`)}),n("#newVersionIndicator").addClass("hidden")}})}const QM=new fe({dialogId:"versionHistoryModal"});var Xh;(Xh=document.querySelector("footer #commandLineMobileButton"))==null||Xh.addEventListener("click",async()=>{(await nn()).show({singleListOverride:!1})});var Jh;(Jh=document.querySelector("footer #newVersionIndicator"))==null||Jh.addEventListener("click",e=>{var t;e.stopPropagation(),(t=document.querySelector("#newVersionIndicator"))==null||t.classList.add("hidden")});var ey;(ey=document.querySelector("footer .currentVersion"))==null||ey.addEventListener("click",e=>{e.shiftKey?alert(Zr.clientVersion):VM()});var ty;(ty=document.querySelector("footer .right .current-theme"))==null||ty.addEventListener("click",async e=>{var a,s;if(e.shiftKey){if(r.customTheme){yo(!1);return}if(j()&&(((s=(a=$())==null?void 0:a.customThemes)==null?void 0:s.length)??0)<1){g("No custom themes!",0),yo(!1);return}yo(!0)}else{const i=r.customTheme?"customThemesList":"themes";(await nn()).show({subgroupOverride:i})}});var ay;(ay=document.querySelector("footer #supportMeButton"))==null||ay.addEventListener("click",()=>{Aw()});var oy;(oy=document.querySelector("footer #contactPopupButton"))==null||oy.addEventListener("click",()=>{Ew()});n("#keymap").on("click",".r5 .layoutIndicator",async()=>{(await nn()).show({subgroupOverride:"keymapLayouts"})});let Hf=!1;function be(){Hf=!0}function Sr(){Hf=!1}function ZM(){return Hf}const qw=new Set(["NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space","Enter","Tab","NoCode"]);class YM{constructor(){this.current="",this.history=[],this.koreanStatus=!1}reset(){this.current="",this.history=[]}resetHistory(){this.history=[]}setKoreanStatus(t){this.koreanStatus=t}getKoreanStatus(){return this.koreanStatus}pushHistory(){this.history.push(this.current),this.current=""}popHistory(){return this.history.pop()??""}getHistory(t){return t===void 0?this.history:this.history[t]}getHistoryLast(){return Hs(this.history)}}class XM{constructor(){this.current="",this.history=[]}reset(){this.history=[],this.current=""}getHistory(t){return this.history[t]}popHistory(){return this.history.pop()??""}pushHistory(){this.history.push(this.current),this.current=""}}let bo={};const T=new YM,at=new XM;let Ks=[],Mc=0,xd=0,vo={},da={correct:0,incorrect:0},Ce={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},no={total:0,lastStartTime:-1},wo=[],Td=[],La=[],rl=[],xr={count:0,words:[]},ll=[],Ec=!0;function lm(){Mc++}function Bw(){Ec=!1}function Dw(){xr.count++}function cm(e){xr.words.push(e)}function JM(e){xd=e}function $d(){Ks.push(Mc),Mc=0}function Ld(){ll.push(Ec),Ec=!0}function Ad(){rl.push(xr),xr={count:0,words:[]}}function Fw(e){e?da.correct++:da.incorrect++}function e2(e){var l,c;const t=Q(ec(Ce.duration.array)),a=Object.entries(bo);a.sort((d,u)=>d[1].timestamp-u[1].timestamp);for(const d of a)Ww(e,d[0]);const s=(l=Hs(a))==null?void 0:l[0],i=(c=bo[s])==null?void 0:c.index;s!==void 0&&i!==void 0&&(Ce.duration.array[i]=t)}let Tr=0;function Ww(e,t){if(!qw.has(t))return;t==="NoCode"&&(Tr--,t="NoCode"+Tr);const a=bo[t];if(a===void 0)return;const s=Math.abs(a.timestamp-e);Ce.duration.array[a.index]=s,console.debug("Keyup recorded",t,s),delete bo[t],zw(e)}function t2(e,t){var a;if(!qw.has(t)){console.debug("Key not tracked",t);return}if(t==="NoCode"&&(t="NoCode"+Tr,Tr++),bo[t]!==void 0){console.debug("Key already down",t);return}if(bo[t]={timestamp:e,index:Ce.duration.array.length},Ce.duration.array.push(0),zw((a=bo[t])==null?void 0:a.timestamp),Ce.spacing.last!==-1){const s=Math.abs(e-Ce.spacing.last);Ce.spacing.array.push(Q(s)),console.debug("Keydown recorded",t,s)}Ce.spacing.last=e,Ce.spacing.first===-1&&(Ce.spacing.first=e,console.debug("First keydown recorded",t,e))}function zw(e){Object.keys(bo).length>1?no.lastStartTime===-1&&(no.lastStartTime=e):no.lastStartTime!==-1&&(no.total+=e-no.lastStartTime,no.lastStartTime=-1)}function a2(){Ce={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},no={total:0,lastStartTime:-1},bo={},Tr=0,console.debug("Keypress timings reset")}function Rw(e){Object.keys(vo).includes(e)?vo[e]++:vo[e]=1}function Ow(e){wo.push(e)}function _w(e){Td.push(e)}function Hw(e){La[te]===void 0?La.push(e):La[te]=e}function o2(){wo=[],Td=[],La=[],Ks=[],Mc=0,ll=[],Ec=!0,rl=[],xr={count:0,words:[]},xd=0,vo={},da={correct:0,incorrect:0},Ce={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}}}const s2=o.record(o.string(),o.string()),n2=o.record(o.string(),o.object({text:o.string(),progress:o.number()})),jw=new jt({key:"customText",schema:s2,fallback:{}}),Nw=new jt({key:"customTextLong",schema:n2,fallback:{}}),Gw=o.object({text:o.array(o.string()),mode:wM,limit:o.object({value:o.number(),mode:kM}),pipeDelimiter:o.boolean()}),i2={text:["The","quick","brown","fox","jumps","over","the","lazy","dog"],mode:"repeat",limit:{value:9,mode:"word"},pipeDelimiter:!1},St=new jt({key:"customTextSettings",schema:Gw,fallback:i2,migrate:(e,t,a)=>{if(typeof e!="object"||e===null)return a;const s=a;return"text"in e&&o.array(o.string()).safeParse(s.text).success&&(s.text=e.text),s}});function cl(){return St.get().text}function Lo(e){const t=St.get();St.set({...t,text:e,limit:{value:e.length,mode:t.limit.mode}})}function er(){return St.get().mode}function Zn(e){const t=St.get();St.set({...t,mode:e,limit:{value:t.text.length,mode:t.limit.mode}})}function r2(){return St.get().limit}function qe(){return St.get().limit.value}function je(){return St.get().limit.mode}function Ua(e){const t=St.get();St.set({...t,limit:{value:e,mode:t.limit.mode}})}function xa(e){const t=St.get();St.set({...t,limit:{value:t.limit.value,mode:e}})}function di(){return St.get().pipeDelimiter}function Vs(e){const t=St.get();St.set({...t,pipeDelimiter:e})}function rn(){return{text:cl(),mode:er(),limit:r2(),pipeDelimiter:di()}}function Pc(e,t=!1){if(t){const s=ui()[e];if(s===void 0)throw new Error(`Custom text ${e} not found`);return s.text.split(/ +/)}else{const a=Md()[e];if(a===void 0)throw new Error(`Custom text ${e} not found`);return a.split(/ +/)}}function l2(e,t,a=!1){if(a){const s=ui();s[e]={text:"",progress:0};const i=s[e];if(i===void 0)throw new Error("Custom text not found");return typeof t=="string"?i.text=t:i.text=t.join(" "),Nf(s)}else{const s=Md();return typeof t=="string"?s[e]=t:s[e]=t.join(" "),Kw(s)}}function Uw(e,t){const a=t?ui():Md();delete a[e],t?Nf(a):Kw(a)}function jf(e){const t=ui()[e];if(t===void 0)throw new Error("Custom text not found");return t.progress??0}function dm(e,t){const a=ui(),s=a[e];if(s===void 0)throw new Error("Custom text not found");s.progress=t,Nf(a)}function Md(){return jw.get()}function ui(){return Nw.get()}function Kw(e){return jw.set(e)}function Nf(e){return Nw.set(e)}function um(e=!1){return Object.keys(e?ui():Md())}let Ic=!0;const ko=document.querySelector("#caret");function Vw(){Ic&&(ko.style.animationName="none",ko.style.opacity="1",Ic=!1)}function Qw(){Ic||(r.smoothCaret!=="off"&&!He()?ko.style.animationName="caretFlashSmooth":ko.style.animationName="caretFlashHard",Ic=!0)}function dl(){ko.classList.add("hidden")}function c2(e){var a,s;if(e||(e=(s=(a=document.getElementById("words"))==null?void 0:a.querySelectorAll(".word"))==null?void 0:s[0]),!e)return 0;const t=window.getComputedStyle(e);return parseInt(t.marginRight)+parseInt(t.marginLeft)}function d2(e,t,a,s,i,l,c,d){const u=r.blindMode||r.hideExtraLetters;let m=0;if(r.tapeMode==="off"){let f=0;const p=i[d],h=i[c-1],y=i[d-1];t?d<c&&p?f=(p==null?void 0:p.offsetLeft)+(e?0:l):u?f=((h==null?void 0:h.offsetLeft)??0)-(e?l:0):f=((y==null?void 0:y.offsetLeft)??0)-(e?l:0):d<c&&p?f=p==null?void 0:p.offsetLeft:u?f=((h==null?void 0:h.offsetLeft)??0)+((h==null?void 0:h.offsetWidth)??0):f=((y==null?void 0:y.offsetLeft)??0)+((y==null?void 0:y.offsetWidth)??0),m=a.offsetLeft+f,s&&t&&(m+=a.offsetWidth)}else if(m=(n(document.querySelector("#wordsWrapper")).width()??0)*(r.tapeMargin/100)-(e&&t?l:0),r.tapeMode==="word"&&d>0){let h=0;for(let y=0;y<d&&!(u&&y>=c);y++)h+=n(i[y]).outerWidth(!0)??0;t&&(h*=-1),m+=h}return m}async function Ao(e=!1){var D,K;const t=Math.round(((D=document.querySelector("#caret"))==null?void 0:D.getBoundingClientRect().width)??0),a=["block","outline","underline"].includes(r.caretStyle);let s=go(R.getCurrent()).length;const i=go(T.current).length;r.mode==="zen"&&(s=i);const l=document==null?void 0:document.querySelector("#words .active");let c=!1;r.mode==="zen"&&(s=i,i===0&&(c=!0));const d=l==null?void 0:l.querySelectorAll("letter");if(!(d!=null&&d.length))return;const u=d[i],m=d[s-1],p=(await ps(r.language)).rightToLeft,h=(u==null?void 0:u.offsetHeight)||(m==null?void 0:m.offsetHeight)||r.fontSize*Kn(1),y=(u==null?void 0:u.offsetTop)??(m==null?void 0:m.offsetTop)??0,b=h-ko.offsetHeight;let v=l.offsetTop+y+b/2;r.caretStyle==="underline"&&(v=l.offsetTop+y-ko.offsetHeight/2);let C=u==null?void 0:u.offsetWidth;if(C===void 0||c)C=c2(l);else if(C===0){C=0;for(let J=i;J>=0&&(C=(K=d[J])==null?void 0:K.offsetWidth,!C);J--);}const E=a?(C??0)+"px":"",M=d2(a,p,l,c,d,C,s,i)-(a?0:t/2);let q=n("#words .smoothScroller").height();q===void 0&&(q=0);const W=n(ko);W.css("display","block");const x={top:v-q,left:M};E!==""?x.width=E:W.css("width","");const L=r.smoothCaret==="off"?0:r.smoothCaret==="slow"?150:r.smoothCaret==="medium"?100:r.smoothCaret==="fast"?85:0;if(W.stop(!0,!1).animate(x,He()||e?0:L),r.showAllLines){const J=window.innerHeight,ke=J/2-W.outerHeight()/2,Je=document.body.scrollHeight;if(v>=ke&&Je>J&&Ge){const Jt=v-ke/2;window.scrollTo({left:0,top:Jt,behavior:gy()?"instant":"smooth"})}}}function Zw(e=!1){ko.classList.remove("hidden"),Ao(e),Qw()}const Dg=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],["Space"]],u2=new Set(["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyA","KeyS","KeyD","KeyF","KeyG","ShiftLeft","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","Space"]),m2=new Set(["Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadEnter","Space"]);function Yw(e,t){var d,u;const a=Object.values(t.keys),s=a.findIndex(m=>m.find(f=>f.includes(e))),i=a[s];if(i===void 0)return;const l=i.findIndex(m=>m.includes(e));if(l===-1)return;let c=(d=Dg[s])==null?void 0:d[l];return t.type==="iso"&&(s===2&&l===11?c="Backslash":s===3&&l===0?c="IntlBackslash":s===3&&(c=(u=Dg[3])==null?void 0:u[l-1])),c}function Gf(e){const t=u2.has(e),a=m2.has(e);return{leftSide:t,rightSide:a}}function Uf(e){const t=[11,10,10,10,10],a={row1:[...[...e.keys.row1.slice(0,t[0])].reverse(),...e.keys.row1.slice(t[0])],row2:[...[...e.keys.row2.slice(0,t[1])].reverse(),...e.keys.row2.slice(t[1])],row3:[...[...e.keys.row3.slice(0,t[2])].reverse(),...e.keys.row3.slice(t[2])],row4:[...[...e.keys.row4.slice(0,t[3])].reverse(),...e.keys.row4.slice(t[3])],row5:[...[...e.keys.row5.slice(0,t[4])].reverse(),...e.keys.row5.slice(t[4])]};return{...e,keys:a}}let is=!1,rs=!1;n(document).on("keydown",e=>{e.code==="ShiftLeft"?(is=!0,rs=!1):e.code==="ShiftRight"&&(is=!1,rs=!0)});n(document).on("keyup",e=>{(e.code==="ShiftLeft"||e.code==="ShiftRight")&&(is=!1,rs=!1)});function f2(){is=!1,rs=!1}function mm(e){if(!is&&!rs||r.oppositeShiftMode==="off")return!0;const{leftSide:t,rightSide:a}=Gf(e);return!!(!t&&!a||is&&a||rs&&t)}const Wn=document.querySelector("#capsWarning"),p2=navigator.platform.startsWith("Mac");let Yn=!1,qc=!1;function g2(){qc||(Wn==null||Wn.classList.remove("hidden"),qc=!0)}function h2(){qc&&(Wn==null||Wn.classList.add("hidden"),qc=!1)}function Xw(e){var a,s;const t=(s=(a=e==null?void 0:e.originalEvent)==null?void 0:a.getModifierState)==null?void 0:s.call(a,"CapsLock");t!==void 0&&(Yn=t);try{r.capsLockWarning&&Yn?g2():h2()}catch{}}n(document).on("keyup",Xw);n(document).on("keydown",e=>{p2&&Xw(e)});async function Jw(){return await sf(()=>import("./howler.BBEjZEGN.js").then(e=>e.h),__vite__mapDeps([6,1]))}let ia=null,Qs=null;async function e0(){const e=(await Jw()).Howl;ia===null&&(ia={1:[{sounds:[new e({src:"../sound/error1/error1_1.wav"}),new e({src:"../sound/error1/error1_1.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/error2/error2_1.wav"}),new e({src:"../sound/error2/error2_1.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/error3/error3_1.wav"}),new e({src:"../sound/error3/error3_1.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/error4/error4_1.wav"}),new e({src:"../sound/error4/error4_1.wav"})],counter:0},{sounds:[new e({src:"../sound/error4/error4_2.wav"}),new e({src:"../sound/error4/error4_2.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function Ed(){const e=(await Jw()).Howl;Qs===null&&(Qs={1:[{sounds:[new e({src:"../sound/click1/click1_1.wav"}),new e({src:"../sound/click1/click1_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_2.wav"}),new e({src:"../sound/click1/click1_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_3.wav"}),new e({src:"../sound/click1/click1_3.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/click2/click2_1.wav"}),new e({src:"../sound/click2/click2_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_2.wav"}),new e({src:"../sound/click2/click2_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_3.wav"}),new e({src:"../sound/click2/click2_3.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/click3/click3_1.wav"}),new e({src:"../sound/click3/click3_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_2.wav"}),new e({src:"../sound/click3/click3_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_3.wav"}),new e({src:"../sound/click3/click3_3.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/click4/click4_1.wav"}),new e({src:"../sound/click4/click4_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_2.wav"}),new e({src:"../sound/click4/click4_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_3.wav"}),new e({src:"../sound/click4/click4_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_4.wav"}),new e({src:"../sound/click4/click4_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_5.wav"}),new e({src:"../sound/click4/click4_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_6.wav"}),new e({src:"../sound/click4/click4_66.wav"})],counter:0}],5:[{sounds:[new e({src:"../sound/click5/click5_1.wav"}),new e({src:"../sound/click5/click5_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_2.wav"}),new e({src:"../sound/click5/click5_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_3.wav"}),new e({src:"../sound/click5/click5_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_4.wav"}),new e({src:"../sound/click5/click5_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_5.wav"}),new e({src:"../sound/click5/click5_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_6.wav"}),new e({src:"../sound/click5/click5_66.wav"})],counter:0}],6:[{sounds:[new e({src:"../sound/click6/click6_1.wav"}),new e({src:"../sound/click6/click6_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_2.wav"}),new e({src:"../sound/click6/click6_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_3.wav"}),new e({src:"../sound/click6/click6_33.wav"})],counter:0}],7:[{sounds:[new e({src:"../sound/click7/click7_1.wav"}),new e({src:"../sound/click7/click7_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_2.wav"}),new e({src:"../sound/click7/click7_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_3.wav"}),new e({src:"../sound/click7/click7_33.wav"})],counter:0}],14:[{sounds:[new e({src:"../sound/click14/click14_1.wav"}),new e({src:"../sound/click14/click14_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_2.wav"}),new e({src:"../sound/click14/click14_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_3.wav"}),new e({src:"../sound/click14/click14_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_4.wav"}),new e({src:"../sound/click14/click14_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_5.wav"}),new e({src:"../sound/click14/click14_5.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_6.wav"}),new e({src:"../sound/click14/click14_6.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_7.wav"}),new e({src:"../sound/click14/click14_7.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_8.wav"}),new e({src:"../sound/click14/click14_8.wav"})],counter:0}],15:[{sounds:[new e({src:"../sound/click15/click15_1.wav"}),new e({src:"../sound/click15/click15_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_2.wav"}),new e({src:"../sound/click15/click15_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_3.wav"}),new e({src:"../sound/click15/click15_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_4.wav"}),new e({src:"../sound/click15/click15_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_5.wav"}),new e({src:"../sound/click15/click15_5.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function V3(e){var s,i,l,c,d,u;Qs===null&&await Ed();const t=Qs;Object.keys(t).includes(e)&&((l=(i=(s=t==null?void 0:t[e])==null?void 0:s[0])==null?void 0:i.sounds[0])==null||l.seek(0),(u=(d=(c=t==null?void 0:t[e])==null?void 0:c[0])==null?void 0:d.sounds[0])==null||u.play())}async function Q3(e){var s,i,l,c,d,u;ia===null&&await e0(),Object.keys(ia).includes(e)&&((l=(i=(s=ia==null?void 0:ia[e])==null?void 0:s[0])==null?void 0:i.sounds[0])==null||l.seek(0),(u=(d=(c=ia==null?void 0:ia[e])==null?void 0:c[0])==null?void 0:d.sounds[0])==null||u.play())}let Oi="KeyA";n(document).on("keydown",e=>{Oi=e.code||"KeyA"});const se={C:[16.35,32.7,65.41,130.81,261.63,523.25,1046.5,2093,4186.01],Db:[17.32,34.65,69.3,138.59,277.18,554.37,1108.73,2217.46,4434.92],D:[18.35,36.71,73.42,146.83,293.66,587.33,1174.66,2349.32,4698.64],Eb:[19.45,38.89,77.78,155.56,311.13,622.25,1244.51,2489.02,4978.03],E:[20.6,41.2,82.41,164.81,329.63,659.26,1318.51,2637.02],F:[21.83,43.65,87.31,174.61,349.23,698.46,1396.91,2793.83],Gb:[23.12,46.25,92.5,185,369.99,739.99,1479.98,2959.96],G:[24.5,49,98,196,392,783.99,1567.98,3135.96],Ab:[25.96,51.91,103.83,207.65,415.3,830.61,1661.22,3322.44],A:[27.5,55,110,220,440,880,1760,3520],Bb:[29.14,58.27,116.54,233.08,466.16,932.33,1864.66,3729.31],B:[30.87,61.74,123.47,246.94,493.88,987.77,1975.53,3951.07]};function ne(e,t=0){return a=>e[a+t]??0}const Bl={KeyZ:ne(se.C),KeyS:ne(se.Db),KeyX:ne(se.D),KeyD:ne(se.Eb),KeyC:ne(se.E),KeyV:ne(se.F),KeyG:ne(se.Gb),KeyB:ne(se.G),KeyH:ne(se.Ab),KeyN:ne(se.A),KeyJ:ne(se.Bb),KeyM:ne(se.B),Comma:ne(se.C,1),KeyL:ne(se.Db,1),Period:ne(se.D,1),Semicolon:ne(se.Eb,1),Slash:ne(se.E,1),KeyQ:ne(se.C,1),Digit2:ne(se.Db,1),KeyW:ne(se.D,1),Digit3:ne(se.Eb,1),KeyE:ne(se.E,1),KeyR:ne(se.F,1),Digit5:ne(se.Gb,1),KeyT:ne(se.G,1),Digit6:ne(se.Ab,1),KeyY:ne(se.A,1),Digit7:ne(se.Bb,1),KeyU:ne(se.B,1),KeyI:ne(se.C,2),Digit9:ne(se.Db,2),KeyO:ne(se.D,2),Digit0:ne(se.Eb,2),KeyP:ne(se.E,2),BracketLeft:ne(se.F,2),Equal:ne(se.Gb,2),BracketRight:ne(se.G,2)},t0={8:"sine",9:"sawtooth",10:"square",11:"triangle"};let ot;function a0(){if(ot!==null)try{ot=new AudioContext}catch(e){ot=null,console.error(e),g(ae(e,"Error initializing audio context")+". Notes will not play.",-1)}}const Fg={pentatonic:["C","D","E","G","A"],wholetone:["C","D","E","Gb","Ab","Bb"]};function Wg(e){const t={octave:4,direction:1};return async()=>{Qs===null&&await Ed(),o0(e,t)}}const zg={position:0,octave:4,direction:1},Rg={12:{name:"pentatonic",preview:Wg("pentatonic"),meta:zg},13:{name:"wholetone",preview:Wg("wholetone"),meta:zg}};function o0(e,t){if(ot===void 0&&a0(),!ot)return;const a=Ct(0,Fg[e].length-1);Math.random()<.5&&(t.octave+=t.direction),t.octave>=6&&(t.direction=-1),t.octave<=4&&(t.direction=1);const s=Fg[e][a],i=se[s][t.octave],l=ot.createOscillator(),c=ot.createGain();l.type="sine",c.gain.value=r.soundVolume/10,l.connect(c),c.connect(ot.destination),l.frequency.value=i,l.start(ot.currentTime),c.gain.setTargetAtTime(0,ot.currentTime,.3),l.stop(ot.currentTime+2)}function y2(e,t){var d;if(ot===void 0&&a0(),!ot||(Oi=e??Oi,!(Oi in Bl)))return;const s=3+(is||rs||Yn?1:0),i=(d=Bl[Oi])==null?void 0:d.call(Bl,s),l=ot.createOscillator(),c=ot.createGain();l.type=t??t0[r.playSoundOnClick],c.gain.value=r.soundVolume/10,l.connect(c),c.connect(ot.destination),l.frequency.value=i,l.start(ot.currentTime),c.gain.setTargetAtTime(0,ot.currentTime,.15),l.stop(ot.currentTime+.5)}async function Mo(e){if(r.playSoundOnClick==="off")return;if(r.playSoundOnClick in Rg){const{name:i,meta:l}=Rg[r.playSoundOnClick];o0(i,l);return}if(r.playSoundOnClick in t0){y2(e??void 0);return}Qs===null&&await Ed();const t=Qs[r.playSoundOnClick];if(t===void 0)throw new Error("Invalid click sound ID");const a=Ya(t),s=a.sounds[a.counter];a.counter++,a.counter===2&&(a.counter=0),s.seek(0),s.play()}async function Pd(){if(r.playSoundOnError==="off")return;ia===null&&await e0();const e=ia[r.playSoundOnError];if(e===void 0)throw new Error("Invalid error sound ID");const t=Ya(e),a=t.sounds[t.counter];t.counter++,t.counter===2&&(t.counter=0),a.seek(0),a.play()}function b2(e){try{Howler.volume(e)}catch{}}Te((e,t)=>{e==="playSoundOnClick"&&t!=="off"&&Ed(),e==="soundVolume"&&b2(parseFloat(t))});let Kf=[],Ka=[],s0=0,Vf=!0,Na=0,vt=0,Zs=0,ul=0,Bc=[],fm=[];var sy;const mt=(sy=document.getElementById("playpauseReplayButton"))==null?void 0:sy.children[0];function n0(e){Kf=e}function Qf(){const e=document.getElementById("replayWords");if(e===null)return;e.innerHTML="";let t=0;Ka.forEach(a=>{a.action==="backWord"?t--:(a.action==="submitCorrectWord"||a.action==="submitErrorWord")&&t++}),Kf.forEach((a,s)=>{if(s>t)return;const i=document.createElement("div");i.className="word";for(const l of a){const c=document.createElement("letter");c.innerHTML=l,i.appendChild(c)}e.appendChild(i)})}function ml(){var e;Bc.forEach(t=>{clearTimeout(t)}),Bc=[],fm.forEach(t=>{clearTimeout(t)}),fm=[],ul=vt,Zs=Na,mt!==void 0&&(mt.className="fas fa-play",(e=mt.parentNode)==null||e.setAttribute("aria-label","Resume replay"))}function fn(e=!1){e&&r.playSoundOnError!=="off"?Pd():Mo()}function i0(e,t=!1){var s,i,l,c;let a=(s=document.getElementById("replayWords"))==null?void 0:s.children[Na];if(a!==void 0){if(e.action==="correctLetter")t||fn(),(i=a.children[vt])==null||i.classList.add("correct"),vt++;else if(e.action==="incorrectLetter"){t||fn(!0);let d;vt>=a.children.length&&(d=document.createElement("letter"),d==null||d.classList.add("extra"),d.innerHTML=((l=e.value)==null?void 0:l.toString())??"",a.appendChild(d)),d=a.children[vt],d==null||d.classList.add("incorrect"),vt++}else if(e.action==="setLetterIndex"&&typeof e.value=="number"){t||fn(),vt=e.value;for(const d of[...a.children].slice(vt))d!=null&&d.classList.contains("extra")?d.remove():d.className=""}else if(e.action==="submitCorrectWord")t||fn(),Na++,vt=0;else if(e.action==="submitErrorWord")t||fn(!0),a==null||a.classList.add("error"),Na++,vt=0;else if(e.action==="backWord"){t||fn(),Na--;const d=document.getElementById("replayWords");for(d!==null&&(a=d.children[Na]),vt=a.children.length;((c=a.children[vt-1])==null?void 0:c.className)==="";)vt--;a==null||a.classList.remove("error")}}}function Zf(){var s;let e=0;vt=0,Na=0,Ka.forEach((i,l)=>{(Na<Zs||Na===Zs&&vt<ul)&&(i0(i,!0),e=l+1)});const t=(s=Ka[e])==null?void 0:s.time;if(t===void 0)throw new Error("Failed to load old replay: datatime is undefined");const a=Math.floor(t/1e3);return l0(a),e}function r0(){var e;n("#resultReplay").stop(!0,!0).hasClass("hidden")?(Qf(),Zf(),n("#watchReplayButton").hasClass("loaded")?n("#resultReplay").removeClass("hidden").css("display","none").slideDown(250):(n("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),n("#resultReplay").removeClass("hidden").css("display","none").slideDown(250))):(((e=mt==null?void 0:mt.parentNode)==null?void 0:e.getAttribute("aria-label"))!=="Start replay"&&ml(),n("#resultReplay").slideUp(250,()=>{n("#resultReplay").addClass("hidden")}))}function v2(){n("#resultReplay").stop(!0,!0).hasClass("hidden")||r0(),n("#replayStats").text(""),Ka=[],s0=performance.now(),Vf=!0,ul=0,Zs=0}function Yf(){Vf=!1}function Fs(e,t){if(!Vf)return;const a=performance.now()-s0;Ka.push({action:e,value:t,time:a})}function l0(e){const a=`${wo[e-1]??0}wpm	${e}s`;n("#replayStats").text(a)}function w2(){var i,l;if(vt=0,Na=0,mt===void 0)return;mt.className="fas fa-pause",(i=mt.parentNode)==null||i.setAttribute("aria-label","Pause replay"),Qf();const e=Zf(),t=(l=Ka[e])==null?void 0:l.time;if(t===void 0)throw new Error("Failed to play replay: lastTime is undefined");let a=Math.round(t/1e3);const s=Math.round(Hs(Ka).time/1e3);for(;a<=s;){const c=a;fm.push(setTimeout(()=>{l0(c)},c*1e3-t)),a++}Ka.forEach((c,d)=>{d<e||Bc.push(setTimeout(()=>{i0(c)},c.time-t))}),Bc.push(setTimeout(()=>{ul=0,Zs=0,mt.className="fas fa-play",mt.parentNode.setAttribute("aria-label","Start replay")},Hs(Ka).time-t))}function k2(){return JSON.stringify({replayData:Ka,wordsList:Kf})}n(".pageTest #playpauseReplayButton").on("click",()=>{(mt==null?void 0:mt.className)==="fas fa-play"?w2():(mt==null?void 0:mt.className)==="fas fa-pause"&&ml()});n("#replayWords").on("click","letter",e=>{ml();const t=document.querySelector("#replayWords"),a=[...(t==null?void 0:t.children)??[]];Zs=a.indexOf(e.target.parentNode),ul=[...a[Zs].children].indexOf(e.target),Qf(),Zf()});n(".pageTest").on("click","#watchReplayButton",()=>{r0()});class Ai{constructor(t,a,s,i,l){this.unit=t,this.convertFactor=a,this.fullUnitString=s,this.histogramDataBucketSize=i,this.historyStepSize=l}fromWpm(t){return t*this.convertFactor}toWpm(t){return t/this.convertFactor}}const C2={wpm:new Ai("wpm",1,"Words per Minute",10,10),cpm:new Ai("cpm",5,"Characters per Minute",50,100),wps:new Ai("wps",1/60,"Words per Second",.5,2),cps:new Ai("cps",5/60,"Characters per Second",5,5),wph:new Ai("wph",60,"Words per Hour",250,1e3)};function pt(e){return C2[e]}const Id={composing:!1,startPos:-1};function Ws(){return Id.composing}function S2(){return Id.startPos}function Xf(e){Id.composing=e}function x2(e){Id.startPos=e}const Lt=16,c0=12,pm=Lt/2,T2=c0/2,Og=250;let zt=[],lt,Xn={},Dc=[],qd=[],tr=[],Jf=[],Ln=[],Dl,pn,d0=new Date,$r=!1,u0=!1,gm=!0,Fc=!0,hm=!1,Fl=!1;async function $2(e,t){if(!u0||Ln!==void 0&&e===Ln[0]&&t===Ln[1]||!$r&&!await A2()||e===void 0||t===void 0||e<0||t<0||t<e)return!1;t=Math.min(t,lt.length-1);const a=M2(e,t,hm);for(let s=0;s<zt.length;s++){const i=qd[s],l=i.children[0];i.classList.remove("highlight-hidden"),!gm&&!Fc?(i.classList.add("withAnimation"),l.classList.add("withAnimation")):(i.classList.remove("withAnimation"),l.classList.remove("withAnimation"));const c=a[s];c&&(i.style.right=c.highlightRight+"px",l.style.left=c.inputContainerLeft+"px",i.style.left=c.highlightLeft+"px")}return gm=!1,Fc=!1,Ln=[e,t],!0}function L2(){for(const e of qd)e.classList.add("highlight-hidden");Fc=!0,Ln=[]}function ep(){if($r){for(const e of Dc)e.remove();qd=[],Dc=[],Xn={},zt=[],tr=[],Jf=[],$r=!1,gm=!0,Fc=!0,Ln=[]}}function m0(e){u0=e}async function A2(){if($r||Fl)return!1;Fl=!0;const e=new Date().getTime()-d0.getTime();if(e<Og&&await new Promise(m=>setTimeout(m,Og-e)),hm=(await ps(r.language)).rightToLeft,Dl=n("#resultWordsHistory")[0],pn=Dl.getBoundingClientRect(),lt=n(Dl).find(".words .word[input]"),lt.length===0)return Fl=!1,!1;let a=-1,s,i=0;Xn[0]=0;for(let m=1;m<lt.length;m++){const f=lt[m],p=lt[m-1];f.offsetTop!==p.offsetTop&&(i++,s=Qi([lt[a+1],p]),zt.push({firstWordIndex:a+1,lastWordIndex:m-1,rect:s}),a=m-1),Xn[m]=i}s=Qi([lt[a+1],lt[lt.length-1]]),zt.push({firstWordIndex:a+1,lastWordIndex:lt.length-1,rect:s});const l=pn.width,c=pn.height,d=pn.top,u=pn.left;return zt.forEach(m=>{const f=document.createElement("div");f.classList.add("highlightContainer"),Dc.push(f);const p=m.rect.top-T2,h=m.rect.left-pm,y=p-d,b=h-u,v=m.rect.width+Lt,C=m.rect.height+c0,E=m.rect.width,k=m.rect.height,M=y/c*100+"%",q=b/l*100+"%",W=v/l*100+"%",x=C/c*100+"%";f.style.width=W,f.style.top=M,f.style.left=q,f.style.height=x;const L=document.createElement("div"),D=document.createElement("div");D.style.top=m.rect.top-p+"px",D.style.left=m.rect.left-h+"px",D.style.width=E+"px",D.style.height=k+"px",L.className="highlight highlight-hidden",D.className="inputWordsContainer";for(let K=m.firstWordIndex;K<=m.lastWordIndex;K+=1){const J=lt[K],ke=J.getAttribute("input")??"";if(!ke)continue;const Je=document.createElement("div");let Jt;hm?Jt=m.rect.left-pn.left+Lt:Jt=0,Je.style.left=J.offsetLeft+pm-Jt+"px",Je.innerHTML=ke.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt").slice(0,J.childElementCount),Je.className="inputWord",D.append(Je),Jf.push(Je)}tr.push(D),qd.push(L),L.append(D),f.append(L),Dl.append(f)}),$r=!0,Fl=!1,!0}function M2(e,t,a=!1){const s=Xn[e],i=new Array(zt.length).fill(null).map(()=>({highlightLeft:0,highlightRight:0,inputContainerLeft:0,inputContainerRight:0})),l=E2(e,t),c=lt[e],d=zt[s],u=i[s],m=Dc[s],f=tr[s];if(c===void 0||d===void 0||u===void 0||m===void 0||f===void 0)return i;if(!a)u.highlightLeft=c.offsetLeft,u.highlightRight=d.rect.width-(u.highlightLeft+l)+Lt;else{const p=m.offsetLeft;u.highlightRight=d.rect.width-(c.offsetLeft+c.offsetWidth)+p+pm,u.highlightLeft=d.rect.width-(u.highlightRight+l)+Lt}a?u.inputContainerLeft=-1*(f.getBoundingClientRect().width-l-u.highlightRight):u.inputContainerLeft=-1*u.highlightLeft;for(let p=s-1;p>=0;p--){const h=i[p],y=i[p+1],b=zt[p],v=tr[p];h===void 0||b===void 0||y===void 0||v===void 0||(a?(h.highlightRight=y.highlightRight+b.rect.width+Lt,h.highlightLeft=b.rect.width-(h.highlightRight+l)+Lt,h.inputContainerLeft=-1*(v.getBoundingClientRect().width-l-h.highlightRight)):(h.highlightLeft=y.highlightLeft+b.rect.width+Lt,h.highlightRight=b.rect.width-(h.highlightLeft+l)+Lt,h.inputContainerLeft=-1*h.highlightLeft))}for(let p=s+1;p<zt.length;p++){const h=i[p],y=zt[p-1],b=zt[p],v=i[p-1],C=tr[p];h===void 0||y===void 0||b===void 0||v===void 0||C===void 0||(a?(h.highlightRight=-1*(y.rect.width-v.highlightRight+Lt),h.highlightLeft=b.rect.width-(h.highlightRight+l)+Lt,h.inputContainerLeft=-1*(C.getBoundingClientRect().width-l-h.highlightRight)):(h.highlightLeft=-1*(y.rect.width-v.highlightLeft+Lt),h.highlightRight=b.rect.width-(h.highlightLeft+l)+Lt,h.inputContainerLeft=-1*h.highlightLeft))}return i}function E2(e,t){var b,v;const a=Xn[e],s=Xn[t];if(a===void 0||s===void 0)return 0;const i=lt[e],l=lt[t],c=Jf[t],d=lt[((b=zt[a])==null?void 0:b.lastWordIndex)??-1],u=lt[((v=zt[s])==null?void 0:v.firstWordIndex)??-1];if(i===void 0||l===void 0||c===void 0||d===void 0||u===void 0)return 0;if(a===s){const C=Qi([i,l]),E=l.getBoundingClientRect(),k=c.getBoundingClientRect();let M=C.width+Lt;return M-=E.width-k.width,M}const m=Qi([i,d]),f=Qi([u,l]);let p=m.width+f.width;for(let C=a+1;C<s;C++)p+=zt[C].rect.width;p+=2*Lt*(s-a);const h=l.getBoundingClientRect(),y=c.getBoundingClientRect();return p-=h.width-y.width,p}function P2(){d0=new Date}let f0="loading";function ce(){return f0}function I2(e){f0=e}const yu={suffix:"",fallback:"-",showDecimalPlaces:void 0,rounding:Math.round};class q2{constructor(t){this.config=t}typingSpeed(t,a={}){const s={...yu,...a};if(t==null)return s.fallback??"";const i=pt(this.config.typingSpeedUnit).fromWpm(t);return this.number(i,s)}percentage(t,a={}){const s={...yu,...a};return s.suffix="%"+(s.suffix??""),this.number(t,s)}accuracy(t,a={}){return this.percentage(t,{rounding:Math.floor,...a})}decimals(t,a={}){const s={...yu,...a};return this.number(t,s)}number(t,a){if(t==null)return a.fallback??"";const s=a.suffix??"";return(a.showDecimalPlaces!==void 0?a.showDecimalPlaces:this.config.alwaysShowDecimalPlaces)?Q(t).toFixed(2)+s:(a.rounding??Math.round)(t).toString()+s}rank(t,a={}){const s={fallback:"-",...a};if(t==null)return s.fallback??"";let i="th";const l=t%10,c=t%100;return l===1&&c!==11&&(i="st"),l===2&&c!==12&&(i="nd"),l===3&&c!==13&&(i="rd"),t+i}}const N=new q2(r);let Mi=null;class Wc{constructor(t){this.words=t,this.length=this.words.length,this.shuffledIndexes=[],this.orderedIndex=0}resetIndexes(){this.orderedIndex=0,this.shuffledIndexes=[]}randomWord(t){return t==="zipf"?this.words[j1(this.words.length)]:Ya(this.words)}shuffledWord(){return this.shuffledIndexes.length===0&&this.generateShuffledIndexes(),this.words[this.shuffledIndexes.pop()]}generateShuffledIndexes(){this.shuffledIndexes=[];for(let t=0;t<this.length;t++)this.shuffledIndexes.push(t);Gn(this.shuffledIndexes)}nextWord(){return this.orderedIndex>=this.length&&(this.orderedIndex=0),this.words[this.orderedIndex++]}}async function B2(e){return(Mi===null||e!==Mi.words)&&(Mi=new Wc(e)),Mi.resetIndexes(),Mi}function D2(){return Math.floor(Math.random()*256).toString(2).padStart(8,"0")}function F2(){const e=Ct(1,4);return Array.from({length:e},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join("")}function W2(e){const t={a:".-",b:"-...",c:"-.-.",d:"-..",e:".",f:"..-.",g:"--.",h:"....",i:"..",j:".---",k:"-.-",l:".-..",m:"--",n:"-.",o:"---",p:".--.",q:"--.-",r:".-.",s:"...",t:"-",u:"..-",v:"...-",w:".--",x:"-..-",y:"-.--",z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",_:"..--.-",'"':".-..-.",$:"...-..-","!":"-.-.--","@":".--.-."};let a="";const s=lM(e);for(let i=0;i<s.length;i++){const l=t[s.toLowerCase()[i]];a+=l!==void 0?l+"/":""}return a}function z2(){const e=Ct(1,7);let t="";for(let a=0;a<e;a++)t+=String.fromCharCode(97+Ct(0,25));return t}function R2(){const e=Ct(1,10);let t="";for(let a=0;a<e;a++){const s=33+Ct(0,93);t+=String.fromCharCode(s)}return t}function O2(){const e=Ct(1,7);let t="";const a=["`","~","!","@","#","$","%","^","&","*","(",")","-","_","=","+","{","}","[","]","'",'"',"/","\\","|","?",";",":",">","<"];for(let s=0;s<e;s++)t+=Ya(a);return t}function p0(e){const t=Ct(1,e);let a="";for(let s=0;s<t;s++){let i;s===0?i=Ct(1,9):i=Ct(0,9),a+=i.toString()}return a}let zn={};function tt(e,t,a){zn[e]??(zn[e]={value:t,setFunction:a})}function g0(){Object.keys(zn).forEach(e=>{const t=zn[e];t.setFunction(t.value,!0)}),zn={}}const h0=[];function _2(e){h0.push(e)}async function H2(e){h0.forEach(t=>{try{t(e)}catch(a){console.error("TTS event subscriber threw an error"),console.error(a)}})}let Ei=!1,Wl=0,bu=0,_g=0,Hg=3,gn=0,hn=0;function j2(e){bu--;let t=Math.round(Math.random()),a=Math.round(Math.random()*5-.5);return e?(Ei=!!Math.round(Math.random()),Ei?a=3:a=0):(Ei?(_g===t?gn++:gn=0,(gn>1||hn>0&&gn>0)&&(t=1-t,gn=0),_g=t,a=t*(Wl+1)):(Hg===t?hn++:hn=0,(hn>1||hn>0&&gn>0)&&(t=1-t,hn=0),Hg=t,a=3-t*(Wl+1)),Ei=!Ei,bu<0&&t===0&&(Wl=1-Wl,bu=Math.floor(Math.random()*3)+3)),a}function N2(e){const t=["←","↓","↑","→"];let a="";for(let s=0;s<4;s++)a+=t[j2(s===0&&e)];return a}function y0(){n("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:1},125)}function ar(){n("#typingTest #layoutfluidTimer").stop(!0,!0).animate({opacity:0},125)}function vu(e,t){n("#typingTest #layoutfluidTimer").text(`${Gs(t)} in: ${e}s`)}function G2(e,t){const a=Gs(t.replace(/_/g," "));let s=`${a} in: ${e} words`;e===1&&(s=`${a} starting next word`),n("#typingTest #layoutfluidTimer").text(s)}const tp=[];function U2(e){tp.push(e)}async function b0(e,t){tp.forEach(a=>{try{a("flash",e,t)}catch(s){console.error("Keymap flash event subscriber threw an error"),console.error(s)}})}async function Zo(e){tp.forEach(t=>{try{t("highlight",e)}catch(a){console.error("Keymap highlight event subscriber threw an error"),console.error(a)}})}let No=null,ic=null;function K2(){n("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:1},125)}function v0(){n("#typingTest #memoryTimer").stop(!0,!0).animate({opacity:0},125)}function Jn(){ic!==null&&(clearInterval(ic),ic=null),No=null,v0()}function V2(e){Jn(),No=e,jg(No),K2(),ic=setInterval(()=>{No!==null&&(No-=1,No===0?v0():jg(No),No<=0&&(Jn(),n("#wordsWrapper").addClass("hidden")))},1e3)}function jg(e){n("#typingTest #memoryTimer").text(`Timer left to memorise all words: ${e}s`)}const Q2=new Set(["—","_"," "]),Z2=100,Y2="https://poetrydb.org/random";class X2 extends Iw{constructor(t,a,s){super(t,a,s),this.title=t,this.author=a,this.words=s,this.cleanUpText()}cleanUpText(){let t=0;const a=[];for(const s of this.words){let i="";for(const l of s)Q2.has(l)||(i+=l);if(i!==""&&(a.push(i),t++,t===Z2))break}this.words=a}}async function J2(){console.log("Getting poem");try{const a=(await(await fetch(Y2)).json())[0];if(!a)return!1;const s=[];return a.lines.forEach(i=>{i.split(/ +/).forEach(l=>{s.push(l)})}),new X2(a.title,a.author,s)}catch(e){return console.log(e),!1}}async function eE(e){switch(e.name){case"english":return"en";case"spanish":return"es";case"french":return"fr";case"german":return"de";case"portuguese":return"pt";case"arabic":return"ar";case"italian":return"it";case"latin":return"la";case"afrikaans":return"af";case"korean":return"ko";case"russian":return"ru";case"polish":return"pl";case"czech":return"cs";case"slovak":return"sk";case"ukrainian":return"uk";case"lithuanian":return"lt";case"indonesian":return"id";case"greek":return"el";case"turkish":return"tr";case"thai":return"th";case"tamil":return"ta";case"slovenian":return"sl";case"croatian":return"hr";case"dutch":return"nl";case"danish":return"da";case"hungarian":return"hu";case"norwegian_bokmal":return"no";case"norwegian_nynorsk":return"nn";case"hebrew":return"he";case"malay":return"ms";case"romanian":return"ro";case"finnish":return"fi";case"estonian":return"et";case"welsh":return"cy";case"persian":return"fa";case"kazakh":return"kk";case"vietnamese":return"vi";case"swedish":return"sv";case"serbian":return"sr";case"georgian":return"ka";case"catalan":return"ca";case"bulgarian":return"bg";case"esperanto":return"eo";case"bangla":return"bn";case"urdu":return"ur";case"armenian":return"hy";case"myanmar":return"my";case"hindi":return"hi";case"macedonian":return"mk";case"uzbek":return"uz";case"belarusian":return"be";case"azerbaijani":return"az";case"latvian":return"lv";case"euskera":return"eu";default:return"en"}}const tE=o.object({query:o.object({pages:o.record(o.string(),o.object({extract:o.string()}))})});async function aE(e){de();let t="en",a;try{a=await _M(e)}catch(d){console.error(ae(d,"Failed to find current language group"))}a!==void 0&&(t=await eE(a));const s=`https://${t}.wikipedia.org/api/rest_v1/page/random/summary`,i={title:"",author:""},l=await fetch(s);let c=0;if(l.status===200){const d=await l.json();i.title=d.title,i.author=d.author,c=d.pageid}return new Promise((d,u)=>{l.status!==200&&(Z(),u(l.status));const m=`https://${t}.wikipedia.org/w/api.php?action=query&format=json&pageids=${c}&prop=extracts&exintro=true&origin=*`,f=new XMLHttpRequest;f.onload=()=>{if(f.readyState===4)if(f.status===200){const h=ri(f.responseText,tE).query.pages[c.toString()];if(!h){Z(),u("Page not found");return}let y=h.extract;y=y.replace(/<\/p><p>+/g," "),y=N1(y),y=y.replace(/\[\d+\]/gi,""),y=y.replace(/[\u200B-\u200D\uFEFF]/g,""),y=Cb(y),t==="en"&&(y=y.replace(/[^\x20-\x7E]+/g,"")),y=y.replace(/\s+/g," "),y=y.trim();const b=y.split(" "),v=new Iw(i.title,i.author,b);Z(),d(v)}else Z(),u(f.status)},f.open("GET",m),f.send()})}const oE=50,sE=20,nE=5e3,or={};class iE{constructor(){this.average=0,this.count=0}update(t){this.count<oE&&this.count++;const a=1/this.count;this.average=t*a+this.average*(1-a)}}function rE(e,t){var i;const a=Ce.spacing.array;if(a.length===0||typeof a=="string")return;let s=a[a.length-1];t||(s+=nE),e in or||(or[e]=new iE),(i=or[e])==null||i.update(s)}function lE(e){let t=0,a=0;for(const s of e)s in or&&(t+=or[s].average,a++);return a===0?0:t/a}function cE(e){let t,a="";for(let s=0;s<sE;s++){const i=e.randomWord("normal"),l=lE(i);(s===0||t===void 0||l>t)&&(a=i,t=l)}return a}function w0(e,t,a,s,i){const l=[],c=Math.round(e/t);for(let d=0;d<t;d++){let m=Ct(0,2**c-1).toString(a);if(s){const f=Math.ceil(c/Math.ceil(Math.log2(a)));m="0".repeat(Math.max(0,f-m.length))+m}l.push(m)}return l.join(i)}function Ng(e,t,a,s,i,l){const c=i.split(s).map(m=>parseInt(m,a)),d=Math.round(e/t);let u=l;for(let m=0;m<t;m++)u-=d,u<0&&(-u<=d?c[m]&=2**d-1^2**-u-1:c[m]=0);return c.map(m=>m.toString(a)).join(s)+"/"+l.toString()}function dE(){return w0(32,4,10,!1,".")}function uE(){return w0(128,8,16,!0,":")}function Gg(e){return e.includes(":")?Ng(128,8,16,":",e,Ct(16,32)*4):Ng(32,4,10,".",e,Ct(8,32))}function mE(e){const t=e.split("/");let a=t[0].split(":"),s="";a=a.map(f=>f.replace(/^0+/gm,""));let i=0,l=-1,c=-1,d=0,u=-1,m=-1;for(let f=0;f<a.length;f++)a[f]===""?(u===-1&&(u=f),d++):(m=f-1,i<d&&(i=d,l=u,c=m),d=0,u=-1,m=-1);return i<d&&(i=d,l=u,c=a.length-1),a=a.map((f,p)=>f===""?p>=l&&p<=c&&l!==c?":":"0":f),s=a.join(":"),s=s.replace(/:{3,}/gm,"::"),t.length>1&&(s+="/"+t[1]),s}class ut extends Error{constructor(t){super(t),this.name="WordGenError"}}async function wu(e){const t=(T.current??"").slice(-1),a=R.getCurrent().slice(T.current.length-1,T.current.length),s=t===a;e.key==="Backspace"&&!s&&(T.current!==""||T.getHistory(te-1)!==R.get(te-1)||r.freedomMode)?n("#words").addClass("read_ahead_disabled"):e.key===" "&&n("#words").removeClass("read_ahead_disabled")}class fE{constructor(){this.chars={},this.count=0}addChar(t){this.count++,t in this.chars?this.chars[t]++:this.chars[t]=1}randomChar(){const t=Ct(0,this.count-1);let a=0;for(const[s,i]of Object.entries(this.chars))if(a+=i,a>t)return s;return Object.keys(this.chars)[0]}}class pE extends Wc{constructor(t){super(t),this.ngrams={},this.length=1/0;for(let a of t){a+=" ";let s="";for(const i of a)s in this.ngrams||(this.ngrams[s]=new fE),this.ngrams[s].addChar(i),s=(s+i).slice(-2)}}randomWord(){let t="";for(;;){const a=t.slice(-2),s=this.ngrams[a];if(!s){t="";continue}const i=s.randomChar();if(i===" ")break;t+=i}return t}}const gE={58008:{getWord(){let e=p0(7);return r.language.startsWith("kurdish")?e=hy(e):r.language.startsWith("nepali")&&(e=yy(e)),e},punctuateWord(e){if(e.length>3&&(Math.random()<.5&&(e=qg(e,Ct(1,e.length-2),".")),Math.random()<.75)){const t=Ct(1,e.length-2);if(e[t-1]!=="."&&e[t+1]!=="."&&e[t+1]!=="0"){const a=Ya(["/","*","-","+"]);e=qg(e,t,a)}}return e},rememberSettings(){tt("numbers",r.numbers,ma)},handleChar(e){return e===`
`?" ":e}},simon_says:{applyConfig(){na("next",!0)},rememberSettings(){tt("keymapMode",r.keymapMode,na)}},tts:{applyConfig(){na("off",!0)},rememberSettings(){tt("keymapMode",r.keymapMode,na)},toggleScript(e){if(window.speechSynthesis===void 0){g("Failed to load text-to-speech script",-1);return}e[0]!==void 0&&H2(e[0])}},arrows:{getWord(e,t){return N2(t===0)},rememberSettings(){tt("highlightMode",r.highlightMode,Ko)},handleChar(e){return e==="a"||e==="ArrowLeft"||e==="j"?"←":e==="s"||e==="ArrowDown"||e==="k"?"↓":e==="w"||e==="ArrowUp"||e==="i"?"↑":e==="d"||e==="ArrowRight"||e==="l"?"→":e},isCharCorrect(e,t){return(e==="a"||e==="ArrowLeft"||e==="j")&&t==="←"||(e==="s"||e==="ArrowDown"||e==="k")&&t==="↓"||(e==="w"||e==="ArrowUp"||e==="i")&&t==="↑"||(e==="d"||e==="ArrowRight"||e==="l")&&t==="→"},async preventDefaultEvent(e){return["ArrowLeft","ArrowUp","ArrowRight","ArrowDown"].includes(e.key)},getWordHtml(e,t){let a="";return e==="↑"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-up"></i>',t&&(a+="</letter>")),e==="↓"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-down"></i>',t&&(a+="</letter>")),e==="←"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-left"></i>',t&&(a+="</letter>")),e==="→"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-right"></i>',t&&(a+="</letter>")),a}},rAnDoMcAsE:{alterText(e){let t=e[0];for(let a=1;a<e.length;a++)t[a-1]===t[a-1].toUpperCase()?t+=e[a].toLowerCase():t+=e[a].toUpperCase();return t}},backwards:{alterText(e){return e.split("").reverse().join("")}},capitals:{alterText(e){return al(e)}},layout_mirror:{applyConfig(){let e=r.layout;r.layout==="default"&&(e="qwerty"),ro(e,!0),Qo("overrideSync",!0)},rememberSettings(){tt("keymapMode",r.keymapMode,na),tt("layout",r.layout,ro)}},layoutfluid:{applyConfig(){const e=r.customLayoutfluid.split("#")[0]??"qwerty";ro(e,!0),Qo(e,!0)},rememberSettings(){tt("keymapMode",r.keymapMode,na),tt("layout",r.layout,ro),tt("keymapLayout",r.keymapLayout,Qo)},handleSpace(){if(r.mode!=="time"){const e=r.customLayoutfluid?r.customLayoutfluid.split("#"):["qwerty","dvorak","colemak"],t=R.length,a=Math.floor(t/e.length),s=Math.floor((T.getHistory().length+1)/a),i=a-(te+1)%a;e[s]?(i<=3&&e[s+1]?(y0(),G2(i,e[s+1])):ar(),i===a&&(ro(e[s]),Qo(e[s]),i>3&&ar())):ar(),setTimeout(()=>{Zo(R.getCurrent().charAt(T.current.length).toString())},1)}},getResultContent(){return r.customLayoutfluid.replace(/#/g," ")},restart(){this.applyConfig&&this.applyConfig(),setTimeout(()=>{Zo(R.getCurrent().substring(T.current.length,T.current.length+1).toString())},1)}},gibberish:{getWord(){return z2()}},ascii:{getWord(){return R2()}},specials:{getWord(){return O2()}},read_ahead_easy:{rememberSettings(){tt("highlightMode",r.highlightMode,Ko)},async handleKeydown(e){await wu(e)}},read_ahead:{rememberSettings(){tt("highlightMode",r.highlightMode,Ko)},async handleKeydown(e){await wu(e)}},read_ahead_hard:{rememberSettings(){tt("highlightMode",r.highlightMode,Ko)},async handleKeydown(e){await wu(e)}},memory:{applyConfig(){n("#wordsWrapper").addClass("hidden"),br(!0,!0),r.keymapMode==="next"&&na("react",!0)},rememberSettings(){tt("mode",r.mode,dt),tt("showAllLines",r.showAllLines,br),r.keymapMode==="next"&&tt("keymapMode",r.keymapMode,na)},start(){Jn(),n("#words").addClass("hidden")},restart(){V2(Math.round(Math.pow(R.length,1.2))),n("#words").removeClass("hidden"),r.keymapMode==="next"&&na("react")}},nospace:{rememberSettings(){tt("highlightMode",r.highlightMode,Ko)}},poetry:{async pullSection(){return J2()}},wikipedia:{async pullSection(e){return aE((e??"")||"english")}},weakspot:{getWord(e){return e!==void 0?cE(e):""}},pseudolang:{async withWords(e){return e!==void 0?new pE(e):new Wc([])}},IPv4:{getWord(){return dE()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Gg(e)),t},rememberSettings(){tt("numbers",r.numbers,ma)}},IPv6:{getWord(){return uE()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=Gg(e)),t.includes(":")&&(t=mE(t)),t},rememberSettings(){tt("numbers",r.numbers,ma)}},binary:{getWord(){return D2()}},hexadecimal:{getWord(){return F2()},punctuateWord(e){return`0x${e}`},rememberSettings(){tt("punctuation",r.punctuation,Ea)}},zipf:{getWordsFrequencyMode(){return"zipf"}},ddoouubblleedd:{alterText(e){return e.replace(/./gu,"$&$&")}},instant_messaging:{alterText(e){return e.toLowerCase().replace(/[.!?]$/g,`
`).replace(/[().'"]/g,"").replace(/\n+/g,`
`)}},morse:{alterText(e){return W2(e)}},underscore_spaces:{alterText(e,t,a){return t===a-1?e:e+"_"}},crt:{applyGlobalCSS(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){const t=navigator.userAgent.match(/.*Version\/([0-9]*)\.([0-9]*).*/),a=t!==null?parseInt(t[1]??"0"):0,s=t!==null?parseInt(t[2]??"0"):0;if(a<=16&&s<=5){g("CRT is not available on Safari 16.5 or earlier.",0,{duration:5}),Fn("crt");return}}n("body").append('<div id="scanline" />'),n("body").addClass("crtmode"),n("#globalFunBoxTheme").attr("href","funbox/crt.css")},clearGlobal(){n("#scanline").remove(),n("body").removeClass("crtmode"),n("#globalFunBoxTheme").attr("href","")}},ALL_CAPS:{alterText(e){return e.toUpperCase()}},polyglot:{async withWords(e){const t=r.customPolyglot.map(async i=>ci(i).catch(()=>(g(`Failed to load language: ${i}. It will be ignored.`,0),null))),a=(await Promise.all(t)).filter(i=>i!==null);if(a.length===0)throw Fn("polyglot"),new Error(`No valid languages found. Please check your polyglot languages config (${r.customPolyglot.join(", ")}).`);if(a.length===1){const i=a[0];throw Us(i.name,!0),Fn("polyglot",!0),g(`Disabled polyglot funbox because only one valid language was found. Check your polyglot languages config (${r.customPolyglot.join(", ")}).`,0,{duration:7}),new ut("")}const s=a.flatMap(i=>i.words);return Gn(s),new Wc(s)}}};function hE(){return gE}const yE=uM(),bE=hE(),ym={};for(const[e,t]of Object.entries(yE))ym[e]={...t,functions:bE[e]};function zc(e){return Array.isArray(e)?e.map(a=>ym[a]):ym[e]}function vE(e){return zc(hd(e))}function Wo(){return zc(hd(r.funbox))}function Eo(){return hd(r.funbox)}function k0(e){return Wo().filter(t=>{var a;return(a=t.properties)==null?void 0:a.includes(e)})}function ln(e){return k0(e).length>0}function ht(e){return Wo().filter(t=>{var a;return(a=t.functions)==null?void 0:a[e]})}function C0(e){return ht(e).length>0}function zo(e){const t=ht(e);if(t.length!==0){if(t.length===1)return t[0];throw new Error(`Expecting exactly one funbox implementing "${e} but found ${t.length}`)}}async function wE(){return(await sf(async()=>{const{default:e}=await import("./html2canvas.esm.CBrSDip1.js");return{default:e}},[])).default}function kE(e,t,a){const s=go(a);let i="";for(const l of e)for(const c of l){const d=t[c].offsetLeft,u=t[c].offsetWidth,m=`[${c}]`,f=s[c];i+=`<hint data-length=1 data-chars-index=${m} style="left: ${d+u/2}px;">${f}</hint>`}return i=`<div class="hints">${i}</div>`,i}async function CE(e,t,a){const i=(await ps(r.language)).rightToLeft;let l=0;for(const c of e){for(let d=0;d<c.length-1;d++){const u=a[l],m=a[l+1],f=i?m:u,p=i?u:m;if(f.offsetLeft+f.offsetWidth/2>p.offsetLeft-p.offsetWidth/2){u.dataset.length=(parseInt(u.dataset.length??"1")+parseInt(m.dataset.length??"1")).toString();const h=u.dataset.charsIndex??"[]",y=m.dataset.charsIndex??"[]";u.dataset.charsIndex=h.slice(0,-1)+","+y.slice(1);const b=c[d]??0,v=t[b].offsetLeft+(i?t[b].offsetWidth:0)+(m.offsetLeft-u.offsetLeft);u.style.left=v.toString()+"px",u.insertAdjacentHTML("beforeend",m.innerHTML),m.remove(),c.splice(d+1,1),l-=d===0?1:2,d-=d===0?1:2}l++}l++}}const SE=Pt(250,async()=>{const e=await OM(r.language);e==="no"&&g(`${Gs($o(r.language))} does not support Zipf funbox, because the list is not ordered by frequency. Please try another word list.`,0,{duration:7}),e==="unknown"&&g(`${Gs($o(r.language))} may not support Zipf funbox, because we don't know if it's ordered by frequency or not. If you would like to add this label, please contact us.`,0,{duration:7})});Te((e,t,a)=>{(e==="language"||e==="funbox")&&r.funbox.split("#").includes("zipf")&&SE(),e==="fontSize"&&!a&&(Jr(),km()),["fontSize","fontFamily","blindMode","hideExtraLetters"].includes(e)&&T0().catch(s=>{console.error(s)}),e==="theme"&&Rn(),t!==void 0&&(e==="highlightMode"&&ce()==="test"&&Dd(),["highlightMode","blindMode","indicateTypos","tapeMode","hideExtraLetters"].includes(e)&&km(),["tapeMode","tapeMargin"].includes(e)&&_E(),e==="showAllLines"&&(op(!0),t===!1&&M0()),typeof t=="boolean"&&(e==="flipTestColors"&&PE(t),e==="colorfulMode"&&IE(t),e==="burstHeatmap"&&Rn()))});let Ze=0,ze=!1,_t=!1,bm=!1,vm=0,Ys=!1;function S0(e){ze=e}function xE(e){Ze=e}let{promise:TE,resolve:Ug}=an();function wm(e){_t=e,e?{promise:TE,resolve:Ug}=an():Ug()}function x0(e){Ys=e}function $E(){vm=0,Ze=0}function Bd(){n("#wordsInput").trigger("focus")}function Dd(e,t=!1){const a=document.querySelector("#words .active");e||a==null||a.classList.add("typed"),r.mode==="zen"&&e?a==null||a.remove():a!==null&&!t&&a.classList.remove("active");const s=document.querySelectorAll("#words .word")[te-Ze];if(s===void 0)throw new Error("activeWord is undefined - can't update active element");s.classList.add("active"),s.classList.remove("error"),s.classList.remove("typed"),s.offsetTop,!t&&ME()&&ap(),!t&&r.tapeMode!=="off"&&Fd()}async function T0(){var l,c,d,u;if(ce()!=="test"||ze||r.indicateTypos!=="below")return;const t=(await ps(r.language)).rightToLeft;let a,s;const i=(l=document.getElementById("words"))==null?void 0:l.querySelectorAll("div.word > div.hints > hint");for(let m=0;m<((i==null?void 0:i.length)??0);m++){const f=i==null?void 0:i[m];(!a||((c=f.parentElement)==null?void 0:c.parentElement)!==a)&&(a=(d=f.parentElement)==null?void 0:d.parentElement,s=a==null?void 0:a.querySelectorAll("letter"));const p=(u=f.dataset.charsIndex)==null?void 0:u.slice(1,-1).split(",").map(C=>parseInt(C)),h=t?parseInt(f.dataset.length??"1")-1:0;let b=(s==null?void 0:s[(p==null?void 0:p[h])??0]).offsetLeft;const v=(p==null?void 0:p.reduce((C,E)=>{const k=s==null?void 0:s[E];return C+k.offsetWidth},0))??0;b+=v/2,f.style.left=b.toString()+"px"}}function $0(e){let t=!1,a="<div class='word'>";const s=zo("getWordHtml"),i=go(e);for(const l of i)s?a+=s.functions.getWordHtml(l,!0):l==="	"?a+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:l===`
`?(t=!0,a+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):a+="<letter>"+l+"</letter>";return a+="</div>",t&&(a+="<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),a}function km(){var t,a,s;r.tapeMode!=="off"?(n("#words").addClass("tape"),n("#wordsWrapper").addClass("tape")):(n("#words").removeClass("tape"),n("#wordsWrapper").removeClass("tape")),r.blindMode?(n("#words").addClass("blind"),n("#wordsWrapper").addClass("blind")):(n("#words").removeClass("blind"),n("#wordsWrapper").removeClass("blind")),r.indicateTypos==="below"?(n("#words").addClass("indicateTyposBelow"),n("#wordsWrapper").addClass("indicateTyposBelow")):(n("#words").removeClass("indicateTyposBelow"),n("#wordsWrapper").removeClass("indicateTyposBelow")),r.hideExtraLetters?(n("#words").addClass("hideExtraLetters"),n("#wordsWrapper").addClass("hideExtraLetters")):(n("#words").removeClass("hideExtraLetters"),n("#wordsWrapper").removeClass("hideExtraLetters"));const e=((s=(a=(t=n("#words"))==null?void 0:t.attr("class"))==null?void 0:a.split(/\s+/))==null?void 0:s.filter(i=>!i.startsWith("highlight-")))??[];r.highlightMode!==null&&e.push("highlight-"+r.highlightMode.replaceAll("_","-")),n("#words").attr("class",e.join(" ")),P0(),op(!0),EE(),setTimeout(()=>{ap(!0)},250)}function LE(){if(n("#words").empty(),r.mode==="zen")L0();else{let e="";for(let t=0;t<R.length;t++)e+=$0(R.get(t));n("#words").html(e)}Dd(void 0,!0),setTimeout(()=>{Ao()},125),km()}function L0(){n("#words").append("<div class='word'><letter class='invisible'>_</letter></div>")}const AE=["japanese","chinese","korean"];function ME(){return AE.some(t=>r.language.startsWith(t))||r.mode!=="time"&&r.showAllLines}async function ap(e=!1){if(ce()!=="test")return;const a=(await ps(r.language)).rightToLeft,s=document.querySelector("#wordsInput"),i=document.querySelectorAll("#words .word")[te-Ze];if(!i){s.style.top="0px",s.style.left="0px";return}const l=window.getComputedStyle(i),c=parseInt(l.marginTop)+parseInt(l.marginBottom),d=Kn(r.fontSize),u=i.offsetTop+d/2-s.offsetHeight/2+1;i.offsetWidth<d?s.style.width=d+"px":s.style.width=i.offsetWidth+"px",e&&r.tapeMode==="off"?s.style.top=u+d+c+4+"px":s.style.top=u+"px",i.offsetWidth<d&&a?s.style.left=i.offsetLeft-d+"px":s.style.left=i.offsetLeft+"px"}let A0=Promise.resolve();async function M0(){var d;if(r.showAllLines)return;const{resolve:e,promise:t}=an();A0=t;const a=document.querySelectorAll("#words .word"),s=te-Ze,i=a[s];if(!i){e();return}const l=i.offsetTop;let c=l;for(let u=s-1;u>=0;u--)if(c=((d=a[u])==null?void 0:d.offsetTop)??l,c<l){await sp(c,!0),e();return}e()}function op(e=!1){var f;if(ce()!=="test"||ze||!e&&r.mode!=="custom")return;const t=document.getElementById("wordsWrapper"),a=document.querySelector(".outOfFocusWarning"),s=t.querySelectorAll("#words .word"),i=s[te-Ze];if(!i)return;t.classList.remove("hidden");const l=window.getComputedStyle(i),c=parseInt(l.marginTop)+parseInt(l.marginBottom),d=i.offsetHeight+c,u=r.mode==="time"||r.mode==="custom"&&je()==="time"||r.mode==="custom"&&qe()===0;if(r.showAllLines&&!u)t.style.height="";else if(r.mode==="zen")t.style.height=d*2+"px";else if(r.tapeMode==="off"){let p=0,h=0,y=0,b=0;for(;p<3;){const v=s[y];if(!v)break;const C=v.offsetTop;C>h&&(p++,b+=v.offsetHeight+c,h=C),y++}p<3&&(b=b*(3/p)),t.style.height=b+"px"}else if(Cr)t.style.height=d*3+"px";else{const p=((f=document.getElementById("words"))==null?void 0:f.offsetHeight)??d;t.style.height=p+"px"}a.style.maxHeight=d*3+"px"}function EE(){r.tapeMode!=="off"?Fd():setTimeout(()=>{n("#words").css("margin-left","unset"),n("#words .afterNewline").css("margin-left","unset")},0)}function Kg(e){n("#words").append($0(e))}function PE(e){e?n("#words").addClass("flipped"):n("#words").removeClass("flipped")}function IE(e){e?n("#words").addClass("colorfulMode"):n("#words").removeClass("colorfulMode")}let Vg=!1;async function qE(){var p,h;de();let e=!1,t=!1;(G1("#cookiesModal")||document.contains(document.querySelector("#cookiesModal")))&&(t=!0);function a(){Z(),n("#ad-result-wrapper").removeClass("hidden"),n("#ad-result-small-wrapper").removeClass("hidden"),n("#testConfig").removeClass("hidden"),n(".pageTest .screenshotSpacer").remove(),n("#notificationCenter").removeClass("hidden"),n("#commandLineMobileButton").removeClass("hidden"),n(".pageTest .ssWatermark").addClass("hidden"),n(".pageTest .ssWatermark").text("monkeytype.com"),n(".pageTest .buttons").removeClass("hidden"),n("noscript").removeClass("hidden"),n("#nocss").removeClass("hidden"),n("header, footer").removeClass("invisible"),n("#result").removeClass("noBalloons"),n(".wordInputHighlight").removeClass("hidden"),n(".highlightContainer").removeClass("hidden"),t&&n("#cookiesModal").removeClass("hidden"),e&&n("#resultReplay").removeClass("hidden"),j()||n(".pageTest .loginTip").removeClass("hidden"),document.querySelector("html").style.scrollBehavior="smooth";for(const y of ht("applyGlobalCSS"))y.functions.applyGlobalCSS()}n("#resultReplay").hasClass("hidden")||(e=!0,ml());const s=new Date(Date.now());n("#resultReplay").addClass("hidden"),n(".pageTest .ssWatermark").removeClass("hidden");const i=$(),l=[oe(s,"dd MMM yyyy HH:mm"),"monkeytype.com"];if((i==null?void 0:i.name)!==void 0){const y=`${i==null?void 0:i.name}${el(i,{iconsOnly:!0})}`;l.unshift(y)}n(".pageTest .ssWatermark").html(l.map(y=>`<span>${y}</span>`).join("<span class='pipe'>|</span>")),n(".pageTest .buttons").addClass("hidden"),n("#notificationCenter").addClass("hidden"),n("#commandLineMobileButton").addClass("hidden"),n(".pageTest .loginTip").addClass("hidden"),n("noscript").addClass("hidden"),n("#nocss").addClass("hidden"),n("#ad-result-wrapper").addClass("hidden"),n("#ad-result-small-wrapper").addClass("hidden"),n("#testConfig").addClass("hidden"),n(".page.pageTest").prepend("<div class='screenshotSpacer'></div>"),n("header, footer").addClass("invisible"),n("#result").addClass("noBalloons"),n(".wordInputHighlight").addClass("hidden"),n(".highlightContainer").addClass("hidden"),t&&n("#cookiesModal").addClass("hidden");for(const y of ht("clearGlobal"))y.functions.clearGlobal();document.querySelector("html").style.scrollBehavior="auto",window.scrollTo({top:0});const c=n("#result .wrapper"),d=((p=c.offset())==null?void 0:p.left)??0,u=((h=c.offset())==null?void 0:h.top)??0,m=c.outerWidth(!0),f=c.outerHeight(!0);try{const y=Kn(2),b=Kn(2);(await(await wE())(document.body,{backgroundColor:await Ut("bg"),width:m+y*2,height:f+b*2,x:d-y,y:u-b})).toBlob(async C=>{try{if(C===null)throw new Error("Could not create image, blob is null");const E=new ClipboardItem(Object.defineProperty({},C.type,{value:C,enumerable:!0}));await navigator.clipboard.write([E]),g("Copied to clipboard",1,{duration:2})}catch(E){console.error("Error while saving image to clipboard",E),C?(navigator.userAgent.toLowerCase().includes("firefox")&&!Vg&&(Vg=!0,g("On Firefox you can enable the asyncClipboard.clipboardItem permission in about:config to enable copying straight to the clipboard",0,{duration:10})),g("Could not save image to clipboard. Opening in new tab instead (make sure popups are allowed)",0,{duration:5}),open(URL.createObjectURL(C))):g(ae(E,"Error saving image to clipboard"),-1)}a()})}catch(y){g(ae(y,"Error creating image"),-1),a()}setTimeout(()=>{a()},3e3)}async function Ta(e){var d,u;const t=e??T.current,a=R.getCurrent();if(!a&&r.mode!=="zen")return;let s="";const i=(d=document.querySelectorAll("#words .word"))==null?void 0:d[te-Ze];if(!i)return;const l=[];let c=!1;if(r.mode==="zen"){for(const m of T.current)m==="	"?s+=`<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:m===`
`?(c=!0,s+=`<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):s+=`<letter class="correct">${m}</letter>`;T.current===""&&(s+="<letter class='invisible'>_</letter>")}else{let m=!1;const f=T.getKoreanStatus();if(f){const b=it.disassemble(a).join(""),v=it.disassemble(t).join(""),C=Go.test(t)?t.search(Go):v.length;t.search(Go)<it.d(b).length&&b.slice(0,C)===v.slice(0,C)&&(m=!0)}else{const b=Go.test(t)?t.search(Go):t.length;t.search(Go)<a.length&&a.slice(0,b)===t.slice(0,b)&&(m=!0)}const p=zo("getWordHtml"),h=go(t),y=go(a);for(let b=0;b<h.length;b++){const v=y[b]===h[b];let C=y[b],E="",k="";if(p){const M=p.functions.getWordHtml(C);M!==""&&(C=M)}else C==="	"?(E="tabChar",C='<i class="fas fa-long-arrow-alt-right fa-fw"></i>'):C===`
`&&(k="nlChar",C='<i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i>');if(v)s+=`<letter class="correct ${E}${k}">${C}</letter>`;else if(C!==void 0&&Ws()&&b>=S2()&&!(f&&!m))s+=`<letter class="dead">${r.indicateTypos==="replace"?h[b]===" "?"_":h[b]:C}</letter>`;else if(C===void 0){let M=h[b];(M===" "||M==="	"||M===`
`)&&(M="_"),s+=`<letter class="incorrect extra ${E}${k}">${M}</letter>`}else if(s+=`<letter class="incorrect ${E}${k}">`+(r.indicateTypos==="replace"?h[b]===" "?"_":h[b]:C)+"</letter>",r.indicateTypos==="below")if(!(l!=null&&l.length))l.push([b]);else{const M=l[l.length-1];(M==null?void 0:M[M.length-1])===b-1?M.push(b):l.push([b])}}for(let b=h.length;b<y.length;b++){const v=y[b];(u=p==null?void 0:p.functions)!=null&&u.getWordHtml?s+=p.functions.getWordHtml(v,!0):v==="	"?s+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:v===`
`?s+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`:s+="<letter>"+v+"</letter>"}}if(i.innerHTML=s,l!=null&&l.length){const m=i.querySelectorAll("letter"),f=kE(l,m,t);i.insertAdjacentHTML("beforeend",f);const p=i.getElementsByTagName("hint");await CE(l,m,p)}c&&n("#words").append("<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),r.tapeMode!=="off"&&Fd()}function BE(e,t=!0){let a;if(e?a=e.querySelector("letter.nlChar"):a=document.querySelector("#words > .word > letter.nlChar"),!a||t&&a.classList.contains("incorrect"))return 0;const s=window.getComputedStyle(a),i=parseFloat(s.marginLeft)+parseFloat(s.marginRight);return a.offsetWidth+i}async function Fd(){if(ce()!=="test"||ze)return;await A0;const e=te-Ze,t=document.querySelector("#wordsWrapper").offsetWidth,a=document.getElementById("words"),s=[...a.children],l=a.getElementsByClassName("word")[e];if(!l)return;const c=a.getElementsByClassName("afterNewline");let d=0,u=0,m=0,f=!1,p,h=0;const y=[],b=[],v=[];for(const K of s)if(K.classList.contains("word")){p&&(h+=parseFloat(p.style.marginLeft));break}else K.classList.contains("afterNewline")&&(v.push(K),f=!0,p=K);let C;const E=s.indexOf(l),k=s.slice(0,E).filter(K=>K.classList.contains("afterNewline")).length;let M=c[k+1];M?C=s.indexOf(M):(M=c[k],M?C=s.indexOf(M):C=E-1);const q=parseFloat(window.getComputedStyle(l).marginRight);for(let K=0;K<=C;K++){const J=s[K];if(J.classList.contains("word")){f=!1;const ke=n(J).outerWidth(!0)??0,Je=Math.floor(J.offsetLeft),Jt=Math.floor(J.offsetWidth);Je<0-Jt?(v.push(J),h+=ke,m++):(u+=ke,K<E&&(d=u))}else if(J.classList.contains("afterNewline")){if(f)continue;const ke=BE(s[K-3]);if(u-=ke+q,K<E&&(d=u),u<a.offsetWidth)b.push(u),y.push(h);else{b.push(a.offsetWidth),y.push(h),K<C&&(b.push(a.offsetWidth),y.push(h));break}}}if(v.length>0){Ze+=m;for(const J of v)J.remove();for(let J=0;J<y.length;J++){const ke=c[J],Je=parseFloat(ke.style.marginLeft)||0;ke.style.marginLeft=`${Je-(y[J]??0)}px`}const K=parseFloat(a.style.marginLeft)||0;a.style.marginLeft=`${K+h}px`}let W=0;if(r.tapeMode==="letter"&&T.current.length>0){const K=l.querySelectorAll("letter");for(let J=0;J<T.current.length;J++){const ke=K[J];(r.blindMode||r.hideExtraLetters)&&ke.classList.contains("extra")||(W+=n(ke).outerWidth(!0)??0)}}const L=t*(r.tapeMargin/100)-(d+W),D=n(a);if(r.smoothLineScroll){D.stop("leftMargin",!0,!1).animate({marginLeft:L},{duration:He()?0:125,queue:"leftMargin"}),D.dequeue("leftMargin");for(let K=0;K<b.length;K++){const J=b[K]??0;n(c[K]).stop(!0,!1).animate({marginLeft:J},He()?0:125)}}else{a.style.marginLeft=`${L}px`;for(let K=0;K<b.length;K++){const J=b[K]??0;c[K].style.marginLeft=`${J}px`}}}function DE(){const e=Qr(r,re);let t="";r.funbox!=="none"&&(t=" "+r.funbox.split("#").join(" ")),n(".pageTest #premidTestMode").text(`${r.mode} ${e} ${$o(r.language)}${t}`),n(".pageTest #premidSecondsLeft").text(r.time)}function Qg(e,t){var s;if(!t&&(t=(s=document.getElementById("words"))==null?void 0:s.children,!t))return 0;let a=0;for(let i=0;i<=e;i++){const l=t[i];!l||!l.isConnected||(l.classList.contains("word")&&a++,l.classList.contains("smoothScroller")||l.remove())}return a}let ku=0;async function sp(e,t=!1){const{resolve:a,promise:s}=an();if(vm>0||t){const i=e,l=te-Ze,c=document.getElementById("words"),d=[...c.children],m=c.querySelectorAll(".word")[l];if(!m){a();return}const f=d.indexOf(m);let p;for(let b=f-1;b>=0;b--){const v=d[b];if(!v.classList.contains("hidden")&&Math.floor(v.offsetTop)<i){if(v.classList.contains("word")){p=b;break}else if(v.classList.contains("beforeNewline")){p=b+1;break}}}const h=n(m).outerHeight(!0),y=document.querySelector("#paceCaret");if(p===void 0)a();else if(r.smoothLineScroll){bm=!0;const b=n("#words .smoothScroller");b.length===0?c.insertAdjacentHTML("afterbegin",`<div class="smoothScroller" style="position: fixed;height:${h}px;width:100%"></div>`):b.css("height",`${(b.outerHeight(!0)??0)+h}px`),n("#words .smoothScroller").stop(!0,!1).animate({height:0},He()?0:125,()=>{n("#words .smoothScroller").remove()}),n(y).stop(!0,!1).animate({top:(y==null?void 0:y.offsetTop)-h},He()?0:125);const v={marginTop:`-${h*(ku+1)}px`};ku++;const C=n(c);C.stop("topMargin",!0,!1).animate(v,{duration:He()?0:125,queue:"topMargin",complete:()=>{var E,k;ku=0,(k=(E=document.querySelectorAll("#words .word"))==null?void 0:E[l])==null||k.offsetTop,Ze+=Qg(p,d),c.style.marginTop="0",bm=!1,a()}}),C.dequeue("topMargin")}else Ze+=Qg(p,d),y.style.top=`${y.offsetTop-h}px`,a()}return vm++,op(),s}function FE(e){e?(n("#words").addClass("rightToLeftTest"),n("#resultWordsHistory .words").addClass("rightToLeftTest"),n("#resultReplay .words").addClass("rightToLeftTest")):(n("#words").removeClass("rightToLeftTest"),n("#resultWordsHistory .words").removeClass("rightToLeftTest"),n("#resultReplay .words").removeClass("rightToLeftTest"))}function WE(e){e?(n("#words").addClass("withLigatures"),n("#resultWordsHistory .words").addClass("withLigatures"),n("#resultReplay .words").addClass("withLigatures")):(n("#words").removeClass("withLigatures"),n("#resultWordsHistory .words").removeClass("withLigatures"),n("#resultReplay .words").removeClass("withLigatures"))}async function zE(){n("#resultWordsHistory .words").empty();let e="";for(let t=0;t<T.getHistory().length+2;t++){const a=T.getHistory(t),s=at.getHistory(t),i=R.get(t),l=(a==null?void 0:a.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null||(i==null?void 0:i.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g))!==null;let c="";try{if(a===void 0||a==="")throw new Error("empty input word");const d=a!==i?"error":"";if(s!==void 0&&s!==""){const h=l?it.assemble(s.split("")):s;c=`<div class='word nocursor ${d}' burst="${La[t]}" input="${h.replace(/"/g,"&quot;").replace(/ /g,"_")}">`}else c=`<div class='word nocursor ${d}' burst="${La[t]}" input="${a.replace(/"/g,"&quot;").replace(/ /g,"_")}">`;const u=go(a),m=go(i),f=go(s??"");let p;if(r.mode==="zen"||a.length>i.length?p=u.length:p=m.length,s===void 0)throw new Error("empty corrected word");for(let h=0;h<p;h++){let y;try{y=l?it.assemble(s.split(""))[h]:f[h]}catch{y=void 0}let b="";const v=l?it.assemble(s.split("")):s;h+1===p&&v!==void 0&&v.length>a.length&&(b="extraCorrected"),r.mode==="zen"||m[h]!==void 0?r.mode==="zen"||u[h]===m[h]?y===u[h]||y===void 0?c+=`<letter class="correct ${b}">${u[h]}</letter>`:c+=`<letter class="corrected ${b}">`+u[h]+"</letter>":u[h]===T.current?c+=`<letter class='correct ${b}'>`+m[h]+"</letter>":u[h]===void 0?c+="<letter>"+m[h]+"</letter>":c+=`<letter class="incorrect ${b}">`+m[h]+"</letter>":c+='<letter class="incorrect extra">'+u[h]+"</letter>"}c+="</div>"}catch{try{c="<div class='word'>";for(const u of i)c+="<letter>"+u+"</letter>";c+="</div>"}catch{}}e+=c}return n("#resultWordsHistory .words").html(e),n("#showWordHistoryButton").addClass("loaded"),!0}function E0(e=!1){ze&&(P2(),n("#resultWordsHistory").stop(!0,!0).hasClass("hidden")?n("#resultWordsHistory .words .word").length===0?(n("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),zE().then(()=>{r.burstHeatmap&&Rn(),n("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250,()=>{r.burstHeatmap&&Rn()})})):(r.burstHeatmap&&Rn(),n("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250)):n("#resultWordsHistory").slideUp(250,()=>{n("#resultWordsHistory").addClass("hidden")}))}async function Rn(){if(r.burstHeatmap){n("#resultWordsHistory .heatmapLegend").removeClass("hidden");let e=[...La];e=e.filter(u=>u!==1/0),e=e.filter(u=>u<350);const t=pt(r.typingSpeedUnit);e.forEach((u,m)=>{e[m]=Math.round(t.fromWpm(u))});const a=await fs();let s=[a.colorfulError,wa(a.colorfulError,a.text,.5),a.text,wa(a.main,a.text,.5),a.main],i=a.sub;a.main===a.text&&(s=[a.colorfulError,wa(a.colorfulError,a.text,.5),a.sub,wa(a.sub,a.text,.5),a.main],i=a.subAlt);const l=e.sort((u,m)=>u-m),c=e.length,d=[{val:0,colorId:0},{val:l[c*.15|0],colorId:1},{val:l[c*.35|0],colorId:2},{val:l[c*.65|0],colorId:3},{val:l[c*.85|0],colorId:4}];d.forEach((u,m)=>{const f=d[m+1];let p="";m===0&&f?p=`<${Math.round(f.val)}`:m===4?p=`${Math.round(u.val)}+`:f&&(u.val!==f.val?p=`${Math.round(u.val)}-${Math.round(f.val)-1}`:p=`${Math.round(u.val)}-${Math.round(u.val)}`),n("#resultWordsHistory .heatmapLegend .box"+m).html(`<div>${p}</div>`)}),n("#resultWordsHistory .words .word").each((u,m)=>{const f=n(m).attr("burst");if(f===void 0)n(m).css("color",i);else{let p=parseInt(f);p=Math.round(pt(r.typingSpeedUnit).fromWpm(p)),d.forEach(h=>{p>=h.val&&(n(m).addClass("heatmapInherit"),n(m).css("color",s[h.colorId]))})}}),n("#resultWordsHistory .heatmapLegend .boxes .box").each((u,m)=>{n(m).css("background",s[u])})}else n("#resultWordsHistory .heatmapLegend").addClass("hidden"),n("#resultWordsHistory .words .word").removeClass("heatmapInherit"),n("#resultWordsHistory .words .word").css("color",""),n("#resultWordsHistory .heatmapLegend .boxes .box").css("color","")}function RE(e){n(n("#words .word")[e]).addClass("error")}function OE(e){n(n("#words .word")[e]).find("letter").addClass("correct")}function P0(){let e={};r.tapeMode==="off"?r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":r.maxLineWidth+"ch"}:r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":"100%"};const t=n("#typingTest");t.css(e),r.maxLineWidth===0?t.removeClass("full-width-padding").addClass("content"):t.removeClass("content").addClass("full-width-padding")}function _E(){r.tapeMode==="off"?n("#liveStatsMini").css({"justify-content":"start","margin-left":"0.25em"}):n("#liveStatsMini").css({"justify-content":"center","margin-left":r.tapeMargin+"%"})}function HE(e){n("#barTimerProgress").css("opacity",parseFloat(e)),n("#liveStatsTextTop").css("opacity",parseFloat(e)),n("#liveStatsTextBottom").css("opacity",parseFloat(e)),n("#liveStatsMini").css("opacity",parseFloat(e))}function jE(e){n("#barTimerProgress").removeClass("timerSub"),n("#barTimerProgress").removeClass("timerText"),n("#barTimerProgress").removeClass("timerMain"),n("#liveStatsTextTop").removeClass("timerSub"),n("#liveStatsTextTop").removeClass("timerText"),n("#liveStatsTextTop").removeClass("timerMain"),n("#liveStatsTextBottom").removeClass("timerSub"),n("#liveStatsTextBottom").removeClass("timerText"),n("#liveStatsTextBottom").removeClass("timerMain"),n("#liveStatsMini").removeClass("timerSub"),n("#liveStatsMini").removeClass("timerText"),n("#liveStatsMini").removeClass("timerMain"),e==="main"?(n("#barTimerProgress").addClass("timerMain"),n("#liveStatsTextTop").addClass("timerMain"),n("#liveStatsTextBottom").addClass("timerMain"),n("#liveStatsMini").addClass("timerMain")):e==="sub"?(n("#barTimerProgress").addClass("timerSub"),n("#liveStatsTextTop").addClass("timerSub"),n("#liveStatsTextBottom").addClass("timerSub"),n("#liveStatsMini").addClass("timerSub")):e==="text"&&(n("#barTimerProgress").addClass("timerText"),n("#liveStatsTextTop").addClass("timerText"),n("#liveStatsTextBottom").addClass("timerText"),n("#liveStatsMini").addClass("timerText"))}n(".pageTest").on("click","#saveScreenshotButton",()=>{qE()});n(".pageTest #copyWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=T.getHistory().join(" "):e=R.get().slice(0,T.getHistory().length).join(" "),await I0(e)});n(".pageTest #copyMissedWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=T.getHistory().join(" "):e=Object.keys(vo??{}).join(" "),await I0(e)});async function I0(e){try{await navigator.clipboard.writeText(e),g("Copied to clipboard",0,{duration:2})}catch(t){g("Could not copy to clipboard: "+t,-1)}}n(".pageTest #toggleBurstHeatmap").on("click",async()=>{Lw(!r.burstHeatmap),ep()});n(".pageTest #resultWordsHistory").on("mouseleave",".words .word",()=>{n(".wordInputHighlight").remove()});n(".pageTest #result #wpmChart").on("mouseleave",()=>{m0(!1),L2()});n(".pageTest #result #wpmChart").on("mouseenter",()=>{m0(!0)});n(".pageTest #resultWordsHistory").on("mouseenter",".words .word",e=>{if(ze){const t=n(e.currentTarget).attr("input"),a=parseInt(n(e.currentTarget).attr("burst"));t!==void 0&&n(e.currentTarget).append(`<div class="wordInputHighlight withSpeed">
          <div class="text">
          ${t.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt")}
          </div>
          <div class="speed">
          ${N.typingSpeed(a,{showDecimalPlaces:!1})}
          ${r.typingSpeedUnit}
          </div>
          </div>`)}});addEventListener("resize",()=>{ep()});n("#wordsInput").on("focus",e=>{e.target===document.activeElement&&(!ze&&r.showOutOfFocusWarning&&Jr(),Zw(!0))});n("#wordsInput").on("focusout",()=>{!ze&&r.showOutOfFocusWarning&&GA(),dl()});n(".pageTest").on("click","#showWordHistoryButton",()=>{E0()});n("#wordsWrapper").on("click",()=>{Bd()});Te((e,t)=>{e==="quickRestart"&&(t==="off"?n(".pageTest #restartTestButton").removeClass("hidden"):n(".pageTest #restartTestButton").addClass("hidden")),e==="maxLineWidth"&&P0(),e==="timerOpacity"&&HE(t),e==="timerColor"&&jE(t)});let q0="",B0=!1;function np(){return q0}function Po(){return B0}function ls(e,t){q0=e,B0=t}let ip=!1,Xs,mi,Cm,Sm,Lr,Ar,Js=!1,D0;function NE(e){D0=e}function GE(){const e={lastResult:D0,start:Xs,end:mi,start3:Lr,end3:Ar,afkHistory:ll,errorHistory:rl,wpmHistory:wo,rawHistory:Td,burstHistory:La,keypressCountHistory:Ks,currentBurstStart:xd,lastSecondNotRound:Js,missedWords:vo,accuracy:da,keypressTimings:Ce,keyOverlap:no,wordsHistory:R.list.slice(0,T.getHistory().length),inputHistory:T.getHistory()};try{e.keypressTimings.spacing.average=Ce.spacing.array.reduce((t,a)=>a+=t)/Ce.spacing.array.length,e.keypressTimings.spacing.sd=Zi(Ce.spacing.array)}catch{}try{e.keypressTimings.duration.average=Ce.duration.array.reduce((t,a)=>a+=t)/Ce.duration.array.length,e.keypressTimings.duration.sd=Zi(Ce.duration.array)}catch{}return e}function UE(){Xs=0,mi=0,ip=!1,Js=!1}let rp=0,Rc=0,lp=[];function cp(){rp++}function dp(e){Rc+=e}function up(e,t){lp.push({acc:e,seconds:t})}function F0(){rp=0,Rc=0,lp=[]}function zl(){ip=!0}function fl(e){return e===void 0?(mi-Xs)/1e3:(e-Xs)/1e3}function mp(e){const t=fl(Ge?performance.now():mi),a=z0(),s=Q((a.correctWordChars+a.correctSpaces)*(60/t)/5),i=Q((a.allCorrectChars+a.spaces+a.incorrectChars+a.extraChars)*(60/t)/5);return{wpm:e?s:Math.round(s),raw:e?i:Math.round(i)}}function Zg(e){mi=e,Sm=Date.now(),Ar=new Date().getTime()}function KE(e){Xs=e,Cm=Date.now(),Lr=new Date().getTime()}function fp(e){let t=0;return e!==void 0&&(r.mode==="time"?t=Math.round(e)-Ks.length:t=Math.ceil(e)-Ks.length,t<0&&(t=0)),ll.filter(s=>s).length+t}function VE(){Js=!0}function W0(){var i,l;const e=T.getKoreanStatus(),t=(performance.now()-xd)/1e3;let a;if(a=e?bc.disassemble(T.current).length:T.current.length,a===0&&(a=e?((l=bc.disassemble(T.getHistoryLast()))==null?void 0:l.length)??0:((i=T.getHistoryLast())==null?void 0:i.length)??0),a===0)return 0;const s=Q(a*(60/t)/5);return Math.round(s)}function pl(){const e=da.correct/(da.correct+da.incorrect)*100;return isNaN(e)?100:e}function QE(){const e=fl();Ks.splice(e),wo.splice(e),La.splice(e),Td.splice(e)}function ZE(){const e=T.getKoreanStatus();let t=[...T.getHistory()];return Ge&&t.push(T.current),e&&(t=t.map(a=>bc.disassemble(a).join(""))),t}function YE(){const e=T.getKoreanStatus();let t=[...r.mode==="zen"?T.getHistory():R.list];return Ge&&t.push(r.mode==="zen"?T.current:R.getCurrent()),e&&(t=t.map(a=>bc.disassemble(a).join(""))),t}function z0(){let e=0,t=0,a=0,s=0,i=0,l=0,c=0;const d=ZE(),u=YE();for(let m=0;m<d.length;m++){const f=d[m],p=u[m];if(f===p)e+=p.length,t+=p.length,m<d.length-1&&kb(f)!==`
`&&c++;else if(f.length>=p.length)for(let h=0;h<f.length;h++)h<p.length?f[h]===p[h]?t++:a++:s++;else{const h={correct:0,incorrect:0,missed:0};for(let y=0;y<p.length;y++)y<f.length?f[y]===p[y]?h.correct++:h.incorrect++:h.missed++;t+=h.correct,a+=h.incorrect,m===d.length-1&&r.mode==="time"?h.incorrect===0&&(e+=h.correct):i+=h.missed}m<d.length-1&&l++}return ln("nospace")&&(l=0,c=0),{spaces:l,correctWordChars:e,allCorrectChars:t,incorrectChars:r.mode==="zen"?da.incorrect:a,extraChars:s,missedChars:i,correctSpaces:c}}function XE(){console.debug("Calculating result stats");let e=fl();console.debug("Test seconds",e," (date based) ",(Sm-Cm)/1e3," (performance.now based)",(Ar-Lr)/1e3," (new Date based)"),console.debug("Test seconds",Jl(e)," (date based) ",Jl((Sm-Cm)/1e3)," (performance.now based)",Jl((Ar-Lr)/1e3)," (new Date based)"),r.mode!=="custom"&&(e=Q(e),console.debug("Mode is not custom - rounding to 2. New time: ",e));const t=z0(),{wpm:a,raw:s}=mp(!0),i=Q(pl()),l={wpm:isNaN(a)?0:a,wpmRaw:isNaN(s)?0:s,acc:i,correctChars:t.correctWordChars,incorrectChars:t.incorrectChars,missedChars:t.missedChars,extraChars:t.extraChars,allChars:t.allCorrectChars+t.spaces+t.incorrectChars+t.extraChars,time:Q(e),spaces:t.spaces,correctSpaces:t.correctSpaces};return console.debug("Result stats",l),l}const Le={mode:null,punctuation:null,numbers:null,customText:null};function JE(e,t){if(r.mode==="zen")return!1;let a;e==="words"&&!t||e==="off"&&t?a=20:a=10;let s=[];e==="words"&&(Object.keys(vo).forEach(p=>{const h=vo[p];h!==void 0&&s.push([p,h])}),s.sort((p,h)=>h[1]-p[1]),s=s.slice(0,a));let i=[];if(e==="biwords"){for(let p=0;p<R.length;p++){const h=R.get(p),y=vo[h];y!==void 0&&(p===0?i.push([h,"",y]):i.push([h,R.get(p-1),y]))}i.sort((p,h)=>h[2]-p[2]),i=i.slice(0,a)}if((e==="words"&&s.length===0||e==="biwords"&&i.length===0)&&!t)return g("You haven't missed any words",0),!1;let l=[];if(t&&(l=R.get().map((p,h)=>[p,La[h]??0]),l.sort((p,h)=>p[1]-h[1]),l=l.slice(0,Math.min(a,Math.round(R.length*.2))),l.length===0&&g("Test too short to classify slow words.",0)),s.length===0&&i.length===0&&l.length===0)return g("Could not start a new custom test",0),!1;const c=[];s.forEach(p=>{for(let h=0;h<p[1];h++)c.push(p[0])}),i.forEach(p=>{for(let h=0;h<p[2];h++)p[1]!==""?c.push(p[1]+" "+p[0]):c.push(p[0])}),l.forEach((p,h)=>{for(let y=0;y<l.length-h;y++)c.push(p[0])});const d=Le.mode===null?r.mode:Le.mode,u=Le.punctuation===null?r.punctuation:Le.punctuation,m=Le.numbers===null?r.numbers:Le.numbers;let f=null;return r.mode==="custom"&&(f=rn()),dt("custom",!0),Vs(!0),Lo(c),xa("section"),Zn("shuffle"),Ua((l.length+s.length+i.length)*5),ls("practise",void 0),Le.mode=d,Le.punctuation=u,Le.numbers=m,Le.customText=f,!0}function R0(){Le.mode=null,Le.punctuation=null,Le.numbers=null,Le.customText=null}Te(e=>{e==="mode"&&R0()});let Wd=!1,zd=!1;n(document).on("keydown",e=>{e.code==="AltLeft"?Wd=!0:e.code==="AltRight"&&(zd=!0)});n(document).on("keyup",e=>{e.code==="AltLeft"?Wd=!1:e.code==="AltRight"&&(zd=!1)});function eP(){Wd=!1,zd=!1}const Mr=document.querySelector("#liveStatsTextBottom .liveSpeed"),Er=document.querySelector("#liveStatsMini .speed");function tP(){Mr.innerHTML="0",Er.innerHTML="0"}function aP(e,t){let a=e;r.blindMode&&(a=t);const s=N.typingSpeed(a,{showDecimalPlaces:!1});Mr.innerHTML=s,Er.innerHTML=s}let Oc=!1;function pp(){r.liveSpeedStyle!=="off"&&Ge&&(Oc||(r.liveSpeedStyle==="mini"?n(Er).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):n(Mr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Oc=!0))}function Rd(){Oc&&(n(Mr).stop(!0,!1).animate({opacity:0},125,()=>{Mr.classList.add("hidden")}),n(Er).stop(!0,!1).animate({opacity:0},125,()=>{Er.classList.add("hidden")}),Oc=!1)}Te((e,t)=>{e==="liveSpeedStyle"&&(t==="off"?Rd():pp())});const Pr=document.querySelector("#liveStatsTextBottom .liveBurst"),Ir=document.querySelector("#liveStatsMini .burst");function oP(){Pr.innerHTML="0",Ir.innerHTML="0"}async function sP(e){const t=N.typingSpeed(e,{showDecimalPlaces:!1});Ir.innerHTML=t,Pr.innerHTML=t}let _c=!1;function gp(){r.liveBurstStyle!=="off"&&Ge&&(_c||(r.liveBurstStyle==="mini"?n(Ir).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):n(Pr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),_c=!0))}function Od(){_c&&(n(Pr).stop(!0,!1).animate({opacity:0},125,()=>{n(Pr).addClass("hidden")}),n(Ir).stop(!0,!1).animate({opacity:0},125,()=>{n(Ir).addClass("hidden")}),_c=!1)}Te((e,t)=>{e==="liveBurstStyle"&&(t==="off"?Od():gp())});const qr=document.querySelector("#liveStatsTextBottom .liveAcc"),Br=document.querySelector("#liveStatsMini .acc");function nP(e){let t=Math.floor(e);r.blindMode&&(t=100),Br.innerHTML=t+"%",qr.innerHTML=t+"%"}function iP(){Br.innerHTML="100%",qr.innerHTML="100%"}let Hc=!1;function hp(){r.liveAccStyle!=="off"&&Ge&&(Hc||(r.liveAccStyle==="mini"?n(Br).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125):n(qr).stop(!0,!1).removeClass("hidden").css("opacity",0).animate({opacity:1},125),Hc=!0))}function _d(){Hc&&(n(qr).stop(!0,!1).animate({opacity:0},125,()=>{n(qr).addClass("hidden")}),n(Br).stop(!0,!1).animate({opacity:0},125,()=>{n(Br).addClass("hidden")}),Hc=!1)}Te((e,t)=>{e==="liveAccStyle"&&(t==="off"?_d():hp())});let yp=0;function Dr(){return yp}function rP(e){yp=e}function lP(){yp++}const xm=n("#barTimerProgress .bar"),O0=n("#barTimerProgress .opacityWrapper"),Hd=n("#liveStatsTextTop .timerProgress"),Fr=n("#liveStatsMini .time");function bp(){r.mode!=="zen"&&r.timerStyle==="bar"?O0.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):r.timerStyle==="text"?Hd.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125):(r.mode==="zen"||r.timerStyle==="mini")&&Fr.stop(!0,!0).removeClass("hidden").css("opacity",0).animate({opacity:1},125)}function cP(){let e="0vw";(r.mode==="time"||r.mode==="custom"&&je()==="time")&&(e="100vw"),xm.stop(!0,!0).animate({width:e},0),Fr.text("0"),Hd.text("0")}function jd(){O0.stop(!0,!0).animate({opacity:0},125),Fr.stop(!0,!0).animate({opacity:0},125,()=>{Fr.addClass("hidden")}),Hd.stop(!0,!0).animate({opacity:0},125)}const Ho=Hd[0],jo=Fr[0];function Yg(){return r.mode==="custom"&&je()==="section"?R.sectionIndexList[te]-1:T.getHistory().length}function gl(){const e=Dr();if(r.mode==="time"||r.mode==="custom"&&je()==="time"){let t=r.time;if(r.mode==="custom"&&je()==="time"&&(t=qe()),r.timerStyle==="bar"){const a=100-(e+1)/t*100;xm.stop(!0,!0).animate({width:a+"vw"},He()?0:1e3,"linear")}else if(r.timerStyle==="text"){let a=rt(t-e);t===0&&(a=rt(e)),Ho!==null&&(Ho.innerHTML="<div>"+a+"</div>")}else if(r.timerStyle==="mini"){let a=rt(t-e);t===0&&(a=rt(e)),jo!==null&&(jo.innerHTML=a)}}else if(r.mode==="words"||r.mode==="custom"||r.mode==="quote"){let t=R.length;if(r.mode==="words"&&(t=r.words),r.mode==="custom"&&(t=qe()),r.mode==="quote"&&(t=(re==null?void 0:re.textSplit.length)??1),r.timerStyle==="bar"){const a=Math.floor((te+1)/t*100);xm.stop(!0,!0).animate({width:a+"vw"},He()?0:250)}else r.timerStyle==="text"?t===0?Ho!==null&&(Ho.innerHTML=`<div>${T.getHistory().length}</div>`):Ho!==null&&(Ho.innerHTML=`<div>${Yg()}/${t}</div>`):r.timerStyle==="mini"&&(t===0?jo!==null&&(jo.innerHTML=`${T.getHistory().length}`):jo!==null&&(jo.innerHTML=`${Yg()}/${t}`))}else r.mode==="zen"&&(r.timerStyle==="text"?Ho!==null&&(Ho.innerHTML=`<div>${T.getHistory().length}</div>`):jo!==null&&(jo.innerHTML=`${T.getHistory().length}`))}function dP(){Ge&&(jd(),gl(),r.timerStyle!=="off"&&setTimeout(()=>{bp()},125))}Te((e,t)=>{e==="timerStyle"&&dP()});const Xg=3;let An=!1;function gs(e,t=!1){e&&!An?(An=!0,Vw(),n("header").addClass("focus"),n("footer").addClass("focus"),t||n("body").css("cursor","none"),n("main").addClass("focus"),n("#bannerCenter").addClass("focus"),n("#notificationCenter").addClass("focus"),n("#capsWarning").addClass("focus"),n("#ad-vertical-right-wrapper").addClass("focus"),n("#ad-vertical-left-wrapper").addClass("focus"),n("#ad-footer-wrapper").addClass("focus"),n("#ad-footer-small-wrapper").addClass("focus"),pp(),gp(),hp(),bp()):!e&&An&&(An=!1,Qw(),n("header").removeClass("focus"),n("footer").removeClass("focus"),n("body").css("cursor","default"),n("main").removeClass("focus"),n("#bannerCenter").removeClass("focus"),n("#notificationCenter").removeClass("focus"),n("#capsWarning").removeClass("focus"),n("#app").removeClass("focus"),n("#ad-vertical-right-wrapper").removeClass("focus"),n("#ad-vertical-left-wrapper").removeClass("focus"),n("#ad-footer-wrapper").removeClass("focus"),n("#ad-footer-small-wrapper").removeClass("focus"),Rd(),Od(),_d(),jd())}n(document).on("mousemove",function(e){An&&ce()!=="loading"&&(ce()==="account"&&An||e.originalEvent&&(e.originalEvent.movementX>Xg||e.originalEvent.movementY>Xg)&&gs(!1))});function jc(...e){if(r.funbox!=="none")for(const t of ht("toggleScript"))t.functions.toggleScript(e)}function uP(e){for(const t of ht("clearGlobal"))t.functions.clearGlobal();return g0(),fo(e,!1),!0}function mP(e){var a,s,i,l;if(e==="none"&&uP("none"),!Cf(Eo(),e==="none"?void 0:e)&&!r.funbox.split("#").includes(e))return g(`${Gs(e.replace(/_/g," "))} funbox is not compatible with the current funbox selection`,0),!0;g0();const t=Fn(e,!1);return Eo().includes(e)?(l=(i=zc(e).functions)==null?void 0:i.applyGlobalCSS)==null||l.call(i):(s=(a=zc(e).functions)==null?void 0:a.clearGlobal)==null||s.call(a),!(t===!1||t===!0)}async function Mn(){var e,t,a,s;return n("body").attr("class",((s=(a=(t=(e=n("body"))==null?void 0:e.attr("class"))==null?void 0:t.split(/\s+/))==null?void 0:a.filter(i=>!i.startsWith("fb-")))==null?void 0:s.join(" "))??""),n(".funBoxTheme").remove(),n("#wordsWrapper").removeClass("hidden"),Jn(),be(),!0}async function vp(e){if(e==null?e=r.funbox:r.funbox!==e&&(r.funbox=e),!Cf(Eo()))return g(ae(void 0,`Failed to activate funbox: funboxes ${r.funbox.replace(/_/g," ")} are not compatible`),-1),fo("none",!0),await Mn(),!1;Jn(),await pP(),await gP(),n("#wordsWrapper").removeClass("hidden");let t;try{t=await ps(r.language)}catch(s){return g(ae(s,"Failed to activate funbox"),-1),fo("none",!0),await Mn(),!1}if(t.ligatures&&ln("noLigatures")){g("Current language does not support this funbox mode",0),fo("none",!0),await Mn();return}let a=!0;for(const[s,i]of Object.entries(r)){const l=sm(s,i,Wo());if(!l.result&&!l.result)if(l.forcedConfigs&&l.forcedConfigs.length>0)s==="mode"&&dt(l.forcedConfigs[0]),s==="words"&&ns(l.forcedConfigs[0]),s==="time"&&Ga(l.forcedConfigs[0]),s==="punctuation"&&Ea(l.forcedConfigs[0]),s==="numbers"&&ma(l.forcedConfigs[0]),s==="highlightMode"&&Ko(l.forcedConfigs[0]);else{a=!1;break}}if(!a){r.funbox.includes("#")?g(`Failed to activate funboxes ${r.funbox}: no intersecting forced configs. Disabling funbox`,-1):g(`Failed to activate funbox ${r.funbox}: no forced configs. Disabling funbox`,-1),fo("none",!0),await Mn();return}be();for(const s of ht("applyConfig"))s.functions.applyConfig();return!0}async function fP(){for(const e of ht("rememberSettings"))e.functions.rememberSettings()}async function pP(){var s;const e=n("body"),t=Eo().map(i=>"fb-"+i.replaceAll("_","-")),a=((s=e==null?void 0:e.attr("class"))==null?void 0:s.split(/\s+/).filter(i=>!i.startsWith("fb-")))??[];return ln("ignoreReducedMotion")&&a.push("ignore-reduced-motion"),e.attr("class",[...new Set([...a,...t]).keys()].join(" ")),!0}async function gP(){n(".funBoxTheme").remove();for(const e of k0("hasCssFile")){const t=document.createElement("link");t.classList.add("funBoxTheme"),t.rel="stylesheet",t.href="funbox/"+e.name+".css",document.head.appendChild(t)}return!0}const hP={keymapShowTopRow:!0,type:"matrix",keys:{row1:[],row2:["sS","tT","pP","hH","**","fF","pP","lL","tT","dD"],row3:["sS","kK","wW","rR","**","rR","bB","gG","sS","zZ"],row4:["aA","oO","eE","uU"],row5:[]}};function yP(e){if(r.mode!=="zen"){e===""&&(e=" ");try{n(".activeKey").removeClass("activeKey");let t;r.language.startsWith("korean")&&(e=it.disassemble(e)[0]??e),e===" "?t="#keymap .keySpace":e==='"'?t=`#keymap .keymapKey[data-key*='${e}']`:t=`#keymap .keymapKey[data-key*="${e}"]`,n(t).addClass("activeKey")}catch(t){t instanceof Error&&console.log("could not update highlighted keymap key: "+t.message)}}}async function bP(e,t){if(e===void 0)return;e===" "?e="#keymap .keySpace":e==='"'?e=`#keymap .keymapKey[data-key*='${e}']`:e=`#keymap .keymapKey[data-key*="${e}"]`;const a=await fs();try{let s={color:a.bg,backgroundColor:a.sub,borderColor:a.sub};t||r.blindMode?s={color:a.bg,backgroundColor:a.main,borderColor:a.main}:s={color:a.bg,backgroundColor:a.error,borderColor:a.error},n(e).stop(!0,!0).css(s).animate({color:a.sub,backgroundColor:a.subAlt,borderColor:a.sub},He()?0:500,"easeOutExpo")}catch{}}function vP(){n("#keymap").addClass("hidden")}function wP(){n("#keymap").removeClass("hidden")}function kP(e){const{layoutData:t,rowId:a,isMatrix:s,showTopRow:i,isSteno:l,isISO:c,layoutNameDisplayString:d,isAlice:u}=e;let{rowKeys:m}=e,f=!1,p="",h="",y="";if(a==="row1"&&(s||r.keymapStyle==="staggered")&&(m=m.slice(1)),a==="row1"&&(!i||l))return"";if((a==="row2"||a==="row3"||a==="row4")&&!s&&!l&&(y+="<div></div>"),a==="row4"&&!c&&!s&&!l&&(y+="<div></div>"),s&&(a!=="row5"&&t.matrixShowRightColumn?y+='<div class="keymapKey"></div>':y+="<div></div>"),a==="row5"){if(l)return"";let b=d.replace(/_/g," "),v="";r.keymapLegendStyle==="blank"&&(v='style="display: none;"'),m.length===1&&m[0]===" "&&(m[1]=m[0]),m.length===1&&m[0]!==" "&&(m[1]=" ",m.reverse()),m.length>1&&m[0]!==" "&&m[0]===m[1]&&(m[0]=" ");const C=E=>E!==" ";f=m.some(C),y+="<div></div>";for(let E=0;E<m.length;E++){const k=m[E];let M=k[0];r.keymapLegendStyle==="uppercase"&&(M=M.toUpperCase());const q=k.replace('"',"&quot;");let W=E<1?"left":"right";f&&!u&&(W=""),E===1&&(y+='<div class="keymapSplitSpacer"></div>',p+="-"),q===" "?(y+=`<div class="keymapKey keySpace layoutIndicator ${W}">
              <div class="letter" ${v}>${b}</div>
            </div>`,p+="3",b=""):(y+=`<div class="keymapKey ${W}">
              <div class="letter">${M}</div>
            </div>`,p+="1")}}else for(let b=0;b<m.length;b++){if(a==="row2"&&b===12||a==="row4"&&s&&c&&b===0)continue;let v=10;if(t.matrixShowRightColumn&&(v=11),a==="row4"&&s&&c&&(v+=1),(r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix")&&b>=v)continue;const C=m[b],E=a==="row3"&&(b===3||b===6);let k=C[0],M="";r.keymapLegendStyle==="blank"?M='style="display: none;"':r.keymapLegendStyle==="uppercase"&&(k=k.toUpperCase());let q="";a==="row1"&&b===0&&!s&&r.keymapStyle!=="staggered"&&(q=" invisible");const W=`<div class="keymapKey${q}" data-key="${C.replace('"',"&quot;")}"><span class="letter" ${M}>${k}</span>${E?"<div class='bump'></div>":""}</div>`;let x="";(r.keymapStyle==="split"||r.keymapStyle==="split_matrix"||r.keymapStyle==="alice"||l)&&(a==="row4"&&l&&(b===0||b===2||b===4)?x+='<div class="keymapSplitSpacer"></div>':a==="row4"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")&&c?b===6&&(x+='<div class="keymapSplitSpacer"></div>'):a==="row1"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")?b===7&&(x+='<div class="keymapSplitSpacer"></div>'):a==="row4"&&s&&c?b===6&&(x+='<div class="keymapSplitSpacer"></div>'):b===5&&(x+='<div class="keymapSplitSpacer"></div>')),r.keymapStyle==="alice"&&a==="row4"&&(c&&b===6||!c&&b===5)&&(x+='<div class="extraKey"><span class="letter"></span></div>'),y+=x+W}if(a==="row5")h+=`<div
          class="row r5"
          data-row5-grid="${p}"
          data-row5-has-alpha="${f}"
        >${y}</div>`;else{const b=parseInt(a.replace("row",""));h+=`<div class="row r${b}">${y}</div>`}return h}async function Nc(e=r.layout){if(r.keymapMode!=="off"&&ce()==="test"&&e)try{let t=e,a;try{r.keymapLayout==="overrideSync"?r.layout==="default"?(a=await Ds("qwerty"),t="default"):(a=await Ds(r.layout),t=r.layout):(a=await Ds(r.keymapLayout),t=r.keymapLayout)}catch(f){g(ae(f,`Failed to load keymap ${e}`),-1);return}const s=zf&&r.keymapMode==="next"||r.keymapShowTopRow==="always"||a.keymapShowTopRow&&r.keymapShowTopRow!=="never",i=r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix",l=r.keymapStyle==="steno"||r.keymapStyle==="steno_matrix",c=r.keymapStyle==="alice";l&&(a=hP),Eo().includes("layout_mirror")&&(a=Uf(a));const u=a.type==="iso";let m="";for(const[f,p]of Object.entries(a.keys))m+=kP({layoutData:a,rowId:f,rowKeys:p,isMatrix:i,showTopRow:s,isSteno:l,isISO:u,layoutNameDisplayString:t,isAlice:c});n("#keymap").html(m),n("#keymap").removeClass("staggered"),n("#keymap").removeClass("matrix"),n("#keymap").removeClass("split"),n("#keymap").removeClass("split_matrix"),n("#keymap").removeClass("alice"),n("#keymap").removeClass("steno"),n("#keymap").removeClass("steno_matrix"),n("#keymap").addClass(r.keymapStyle)}catch(t){t instanceof Error&&console.log("something went wrong when changing layout, resettings: "+t.message)}}const CP=/Mac|iPod|iPhone|iPad/.test(navigator.platform),SP=/^[^\p{L}\p{N}]{1}$/u;let Cu=[0,0];function xP(){const e=is||rs,t=Wd||zd,s=((CP?e||Yn:e!==Yn)?1:0)+(t?2:0),i=(e?1:0)+(t?2:0),[l,c]=Cu;if(!(l===s&&c===i))return Cu=[s,i],Cu}async function _0(){const e=xP();if(e===void 0)return;const t=[...document.getElementsByClassName("keymapKey")].filter(u=>{const m=u.classList.contains("keymapKey"),f=!u.classList.contains("keySpace");return m&&f}),a=t.map(u=>u.dataset.key);if(a.includes(void 0))return;const s=t.map(u=>u.childNodes[1]),[i,l]=e,c=r.keymapLayout==="overrideSync"?r.layout==="default"?"qwerty":r.layout:r.keymapLayout,d=await Ds(c).catch(()=>{});if(d===void 0){g("Failed to load keymap layout",-1);return}for(let u=0;u<a.length;u++){const m=a[u],f=s[u],p=m[0],h=m[1];if(f===void 0||m===void 0||p===void 0||h===void 0)continue;const y=[p,h].some(M=>SP.test(M??"")),b=Yw(p,d);if(b===void 0)return;const E=mm(b)?y?l:i:0,k=m[E]??m[E-2];f.textContent=k??""}}Te((e,t)=>{e==="layout"&&r.keymapLayout==="overrideSync"&&Nc(r.keymapLayout),(e==="keymapLayout"||e==="keymapStyle"||e==="keymapShowTopRow"||e==="keymapMode")&&Nc(),e==="keymapMode"&&(t==="off"?vP():wP())});U2((e,t,a)=>{e==="highlight"&&yP(t),e==="flash"&&bP(t,a)});n(document).on("keydown",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&_0()});n(document).on("keyup",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&_0()});ga.register(gS,hS,yS,bS,vS,wS,kS,CS,SS,xS,TS,$S,LS,AS);ga.defaults.animation.duration=0;ga.defaults.elements.line.tension=.3;ga.defaults.elements.line.fill="origin";class fi extends ga{constructor(t,a){super(t,a)}async updateColors(){await $P(this)}getDataset(t){var a;return(a=this.data.datasets)==null?void 0:a.find(s=>s.yAxisID===t)}getScale(t){return this.options.scales[t]}}let Jg;const Ie=new fi(document.querySelector("#wpmChart"),{type:"line",data:{labels:[],datasets:[{clip:!1,label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{clip:!1,label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"raw",order:3,pointRadius:1},{clip:!1,label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{axis:"y",display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1,callbacks:{afterLabel:function(e){var t;if(Jg===e)return"";Jg=e;try{const a=Math.round(parseFloat(e.label))-1,s=(t=rl[a])==null?void 0:t.words,i=[...new Set(s)],l=i[0],c=Hs(i);if(l===void 0||c===void 0)return"";$2(l,c)}catch{}return""}}}}}});let H0;const U=new fi(document.querySelector(".pageAccount #accountHistoryChart"),{type:"line",data:{datasets:[{yAxisID:"wpm",data:[],fill:!1,borderWidth:0,order:3},{yAxisID:"pb",data:[],fill:!1,stepped:!0,pointRadius:0,pointHoverRadius:0,order:4},{yAxisID:"acc",fill:!1,data:[],pointStyle:"triangle",borderWidth:0,pointRadius:3.5,order:3},{yAxisID:"wpmAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"accAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"wpmAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1},{yAxisID:"accAvgHundred",label:"accAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1}]},options:{maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",type:"linear",reverse:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpm:{axis:"y",type:"linear",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Words per Minute"},position:"right"},pb:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1},acc:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Accuracy"},grid:{display:!1},position:"left"},wpmAvgTen:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgTen:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpmAvgHundred:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgHundred:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},enabled:!0,intersect:!1,external:function(e){e!==void 0&&(e.tooltip.options.displayColors=!1)},filter:function(e){return e.datasetIndex!==1&&e.datasetIndex!==3&&e.datasetIndex!==4&&e.datasetIndex!==5&&e.datasetIndex!==6},callbacks:{title:function(){return""},beforeLabel:function(e){if(e.datasetIndex!==0){const i=e.dataset.data[e.dataIndex];return`error rate: ${Q(i.errorRate)}%
acc: ${Q(100-i.errorRate)}%`}const t=e.dataset.data[e.dataIndex];let a=`${r.typingSpeedUnit}: ${t.wpm}
raw: ${t.raw}
acc: ${t.acc}

mode: ${t.mode} `;(t.mode==="time"||t.mode==="words")&&(a+=t.mode2);let s=t.difficulty;return s===void 0&&(s="normal"),a+=`
difficulty: ${s}`,a+=`
punctuation: ${t.punctuation}
language: ${t.language}${t.isPb?`

new personal best`:""}

date: ${oe(new Date(t.timestamp),"dd MMM yyyy HH:mm")}`,a},label:function(){return""},afterLabel:function(e){return H0=e.dataIndex,""}}}}}}),Yo=new fi(document.querySelector(".pageAccount #accountActivityChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Seconds",data:[],trendlineLinear:{style:"rgba(255,105,180, .8)",lineStyle:"dotted",width:2},order:3},{yAxisID:"avgWpm",label:"Average Wpm",data:[],type:"line",order:2,tension:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},type:"time",time:{unit:"day",displayFormats:{day:"d MMM"}},bounds:"ticks",display:!0,title:{display:!1,text:"Date"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:1},display:!0,title:{display:!0,text:"Time typing (minutes)"}},avgWpm:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,position:"right",title:{display:!0,text:"Average Wpm"},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index",filter:e=>e.datasetIndex===0,callbacks:{title:function(e){const t=e[0],a=t.dataset.data[t.dataIndex];return oe(new Date(a.x),"dd MMM yyyy")},beforeLabel:function(e){const t=e.dataset.data[e.dataIndex],a=pt(r.typingSpeedUnit);return`Time Typing: ${rt(Math.round(t.y*60),!0,!0)}
Tests Completed: ${t.amount}
Average ${r.typingSpeedUnit.toUpperCase()}: ${Q(a.fromWpm(t.avgWpm??0))}
Average Accuracy: ${Q(t.avgAcc??0)}%
Average Consistency: ${Q(t.avgCon??0)}%`},label:function(){return""}}}}}}),On=new fi(document.querySelector(".pageAccount #accountHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Tests",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Tests"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),_n=new fi(document.querySelector(".pageAbout #publicStatsHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Users",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Users"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),sa=new fi(document.querySelector("#miniResultChartModal canvas"),{type:"line",data:{labels:[],datasets:[{label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"wpm",order:2,pointRadius:2},{label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"raw",order:3,pointRadius:2},{label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1}}}});function TP(){j0(!1),N0(!1),G0(!1),U0(!1)}function Nd(e,t){e?n(`.pageAccount ${t}`).addClass("active"):n(`.pageAccount ${t}`).removeClass("active")}function j0(e=!0){const t=r.accountChart[0]==="on";Nd(t,".toggleResultsOnChart"),U.getDataset("wpm").hidden=!t,U.getDataset("pb").hidden=!t,U.getDataset("wpmAvgTen").hidden=!t,U.getDataset("wpmAvgHundred").hidden=!t,U.getScale("wpm").display=t,e&&U.updateColors()}function N0(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on";if(Nd(a,".toggleAccuracyOnChart"),U.getDataset("acc").hidden=!a,U.getDataset("accAvgTen").hidden=!a,U.getDataset("accAvgHundred").hidden=!a,U.getScale("acc").display=a,t)U.getScale("acc").min=0,U.getScale("accAvgTen").min=0,U.getScale("accAvgHundred").min=0;else{const s=Math.floor(Math.min(...U.getDataset("acc").data.map(i=>i.y))/10)*10;U.getScale("acc").min=s,U.getScale("accAvgTen").min=s,U.getScale("accAvgHundred").min=s}e&&U.updateColors()}function G0(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on",s=r.accountChart[2]==="on";Nd(s,".toggleAverage10OnChart"),a&&(U.getDataset("accAvgTen").hidden=!s),t&&(U.getDataset("wpmAvgTen").hidden=!s),e&&U.updateColors()}function U0(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on",s=r.accountChart[3]==="on";Nd(s,".toggleAverage100OnChart"),a&&(U.getDataset("accAvgHundred").hidden=!s),t&&(U.getDataset("wpmAvgHundred").hidden=!s),e&&U.updateColors()}async function $P(e){var h,y;const t=await Ut("bg"),a=await Ut("sub"),s=await Ut("subAlt"),i=await Ut("main"),l=await Ut("error"),c=await Ut("text"),d=wa(t,s,.75);e.data.datasets[0].borderColor=b=>{var E;return((E=b.raw)==null?void 0:E.isPb)?c:i},e.data.datasets[1]&&(e.data.datasets[1].borderColor=a),e.data.datasets[2]&&(e.data.datasets[2].borderColor=l);const u=e.data.datasets[0];((y=(h=e==null?void 0:e.data)==null?void 0:h.datasets[0])==null?void 0:y.type)===void 0?e.config.type==="line"?u.pointBackgroundColor=b=>{var E;return((E=b.raw)==null?void 0:E.isPb)?c:i}:e.config.type==="bar"&&(u.backgroundColor=i):e.data.datasets[0].type==="bar"?e.data.datasets[0].backgroundColor=i:e.data.datasets[0].type==="line"&&(u.pointBackgroundColor=i);const m=e.data.datasets[1];m!==void 0&&(m.type===void 0?e.config.type==="line"?m.pointBackgroundColor=a:e.config.type==="bar"&&(m.backgroundColor=a):(m==null?void 0:m.type)==="bar"?m.backgroundColor=a:m.type==="line"&&(m.pointBackgroundColor=a)),e.data.datasets.length===2&&(m.borderColor=()=>a);const f=e.data.datasets[2];if(e.data.datasets.length===7){f.borderColor=()=>a;const b=r.accountChart[2]==="on",v=r.accountChart[3]==="on",C=wa(t,c,.2),E=wa(t,i,.2),k=wa(t,i,.4),M=wa(t,a,.2),q=wa(t,a,.4),[W,x,L,D,K,J,ke]=e.data.datasets;if(W===void 0||x===void 0||L===void 0||D===void 0||K===void 0||J===void 0||ke===void 0)return;b&&v?(W.pointBackgroundColor=E,x.borderColor=C,L.pointBackgroundColor=M,D.borderColor=k,K.borderColor=q,J.borderColor=i,ke.borderColor=a):b&&!v||!b&&v?(x.borderColor=C,W.pointBackgroundColor=k,L.pointBackgroundColor=q,D.borderColor=i,J.borderColor=i,K.borderColor=a,ke.borderColor=a):(x.borderColor=C,W.pointBackgroundColor=i,L.pointBackgroundColor=a)}const p=e.options;Object.keys(p.scales).forEach(b=>{const v=p.scales[b];v.ticks.color=a,v.title.color=a,v.grid.color=d,v.grid.tickColor=d,v.grid.borderColor=d});try{u.trendlineLinear.style=a}catch{}e.options.plugins.annotation.annotations.forEach(b=>{b.id!=="funbox-label"&&(b.borderColor=a),b.label.backgroundColor=a,b.label.color=t}),e.update("none")}function LP(e){ga.defaults.font.family=e.replace(/_/g," ")}function K0(){tl(),U.updateColors(),On.updateColors(),_n.updateColors(),Ie.updateColors(),Yo.updateColors(),sa.updateColors()}Te((e,t)=>{e==="accountChart"&&ce()==="account"&&(j0(),N0(),G0(),U0()),e==="fontFamily"&&LP(t)});const Ae={blur:{value:0,default:0},brightness:{value:1,default:1},saturate:{value:1,default:1},opacity:{value:1,default:1}};function AP(){let e="";return Object.keys(Ae).forEach(t=>{const a=t;Ae[a].value!==Ae[a].default&&(e+=`${t}(${Ae[a].value}${t==="blur"?"rem":""}) `)}),e}function pi(){const t={filter:AP(),width:`calc(100% + ${Ae.blur.value*4}rem)`,height:`calc(100% + ${Ae.blur.value*4}rem)`,left:`-${Ae.blur.value*2}rem`,top:`-${Ae.blur.value*2}rem`,position:"absolute"};n(".customBackground img").css(t)}function MP(){n(".section[data-config-name='customBackgroundFilter'] .blur input").val(Ae.blur.value),n(".section[data-config-name='customBackgroundFilter'] .brightness input").val(Ae.brightness.value),n(".section[data-config-name='customBackgroundFilter'] .saturate input").val(Ae.saturate.value),n(".section[data-config-name='customBackgroundFilter'] .opacity input").val(Ae.opacity.value)}function hl(){n(".section[data-config-name='customBackgroundFilter'] .blur .value").html(Ae.blur.value.toFixed(1)),n(".section[data-config-name='customBackgroundFilter'] .brightness .value").html(Ae.brightness.value.toFixed(1)),n(".section[data-config-name='customBackgroundFilter'] .saturate .value").html(Ae.saturate.value.toFixed(1)),n(".section[data-config-name='customBackgroundFilter'] .opacity .value").html(Ae.opacity.value.toFixed(1))}function V0(){MP(),hl()}function EP(e){Ae.blur.value=e[0],Ae.brightness.value=e[1],Ae.saturate.value=e[2],Ae.opacity.value=e[3],V0()}n(".section[data-config-name='customBackgroundFilter'] .blur input").on("input",()=>{Ae.blur.value=parseFloat(n(".section[data-config-name='customBackgroundFilter'] .blur input").val()),hl(),pi()});n(".section[data-config-name='customBackgroundFilter'] .brightness input").on("input",()=>{Ae.brightness.value=parseFloat(n(".section[data-config-name='customBackgroundFilter'] .brightness input").val()),hl(),pi()});n(".section[data-config-name='customBackgroundFilter'] .saturate input").on("input",()=>{Ae.saturate.value=parseFloat(n(".section[data-config-name='customBackgroundFilter'] .saturate input").val()),hl(),pi()});n(".section[data-config-name='customBackgroundFilter'] .opacity input").on("input",()=>{Ae.opacity.value=parseFloat(n(".section[data-config-name='customBackgroundFilter'] .opacity input").val()),hl(),pi()});n(".section[data-config-name='customBackgroundFilter'] input").on("input",()=>{PP()});const PP=Pt(2e3,async()=>{const e=Object.keys(Ae).map(t=>Ae[t].value);Df(e,!1)});Te((e,t)=>{e==="customBackgroundFilter"&&t&&(EP(t),pi())});let kt=null,Tm=!1,Cn=0;const Io=["--bg-color","--main-color","--caret-color","--sub-color","--sub-alt-color","--text-color","--error-color","--error-extra-color","--colorful-error-color","--colorful-error-extra-color"];async function IP(){setTimeout(async()=>{let e,t;t=await Ut("bg"),e=await Ut("main"),t===e&&(t="#111",e="#eee");const a=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <style>
    #bg{fill:${t};}
    path{fill:${e};}
  </style>
  <g>
    <path id="bg" d="M0 16Q0 0 16 0h32q16 0 16 16v32q0 16-16 16H16Q0 64 0 48"/>
    <path d="M9.09 24.1v21.2h5.12V33.1q.256-4.61 4.48-4.61 3.46.384 3.46 3.84v12.9h5.12v-11.5q-.128-5.25 4.48-5.25 3.46.384 3.46 3.84v12.9h5.12v-12.2q0-9.47-7.04-9.47-4.22 0-7.04 3.46-2.18-3.46-6.02-3.46-3.46 0-6.02 2.43v-2.05M47 18.9v5.12h-4.61v5.12H47v16.1h5.12v-16.1h4.61v-5.12h-4.61V18.9"/>
  </g>
</svg>`;n("#favicon").attr("href","data:image/svg+xml;base64,"+btoa(a))},125)}function qP(){console.debug("Theme controller clearing custom theme");for(const e of Io)document.documentElement.style.setProperty(e,"")}let Pi=[];async function Q0(e){return new Promise(t=>{function a(){console.debug("Theme controller swapping elements");const l=n("#currentTheme"),c=n("#nextTheme");if(c.length===0){console.debug("Theme controller failed to swap elements, next is missing");return}l.remove(),c.attr("id","currentTheme")}console.debug("Theme controller loading style",e),Pi.push(setTimeout(()=>{de()},100)),n("#nextTheme").remove();const s=document.querySelector("#currentTheme"),i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.id="nextTheme",i.onload=()=>{console.debug("Theme controller loaded style",e),Z(),a(),Pi.map(l=>clearTimeout(l)),Pi=[],n("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},i.onerror=l=>{console.debug("Theme controller failed to load style",e,l),console.error(`Failed to load theme ${e}`,l),Z(),g("Failed to load theme",0),a(),Pi.map(c=>clearTimeout(c)),Pi=[],n("#keymap .keymapKey").stop(!0,!0).removeAttr("style"),t()},e==="custom"?i.href="/themes/serika_dark.css":i.href=`/themes/${e}.css`,s===null?(console.debug("Theme controller appending link to the head",i),document.head.appendChild(i)):(console.debug("Theme controller inserting link after current theme",i),s.after(i))})}async function os(e,t,a=!1){console.debug("Theme controller applying theme",e,t,a),qP();const s=t?"custom":e;if(tM(),n(".keymapKey").attr("style",""),await Q0(s),tl(),r.customTheme&&!a||t){const l=t??r.customThemeColors;for(let c=0;c<Io.length;c++){const d=Io[c];document.documentElement.style.setProperty(d,l[c])}}To("changedTheme",{theme:s});const i=await fs();n(".keymapKey").attr("style",""),K0(),IP(),n("#metaThemeColor").attr("content",i.bg),BP(a?e:void 0),Pw(await Ut("bg"))?n("body").addClass("darkMode"):n("body").removeClass("darkMode")}function BP(e){let t=r.theme;kt!==null&&(t=kt),r.customTheme&&(t="custom"),e!==void 0&&e!==""&&(t=e),t=t.replace(/_/g," "),n(".current-theme .text").text(t)}function DP(e,t){FP(e,t)}const FP=Pt(250,(e,t)=>{Tm=!0,os(e,t,!0)});async function Tt(e,t=!1){console.debug("Theme controller setting theme",e,t),await os(e,void 0,t),!t&&r.autoSwitchTheme&&(hw(!1),g("Auto switch theme disabled",0))}async function eh(e=!0){Tm&&(Tm=!1,e&&(kt!==null?await os(kt):r.customTheme?await os("custom"):await os(r.theme)))}let ra=[];async function Z0(){var t,a;let e;try{e=await Rf()}catch(s){console.error(ae(s,"Failed to update random theme list"));return}r.randomTheme==="fav"&&r.favThemes.length>0?ra=r.favThemes:r.randomTheme==="light"?ra=e.filter(s=>DM(s.bgColor)).map(s=>s.name):r.randomTheme==="dark"?ra=e.filter(s=>Pw(s.bgColor)).map(s=>s.name):r.randomTheme==="on"?ra=e.map(s=>s.name):r.randomTheme==="custom"&&$()&&(ra=((a=(t=$())==null?void 0:t.customThemes)==null?void 0:a.map(s=>s._id))??[]),Gn(ra),Cn=0}async function WP(){var t,a,s,i,l;if(ra.length===0&&(await Z0(),ra.length===0))return;kt=ra[Cn],Cn++,Cn>=ra.length&&(Gn(ra),Cn=0);let e;if(r.randomTheme==="custom"){const c=(a=(t=$())==null?void 0:t.customThemes)==null?void 0:a.find(d=>d._id===kt);e=c==null?void 0:c.colors,kt="custom"}if(yo(!1,!0),await os(kt,e),Cn>=ra.length){let c=kt.replace(/_/g," ");r.randomTheme==="custom"&&(c=(((l=(i=(s=$())==null?void 0:s.customThemes)==null?void 0:i.find(d=>d._id===kt))==null?void 0:l.name)??"custom").replace(/_/g," ")),g(c,0)}}async function Su(){kt!==null&&(kt=null,r.customTheme?await os("custom"):await os(r.theme))}function Y0(){r.customBackgroundSize==="max"?n(".customBackground img").css({objectFit:""}):n(".customBackground img").css({objectFit:r.customBackgroundSize})}function zP(){if(r.customBackground==="")n("#words").removeClass("noErrorBorder"),n("#resultWordsHistory").removeClass("noErrorBorder"),n(".customBackground img").remove();else{n("#words").addClass("noErrorBorder"),n("#resultWordsHistory").addClass("noErrorBorder");const e=document.querySelector(".customBackground"),t=document.createElement("img");t.setAttribute("src",r.customBackground),t.setAttribute("onError","javascript:window.dispatchEvent(new Event('customBackgroundFailed'))"),e==null||e.replaceChildren(t),pi(),Y0()}}var ny,Xl,iy;(iy=(Xl=(ny=window.matchMedia)==null?void 0:ny.call(window,"(prefers-color-scheme: dark)"))==null?void 0:Xl.addEventListener)==null||iy.call(Xl,"change",e=>{!r.autoSwitchTheme||r.customTheme||(e.matches?Tt(r.themeDark,!0):Tt(r.themeLight,!0))});Te(async(e,t,a)=>{var s,i,l;e==="randomTheme"&&Z0(),e==="customTheme"&&(t?await Tt("custom"):await Tt(r.theme)),e==="customThemeColors"&&(a?DP("custom"):await Tt("custom")),e==="theme"&&(await Su(),await eh(!1),await Tt(t)),e==="setThemes"&&(await Su(),await eh(!1),r.autoSwitchTheme?(s=window.matchMedia)!=null&&s.call(window,"(prefers-color-scheme: dark)").matches?await Tt(r.themeDark,!0):await Tt(r.themeLight,!0):t?await Tt("custom"):await Tt(r.theme)),e==="randomTheme"&&t==="off"&&await Su(),e==="customBackground"&&zP(),e==="customBackgroundSize"&&Y0(),e==="autoSwitchTheme"&&(t?(i=window.matchMedia)!=null&&i.call(window,"(prefers-color-scheme: dark)").matches?await Tt(r.themeDark,!0):await Tt(r.themeLight,!0):await Tt(r.theme)),e==="themeLight"&&r.autoSwitchTheme&&!((l=window.matchMedia)!=null&&l.call(window,"(prefers-color-scheme: dark)").matches)&&!a&&await Tt(r.themeLight,!0),e==="themeDark"&&r.autoSwitchTheme&&window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!a&&await Tt(r.themeDark,!0)});window.addEventListener("customBackgroundFailed",()=>{g("Custom background link is either temporairly unavailable or expired. Please make sure the URL is correct or change it",0,{duration:5})});let G=null,$m=0;function RP(e){(!Ns||Ns&&e>$m)&&($m=e)}async function OP(){var l;if(r.paceCaret==="off"&&!Ns||(n("#paceCaret").hasClass("hidden")||n("#paceCaret").addClass("hidden"),r.mode==="zen"))return;const e=n("#paceCaret"),t=(l=document==null?void 0:document.querySelector("#words .word"))==null?void 0:l.querySelector("letter"),a=n(t).height();if(t===void 0||a===void 0)return;const i=(await ps(r.language)).rightToLeft;e.stop(!0,!0).animate({top:t.offsetTop-a/4,left:t.offsetLeft+(i?t.offsetWidth:0)},0,"linear")}async function X0(){var l;n("#paceCaret").addClass("hidden");const e=Qr(r,re);let t=0;if(r.paceCaret==="pb"?t=((l=await gr(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,Wo()))==null?void 0:l.wpm)??0:r.paceCaret==="tagPb"?t=await WA(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode):r.paceCaret==="average"?([t]=await cb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="daily"?(t=await FA(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="custom"?t=r.paceCaretCustomSpeed:(r.paceCaret==="last"||Ns)&&(t=$m),t===void 0||t<1||Number.isNaN(t)){G=null;return}const a=t*5,s=a/60,i=60/a;G={wpm:t,cps:s,spc:i,correction:0,currentWordIndex:0,currentLetterIndex:-1,wordsStatus:{},timeout:null},await OP()}async function J0(e){if(!(G===null||!Ge||ze)){try{if(G.currentLetterIndex++,G.currentLetterIndex>=R.get(G.currentWordIndex).length&&(G.currentLetterIndex=-1,G.currentWordIndex++),!r.blindMode){if(G.correction<0)for(;G.correction<0;)G.currentLetterIndex--,G.currentLetterIndex<=-2&&(G.currentLetterIndex=R.get(G.currentWordIndex-1).length-1,G.currentWordIndex--),G.correction++;else if(G.correction>0)for(;G.correction>0;)G.currentLetterIndex++,G.currentLetterIndex>=R.get(G.currentWordIndex).length&&(G.currentLetterIndex=-1,G.currentWordIndex++),G.correction--}}catch{G=null,n("#paceCaret").addClass("hidden");return}try{const t=n("#paceCaret");let a,s,i;try{const c=G.currentWordIndex-Ze,d=document.querySelectorAll("#words .word")[c];G.currentLetterIndex===-1?a=d.querySelectorAll("letter")[0]:a=d.querySelectorAll("letter")[G.currentLetterIndex];const u=n(a).height(),m=n(a).width(),f=t.width();if(u===void 0||m===void 0||f===void 0)throw new Error("Undefined current letter height, width or caret width.");const h=(await ps(r.language)).rightToLeft;s=d.offsetTop+a.offsetTop-r.fontSize*Kn(1)*.1,G.currentLetterIndex===-1?i=d.offsetLeft+a.offsetLeft-f/2+(h?m:0):i=d.offsetLeft+a.offsetLeft-f/2+(h?0:m),t.removeClass("hidden")}catch{t.addClass("hidden")}const l=e-performance.now();if(s!==void 0){let c=n("#words .smoothScroller").height();c===void 0&&(c=0),n("#paceCaret").css({top:s-c}),r.smoothCaret!=="off"?t.stop(!0,!0).animate({left:i},He()?0:l,"linear"):t.stop(!0,!0).animate({left:i},0,"linear")}G.timeout=setTimeout(()=>{J0(e+((G==null?void 0:G.spc)??0)*1e3).catch(()=>{G=null})},l)}catch(t){console.error(t),n("#paceCaret").addClass("hidden")}}}function _P(){(G==null?void 0:G.timeout)!==null&&(G==null?void 0:G.timeout)!==void 0&&clearTimeout(G.timeout),G=null}function th(e,t){e?G!==null&&G.wordsStatus[te]===!0&&!r.blindMode&&(G.wordsStatus[te]=void 0,G.correction-=t.length+1):G!==null&&G.wordsStatus[te]===void 0&&!r.blindMode&&(G.wordsStatus[te]=!0,G.correction+=t.length+1)}function HP(){J0(performance.now()+((G==null?void 0:G.spc)??0)*1e3)}Te(e=>{e==="paceCaret"&&X0()});Te(e=>{e==="monkey"&&Ge&&(r.monkey?n("#monkey").removeClass("hidden"):n("#monkey").addClass("hidden"))});let la=!1,ca=!1;const ct={left:!1,right:!1,last:"right"},xu={"00":document.querySelector("#monkey .up"),"01":document.querySelector("#monkey .right"),10:document.querySelector("#monkey .left"),11:document.querySelector("#monkey .both")},Tu={"00":document.querySelector("#monkey .fast .up"),"01":document.querySelector("#monkey .fast .right"),10:document.querySelector("#monkey .fast .left"),11:document.querySelector("#monkey .fast .both")};function ah(e){return e?"1":"0"}function ek(){var e,t,a;if(r.monkey&&!((e=document.querySelector("#monkey"))!=null&&e.classList.contains("hidden"))){Object.keys(xu).forEach(i=>{var l;(l=xu[i])==null||l.classList.add("hidden")}),Object.keys(Tu).forEach(i=>{var l;(l=Tu[i])==null||l.classList.add("hidden")});const s=`${ah(la)}${ah(ca)}`;(t=xu[s])==null||t.classList.remove("hidden"),(a=Tu[s])==null||a.classList.remove("hidden")}}function jP(e){if(!r.monkey)return;const t=yc(e,130,180,0,1);n("#monkey .fast").animate({opacity:t},1e3);let a=yc(e,130,180,.25,.01);a===.25&&(a=0),n("#monkey").css({animationDuration:a+"s"})}function NP(e){if(!r.monkey)return;const{leftSide:t,rightSide:a}=Gf(e.code);t&&a?ct.last==="left"?ca?la||(la=!0,ct.last="left",ct.left=!0):(ca=!0,ct.last="right",ct.right=!0):la?ca||(ca=!0,ct.last="right",ct.right=!0):(la=!0,ct.last="left",ct.left=!0):(la=la||t,ca=ca||a),ek()}function GP(e){if(!r.monkey)return;const{leftSide:t,rightSide:a}=Gf(e.code);t&&a?ct.left&&ct.last==="left"?(la=!1,ct.left=!1):ct.right&&ct.last==="right"?(ca=!1,ct.right=!1):(la=la&&!ct.left,ca=ca&&!ct.right):(la=la&&!t,ca=ca&&!a),ek()}function UP(){r.monkey&&n("#monkey").css("opacity",0).removeClass("hidden").animate({opacity:1},125)}function tk(){n("#monkey").css("opacity",1).animate({opacity:1},125,()=>{n("#monkey").addClass("hidden"),n("#monkey .fast").stop(!0,!0).css("opacity",0),n("#monkey").stop(!0,!0).css({animationDuration:"0s"})})}const ak=[];function KP(e){ak.push(e)}function Wr(e,t,a){ak.forEach(s=>{try{s(e,t,a)}catch(i){console.error("Timer event subscriber threw an error"),console.error(i)}})}let Ps=0,$a=null;const Rl=1e3;let Ol=0,We=!1;function VP(){We=!0}function wp(){rP(0),$a!==null&&clearTimeout($a)}function QP(){We&&console.time("premid");const e=document.querySelector("#premidSecondsLeft");e!==null&&(e.innerHTML=(r.time-Dr()).toString()),We&&console.timeEnd("premid")}function ZP(){We&&console.time("timer progress update"),(r.mode==="time"||r.mode==="custom"&&je()==="time")&&gl(),We&&console.timeEnd("timer progress update")}function YP(){We&&console.time("calculate wpm and raw");const e=mp();return We&&console.timeEnd("calculate wpm and raw"),We&&console.time("update live wpm"),aP(e.wpm,e.raw),We&&console.timeEnd("update live wpm"),We&&console.time("push to history"),Ow(e.wpm),_w(e.raw),We&&console.timeEnd("push to history"),e}function XP(e){We&&console.time("update monkey");const t=r.blindMode?e.raw:e.wpm;jP(t),We&&console.timeEnd("update monkey")}function JP(){We&&console.time("calculate acc");const e=Q(pl());return We&&console.timeEnd("calculate acc"),e}function eI(){if(We&&console.time("layoutfluid"),r.funbox.split("#").includes("layoutfluid")&&r.mode==="time"){const e=r.customLayoutfluid?r.customLayoutfluid.split("#"):["qwerty","dvorak","colemak"],t=r.time/e.length,a=Dr(),s=Math.floor(a/t),i=e[s],l=[];for(let c=1;c<e.length;c++)l.push(Math.floor(t*c));l.includes(a+3)?(y0(),vu(3,e[s+1])):l.includes(a+2)?vu(2,e[s+1]):l.includes(a+1)&&vu(1,e[s+1]),r.layout!==i&&i!==void 0&&(ar(),ro(i,!0),Qo(i,!0))}We&&console.timeEnd("layoutfluid")}function tI(e,t){return We&&console.time("fail conditions"),$d(),Ad(),Ld(),r.minWpm==="custom"&&e.wpm<r.minWpmCustomSpeed&&te>3?($a!==null&&clearTimeout($a),yr(),Ps=0,Wr("fail","min speed"),!0):r.minAcc==="custom"&&t<r.minAccCustom?($a!==null&&clearTimeout($a),yr(),Ps=0,Wr("fail","min accuracy"),!0):(We&&console.timeEnd("fail conditions"),!1)}function aI(){if(We&&console.time("times up check"),(r.mode==="time"||r.mode==="custom"&&je()==="time")&&(Dr()>=r.time&&r.time!==0&&r.mode==="time"||Dr()>=qe()&&qe()!==0&&r.mode==="custom")){$a!==null&&clearTimeout($a),dl(),T.pushHistory(),at.pushHistory(),yr(),Ps=0,Wr("finish");return}We&&console.timeEnd("times up check")}let Lm=[];function oI(){return Lm}async function sI(){We&&console.time("timer step -----------------------------"),lP(),QP(),ZP();const e=YP(),t=JP();XP(e),eI(),tI(e,t)||aI(),We&&console.timeEnd("timer step -----------------------------")}async function nI(){yr(),Ps=0,Lm=[],Ol=Xs+Rl,function e(){const t=Ol-performance.now();Lm.push({dateNow:Date.now(),now:performance.now(),expected:Ol,nextDelay:t}),(r.mode==="time"&&r.time<130&&r.time>0||r.mode==="words"&&r.words<250&&r.words>0)&&(t<Rl/2&&aM(),t<Rl/10&&(Ps++,Ps>5&&(g('This could be caused by "efficiency mode" on Microsoft Edge.'),g("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.",-1),Wr("fail","slow timer")))),$a=setTimeout(function(){if(!Ge){$a!==null&&clearTimeout($a),yr(),Ps=0;return}sI(),Ol+=Rl,e()},t)}()}let zr=0,kp=!1,ok;function iI(e){if(kp&&new Date().getDate()>ok){zr=e;return}zr+=e}function rI(){return rt(Math.round(zr),!0,!0)+(kp?" today":" session")}function lI(){const e=new Date;e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setMilliseconds(0),ok=e.getDate();const t=e.getTime();zr=0;const a=$();if(!a)return;const s=a.results;s==null||s.forEach(i=>{const l=new Date(i.timestamp);l.setSeconds(0),l.setMinutes(0),l.setHours(0),l.setMilliseconds(0),l.getTime()>=t&&(zr+=i.testDuration+i.incompleteTestSeconds-i.afkDuration)}),kp=!0}let Am=!1;function sk(){Dt&&!Am&&!_t&&(g("Challenge cleared",0),nb(null))}function cI(e,t,a){var d,u,m;let s=!0,i=[];const l=e.afkDuration/e.testDuration*100,c=t[a];if(c===void 0)throw new Error("Requirement value is undefined");if(a==="wpm"){const f=Object.keys(c)[0];f==="exact"?Math.round(e.wpm)!==c.exact&&(s=!1,i.push(`WPM not ${c.exact}`)):f==="min"&&e.wpm<Number(c.min)&&(s=!1,i.push(`WPM below ${c.min}`))}else if(a==="acc"){const f=Object.keys(c)[0];f==="exact"?e.acc!==c.exact&&(s=!1,i.push(`Accuracy not ${c.exact}`)):f==="min"&&e.acc<Number(c.min)&&(s=!1,i.push(`Accuracy below ${c.min}`))}else if(a==="afk")Object.keys(c)[0]==="max"&&Math.round(l)>Number(c.max)&&(s=!1,i.push(`AFK percentage above ${c.max}`));else if(a==="time")Object.keys(c)[0]==="min"&&Math.round(e.testDuration)<Number(c.min)&&(s=!1,i.push(`Test time below ${c.min}`));else if(a==="funbox"){const f=(d=c.exact)==null?void 0:d.toString().split("#").sort().join("#");if(f===void 0)throw new Error("Funbox mode is undefined");if(f!==e.funbox){s=!1;for(const h of f.split("#"))((u=e.funbox)==null?void 0:u.split("#").find(y=>y===h))===void 0&&i.push(`${h} funbox not active`);const p=(m=e.funbox)==null?void 0:m.split("#");if(p!==void 0&&p.length>0)for(const h of p)f.split("#").find(y=>y===h)===void 0&&i.push(`${h} funbox active`)}}else if(a==="raw")Object.keys(c)[0]==="exact"&&Math.round(e.rawWpm)!==c.exact&&(s=!1,i.push(`Raw WPM not ${c.exact}`));else if(a==="con")Object.keys(c)[0]==="exact"&&Math.round(e.consistency)!==c.exact&&(s=!1,i.push(`Consistency not ${c.exact}`));else if(a==="config")for(const f in c){const p=c[f];r[f]!==p&&(s=!1,i.push(`${f} not set to ${p}`))}return[s,i]}function dI(e){if(!Dt)return null;try{if(e.afkDuration/e.testDuration*100>10)return g("Challenge failed: AFK time is greater than 10%",0),null;if(Dt.requirements===void 0)return g(`${Dt.display} challenge passed!`,1),Dt.name;{let a=!0;const s=[];for(const i in Dt.requirements){const[l,c]=cI(e,Dt.requirements,i);l||(a=!1),s.push(...c)}return a?(Dt.autoRole&&g("You will receive a role shortly. Please don't post a screenshot in challenge submissions.",1,{duration:5}),g(`${Dt.display} challenge passed!`,1),Dt.name):(g(`${Dt.display} challenge failed: ${s.join(", ")}`,0),null)}}catch(t){return console.error(t),g(`Something went wrong when verifying challenge: ${t.message}`,0),null}}async function uI(e){Am=!0,fo("none");let t;try{t=await jM()}catch(i){const l=ae(i,"Failed to setup challenge");return g(l,-1),be(),setTimeout(()=>{n("header .config").removeClass("hidden"),n(".page.pageTest").removeClass("hidden")},250),!1}const a=t.filter(i=>i.name.toLowerCase()===e.toLowerCase())[0];let s;try{if(a===void 0)return g("Challenge not found",0),be(),setTimeout(()=>{n("header .config").removeClass("hidden"),n(".page.pageTest").removeClass("hidden")},250),!1;if(a.type==="customTime")Ga(a.parameters[0],!0),dt("time",!0),_a("normal",!0),a.name==="englishMaster"&&(Us("english_10k",!0),ma(!0,!0),Ea(!0,!0));else if(a.type==="customWords")ns(a.parameters[0],!0),dt("words",!0),_a("normal",!0);else if(a.type==="customText")Lo(a.parameters[0].split(" ")),Zn(a.parameters[1]),Ua(a.parameters[2]),xa(a.parameters[3]),Vs(a.parameters[4]),dt("custom",!0),_a("normal",!0);else if(a.type==="script"){de();const i=await fetch("/challenges/"+a.parameters[0]);if(Z(),i.status!==200)throw new Error(`${i.status} ${i.statusText}`);let c=(await i.text()).trim();c=c.replace(/[\n\r\t ]/gm," "),c=c.replace(/ +/gm," "),Lo(c.split(" ")),Zn("repeat"),xa("word"),Vs(!1),dt("custom",!0),_a("normal",!0),a.parameters[1]!==null&&yw(a.parameters[1]),a.parameters[2]!==null&&vp(a.parameters[2])}else a.type==="accuracy"?(Ga(0,!0),dt("time",!0),_a("master",!0)):a.type==="funbox"?(fo(a.parameters[0],!0),_a("normal",!0),a.parameters[1]==="words"?ns(a.parameters[2],!0):a.parameters[1]==="time"&&Ga(a.parameters[2],!0),dt(a.parameters[1],!0),a.parameters[3]!==void 0&&_a(a.parameters[3],!0)):a.type==="special"&&a.name==="semimak"&&(dt("time",!0),Ga(120,!0),Us("english_10k",!0),Ea(!0,!0),Af("word",!0),ro("semimak",!0),Qo("overrideSync",!0),na("static",!0));return be(),s=a.message,n("header .config").removeClass("hidden"),n(".page.pageTest").removeClass("hidden"),s===void 0?g(`Challenge '${a.display}' loaded.`,0):g("Challenge loaded. "+s,0),nb(a),Am=!1,!0}catch(i){return g(ae(i,"Failed to load challenge"),-1),!1}}Te(e=>{["difficulty","numbers","punctuation","mode","funbox","paceCaret","showAllLines","showLiveWpm","highlightMode","time","words","keymapMode","keymapLayout","layout"].includes(e)&&sk()});let va=0,me=null,Se=null;function mI(){me=null}function fI(){n("#quoteRateModal .quote .text").text("-"),n("#quoteRateModal .quote .source .val").text("-"),n("#quoteRateModal .quote .id .val").text("-"),n("#quoteRateModal .quote .length .val").text("-"),n("#quoteRateModal .ratingCount .val").text("-"),n("#quoteRateModal .ratingAverage .val").text("-")}function nk(e){return!e.totalRating||!e.ratings?0:Math.round(e.totalRating/e.ratings*10)/10}async function ik(e){if(!e)return;Se=e;const t=await F.quotes.getRating({query:{quoteId:Se.id,language:Se.language}});if(Z(),t.status!==200){g("Failed to get quote ratings: "+t.body.message,-1);return}return t.body.data===null?{}:(me=t.body.data,me!==void 0&&!me.average&&(me.average=nk(me)),me)}function rc(e){const t=e??va;n("#quoteRateModal .star").removeClass("active");for(let a=1;a<=t;a++)n(`#quoteRateModal .star[data-rating=${a}]`).addClass("active")}async function pI(){var e;me||await ik(),n("#quoteRateModal .ratingCount .val").text((me==null?void 0:me.ratings)??"0"),n("#quoteRateModal .ratingAverage .val").text(((e=me==null?void 0:me.average)==null?void 0:e.toFixed(1))??"-")}function gI(){if(!Se)return;let e;Se.group===0?e="short":Se.group===1?e="medium":Se.group===2?e="long":Se.group===3&&(e="thicc"),n("#quoteRateModal .quote .text").text(Se.text),n("#quoteRateModal .quote .source .val").text(Se.source),n("#quoteRateModal .quote .id .val").text(Se.id),n("#quoteRateModal .quote .length .val").text(e),pI()}function hI(e,t){rk.show({...t,beforeAnimation:async()=>{var i,l;fI(),Se=e,va=0;const a=$(),s=(l=(i=a==null?void 0:a.quoteRatings)==null?void 0:i[Se.language])==null?void 0:l[Se.id];s&&(va=s),rc(),gI()}})}function yI(e=!1){rk.hide({clearModalChain:e})}async function bI(){var i,l;if(va===0){g("Please select a rating");return}if(!Se)return;yI(!0);const e=await F.quotes.addRating({body:{quoteId:Se.id,language:Se.language,rating:va}});if(Z(),e.status!==200){g("Failed to submit quote rating: "+e.body.message,-1);return}const t=$();if(!t)return;const a=t.quoteRatings??{},s=(a==null?void 0:a[Se.language])??{};if(s!=null&&s[Se.id]){const c=(i=a[Se.language])==null?void 0:i[Se.id],d=va-c;s[Se.id]=va,me={ratings:me==null?void 0:me.ratings,totalRating:isNaN(me==null?void 0:me.totalRating)?0:(me==null?void 0:me.totalRating)+d,quoteId:Se.id,language:Se.language},g("Rating updated",1)}else s[Se.id]=va,me!=null&&me.ratings&&me.totalRating?(me.ratings++,me.totalRating+=va):me={ratings:1,totalRating:va,quoteId:Se.id,language:Se.language},g("Rating submitted",1);t.quoteRatings=a,gt(t),me.average=nk(me),n(".pageTest #result #rateQuoteButton .rating").text((l=me.average)==null?void 0:l.toFixed(1)),n(".pageTest #result #rateQuoteButton .icon").removeClass("far"),n(".pageTest #result #rateQuoteButton .icon").addClass("fas")}async function vI(e){var a;(a=e.querySelector(".submitButton"))==null||a.addEventListener("click",()=>{bI()});const t=e.querySelectorAll(".stars button.star");for(const s of t)s.addEventListener("click",i=>{va=parseInt(i.currentTarget.getAttribute("data-rating")),rc()}),s.addEventListener("mouseenter",i=>{const l=parseInt(i.currentTarget.getAttribute("data-rating"));rc(l)}),s.addEventListener("mouseleave",()=>{rc()})}const rk=new fe({dialogId:"quoteRateModal",setup:vI}),wI=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"}],kI=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"}],CI=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"},{type:"leaderboard_btf",selectorId:"ad-footer-wrapper"},{type:"med_rect_btf",selectorId:"ad-footer-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-3-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-3-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-2-small-wrapper"}];let Gd=!1;function SI(){const e="1024888",t="74058";window.ramp={que:[],passiveMode:!0,forcePath:"320x50-test",onReady:()=>{Gd=!0,Ud()}};const a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("async",!0),s.src=`//cdn.intergient.com/${e}/${t}/ramp.js`,a.appendChild(s),window._pwGA4PageviewId="".concat(Date.now()),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-KETCPNHRJF",{send_page_view:!1}),gtag("event","ramp_js",{send_to:"G-KETCPNHRJF",pageview_id:window._pwGA4PageviewId})}function lk(){let e;r.ads==="result"?e=wI:r.ads==="on"?e=kI:r.ads==="sellout"&&(e=CI);const t=[];for(const a of e){const s=document.querySelector(`#${a.selectorId}`);s&&window.getComputedStyle(s).display!=="none"&&s.offsetParent!==null&&t.push(a)}return t}async function Ud(){if(Gd){if(ce()==="test"&&!ze){ramp.destroyUnits("all");return}await ramp.destroyUnits("all"),await ramp.addUnits(lk()),await ramp.displayUnits()}}async function xI(){}function TI(){Gd&&ramp.destroyUnits("all")}async function $I(){if(!Gd)return;const e=lk();await ramp.addUnits(e),await ramp.displayUnits()}const LI=900;let _l=!0;const AI=1330;let Hl=!0,yl=!1,Kd,Rr;function ck(){SI(),setInterval(()=>{Ge||xI()},6e4),yl=!0}function MI(){Mm(),dk(),EI()}function Mm(){n("#ad-footer-wrapper").remove(),n("#ad-footer-small-wrapper").remove(),n("#ad-about-1-wrapper").remove(),n("#ad-about-1-small-wrapper").remove(),n("#ad-about-2-wrapper").remove(),n("#ad-about-2-small-wrapper").remove(),n("#ad-settings-1-wrapper").remove(),n("#ad-settings-1-small-wrapper").remove(),n("#ad-settings-2-wrapper").remove(),n("#ad-settings-2-small-wrapper").remove(),n("#ad-settings-3-wrapper").remove(),n("#ad-settings-3-small-wrapper").remove(),n("#ad-account-1-wrapper").remove(),n("#ad-account-1-small-wrapper").remove(),n("#ad-account-2-wrapper").remove(),n("#ad-account-2-small-wrapper").remove()}function dk(){n("#ad-vertical-right-wrapper").remove(),n("#ad-vertical-left-wrapper").remove()}function EI(){n("#ad-result-wrapper").remove(),n("#ad-result-small-wrapper").remove()}function PI(){}function uk(e=!1){const t=_l;window.innerWidth>LI?_l=!0:_l=!1,!e&&(r.ads==="off"||!yl||t!==_l&&Ud())}function mk(e=!1){const t=Hl;window.innerWidth>AI?Hl=!0:Hl=!1,!e&&(r.ads==="off"||!yl||t!==Hl&&Ud())}async function Cp(){return new Promise(e=>{window.ramp===void 0&&(Kd=!0),e()})}async function Sp(){return new Promise(e=>{if(Rr===void 0){Rr=!1,e();return}e()})}async function II(){return r.ads==="off"?!1:yl?(await Cp(),await Sp(),Kd||Rr?!1:Ud()):(ck(),!0)}async function qI(){if(r.ads!=="off"){if(yl||ck(),await Cp(),await Sp(),Kd){n("#ad-result-wrapper .iconAndText .text").html(`
    Using an ad blocker? No worries
    <div class="smalltext">
      We understand ads can be annoying
      <br />
      You can
      <i>disable all ads</i>
      in the settings
    </div>
    `);return}if(Rr){n("#ad-result-wrapper .iconAndText .text").html(`
    Ads not working? Ooops
    <div class="smalltext">
      You may have a cookie popup blocker enabled - ads will not show without your consent
      <br />
      You can also 
      <i>disable all ads</i>
      in the settings if you wish
    </div>
    `);return}$I()}}function Gc(e){e?(n("#ad-vertical-left-wrapper").removeClass("testPage"),n("#ad-vertical-right-wrapper").removeClass("testPage"),n("#ad-footer-wrapper").removeClass("testPage"),n("#ad-footer-small-wrapper").removeClass("testPage")):(n("#ad-vertical-left-wrapper").addClass("testPage"),n("#ad-vertical-right-wrapper").addClass("testPage"),n("#ad-footer-wrapper").addClass("testPage"),n("#ad-footer-small-wrapper").addClass("testPage"))}function BI(){ramp.showCmpModal()}function DI(){TI()}const FI=Pt(500,PI),WI=Pt(500,uk),zI=Pt(500,mk);n(window).on("resize",()=>{FI(),WI(),zI()});Te((e,t)=>{e==="ads"&&(t==="off"?MI():t==="result"?(Mm(),dk()):t==="on"&&Mm())});JS(()=>{});n(document).ready(()=>{uk(!0),mk()});window.onerror=function(e){};const $u={quotes:[],length:0,language:null,groups:[]};class RI{constructor(){this.quoteCollection=$u,this.quoteQueue=[],this.queueIndex=0}async getQuotes(t,a){var i,l;const s=ja(t);if(this.quoteCollection.language!==s){let c;try{c=await ha(`quotes/${s}.json`)}catch(d){if(d instanceof Error&&((i=d==null?void 0:d.message)!=null&&i.includes("404")||(l=d==null?void 0:d.message)!=null&&l.includes("Content is not JSON")))return $u;throw d}if(c.quotes===void 0||c.quotes.length===0)return $u;this.quoteCollection={quotes:[],length:c.quotes.length,groups:[],language:c.language},c.quotes.forEach(d=>{const u={text:d.text,britishText:d.britishText,source:d.source,length:d.length,id:d.id,language:c.language,group:0};this.quoteCollection.quotes.push(u)}),c.groups.forEach((d,u)=>{const m=d[0],f=d[1];this.quoteCollection.groups[u]=this.quoteCollection.quotes.filter(p=>p.length>=m&&p.length<=f?(p.group=u,!0):!1)}),a!==void 0&&this.updateQuoteQueue(a)}return this.quoteCollection}getQuoteById(t){return this.quoteCollection.quotes.find(s=>s.id===t)}updateQuoteQueue(t){this.quoteQueue=[],t.forEach(a=>{var s;a<0||(s=this.quoteCollection.groups[a])==null||s.forEach(i=>{this.quoteQueue.push(i)})}),Gn(this.quoteQueue),this.queueIndex=0}getRandomQuote(){if(this.quoteQueue.length===0)return null;this.queueIndex>=this.quoteQueue.length&&(this.queueIndex=0,Gn(this.quoteQueue));const t=this.quoteQueue[this.queueIndex];return this.queueIndex+=1,t}getRandomFavoriteQuote(t){const a=$();if(!a)return null;const s=ja(t),i=[],{favoriteQuotes:l}=a;if(l===void 0||(Object.keys(l).forEach(u=>{ja(u)===s&&i.push(...l[u]??[])}),i.length===0))return null;const c=Ya(i);return this.getQuoteById(parseInt(c,10))??null}isQuoteFavorite({language:t,id:a}){const s=$();if(!s)return!1;const{favoriteQuotes:i}=s;if(i===void 0)return!1;const l=ja(t);return Object.keys(i).find(d=>l!==ja(d)?!1:(i[d]??[]).includes(a.toString()))!==void 0}async setQuoteFavorite(t,a){var i,l,c,d,u;const s=$();if(!s)throw new Error("Snapshot is not available");if(a){const m=await F.users.addQuoteToFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(m.status===200)s.favoriteQuotes===void 0&&(s.favoriteQuotes={}),s.favoriteQuotes[t.language]||(s.favoriteQuotes[t.language]=[]),(u=s.favoriteQuotes[t.language])==null||u.push(`${t.id}`);else throw new Error(m.body.message)}else{const m=await F.users.removeQuoteFromFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(m.status===200){const f=(l=(i=s.favoriteQuotes)==null?void 0:i[t.language])==null?void 0:l.indexOf(`${t.id}`);(d=(c=s.favoriteQuotes)==null?void 0:c[t.language])==null||d.splice(f,1)}else throw new Error(m.body.message)}}}const Qt=new RI;Te((e,t)=>{e==="quoteLength"&&Qt.updateQuoteQueue(t)});let fk=!1;function oh(){return fk}function OI(){fk=!0,console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)"),console.log("To disable Glarses Mode refresh the page.")}function _I(){Em=!1,n("#result .stats .wpm .crown").css("opacity",0).addClass("hidden")}let Em=!1,pk="normal";function HI(){return pk}function gk(){if(Em)return;Em=!0,n("#result .stats .wpm .crown").removeClass("hidden").css("opacity","0").animate({opacity:1},Be(250),"easeOutCubic")}function hk(e){pk=e;const t=n("#result .stats .wpm .crown");t.removeClass("ineligible"),t.removeClass("pending"),t.removeClass("error"),t.removeClass("warning"),t.addClass(e)}function jI(){n("#testConfig").removeClass("invisible"),n("#mobileTestConfigButton").removeClass("invisible")}function NI(){n("#testConfig").addClass("invisible"),n("#mobileTestConfigButton").addClass("invisible")}async function GI(){n("#testConfig .mode .textButton").removeClass("active"),n("#testConfig .mode .textButton[mode='"+r.mode+"']").addClass("active"),n("#testConfig .puncAndNum").addClass("hidden"),n("#testConfig .spacer").addClass("scrolled"),n("#testConfig .time").addClass("hidden"),n("#testConfig .wordCount").addClass("hidden"),n("#testConfig .customText").addClass("hidden"),n("#testConfig .quoteLength").addClass("hidden"),n("#testConfig .zen").addClass("hidden"),r.mode==="time"?(n("#testConfig .puncAndNum").removeClass("hidden"),n("#testConfig .leftSpacer").removeClass("scrolled"),n("#testConfig .rightSpacer").removeClass("scrolled"),n("#testConfig .time").removeClass("hidden"),$s("time",r.time)):r.mode==="words"?(n("#testConfig .puncAndNum").removeClass("hidden"),n("#testConfig .leftSpacer").removeClass("scrolled"),n("#testConfig .rightSpacer").removeClass("scrolled"),n("#testConfig .wordCount").removeClass("hidden"),$s("words",r.words)):r.mode==="quote"?(n("#testConfig .rightSpacer").removeClass("scrolled"),n("#testConfig .quoteLength").removeClass("hidden"),$s("quoteLength",r.quoteLength)):r.mode==="custom"&&(n("#testConfig .puncAndNum").removeClass("hidden"),n("#testConfig .leftSpacer").removeClass("scrolled"),n("#testConfig .rightSpacer").removeClass("scrolled"),n("#testConfig .customText").removeClass("hidden")),$s("numbers",r.numbers),$s("punctuation",r.punctuation)}async function UI(e,t){var y,b,v;if(e===t)return;n("#testConfig .mode .textButton").removeClass("active"),n("#testConfig .mode .textButton[mode='"+t+"']").addClass("active");const a={time:"time",words:"wordCount",custom:"customText",quote:"quoteLength",zen:"zen"},s=Be(250),i={both:"easeInOutSine",in:"easeInSine",out:"easeOutSine"},l={time:!0,words:!0,custom:!0,quote:!1,zen:!1},c=n("#testConfig .puncAndNum");if(l[t]!==l[e]){l[t]?n("#testConfig .leftSpacer").removeClass("scrolled"):n("#testConfig .leftSpacer").addClass("scrolled"),c.css({width:"unset",opacity:1}).removeClass("hidden");const C=Math.round(((y=c[0])==null?void 0:y.getBoundingClientRect().width)??0);c.stop(!0,!1).css({width:l[e]?C:0,opacity:l[e]?1:0}).animate({width:l[t]?C:0,opacity:l[t]?1:0},s,i.both,()=>{l[t]?c.css("width","unset"):c.addClass("hidden")})}t==="zen"?n("#testConfig .rightSpacer").addClass("scrolled"):n("#testConfig .rightSpacer").removeClass("scrolled");const d=n(`#testConfig .${a[t]}`),u=n(`#testConfig .${a[e]}`),m=Math.round(((b=u[0])==null?void 0:b.getBoundingClientRect().width)??0);u.addClass("hidden"),d.removeClass("hidden");const f=Math.round(((v=d[0])==null?void 0:v.getBoundingClientRect().width)??0);u.removeClass("hidden"),d.addClass("hidden");const h=(f-m)/2;u.stop(!0,!1).css({opacity:1,width:m}).animate({width:m+h,opacity:0},s/2,i.in,()=>{u.css({opacity:1,width:"unset"}).addClass("hidden"),d.css({opacity:0,width:m+h}).removeClass("hidden").stop(!0,!1).animate({opacity:1,width:f},s/2,i.out,()=>{d.css("width","unset")})})}function $s(e,t){if(e==="time"){n("#testConfig .time .textButton").removeClass("active");const a=[15,30,60,120].includes(t)?t:"custom";n("#testConfig .time .textButton[timeConfig='"+a+"']").addClass("active")}else if(e==="words"){n("#testConfig .wordCount .textButton").removeClass("active");const a=[10,25,50,100,200].includes(t)?t:"custom";n("#testConfig .wordCount .textButton[wordCount='"+a+"']").addClass("active")}else e==="quoteLength"?(n("#testConfig .quoteLength .textButton").removeClass("active"),t.forEach(a=>{n("#testConfig .quoteLength .textButton[quoteLength='"+a+"']").addClass("active")})):e==="numbers"?t===!1?n("#testConfig .numbersMode.textButton").removeClass("active"):n("#testConfig .numbersMode.textButton").addClass("active"):e==="punctuation"&&(t===!1?n("#testConfig .punctuationMode.textButton").removeClass("active"):n("#testConfig .punctuationMode.textButton").addClass("active"))}function KI(){n("#testConfig .quoteLength .favorite").removeClass("hidden")}function VI(){n("#testConfig .quoteLength .favorite").addClass("hidden")}Te((e,t,a,s)=>{if(ce()==="test")if(e==="mode"){UI(s,t);let i;r.mode==="time"?i=r.time:r.mode==="words"?i=r.words:r.mode==="quote"&&(i=r.quoteLength),i!==void 0&&$s(r.mode,i)}else["time","quoteLength","words","numbers","punctuation"].includes(e)&&t!==void 0&&$s(e,t)});let B,Vo,lc=!1,so="",Sn="";function QI(){lc=!lc,g(lc?"on":"off",1)}let en=[];async function yk(){var c;const e=pt(r.typingSpeedUnit),t=[];for(let d=1;d<=wo.length;d++)Js&&d===wo.length?t.push(Q(B.testDuration).toString()):t.push(d.toString());Ie.getScale("wpm").title.text=e.fullUnitString;const a=[...wo.map(d=>Q(e.fromWpm(d)))];if(B.chartData==="toolong")return;const s=[...B.chartData.raw.map(d=>Q(e.fromWpm(d)))];r.mode!=="time"&&Js&&B.testDuration%1<.5&&(t.pop(),a.pop(),s.pop());let i=s;if(lc||(i=by(i,1),i=i.map(d=>Math.round(d))),Ie.data.labels=t,Ie.getDataset("wpm").data=a,Ie.getDataset("wpm").label=r.typingSpeedUnit,Ie.getDataset("raw").data=i,Vo=Math.max(Math.max(...i),Math.max(...a)),r.startGraphsAtZero)Ie.getScale("wpm").min=0,Ie.getScale("raw").min=0;else{const d=Math.min(Math.min(...i),Math.min(...a));Ie.getScale("wpm").min=d,Ie.getScale("raw").min=d}Ie.getDataset("error").data=B.chartData.err;const l=await Ut("sub");if(r.funbox!=="none"){let d="";for(const u of Wo())d+=u.name,(c=u.functions)!=null&&c.getResultContent&&(d+="("+u.functions.getResultContent()+")"),d+=" ";d=d.trimEnd(),en.push({display:!0,id:"funbox-label",type:"line",scaleID:"wpm",value:Ie.getScale("wpm").min,borderColor:"transparent",borderWidth:1,borderDash:[2,2],label:{backgroundColor:"transparent",font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:ga.defaults.font.weight,lineHeight:ga.defaults.font.lineHeight},color:l,padding:3,borderRadius:3,position:"start",display:!0,content:`${d}`}})}Ie.getScale("wpm").max=Vo,Ie.getScale("raw").max=Vo,Ie.getScale("error").max=Math.max(...B.chartData.err)}async function bk(){const e=await fs(),t=await gr(B.mode,B.mode2,B.punctuation??!1,B.numbers??!1,B.language,B.difficulty,B.lazyMode??!1,Ts(B.funbox??"none")),a=(t==null?void 0:t.wpm)??0;if(a===0)return;const s=pt(r.typingSpeedUnit),i=Q(s.fromWpm(a)).toFixed(2);en.push({display:!0,type:"line",id:"lpb",scaleID:"wpm",value:i,borderColor:e.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:e.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:ga.defaults.font.weight,lineHeight:ga.defaults.font.lineHeight},color:e.bg,padding:3,borderRadius:3,position:"center",content:`PB: ${i}`,display:!0}});const l=s.fromWpm(20);Vo>=parseFloat(i)-l&&Vo<=parseFloat(i)+l&&(Vo=Math.round(parseFloat(i)+l)),Ie.getScale("wpm").max=Vo,Ie.getScale("raw").max=Vo}function vk(){let e=!1;if(B.wpm>=1e3&&(e=!0),n("#result .stats .wpm .top .text").text(r.typingSpeedUnit),e?n("#result .stats .wpm .bottom").text("Infinite"):n("#result .stats .wpm .bottom").text(N.typingSpeed(B.wpm)),n("#result .stats .raw .bottom").text(N.typingSpeed(B.rawWpm)),n("#result .stats .acc .bottom").text(B.acc===100?"100%":N.accuracy(B.acc)),r.alwaysShowDecimalPlaces){r.typingSpeedUnit!=="wpm"?(n("#result .stats .wpm .bottom").attr("aria-label",B.wpm.toFixed(2)+" wpm"),n("#result .stats .raw .bottom").attr("aria-label",B.rawWpm.toFixed(2)+" wpm")):(n("#result .stats .wpm .bottom").removeAttr("aria-label"),n("#result .stats .raw .bottom").removeAttr("aria-label"));let t=Q(B.testDuration).toFixed(2)+"s";B.testDuration>61&&(t=rt(Q(B.testDuration))),n("#result .stats .time .bottom .text").text(t),n("#result .stats .acc .bottom").attr("aria-label",`${da.correct} correct
${da.incorrect} incorrect`)}else{const t={showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`};let a=N.typingSpeed(B.wpm,t),s=N.typingSpeed(B.rawWpm,t);r.typingSpeedUnit!=="wpm"&&(a+=" ("+B.wpm.toFixed(2)+" wpm)",s+=" ("+B.rawWpm.toFixed(2)+" wpm)"),n("#result .stats .wpm .bottom").attr("aria-label",a),n("#result .stats .raw .bottom").attr("aria-label",s),n("#result .stats .acc .bottom").attr("aria-label",`${B.acc===100?"100%":N.percentage(B.acc,{showDecimalPlaces:!0})}
${da.correct} correct
${da.incorrect} incorrect`).attr("data-balloon-break","")}}function ZI(){n("#result .stats .consistency .bottom").text(N.percentage(B.consistency)),r.alwaysShowDecimalPlaces?n("#result .stats .consistency .bottom").attr("aria-label",N.percentage(B.keyConsistency,{showDecimalPlaces:!0,suffix:" key"})):n("#result .stats .consistency .bottom").attr("aria-label",`${B.consistency}% (${B.keyConsistency}% key)`)}function YI(){const e=Q(B.afkDuration/B.testDuration*100);if(n("#result .stats .time .bottom .afk").text(""),e>0&&n("#result .stats .time .bottom .afk").text(e+"% afk"),n("#result .stats .time .bottom").attr("aria-label",`${B.afkDuration}s afk ${e}%`),r.alwaysShowDecimalPlaces){let t=Q(B.testDuration).toFixed(2)+"s";B.testDuration>61&&(t=rt(Q(B.testDuration))),n("#result .stats .time .bottom .text").text(t)}else{let t=Math.round(B.testDuration)+"s";B.testDuration>61&&(t=rt(Math.round(B.testDuration))),n("#result .stats .time .bottom .text").text(t),n("#result .stats .time .bottom").attr("aria-label",`${Q(B.testDuration)}s (${B.afkDuration}s afk ${e}%)`)}}function XI(){n("#result .stats .time .bottom .timeToday").text(rI())}function JI(){n("#result .stats .key .bottom").text(B.charStats[0]+"/"+B.charStats[1]+"/"+B.charStats[2]+"/"+B.charStats[3])}function cc(e){gk(),hk(e)}function sr(e,t=!1){n("#result .stats .wpm .crown").attr("aria-label",e),n("#result .stats .wpm .crown").attr("data-balloon-length",t?"medium":"")}async function eq(e){if(r.mode==="quote"||e){Pm();return}let t=0;const a=await wk();if(console.debug("Result can get PB:",a.value,a.reason??""),a.value){const s=await gr(r.mode,B.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,Wo()),i=(s==null?void 0:s.wpm)??0;t=B.wpm-i,console.debug("Local PB",s,"diff",t),t<=0?(Pm(),console.debug("Hiding crown")):(console.debug("Showing pending crown"),cc("pending"),sr("+"+N.typingSpeed(t,{showDecimalPlaces:!0})))}else{const s=await gr(r.mode,B.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,[]),i=(s==null?void 0:s.wpm)??0;t=B.wpm-i,console.debug("Local PB",s,"diff",t),t<=0?(console.debug("Showing warning crown"),cc("warning"),sr(`This result is not eligible for a new PB (${a.reason})`,!0)):(console.debug("Showing ineligible crown"),cc("ineligible"),sr(`You could've gotten a new PB (+${N.typingSpeed(t,{showDecimalPlaces:!0})}), but your config does not allow it (${a.reason})`,!0))}}function Pm(){_I(),sr("")}function tq(){HI()==="pending"&&(gk(),hk("error"),sr("Local PB data is out of sync with the server - please refresh (pb mismatch)",!0))}async function wk(){var c;const e=((c=B.funbox)==null?void 0:c.split("#"))??[],a=vE(B.funbox).every(d=>d==null?void 0:d.canGetPb),s=B.funbox==="none"||e.length===0||a,i=r.stopOnError!=="letter",l=!B.bailedOut;return s&&i&&l?{value:!0}:s?i?l?{value:!1,reason:"unknown"}:{value:!1,reason:"bailed out"}:{value:!1,reason:"stop on letter"}:{value:!1,reason:"funbox"}}function aq(){if(He())return;const e=getComputedStyle(document.body),t=[e.getPropertyValue("--main-color"),e.getPropertyValue("--text-color"),e.getPropertyValue("--sub-color")],a=Date.now()+125;(function s(){og({particleCount:5,angle:60,spread:75,origin:{x:0},colors:t}),og({particleCount:5,angle:120,spread:75,origin:{x:1},colors:t}),Date.now()<a&&requestAnimationFrame(s)})()}async function oq(e){var l,c,d,u;const t=[],a=((c=(l=$())==null?void 0:l.tags)==null?void 0:c.length)??0;try{(u=(d=$())==null?void 0:d.tags)==null||u.forEach(m=>{m.active===!0&&t.push(m)})}catch{}a===0?n("#result .stats .tags").addClass("hidden"):n("#result .stats .tags").removeClass("hidden"),t.length===0?n("#result .stats .tags .bottom").html("<div class='noTags'>no tags</div>"):n("#result .stats .tags .bottom").text(""),n("#result .stats .tags .editTagsButton").attr("data-result-id",""),n("#result .stats .tags .editTagsButton").attr("data-active-tag-ids",t.map(m=>m._id).join(",")),n("#result .stats .tags .editTagsButton").addClass("invisible");let s="start",i=15;t.forEach(async m=>{const f=await db(m._id,r.mode,B.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode);n("#result .stats .tags .bottom").append(`
      <div tagid="${m._id}" aria-label="PB: ${f}" data-balloon-pos="up">${m.display}<i class="fas fa-crown hidden"></i></div>
    `);const p=pt(r.typingSpeedUnit);if(r.mode!=="quote"&&!e&&(await wk()).value)if(f<B.wpm)await RA(m._id,r.mode,B.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,B.wpm,B.acc,B.rawWpm,B.consistency),n(`#result .stats .tags .bottom div[tagid="${m._id}"] .fas`).removeClass("hidden"),n(`#result .stats .tags .bottom div[tagid="${m._id}"]`).attr("aria-label","+"+Q(B.wpm-f));else{const h=await fs();en.push({display:!0,type:"line",id:"tpb",scaleID:"wpm",value:p.fromWpm(f),borderColor:h.sub,borderWidth:1,borderDash:[2,2],label:{backgroundColor:h.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:ga.defaults.font.weight,lineHeight:ga.defaults.font.lineHeight},color:h.bg,padding:3,borderRadius:3,position:s,xAdjust:i,display:!0,content:`${m.display} PB: ${Q(p.fromWpm(f)).toFixed(2)}`}}),s==="start"?(s="end",i=-15):(s="start",i=15)}})}function sq(e){let t="";t+=r.mode,r.mode==="time"?t+=" "+r.time:r.mode==="words"?t+=" "+r.words:r.mode==="quote"&&(e==null?void 0:e.group)!==void 0&&(t+=" "+["short","medium","long","thicc"][e.group]);const a=ln("ignoresLanguage");r.mode!=="custom"&&!a&&(t+="<br>"+$o(B.language)),r.punctuation&&(t+="<br>punctuation"),r.numbers&&(t+="<br>numbers"),r.blindMode&&(t+="<br>blind"),r.lazyMode&&(t+="<br>lazy"),r.funbox!=="none"&&(t+="<br>"+r.funbox.replace(/_/g," ").replace(/#/g,", ")),r.difficulty==="expert"?t+="<br>expert":r.difficulty==="master"&&(t+="<br>master"),r.stopOnError!=="off"&&(t+=`<br>stop on ${r.stopOnError}`),n("#result .stats .testType .bottom").html(t)}function nq(e,t,a,s,i){let l="";if(e&&(l+=`<br>failed (${t})`),a&&(l+="<br>afk detected"),ip){l+="<br>invalid";const c=[];(B.wpm<0||B.wpm>350&&B.mode!=="words"&&B.mode2!=="10"||B.wpm>420&&B.mode==="words"&&B.mode2==="10")&&c.push("wpm"),(B.rawWpm<0||B.rawWpm>350&&B.mode!=="words"&&B.mode2!=="10"||B.rawWpm>420&&B.mode==="words"&&B.mode2==="10")&&c.push("raw"),(B.acc<75||B.acc>100)&&c.push("accuracy"),c.length>0&&(l+=` (${c.join(",")})`)}s&&(l+="<br>repeated"),B.bailedOut&&(l+="<br>bailed out"),i&&(l+="<br>too short"),l===""?n("#result .stats .info").addClass("hidden"):(n("#result .stats .info").removeClass("hidden"),l=l.substring(4),n("#result .stats .info .bottom").html(l))}function iq(e){var t,a,s;if(r.mode==="quote"){if(e===null){console.error("Failed to update quote rating button: randomQuote is null");return}((s=(a=(t=$())==null?void 0:t.quoteRatings)==null?void 0:a[e.language])==null?void 0:s[e.id])&&n(".pageTest #result #rateQuoteButton .icon").removeClass("far").addClass("fas"),ik(e).then(l=>{var c;n(".pageTest #result #rateQuoteButton .rating").text(((c=l==null?void 0:l.average)==null?void 0:c.toFixed(1))??"")}).catch(l=>{n(".pageTest #result #rateQuoteButton .rating").text("?")}),n(".pageTest #result #rateQuoteButton").css({opacity:0}).removeClass("hidden").css({opacity:1})}}function rq(e){const t=n(".pageTest #result #favoriteQuoteButton .icon");if(r.mode!=="quote"||!j()){t.parent().addClass("hidden");return}if(e===null){console.error("Failed to update quote favorite button: randomQuote is null");return}so=r.mode==="quote"?e.language:"",Sn=r.mode==="quote"?e.id.toString():"";const a=Qt.isQuoteFavorite(e);t.removeClass(a?"far":"fas").addClass(a?"fas":"far"),t.parent().removeClass("hidden")}function lq(e){r.mode==="quote"?(n("#result .stats .source").removeClass("hidden"),n("#result .stats .source .bottom").html((e==null?void 0:e.source)??"Error: Source unknown")):n("#result .stats .source").addClass("hidden")}async function cq(e,t,a,s,i,l,c,d){en=[],B=Ma(e),Pm(),n("#resultWordsHistory .words").empty(),n("#result #resultWordsHistory").addClass("hidden"),n("#retrySavingResultButton").addClass("hidden"),n(".pageTest #result #rateQuoteButton .icon").removeClass("fas").addClass("far"),n(".pageTest #result #rateQuoteButton .rating").text(""),n(".pageTest #result #rateQuoteButton").addClass("hidden"),n("#words").removeClass("blurred"),n("#wordsInput").trigger("blur"),n("#result .stats .time .bottom .afk").text(""),j()?n("#result .loginTip").addClass("hidden"):n("#result .loginTip").removeClass("hidden"),r.ads==="off"||r.ads==="result"?n("#result #watchVideoAdButton").addClass("hidden"):n("#result #watchVideoAdButton").removeClass("hidden"),vk(),ZI(),YI(),JI(),sq(c),lq(c),rq(c),await eq(d),await yk(),await bk(),await oq(d),nq(t,a,s,i,l),Ie.options.plugins.annotation.annotations=en,Ie.updateColors(),Ie.resize(),n("#result .stats .tags").hasClass("hidden")&&n("#result .stats .info").hasClass("hidden")?n("#result .stats .infoAndTags").addClass("hidden"):n("#result .stats .infoAndTags").removeClass("hidden"),oh()?(n("main #result .noStressMessage").remove(),n("main #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `),n("main #result .stats").addClass("hidden"),n("main #result .chart").addClass("hidden"),n("main #result #resultWordsHistory").addClass("hidden"),n("main #result #resultReplay").addClass("hidden"),n("main #result .loginTip").addClass("hidden"),n("main #result #showWordHistoryButton").addClass("hidden"),n("main #result #watchReplayButton").addClass("hidden"),n("main #result #saveScreenshotButton").addClass("hidden"),console.log(`Test Completed: ${B.wpm} wpm ${B.acc}% acc ${B.rawWpm} raw ${B.consistency}% consistency`)):(n("main #result .stats").removeClass("hidden"),n("main #result .chart").removeClass("hidden"),j()||n("main #result .loginTip").removeClass("hidden"),n("main #result #showWordHistoryButton").removeClass("hidden"),n("main #result #watchReplayButton").removeClass("hidden"),n("main #result #saveScreenshotButton").removeClass("hidden")),window.scrollY>0&&n([document.documentElement,document.body]).stop().animate({scrollTop:0},250),NI(),Ja(n("#typingTest"),n("#result"),250,async()=>{n("#result").trigger("focus"),qI(),x0(!1),n("#words").empty(),Ie.resize(),window.scrollTo({top:0})},async()=>{gs(!1),n("#resultExtraButtons").removeClass("hidden").css("opacity",0).animate({opacity:1},Be(125));const u=rd(r.mode,r.words,r.time,rn(),Po()??!1);r.alwaysShowWordsHistory&&u&&!oh()&&E0(!0),Gc(!0),Mn()})}function dq(e,t){var s,i;const a=[];if(e.length>0)for(const l of e)(i=(s=$())==null?void 0:s.tags)==null||i.forEach(c=>{l===c._id&&a.push(c.display)});if(e.length===0)n(".pageTest #result .tags .bottom").html("<div class='noTags'>no tags</div>");else{n(".pageTest #result .tags .bottom div.noTags").remove();const l=n(".pageTest #result .tags .bottom div[tagid]"),c=[];l.each((u,m)=>{const f=n(m).attr("tagid");e.includes(f)?c.push(f):n(m).remove()});let d="";e.forEach((u,m)=>{c.includes(u)||(t.includes(u)?d+=`<div tagid="${u}" data-balloon-pos="up">${a[m]}<i class="fas fa-crown"></i></div>`:d+=`<div tagid="${u}">${a[m]}</div>`)}),n(".pageTest #result .tags .bottom").append(d),n(".pageTest #result .tags .top .editTagsButton").attr("active-tag-ids",e.join(","))}}n(".pageTest #favoriteQuoteButton").on("click",async()=>{var a,s,i,l,c;if(so===""||Sn===""){g("Could not get quote stats!",-1);return}const e=n(".pageTest #favoriteQuoteButton .icon"),t=$();if(t)if(e.hasClass("fas")){de();const d=await F.users.removeQuoteFromFavorites({body:{language:so,quoteId:Sn}});if(Z(),g(d.body.message,d.status===200?1:-1),d.status===200){e.removeClass("fas").addClass("far");const u=(s=(a=t.favoriteQuotes)==null?void 0:a[so])==null?void 0:s.indexOf(Sn);(l=(i=t.favoriteQuotes)==null?void 0:i[so])==null||l.splice(u,1)}}else{de();const d=await F.users.addQuoteToFavorites({body:{language:so,quoteId:Sn}});Z(),g(d.body.message,d.status===200?1:-1),d.status===200&&(e.removeClass("far").addClass("fas"),t.favoriteQuotes===void 0&&(t.favoriteQuotes={}),t.favoriteQuotes[so]||(t.favoriteQuotes[so]=[]),(c=t.favoriteQuotes[so])==null||c.push(Sn))}});Te(async e=>{["typingSpeedUnit","startGraphsAtZero"].includes(e)&&ze&&(en=[],vk(),await yk(),await bk(),Rn(),Ie.options.plugins.annotation.annotations=en,Ie.updateColors(),Ie.resize())});const V={particles:[],rendering:!1},uq=1e3,mq=.05,fq=4,pq=.6,jl=1500,sh=.3,nh=[6,3],Nl=10;function gq(){const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:999999",e.height=window.innerHeight,e.width=window.innerWidth,window.addEventListener("resize",()=>{e.height=window.innerHeight,e.width=window.innerWidth}),document.body.appendChild(e),e}function hq(e,t,a){return{x:e,y:t,color:a,alpha:1,prev:{x:e,y:t},vel:{x:jl-Math.random()*jl*2,y:jl-Math.random()*jl*2}}}function yq(e){!V.canvas||!V.deltaTime||(e.prev.x=e.x,e.prev.y=e.y,e.x+=e.vel.x*V.deltaTime,e.y+=e.vel.y*V.deltaTime,e.x>V.canvas.width?(e.vel.x*=-.3,e.x=V.canvas.width-(e.x-V.canvas.width)*sh):e.x<0&&(e.vel.x*=-.3,e.x*=-.3),e.y>V.canvas.height?(e.vel.y*=-.3,e.y=V.canvas.height-(e.y-V.canvas.height)*sh):e.y<0&&(e.vel.y*=-1,e.y*=-1),e.vel.y+=uq*V.deltaTime,e.vel.x*=1-mq*V.deltaTime,e.alpha*=1-pq*V.deltaTime)}function bq(){V.caret=n("#caret"),V.canvas=gq(),V.context2d=V.canvas.getContext("2d")}function kk(){if(!V.lastFrame||!V.context2d||!V.canvas)return;V.rendering=!0;const e=Date.now();V.deltaTime=(e-V.lastFrame)/1e3,V.lastFrame=e,V.context2d.clearRect(0,0,V.canvas.width,V.canvas.height);const t=[];for(const a of V.particles)a.alpha<.1||(yq(a),V.context2d.globalAlpha=a.alpha,V.context2d.strokeStyle=a.color,V.context2d.lineWidth=fq,V.context2d.beginPath(),V.context2d.moveTo(Math.round(a.prev.x),Math.round(a.prev.y)),V.context2d.lineTo(Math.round(a.x),Math.round(a.y)),V.context2d.stroke(),t.push(a));V.particles=t,V.particles.length&&!He()?requestAnimationFrame(kk):(V.context2d.clearRect(0,0,V.canvas.width,V.canvas.height),V.rendering=!1)}function Ck(e=!1){if(!V.resetTimeOut)return;delete V.resetTimeOut,clearTimeout(V.resetTimeOut);const t=n(document.body);t.css("transition","all .25s, transform 0.8s"),t.css("transform","translate(0,0)"),setTimeout(()=>{t.css("transition","all .25s, transform .05s"),n("html").css("overflow","inherit"),n("html").css("overflow-y","scroll")},e?0:1e3)}function vq(){V.rendering||(V.lastFrame=Date.now(),kk())}function wq(){const e=Math.floor(Math.random()*256).toString(16),t=Math.floor(Math.random()*256).toString(16),a=Math.floor(Math.random()*256).toString(16);return`#${e}${t}${a}`}async function Sk(e=!0,t=!1){var i,l;if(r.monkeyPowerLevel==="off"||He())return;if(r.blindMode&&(e=!0),["3","4"].includes(r.monkeyPowerLevel)){n("html").css("overflow","hidden");const c=[Math.round(Nl-Math.random()*Nl),Math.round(Nl-Math.random()*Nl)];n(document.body).css("transform",`translate(${c[0]}px, ${c[1]}px)`),V.resetTimeOut&&clearTimeout(V.resetTimeOut),V.resetTimeOut=setTimeout(Ck,2e3)}const a=(i=V.caret)==null?void 0:i.offset(),s=[(a==null?void 0:a.left)??0,((a==null?void 0:a.top)??0)+(((l=V.caret)==null?void 0:l.height())??0)];for(let c=Math.round((nh[0]+Math.random()*nh[1])*(t?2:1));c>0;c--){const d=["2","4"].includes(r.monkeyPowerLevel)?wq():e?await Ut("caret"):await Ut("error");V.particles.push(hq(...s,d))}vq()}const kq={laborers:"labourers",industrialized:"industrialised",acclimatizing:"acclimatising",acclimatized:"acclimatised",behoove:"behove",reorganization:"reorganisation",galvanize:"galvanise",demagogism:"demagoguism",canceled:"cancelled",baptize:"baptise",revitalize:"revitalise",skeptical:"sceptical",piscine:"piscinae",ionization:"ionisation",chili:"chilli",dexterous:"dextrous",likable:"likeable",neutralize:"neutralise",meter:"metre",meters:"metres",centimeter:"centimetre",hurrah:"hooray",multicolor:"multicolour",actualization:"actualisation",fertilizing:"fertilising",enamor:"enamour",skepticism:"scepticism",authorize:"authorise",minimize:"minimise",bandoleer:"bandolier",rigor:"rigour",fledgling:"fledgeling",mesquite:"mesquit",fogy:"fogey",characterize:"characterise",wagonette:"waggonette",plagiarize:"plagiarise",kilometers:"kilometres",molt:"moult",leveler:"leveller",checkered:"chequered",vendor:"vender",candor:"candour",moralize:"moralise",denationalization:"denationalisation",anemia:"anaemia",caiman:"cayman",chitterlings:"chitlins",acclimated:"acclimatised",acclimate:"acclimatise",skillful:"skilful",enamored:"enamoured",watercolor:"watercolour",extemporization:"extemporisation",lackluster:"lacklustre",equalizer:"equaliser",cipher:"cypher",polarization:"polarisation",polymerization:"polymerisation",ionize:"ionise",anesthetic:"anaesthetic",aerie:"eyrie",lachrymal:"lacrimal",decimeter:"decimetre",rajah:"raja",modernize:"modernise",gasoline:"petrol",alphabetized:"alphabetised",saber:"sabre",burglarize:"burglarise",terrorize:"terrorise",enthrall:"enthral",mustachioed:"moustachioed",anesthesia:"anaesthesia",sepulcher:"sepulchre",caftan:"kaftan",organize:"organise",manikin:"mannikin",dexterously:"dextrously",artifact:"artefact",kilometer:"kilometre",mommy:"mummy",brant:"brent",hyena:"hyaena",fuze:"fuse",victimize:"victimise",jihad:"jehad",airplane:"aeroplane",laborer:"labourer",vaporware:"vapourware",worshiped:"worshipped",taboret:"tabouret",rationalize:"rationalise",whimsy:"whimsey",scandalize:"scandalise",categorization:"categorisation",centered:"centred",kerosene:"kerosine",specialize:"specialise",specialized:"specialised",cicatrix:"cicatrice",jailer:"jailor",unfavorable:"unfavourable",guerrilla:"guerilla",emphasize:"emphasise",wacky:"whacky",ionizing:"ionising",czarina:"tzarina",ratline:"ratlin",abolitionize:"abolitionise",subsidize:"subsidise",plowing:"ploughing",untrammeled:"untrammelled",worshiping:"worshipping",memorization:"memorisation",anglicize:"anglicise",finalize:"finalise",gases:"gasses",fertilization:"fertilisation",libeling:"libelling",kinesthetic:"kinaesthetic",immunization:"immunisation",coloration:"colouration",overdraft:"overdraught",lambaste:"lambast",unpasteurized:"unpasteurised",ascendance:"ascendence",jeweler:"jeweller",fervor:"fervour",jeopardize:"jeopardise",abridgment:"abridgement",monopolize:"monopolise",colorless:"colourless",colorlessness:"colourlessness",tumors:"tumours",jinni:"jinn",aluminum:"aluminium",salable:"saleable",bronco:"broncho",lupine:"lupin",linchpin:"lynchpin",mesmerize:"mesmerise",internationalization:"internationalisation",anapestic:"anapaestic",supersede:"supercede",europeanize:"europeanise",optimized:"optimised",botanize:"botanise",organizational:"organisational",heme:"haem",estivation:"aestivation",edema:"oedema",penalize:"penalise",peddler:"pedlar",biased:"biassed",aggrandize:"aggrandise",rationalizing:"rationalising",deputize:"deputise",centers:"centres",unicolor:"unicolour",hypnotized:"hypnotised",anglicized:"anglicised",initialization:"initialisation",topee:"topi",nightie:"nighty",tricolor:"tricolour",reorganize:"reorganise",barbecue:"barbeque",fertilized:"fertilised",synthesize:"synthesise",economize:"economise",colter:"coulter",paleontologist:"palaeontologist",acclimatize:"acclimatise",idealize:"idealise",fossilization:"fossilisation",lionize:"lionise",acclimating:"acclimatising",luster:"lustre",demeanor:"demeanour",unauthorized:"unauthorised",smolder:"smoulder",abettor:"abetter",jewelry:"jewellery",demoralization:"demoralisation",fullness:"fulness",neighbored:"neighboured",neighbor:"neighbour",neighbors:"neighbours",neighboring:"neighbouring",neighborly:"neighbourly",neighborhood:"neighbourhood",neighborhoods:"neighbourhoods",magnetizer:"magnetiser",appetizer:"appetiser",hebraizing:"hebraising",carbonization:"carbonisation",favorably:"favourably",favorite:"favourite",behavioral:"behavioural",cognizant:"cognisant",skeptic:"sceptic",fiber:"fibre",fibers:"fibres",labeled:"labelled",analyze:"analyse",disorganization:"disorganisation",concenter:"concentre",categorize:"categorise",novelization:"novelisation",proselytize:"proselytise",draftsman:"draughtsman",paralyze:"paralyse",ostracize:"ostracise",italicize:"italicise",micrometer:"micrometre",cognizance:"cognisance",saltpeter:"saltpetre",conceptualization:"conceptualisation",containerization:"containerisation",anapest:"anapaest",leukemia:"leukaemia",omelet:"omelette",industrialize:"industrialise",characterization:"characterisation",amortize:"amortise",mazurka:"mazourka",macadamize:"macadamise",stymie:"stymy",analog:"analogue",prizer:"priser",cauterize:"cauterise",dysmenorrhea:"dysmenorrhoea",hippie:"hippy",mechanization:"mechanisation",commercialize:"commercialise",unsavory:"unsavoury",somber:"sombre",esophageal:"oesophageal",iodized:"iodised",tyrannize:"tyrannise",liberalize:"liberalise",computerization:"computerisation",synthesizer:"synthesiser",fertilizes:"fertilises",airdrome:"aerodrome",uncivilized:"uncivilised",mold:"mould",nitrogenized:"nitrogenised",legalize:"legalise",tantalize:"tantalise",eulogize:"eulogise",depolarization:"depolarisation",fecal:"faecal",bastardize:"bastardise",summarize:"summarise",cony:"coney",authorization:"authorisation",colorful:"colourful",temporized:"temporised",adviser:"advisor",tendinitis:"tendonitis",crystallization:"crystallisation",humor:"humour",humorous:"humourous",chanty:"shanty",dyspnea:"dyspnoea",aging:"ageing",mousy:"mousey",succor:"succour",distill:"distil",decentralization:"decentralisation",cauterization:"cauterisation",specter:"spectre",snowplow:"snowplough",pediatrics:"paediatrics",discoloration:"discolouration",tumor:"tumour",empathize:"empathise",pawpaw:"papaya",aggrandizement:"aggrandisement",fontanel:"fontanelle",brunet:"brunette",rumor:"rumour",epaulet:"epaulette",glycerin:"glycerine",fraternize:"fraternise",latinize:"latinise",sniveling:"snivelling",pasteurize:"pasteurise",modernization:"modernisation",patronize:"patronise",totaled:"totalled",normalization:"normalisation",niter:"nitre",shoveler:"shoveller",flier:"flyer",equalization:"equalisation",meagerly:"meagrely",favoritism:"favouritism",libelous:"libellous",popularized:"popularised",armory:"armoury",humanization:"humanisation",minuscule:"miniscule",collectible:"collectable",tepee:"teepee",stabilization:"stabilisation",moldy:"mouldy",colonize:"colonise",idealized:"idealised",meager:"meagre",armorer:"armourer",vitalize:"vitalise",fossilized:"fossilised",antagonize:"antagonise",criticize:"criticise",liter:"litre",stigmatize:"stigmatise",theorize:"theorise",combated:"combatted",desalination:"desalinisation",evangelize:"evangelise",idolization:"idolisation",smoldering:"smouldering",commercialization:"commercialisation",laureled:"laurelled",hematology:"haematology",fulfill:"fulfil",disorganized:"disorganised",accouterments:"accoutrements",busses:"buses",utilize:"utilise",enroll:"enrol",goiter:"goitre",stylized:"stylised",diarrhea:"diarrhoea",hypothesize:"hypothesise",esthetic:"aesthetic",dishonor:"dishonour",victualer:"victualler",paleolithic:"palaeolithic",sanatorium:"sanitarium",feminization:"feminisation",flotation:"floatation",teetotaler:"teetotaller",feudalization:"feudalisation",visualize:"visualise",fertilize:"fertilise",czar:"tzar",nationalization:"nationalisation",septicemia:"septicaemia",organizer:"organiser",recrystallization:"recrystallisation",dolor:"dolour",agonizing:"agonising",romanization:"romanisation",synchronize:"synchronise",amorist:"amourist",agonized:"agonised",belabor:"belabour",caster:"castor",softy:"softie",apothegm:"apophthegm",demobilization:"demobilisation",agonizes:"agonises",misdemeanor:"misdemeanour",recognizable:"recognisable",asshole:"arsehole",brutalization:"brutalisation",chamois:"shammy",clamor:"clamour",fertilizer:"fertiliser",deodorization:"deodorisation",privatization:"privatisation",tidbit:"titbit",molding:"moulding",alleluia:"halleluiah",canonization:"canonisation",customize:"customise",customization:"customisations",customizer:"customiser",customizers:"customisers",customizes:"customises",customizing:"customising",popularize:"popularise",specialty:"speciality",meagerness:"meagreness",esophagus:"oesophagus",millimeter:"millimetre",harmonization:"harmonisation",atomizer:"atomiser",dieresis:"diaeresis",maneuver:"manoeuvre",capitalize:"capitalise",gynecologist:"gynaecologist",acclimation:"acclimatisation",generalize:"generalise",temporize:"temporise",premunire:"praemunire",estival:"aestival",selvage:"selvedge",brier:"briar",hyperesthesia:"hyperaesthesia",maximize:"maximise",draftsmen:"draughtsmen",colonization:"colonisation",capitalization:"capitalisation",tenia:"taenia",paleontology:"palaeontology",libeler:"libeller",arytenoid:"arytaenoid",wainscoting:"wainscotting",globalization:"globalisation",legalization:"legalisation",magnetization:"magnetisation",stabilize:"stabilise",mesmerized:"mesmerised",savory:"savoury",reconnoiter:"reconnoitre",bastardized:"bastardised",rancor:"rancour",checker:"chequer",industrialization:"industrialisation",epitomize:"epitomise",socialize:"socialise",externalization:"externalisation",chivy:"chivvy",optimize:"optimise",romanize:"romanise",vulcanize:"vulcanise",plow:"plough",memorize:"memorise",sterilization:"sterilisation",routing:"routeing",raveling:"ravelling",savor:"savour",harmonize:"harmonise",cannibalize:"cannibalise",vaporize:"vaporise",utilization:"utilisation",hybridization:"hybridisation",mechanize:"mechanise",arbor:"arbour",arbors:"arbours",licorice:"liquorice",counselor:"counsellor",orthopedic:"orthopaedic",lusterless:"lustreless",numskull:"numbskull",paleozoic:"palaeozoic",malodor:"malodour",amenorrhea:"amenorrhoea",criticized:"criticised",gonorrhea:"gonorrhoea",fossilize:"fossilise",revolutionize:"revolutionise",woolen:"woollen",dishabille:"deshabille",organdy:"organdie",asses:"arses",furor:"furore",paycheck:"paycheque",pulverize:"pulverise",dramatization:"dramatisation",yodeler:"yodeller",apologize:"apologise",apologized:"apologised",blond:"blonde",oxidize:"oxidise",extemporize:"extemporise",whiz:"whizz",edile:"aedile",appall:"appal",legitimize:"legitimise",urbanization:"urbanisation",magnetize:"magnetise",womanize:"womanise",orthopedics:"orthopaedics",cognize:"cognise",christianization:"christianisation",vocalize:"vocalise",individualization:"individualisation",hemoglobin:"haemoglobin",racket:"racquet",agonize:"agonise",aggrandizes:"aggrandises",accouter:"accoutre",mollusk:"mollusc",publicize:"publicise",fraternization:"fraternisation",odorless:"odourless",odor:"odour",odorous:"odourous",rationalization:"rationalisation",pretense:"pretence",louver:"louvre",kopeck:"kopek",lissome:"lissom",idealization:"idealisation",nosy:"nosey",stogie:"stogy",althea:"althaea",immobilization:"immobilisation",majolica:"maiolica",savior:"saviour",civilize:"civilise",granddad:"grandad",centralization:"centralisation",localization:"localisation",evangelization:"evangelisation",ruble:"rouble",pajamas:"pyjamas",sterilize:"sterilise",math:"maths",localize:"localise",hospitalization:"hospitalisation",scrutinize:"scrutinise",acclimatization:"acclimatisation",misbehavior:"misbehaviour",behavior:"behaviour",color:"colour",tire:{britishWord:"tyre",exceptPreviousWords:["will"]},gray:"grey",grays:"greys",theater:"theatre",amphitheater:"amphitheatre",center:"centre",realize:"realise",realizing:"realising",realization:"realisation",license:"licence",mom:"mum","mom'l":"mum'll",favor:"favour",favors:"favours",favorites:"favourites",analyzed:"analysed",characterized:"characterised",colored:"coloured",colors:"colours",counseling:"counselling",customized:"customised",defense:"defence",offense:"offence",enrollment:"enrolment",flavor:"flavour",flavors:"flavours",flavoring:"flavouring",harbor:"harbour",harbored:"harboured",honor:"honour",honors:"honours",labor:"labour",licensed:"licenced",licenses:"licences",licensing:"licencing",modeling:"modelling",optimization:"optimisation",organization:"organisation",organizations:"organisations",organized:"organised",organizing:"organising",pediatric:"paediatric",personalized:"personalised",practice:"practise",realized:"realised",recognize:"recognise",recognized:"recognised",specialties:"specialities",specializing:"specialising",theaters:"theatres",travelers:"travellers",traveler:"traveller",traveling:"travelling",authorized:"authorised",behaviors:"behaviours",traveled:"travelled",utilizing:"utilising",utilized:"utilised",honored:"honoured",specializes:"specialises",practicing:"practising",signaling:"signalling",analyzing:"analysing",recognizes:"recognises",organizers:"organisers",visualization:"visualisation",standardized:"standardised",favorable:"favourable",analyzer:"analyser",recognizing:"recognising",uncategorized:"uncategorised",categorized:"categorised",vapor:"vapour",synchronization:"synchronisation",synchronized:"synchronised",rumors:"rumours",coloring:"colouring",honorable:"honourable",generalized:"generalised",generalization:"generalisation",mobilize:"mobilise",armor:"armour",armored:"armoured",labeling:"labelling",endeavor:"endeavour",civilized:"civilised",civilization:"civilisation",parlor:"parlour",tranquilize:"tranquilise",tranquillized:"tranquillised",tranquillization:"tranquillisation",catalog:"catalogue",cataloger:"cataloguer",cataloging:"cataloguing",catalogs:"catalogues",cataloged:"catalogued",uncataloged:"uncatalogued",catalogers:"cataloguers",discolored:"discoloured",discolor:"discolour",encyclopedias:"encyclopaedias",endeavored:"endeavoured",endeavors:"endeavours",endeavoring:"endeavouring",judgments:"judgements",judgment:"judgement",paneling:"panelling",defenses:"defences",criticizing:"criticising",mustache:"moustache",emphasized:"emphasised",emphasizes:"emphasises",emphasizing:"emphasising",fetus:"foetus",programs:"programmes",yogurt:"yoghurt",valor:"valour",moisturize:"moisturise",moisturized:"moisturised",moisturizes:"moisturises",moisturizing:"moisturising",favoring:"favouring",marvelous:"marvellous"};async function xk(e,t){if(e.includes("-"))return(await Promise.all(e.split("-").map(async a=>xk(a,t)))).join("-");{const a=e.replace(/^[\W]+|[\W]+$/g,"").toLowerCase(),s=kq[a];if(s===void 0)return e;const[i,l]=typeof s=="string"?[s,[]]:[s.britishWord,s.exceptPreviousWords];return r.mode==="quote"&&l.includes(t)?e:e.replace(RegExp(`^(?:([\\W]*)(${a})([\\W]*))$`,"gi"),(c,d,u,m)=>d+(u.charAt(0)===u.charAt(0).toUpperCase()?u===u.toUpperCase()?i.toUpperCase():al(i):i)+m)}}const Cq=[["áàâäåãąą́āą̄ă","a"],["éèêëẽęę́ēę̄ėě","e"],["íìîïĩįį́īį̄ı","i"],["óòôöøõóōǫǫ́ǭő","o"],["úùûüŭũúūůű","u"],["ńň","n"],["çĉčć","c"],["řŕṛ","r"],["ďđḍ","d"],["ťțṭ","t"],["ṃ","m"],["æ","ae"],["œ","oe"],["ẅŵ","w"],["ĝğg̃","g"],["ĥ","h"],["ĵ","j"],["ńṇṅ","n"],["ŝśšșşṣ","s"],["ß","ss"],["żźž","z"],["ÿỹýÿŷ","y"],["łľĺ","l"],["أإآ","ا"],["َ",""],["ُ",""],["ِ",""],["ْ",""],["ً",""],["ٌ",""],["ٍ",""],["ّ",""],["ё","е"],["ά","α"],["έ","ε"],["ί","ι"],["ύ","υ"],["ό","ο"],["ή","η"],["ώ","ω"],["þ","th"]],Sq=new Map(Cq.flatMap(e=>[...e[0]].map(t=>[t,e[1]])));function xq(e,t){const a=e.toLowerCase(),s=t==null?void 0:t.find(i=>i[0].includes(a));return s!==void 0?s[1]:Sq.get(a)}function Tq(e,t){if(!e)return e;const a=e.toUpperCase(),s=[...e].map((l,c)=>l===a[c]),i=[];for(let l=0;l<e.length;l++){const c=e[l],d=s[l],u=xq(c,t);u!==void 0?d?(i.push(u.substring(0,1).toUpperCase()),i.push(u.substring(1))):i.push(u):i.push(d?c.toUpperCase():c)}return i.join("")}const Tk=[["are",["aren't"]],["can",["can't"]],["could",["couldn't"]],["did",["didn't"]],["does",["doesn't"]],["do",["don't"]],["had",["hadn't"]],["has",["hasn't"]],["have",["haven't"]],["is",["isn't"]],["it",["it's","it'll"]],["i",["i'm","i'll","i've","i'd"]],["you",["you'll","you're","you've","you'd"]],["that",["that's","that'll","that'd"]],["must",["mustn't","must've"]],["there",["there's","there'll","there'd"]],["he",["he's","he'll","he'd"]],["she",["she's","she'll","she'd"]],["we",["we're","we'll","we'd"]],["they",["they're","they'll","they'd"]],["should",["shouldn't","should've"]],["was",["wasn't"]],["were",["weren't"]],["will",["won't"]],["would",["wouldn't","would've"]],["going",["goin'"]]];async function $q(e){return Tk.find(t=>e.match(RegExp(`^([\\W]*${t[0]}[\\W]*)$`,"gi")))!==void 0}async function Lq(e){const t=Tk.find(s=>e.match(RegExp(`^([\\W]*${s[0]}[\\W]*)$`,"gi")));if(t===void 0)return e;const a=Ya(t[1]);return e.replace(RegExp(`^(?:([\\W]*)(${t[0]})([\\W]*))$`,"gi"),(s,i,l,c)=>i+(l.charAt(0)===l.charAt(0).toUpperCase()?Aq(l)?a.toUpperCase():al(a):a)+c)}function Aq(e){return e==="I"?!1:e===e.toUpperCase()}function Mq(e){return/[?!.؟]/.test(e)}let yn="";async function Eq(e,t,a,s){let i=t;const l=r.language.split("_")[0],c=kb(e),d=zo("punctuateWord");if(d)return d.functions.punctuateWord(i);if(l!=="code"&&l!=="georgian"&&(a===0||Mq(c))){if(i=al(i),l==="turkish"&&(i=i.replace(/I/g,"İ")),l==="spanish"){const u=Math.random();u>.9?(i="¿"+i,yn="?"):u>.8&&(i="¡"+i,yn="!")}}else if(Math.random()<.1&&c!=="."&&c!==","&&a!==s-2||a===s-1)if(l==="spanish")(yn==="?"||yn==="!")&&(i+=yn,yn="");else{const u=Math.random();u<=.8?l==="kurdish"?i+=".":l==="nepali"||l==="bangla"||l==="hindi"?i+="।":l==="japanese"||l==="chinese"?i+="。":i+=".":u>.8&&u<.9?l==="french"?i="?":l==="arabic"||l==="persian"||l==="urdu"||l==="kurdish"?i+="؟":l==="greek"?i+=";":l==="japanese"||l==="chinese"?i+="？":i+="?":l==="french"?i="!":l==="japanese"||l==="chinese"?i+="！":i+="!"}else if(Math.random()<.01&&c!==","&&c!=="."&&l!=="russian")i=`"${i}"`;else if(Math.random()<.011&&c!==","&&c!=="."&&l!=="russian"&&l!=="ukrainian"&&l!=="slovak")i=`'${i}'`;else if(Math.random()<.012&&c!==","&&c!==".")if(l==="code"){const u=Math.random(),m=["()","{}","[]","<>"];r.language.startsWith("code_javascript")&&m.push("``");const f=Math.floor(u*m.length),p=m[f];i=`${p[0]}${i}${p[1]}`}else l==="japanese"||l==="chinese"?i=`（${i}）`:i=`(${i})`;else if(Math.random()<.013&&c!==","&&c!=="."&&c!==";"&&c!=="؛"&&c!==":"&&c!=="；"&&c!=="：")l==="french"?i=":":l==="chinese"?i+="：":i+=":";else if(Math.random()<.014&&c!==","&&c!=="."&&e!=="-")i="-";else if(Math.random()<.015&&c!==","&&c!=="."&&c!==";"&&c!=="؛"&&c!=="；"&&c!=="：")l==="french"?i=";":l==="greek"?i=".":l==="arabic"||l==="kurdish"?i+="؛":l==="chinese"?i+="；":i+=";";else if(Math.random()<.2&&c!==",")l==="arabic"||l==="urdu"||l==="persian"||l==="kurdish"?i+="،":l==="japanese"?i+="、":l==="chinese"?i+="，":i+=",";else if(Math.random()<.25&&l==="code"){const u=["{","}","[","]","(",")",";","=","+","%","/"],m=["{","}","[","]","(",")",";","=","+","%","/","/*","*/","//","!=","==","<=",">=","||","&&","<<",">>","%=","&=","*=","++","+=","--","-=","/=","^=","|="];r.language.startsWith("code_c")&&!r.language.startsWith("code_css")||r.language.startsWith("code_arduino")?i=Ya(m):r.language.startsWith("code_javascript")?i=Ya([...u,"`"]):i=Ya(u)}else Math.random()<.5&&l==="english"&&await $q(i)&&(i=await Pq(i));return i.includes("	")&&(i=i.replace(/\t/g,""),i+="	"),i.includes(`
`)&&(i=i.replace(/\n/g,""),i+=`
`),i}async function Pq(e){return Lq(e)}function Iq(){const e=zo("getWordsFrequencyMode");if(e)return e.functions.getWordsFrequencyMode()}async function qq(){const e=[],t=zo("pullSection");if(t){const a=await t.functions.pullSection(r.language);if(a===!1||a===void 0)throw Fn(t.name),new Error("Failed to pull section");for(const s of a.words){if(e.length>=r.words&&r.mode==="words")break;e.push(s)}}return e}function Bq(e,t,a){const s=zo("getWord");return s&&(e=s.functions.getWord(a,t)),e}function Dq(e,t,a){for(const s of ht("alterText"))e=s.functions.alterText(e,t,a);return e}async function Fq(e,t){return!r.britishEnglish||!r.language.includes("english")||r.mode==="quote"&&(re==null?void 0:re.britishText)!==void 0&&(re==null?void 0:re.britishText)!==""?e:await xk(e,t)}function Lu(e,t){const a=!t.noLazyMode||r.mode==="custom";return r.lazyMode&&a&&(e=Tq(e,t.additionalAccents)),e}function Wq(){var t,a;const e=((a=(t=Wo().find(s=>{var i;return(i=s.properties)==null?void 0:i.find(l=>l.startsWith("wordOrder"))}))==null?void 0:t.properties)==null?void 0:a.find(s=>s.startsWith("wordOrder")))??"";return e?e.split(":")[1]:"normal"}function zq(){var s,i;if(r.mode==="zen")return 0;let e=100;const t=re;if(r.mode==="quote"&&t===null)throw new ut("Random quote is null");const a=((i=(s=Wo().find(l=>{var c;return(c=l.properties)==null?void 0:c.find(d=>d.startsWith("toPush"))}))==null?void 0:s.properties)==null?void 0:i.find(l=>l.startsWith("toPush:")))??"";return r.showAllLines&&(r.mode==="custom"&&(e=qe()),r.mode==="words"&&(e=r.words),r.mode==="quote"&&(e=t.textSplit.length)),r.mode==="words"&&r.words===0&&(e=100),r.mode==="custom"&&(qe()===0||je()==="time"?e=100:e=qe()>100?100:qe()),a&&(e=+a.split(":")[1]),r.mode==="words"&&r.words!==0&&r.words<e&&(e=r.words),r.mode==="quote"&&t.textSplit.length<e&&(e=t.textSplit.length),r.mode==="custom"&&je()==="word"&&qe()<e&&qe()!==0&&(e=qe()),e}async function Rq(e,t){if(Ca){if(Qe===null)throw new ut("Current wordset is null");return rm($k),t==="reverse"?Qe.words.reverse():Qe.words}const a=e.name.startsWith("swiss_german")?"german":e.name;if((await Qt.getQuotes(a,r.quoteLength)).length===0)throw dt("words"),new ut(`No ${r.language.replace(/_\d*k$/g,"").replace(/_/g," ")} quotes found`);let i;if(r.quoteLength.includes(-2)&&r.quoteLength.length===1){const l=Qt.getQuoteById(Xu);if(l===void 0)throw ho(-1),new ut(`Quote ${Xu} does not exist`);i=l}else if(r.quoteLength.includes(-3)){const l=Qt.getRandomFavoriteQuote(r.language);if(l===null)throw ho(-1),new ut("No favorite quotes found");i=l}else{const l=Qt.getRandomQuote();if(l===null)throw ho(-1),new ut("No quotes found for selected quote length");i=l}if(i.language=ja(r.language),i.text=i.text.replace(/ +/gm," "),i.text=i.text.replace(/( *(\r\n|\r|\n) *)/g,`
 `),i.text=i.text.replace(/…/g,"..."),i.text=i.text.trim(),i.britishText!==void 0&&i.britishText!==""&&r.britishEnglish?i.textSplit=i.britishText.split(" "):i.textSplit=i.text.split(" "),rm(i),re===null)throw new ut("Random quote is null");if(re.textSplit===void 0)throw new ut("Random quote textSplit is undefined");return re.textSplit}let Qe=null,Ss=null,dc=!1,$k=null;async function Oq(e){Ca||(Im=[]),$k=re,rm(null),Is=[],Hn=0,nr=[],Ss=e;const t={words:[],sectionIndexes:[],hasTab:!1,hasNewline:!1};dc=C0("pullSection");const a=Wq();console.debug("Word order",a);let s=e.words;r.mode==="custom"?s=cl():r.mode==="quote"?s=await Rq(e,a):r.mode==="zen"&&(s=[]);const i=r.mode==="custom"&&di(),l=zq();console.debug(`${i?"Section":"Word"} limit ${l}`),a==="reverse"&&(s=s.reverse());const c=zo("withWords");if(c?Qe=await c.functions.withWords(s):Qe=await B2(s),console.debug("Wordset",Qe),l===0)return t;let d=!1,u=0;for(;!d;){const f=await Lk(u,l,Un(t.words,-1)??"",Un(t.words,-2)??"");if(t.words.push(f.word),t.sectionIndexes.push(f.sectionIndex),i){const p=Is.length===0&&Hn>=l,h=t.words.length>=100;(p||h)&&(d=!0)}else t.words.length>=l&&(d=!0);u++}const m=re;if(r.mode==="quote"&&m===null)throw new ut("Random quote is null");return t.hasTab=t.words.some(f=>f.includes("	"))||Qe.words.some(f=>f.includes("	"))||r.mode==="quote"&&m.textSplit.some(f=>f.includes("	")),t.hasNewline=t.words.some(f=>f.includes(`
`))||Qe.words.some(f=>f.includes(`
`))||r.mode==="quote"&&m.textSplit.some(f=>f.includes(`
`)),nr=[],t}let Hn=0,Is=[],nr=[],Im=[];async function Lk(e,t,a,s){if(console.debug("Getting next word",{isRepeated:Ca,currentWordset:Qe,wordIndex:e,language:Ss,wordsBound:t,previousWord:a,previousWord2:s}),Qe===null)throw new ut("Current wordset is null");if(Ss===null)throw new ut("Current language is null");if(Ca&&r.mode!=="quote"){const f=Im[e];if(f===void 0){let p=!1;if((r.mode==="time"||r.mode==="custom"&&je()==="time"||r.mode==="custom"&&je()==="word"&&e<qe()||r.mode==="words"&&e<r.words)&&(p=!0),p)console.debug("Repeated word is undefined but random generation is allowed - getting random word");else throw new ut("Repeated word is undefined")}else return console.debug("Repeated word: ",f),Hn++,f}const i=Iq()??"normal";let l=Qe.randomWord(i);const c=a.replace(/[.?!":\-,]/g,"").toLowerCase(),d=s==null?void 0:s.replace(/[.?!":\-,']/g,"").toLowerCase();if(Is.length===0){const f=await qq();if(r.mode==="quote")l=Qe.nextWord();else if(r.mode==="custom"&&er()==="repeat")l=Qe.nextWord();else if(r.mode==="custom"&&er()==="random"&&(Qe.length<4||Le.mode!==null))l=Qe.randomWord(i);else if(r.mode==="custom"&&er()==="shuffle")l=Qe.shuffledWord();else if(r.mode==="custom"&&je()==="section"){l=Qe.randomWord(i);const p=Un(nr,-1),h=Un(nr,-2);let y=0;for(;y<100&&(p===l||h===l);)y++,l=Qe.randomWord(i)}else if(dc)l=f.join(" ");else{let p=0,h=l.split(" ")[0].toLowerCase(),y=Lu(h,Ss);for(;p<100&&(c===y||d===y||r.mode!=="custom"&&!r.punctuation&&l==="I"||r.mode!=="custom"&&!r.punctuation&&!r.language.startsWith("code")&&/[-=_+[\]{};'\\:"|,./<>?]/i.test(l)||r.mode!=="custom"&&!r.numbers&&/[0-9]/i.test(l));)p++,l=Qe.randomWord(i),h=l.split(" ")[0],y=Lu(h,Ss)}l=l.replace(/ +/g," "),l=l.replace(/(^ )|( $)/g,""),l=Bq(l,e,Qe),Is=[...l.split(" ")],nr.push(l),l=Is.shift(),Hn++}else l=Is.shift();if(l===void 0)throw new ut("Random word is undefined");if(l==="")throw new ut("Random word is empty");if(/ /g.test(l))throw new ut("Random word contains spaces");const u=C0("getWord");r.mode!=="custom"&&r.mode!=="quote"&&/[A-Z]/.test(l)&&!r.punctuation&&!r.language.startsWith("german")&&!r.language.startsWith("swiss_german")&&!r.language.startsWith("code")&&!r.language.startsWith("klingon")&&!dc&&!u&&(l=l.toLowerCase()),l=l.replace(/ +/gm," "),l=l.replace(/(^ )|( $)/gm,""),l=Lu(l,Ss),l=await Fq(l,c),r.language.startsWith("swiss_german")&&(l=l.replace(/ß/g,"ss")),r.punctuation&&!Ss.originalPunctuation&&!dc&&(l=await Eq(a,l,e,t)),r.numbers&&Math.random()<.1&&(l=p0(4),r.language.startsWith("kurdish")?l=hy(l):r.language.startsWith("nepali")?l=yy(l):r.language.startsWith("bangla")?l=U1(l):r.language.startsWith("hindi")&&(l=K1(l))),l=Dq(l,e,t),console.debug("Word:",l);const m={word:l,sectionIndex:Hn};return Im.push(m),m}let Ak=0,Mk=0;async function _q(){const e=Qr(r,re),[t,a]=(await cb(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode)).map(Q);Ak=r.alwaysShowDecimalPlaces?t:Math.round(t),Mk=r.alwaysShowDecimalPlaces?a:Math.floor(a)}function Hq(){return Ak}function jq(){return Mk}Te(e=>{["difficulty","blindMode","stopOnError","paceCaret","minWpm","minAcc","minBurst","confidenceMode","layout","showAverage","typingSpeedUnit","quickRestart","customPolyglot"].includes(e)&&cs()});async function cs(){var i,l;n(".pageTest #testModesNotice").empty(),Ca&&r.mode!=="quote"&&n(".pageTest #testModesNotice").append('<div class="textButton noInteraction" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>'),Xr||n(".pageTest #testModesNotice").append('<div class="textButton" commands="resultSaving" style="color:var(--error-color);"><i class="fas fa-save"></i>saving disabled</div>'),kr&&(r.quickRestart==="esc"&&(n(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to open commandline</div>'),n(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + esc to restart</div>')),r.quickRestart==="tab"&&n(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + tab to restart</div>')),(Cr||r.funbox.includes("58008"))&&r.quickRestart==="enter"&&n(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + enter to restart</div>');const e=np(),t=Po();r.mode==="custom"&&e!==""&&t&&n(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-book"></i>${e} (shift + enter to save progress)</div>`),Dt&&n(".pageTest #testModesNotice").append(`<div class="textButton noInteraction"><i class="fas fa-award"></i>${Dt.display}</div>`),r.mode==="zen"&&n(".pageTest #testModesNotice").append('<div class="textButton noInteraction"><i class="fas fa-poll"></i>shift + enter to finish zen </div>');const a=Eo().includes("polyglot");if(r.mode!=="zen"&&!a&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="languages"><i class="fas fa-globe-americas"></i>${$o(r.language,r.mode==="quote")}</button>`),a){const c=r.customPolyglot.map(d=>$o(d,!0)).join(", ");n(".pageTest #testModesNotice").append(`<button class="textButton" commandId="changeCustomPolyglot"><i class="fas fa-globe-americas"></i>${c}</button>`)}if(r.difficulty==="expert"?n(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star-half-alt"></i>expert</button>'):r.difficulty==="master"&&n(".pageTest #testModesNotice").append('<button class="textButton" commands="difficulty"><i class="fas fa-star"></i>master</button>'),r.blindMode&&n(".pageTest #testModesNotice").append('<button class="textButton" commands="blindMode"><i class="fas fa-eye-slash"></i>blind</button>'),r.lazyMode&&n(".pageTest #testModesNotice").append('<button class="textButton" commands="lazyMode"><i class="fas fa-couch"></i>lazy</button>'),r.paceCaret!=="off"||r.repeatedPace&&Ns){const c=N.typingSpeed((G==null?void 0:G.wpm)??0,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`});n(".pageTest #testModesNotice").append(`<button class="textButton" commands="paceCaretMode"><i class="fas fa-tachometer-alt"></i>${r.paceCaret==="average"?"average":r.paceCaret==="pb"?"pb":r.paceCaret==="tagPb"?"tag pb":r.paceCaret==="last"?"last":r.paceCaret==="daily"?"daily":"custom"} pace ${c}</button>`)}if(r.showAverage!=="off"){const c=Hq(),d=jq();if(j()&&c>0){const u=["speed","both"].includes(r.showAverage)?N.typingSpeed(c,{suffix:` ${r.typingSpeedUnit}`,showDecimalPlaces:!1}):"",m=["acc","both"].includes(r.showAverage)?N.accuracy(d,{suffix:" acc",showDecimalPlaces:!1}):"",f=`${u} ${m}`.trim();n(".pageTest #testModesNotice").append(`<button class="textButton" commands="showAverage"><i class="fas fa-chart-bar"></i>avg: ${f}</button>`)}}r.minWpm!=="off"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="minWpm"><i class="fas fa-bomb"></i>min ${N.typingSpeed(r.minWpmCustomSpeed,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`})}</button>`),r.minAcc!=="off"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="minAcc"><i class="fas fa-bomb"></i>min ${r.minAccCustom}% acc</button>`),r.minBurst!=="off"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="minBurst"><i class="fas fa-bomb"></i>min ${N.typingSpeed(r.minBurstCustomSpeed,{showDecimalPlaces:!1})} ${r.typingSpeedUnit} burst ${r.minBurst==="flex"?"(flex)":""}</button>`),r.funbox!=="none"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="funbox"><i class="fas fa-gamepad"></i>${r.funbox.replace(/_/g," ").replace(/#/g,", ")}</button>`),r.confidenceMode==="on"&&n(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>confidence</button>'),r.confidenceMode==="max"&&n(".pageTest #testModesNotice").append('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>max confidence</button>'),r.stopOnError!=="off"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="stopOnError"><i class="fas fa-hand-paper"></i>stop on ${r.stopOnError}</button>`),r.layout!=="default"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="layouts"><i class="fas fa-keyboard"></i>emulating ${r.layout.replace(/_/g," ")}</button>`),r.oppositeShiftMode!=="off"&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="oppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${r.oppositeShiftMode==="keymap"?" (keymap)":""}</button>`);let s="";try{(l=(i=$())==null?void 0:i.tags)==null||l.forEach(c=>{c.active===!0&&(s+=c.display+", ")}),s!==""&&n(".pageTest #testModesNotice").append(`<button class="textButton" commands="tags"><i class="fas fa-tag"></i>${s.substring(0,s.length-2)}</button>`)}catch{}}const Ek=new jt({key:"prefersArabicLazyMode",schema:o.boolean(),fallback:!0});function Nq(){return Ek.get()}function Gq(e){Ek.set(e)}let Or="";const Uq=document.getElementById("koInputVisual");let ka=null;function Pk(){ka=null}function Kq(e){ka!==null&&(ka.uid=e,delete ka.hash,ka.hash=wy(ka))}function Vq(e){if(mr())return!1;j()?To("testStarted"):To("testStartedNoLogin"),yf(!0),v2(),n0(R.list),a2(),bp(),pp(),hp(),gp(),gl(),wp(),UP();for(const t of ht("start"))t.functions.start();try{(r.paceCaret!=="off"||r.repeatedPace&&Ns)&&HP()}catch{}return KE(e),nI(),!0}function le(e={}){e={...{withSameWordset:!1,practiseMissed:!1,noAnim:!1,nosave:!1},...e};const a=e.noAnim?0:Be(125);if(_t||Ys){event==null||event.preventDefault();return}if(ce()==="test"&&!ZM()&&(r.mode!=="zen"&&(event==null||event.preventDefault()),!rd(r.mode,r.words,r.time,rn(),Po()??!1))){let i="Use your mouse to confirm.";r.quickRestart==="tab"?i="Press shift + tab or use your mouse to confirm.":r.quickRestart==="esc"?i="Press shift + escape or use your mouse to confirm.":r.quickRestart==="enter"&&(i="Press shift + enter or use your mouse to confirm."),g(`Quick restart disabled in long tests. ${i}`,0,{duration:4,important:!0});return}if(Ge&&(Ca&&(e.withSameWordset=!0),Xr)){$d(),Ad(),Ld();const i=fl(performance.now()),l=fp(i);let c=Q(i-l);c<0&&(c=0),dp(c),cp();const d=Q(pl());up(d,c)}r.mode==="quote"&&re!==null&&r.language.startsWith(re.language)&&r.repeatQuotes==="typing"&&(Ge||Or!=="")&&(e.withSameWordset=!0),Le.mode!==null&&!e.withSameWordset&&!e.practiseMissed&&(g("Reverting to previous settings.",0),Le.punctuation!==null&&Ea(Le.punctuation),Le.numbers!==null&&ma(Le.numbers),Le.customText&&(Lo(Le.customText.text),xa(Le.customText.limit.mode),Ua(Le.customText.limit.value),Vs(Le.customText.pipeDelimiter)),dt(Le.mode),R0()),Sr(),wp(),UE(),o2(),at.reset(),f2(),eP(),dl(),yf(!1),Yf(),Rd(),_d(),Od(),jd(),ml(),ib(!1),_P(),tk(),T.setKoreanStatus(!1),ar(),Jn(),mI(),$E(),Xf(!1),ze&&(r.randomTheme!=="off"&&WP(),oM()),Xe()||gd();let s=null;ze?s=n("#result"):s=n("#typingTest"),S0(!1),js(!0),wm(!0),s.stop(!0,!0).animate({opacity:0},a,async()=>{n("#result").addClass("hidden"),n("#typingTest").css("opacity",0).removeClass("hidden"),n("#wordsInput").val(" "),r.language.startsWith("korean")?(Uq.innerText=" ",r.mode!=="zen"?n("#koInputVisualContainer").show():n("#koInputVisualContainer").hide()):n("#koInputVisualContainer").hide(),gs(!1),ce()==="test"&&Gc(!1),jI(),DI(),await fP(),qm=0,Or="";let i=!1;r.repeatedPace&&e.withSameWordset&&(i=!0),sb(e.withSameWordset??!1),SA(i),await Bm(),await X0();for(const c of ht("restart"))c.functions.restart();r.showAverage!=="off"?_q().then(()=>{cs()}):cs(),n("#wordsInput").is(":focus")&&Jr(),Bd(),n("#typingTest").css("opacity",0).removeClass("hidden").stop(!0,!0).animate({opacity:1},a,()=>{cP(),tP(),iP(),oP(),wm(!1),DE(),Sr(),js(!1)})}),ep()}let uc,qm=0;async function Bm(){if(console.debug("Initializing test"),qm++,qm>=4){wm(!1),g("Too many test reinitialization attempts. Something is going very wrong. Please contact support.",-1,{important:!0});return}Ck(),Yf(),R.reset(),xA(0),xE(0),T.resetHistory(),T.current="";let e;try{e=await ci(r.language)}catch(u){g(ae(u,"Failed to load language"),-1)}if(!e||e.name!==r.language){Us("english"),await Bm();return}ce()==="test"&&await vp(),r.mode==="quote"&&r.quoteLength.includes(-3)&&!j()&&ho(-1),r.tapeMode!=="off"&&e.rightToLeft&&(g("This language does not support tape mode.",0,{important:!0}),qf("off"));const t=!e.noLazyMode||r.mode==="custom";r.lazyMode&&!t?(uc=!0,g("This language does not support lazy mode.",0,{important:!0}),vr(!1,!0)):uc&&!e.noLazyMode&&vr(!0,!0),!r.lazyMode&&!e.noLazyMode&&(uc=!1),r.mode==="custom"&&console.debug("Custom text",rn());let a,s,i=!1,l=!1;try{const u=await Oq(e);a=u.words,s=u.sectionIndexes,i=u.hasTab,l=u.hasNewline}catch(u){console.error(u),u instanceof ut?u.message.length>0&&g(u.message,0,{important:!0}):g(ae(u,"Failed to generate words"),-1,{important:!0}),await Bm();return}const c=zf;let d=!1;for(const u of a)/\d/g.test(u)&&!d&&(d=!0);IM(d),EM(i),PM(l),c!==d&&Nc();for(let u=0;u<a.length;u++)R.push(a[u],s[u]);r.keymapMode==="next"&&r.mode!=="zen"&&Zo(Un([...R.getCurrent()],0)),jc(R.getCurrent()),FE(e.rightToLeft),WE(e.ligatures??!1),LE(),console.debug("Test initialized with words",a),console.debug("Test initialized with section indexes",s)}function xp(){var e;return r.mode==="words"&&R.length>=r.words&&r.words>0||r.mode==="custom"&&je()==="word"&&R.length>=qe()&&qe()!==0||r.mode==="quote"&&R.length>=(((e=re==null?void 0:re.textSplit)==null?void 0:e.length)??0)||r.mode==="custom"&&je()==="section"&&Hn>=qe()&&Is.length===0&&qe()!==0}async function ih(){var i,l;if(r.mode==="zen"){L0();return}let e=100;const t=(l=(i=Wo().find(c=>{var d;return(d=c.properties)==null?void 0:d.find(u=>u.startsWith("toPush"))}))==null?void 0:i.properties)==null?void 0:l.find(c=>c.startsWith("toPush:")),a=t==null?void 0:t.split(":")[1];if(a!==void 0&&(e=+a-1),R.length-T.getHistory().length>e){console.debug("Not adding word, enough words already");return}if(xp()){console.debug("Not adding word, all words generated");return}const s=zo("pullSection");if(s&&R.length-te<20){const c=await s.functions.pullSection(r.language);if(c===!1){g("Error while getting section. Please try again later",-1),Fn(s.name),le();return}if(c===void 0)return;let d=0;for(let u=0;u<c.words.length;u++){const m=c.words[u];if(d>=r.words&&r.mode==="words")break;d++,R.push(m,u),Kg(m)}}try{const c=await Lk(R.length,e,R.get(R.length-1),R.get(R.length-2));R.push(c.word,c.sectionIndex),Kg(c.word)}catch(c){Wr("fail","word generation error"),g(ae(c,"Error while getting next word. Please try again later"),-1)}}const qs={completedEvent:null,canRetry:!1};async function Qq(){const{completedEvent:e}=qs;if(e===null){g("Could not retry saving the result as the result no longer exists.",0,{duration:5,important:!0});return}qs.canRetry&&(qs.canRetry=!1,n("#retrySavingResultButton").addClass("hidden"),ua(!0),g("Retrying to save..."),await Ik(e,!0))}function Zq(e){var L;let t=Q(Ce.spacing.first-Xs);(t<0||r.mode==="zen")&&(t=0);let a=Q(mi-Ce.spacing.last);(a<0||r.mode==="zen")&&(a=0);const s=XE();if(s.time%1!==0&&r.mode!=="time"&&VE(),RP(s.wpm),Js&&!e){const D=mp();Ow(D.wpm),_w(D.raw),$d(),Ad(),Ld()}const i=Ks.map(D=>Math.round(D/5*60));if(r.mode!=="time"&&Js&&s.time%1>=.5){const D=1/(s.time%1);i[i.length-1]=Math.round(i[i.length-1]*D)}const l=Zi(i),c=ec(i);let d=Q(mu(l/c)),u=Ce.spacing.array.slice();u.length>0&&(u=u.slice(0,u.length-1));let m=Q(mu(Zi(u)/ec(u)));(!d||isNaN(d))&&(d=0),(!m||isNaN(m))&&(m=0);const f=[];for(const D of rl)f.push(D.count??0);const p={wpm:wo,raw:i,err:f},h=Zi(p.wpm??[]),y=ec(p.wpm??[]),b=Q(mu(h/y)),v=isNaN(b)?0:b;let C;if(r.mode==="custom"){const D=rn();C={textLen:D.text.length,mode:D.mode,pipeDelimiter:D.pipeDelimiter,limit:D.limit}}const E=[];for(const D of((L=$())==null?void 0:L.tags)??[])D.active===!0&&E.push(D._id);const k=parseFloat(s.time.toString()),M=fp(k);let q=r.language;r.mode==="quote"&&(q=ja(r.language));const W=(re==null?void 0:re.group)??-1,x={wpm:s.wpm,rawWpm:s.wpmRaw,charStats:[s.correctChars+s.correctSpaces,s.incorrectChars,s.extraChars,s.missedChars],charTotal:s.allChars,acc:s.acc,mode:r.mode,mode2:Qr(r,re),quoteLength:W,punctuation:r.punctuation,numbers:r.numbers,lazyMode:r.lazyMode,timestamp:Date.now(),language:q,restartCount:rp,incompleteTests:lp,incompleteTestSeconds:Rc<0?0:Q(Rc),difficulty:r.difficulty,blindMode:r.blindMode,tags:E,keySpacing:Ce.spacing.array,keyDuration:Ce.duration.array,keyOverlap:Q(no.total),lastKeyToEnd:a,startToFirstKey:t,consistency:d,wpmConsistency:v,keyConsistency:m,funbox:r.funbox,bailedOut:xs,chartData:p,customText:C,testDuration:k,afkDuration:M,stopOnLetter:r.stopOnError==="letter"};return x.mode!=="custom"&&delete x.customText,x.mode!=="quote"&&delete x.quoteLength,x}async function ei(e=!1){var b,v,C,E,k,M;if(!Ge)return;x0(!0);const t=performance.now();Zg(t),Ca&&r.mode==="quote"&&sb(!1),await Ee(1),T.current.length!==0&&(T.pushHistory(),at.pushHistory(),n0(T.getHistory())),e2(t);const a=(t-Ce.spacing.last)/1e3;if((r.mode==="zen"||xs)&&a<7&&Zg(Ce.spacing.last),S0(!0),yf(!1),Yf(),dl(),Rd(),_d(),Od(),jd(),Jr(),wp(),tk(),cs(),La.length!==((b=T.getHistory())==null?void 0:b.length)){const q=W0();Hw(q)}(r.mode==="zen"||xs)&&QE();const s=Zq(e);console.debug("Completed event object",s);function i(q){return typeof q=="number"?isNaN(q)?1:0:typeof q>"u"?1:typeof q=="object"&&q!==null?Object.values(q).reduce((W,x)=>W+i(x),0):0}let l=!1;i(s)>0&&(console.log(s),g("Failed to build result object: One of the fields is undefined or NaN",-1),l=!0);const c=Ma(s);let u=ll.slice(-5).every(q=>q);xs&&(u=!1);const m=parseInt(c.mode2);let f=!1;const p=(Ar-Lr)/1e3;if(r.mode==="time"&&!xs&&(s.testDuration<p-.1||s.testDuration>p+.1)&&s.testDuration<=120?(g("Test invalid - inconsistent test duration",0),console.error("Test duration inconsistent",s.testDuration,p),zl(),l=!0):e?(g(`Test failed - ${Or}`,0,{duration:1}),l=!0):u?(g("Test invalid - AFK detected",0),l=!0):Ca?(g("Test invalid - repeated",0),l=!0):c.testDuration<1||r.mode==="time"&&m<15&&m>0||r.mode==="time"&&m===0&&c.testDuration<15||r.mode==="words"&&m<10&&m>0||r.mode==="words"&&m===0&&c.testDuration<15||r.mode==="custom"&&(je()==="word"||je()==="section")&&qe()<10||r.mode==="custom"&&je()==="time"&&qe()<15||r.mode==="zen"&&c.testDuration<15?(g("Test invalid - too short",0),f=!0,l=!0):c.wpm<0||c.wpm>350&&c.mode!=="words"&&c.mode2!=="10"||c.wpm>420&&c.mode==="words"&&c.mode2==="10"?(g("Test invalid - wpm",0),zl(),l=!0):c.rawWpm<0||c.rawWpm>350&&c.mode!=="words"&&c.mode2!=="10"||c.rawWpm>420&&c.mode==="words"&&c.mode2==="10"?(g("Test invalid - raw",0),zl(),l=!0):(!((v=$())!=null&&v.lbOptOut)&&(c.acc<75||c.acc>100)||((C=$())==null?void 0:C.lbOptOut)===!0&&(c.acc<50||c.acc>100))&&(g("Test invalid - accuracy",0),zl(),l=!0),Ca){const q=c.testDuration,W=c.afkDuration;let x=Q(q-W);x<0&&(x=0);const L=c.acc;dp(x),cp(),up(L,x)}const h=np(),y=Po();if(r.mode==="custom"&&h!==""&&y)if(xs||T.getHistory().length<R.length){const q=(E=T.getHistory())==null?void 0:E.length,W=jf(h)+q;dm(h,W),g("Long custom text progress saved",1,{duration:5,important:!0});let x=Pc(h,!0);x=x.slice(W),Lo(x)}else{dm(h,0);const q=Pc(h,!0);Lo(q),g("Long custom text completed",1,{duration:5,important:!0})}if(iI(c.testDuration-c.afkDuration),XI(),j()?n(".pageTest #result #reportQuoteButton").removeClass("hidden"):(n(".pageTest #result #rateQuoteButton").addClass("hidden"),n(".pageTest #result #reportQuoteButton").addClass("hidden"),To("testCompletedNoLogin"),l||(ka=c),l=!0),n("#result .stats .dailyLeaderboard").addClass("hidden"),NE(Ma(c)),Xe()||gd(),await cq(c,e,Or,u,Ca,f,re,l),c.chartData!=="toolong"&&delete c.chartData.unsmoothedRaw,c.testDuration>122&&(c.chartData="toolong",c.keySpacing="toolong",c.keyDuration="toolong"),l){To("testCompletedInvalid");return}if(F0(),c.uid=(M=(k=xe)==null?void 0:k.currentUser)==null?void 0:M.uid,iq(re),ua(!0),!c.bailedOut){const q=dI(c);q!==null&&(c.challenge=q)}c.hash=wy(c),await Ik(c,!1)}async function Ik(e,t){var i;if(!Xr){g("Result not saved: disabled by user",-1,{duration:3,customTitle:"Notice",important:!0}),ua(!1);return}if(!Xe()){g("Result not saved: offline",-1,{duration:2,customTitle:"Notice",important:!0}),ua(!1),qs.canRetry=!0,n("#retrySavingResultButton").removeClass("hidden"),t||(qs.completedEvent=e);return}const a=await F.results.add({body:{result:e}});if(ua(!1),a.status!==200){[460,461,463,464,465,466].includes(a.status)||(qs.canRetry=!0,n("#retrySavingResultButton").removeClass("hidden"),t||(qs.completedEvent=e)),console.log("Error saving result",e),a.body.message==="Old key data format"&&(a.body.message="Old key data format. Please refresh the page to download the new update. If the problem persists, please contact support."),/"result\..+" is (not allowed|required)/gi.test(a.body.message)&&(a.body.message="Looks like your result data is using an incorrect schema. Please refresh the page to download the new update. If the problem persists, please contact support."),g("Failed to save result: "+a.body.message,-1);return}const s=a.body.data;if(n("#result .stats .tags .editTagsButton").attr("data-result-id",s.insertedId),n("#result .stats .tags .editTagsButton").removeClass("invisible"),s.xp!==void 0){const l=((i=$())==null?void 0:i.xp)??0;vb(l,s.xp,ze?s.xpBreakdown:void 0),pb(s.xp)}if(s.streak!==void 0&&jA(s.streak),s.insertedId!==void 0){const l=Ma(e);l._id=s.insertedId,s.isPb!==void 0&&s.isPb&&(l.isPb=!0),mb(l),fb(e.incompleteTests.length+1,e.testDuration+e.incompleteTestSeconds-e.afkDuration)}To("testCompleted"),s.isPb!==void 0&&s.isPb?(await gr(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,Ts(e.funbox))!==void 0&&aq(),cc("normal"),await zA(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,e.wpm,e.acc,e.rawWpm,e.consistency)):tq(),s.dailyLeaderboardRank===void 0?n("#result .stats .dailyLeaderboard").addClass("hidden"):(n("#result .stats .dailyLeaderboard").css({maxWidth:"13rem",opacity:0}).removeClass("hidden").animate({opacity:1},Be(500)),n("#result .stats .dailyLeaderboard .bottom").html(N.rank(s.dailyLeaderboardRank,{fallback:""}))),n("#retrySavingResultButton").addClass("hidden"),t&&g("Result saved",1,{important:!0})}function ir(e){if(Or=e,$d(),Ad(),Ld(),ei(!0),!Xr)return;const t=fl(performance.now()),a=fp(t);let s=Q(t-a);s<0&&(s=0),dp(s),cp();const i=Q(pl());up(i,s)}n(".pageTest").on("click","#testModesNotice .textButton.restart",()=>{le()});n(".pageTest").on("click","#restartTestButton",()=>{be(),!Ys&&(Ge&&r.repeatQuotes==="typing"&&r.mode==="quote"?le({withSameWordset:!0}):le())});n(".pageTest").on("click","#retrySavingResultButton",Qq);n(".pageTest").on("click","#nextTestButton",()=>{be(),le()});n(".pageTest").on("click","#restartTestButtonWithSameWordset",()=>{if(r.mode==="zen"){g("Repeat test disabled in zen mode");return}be(),le({withSameWordset:!0})});n(".pageTest").on("click","#testConfig .mode .textButton",e=>{if(_t||n(e.currentTarget).hasClass("active"))return;const t=n(e.currentTarget).attr("mode")??"time";t!==void 0&&(dt(t),be(),le())});n(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{if(_t)return;const t=n(e.currentTarget).attr("wordCount")??"15";t!=="custom"&&(ns(parseInt(t)),be(),le())});n(".pageTest").on("click","#testConfig .time .textButton",e=>{if(_t)return;const t=n(e.currentTarget).attr("timeConfig")??"10";t!=="custom"&&(Ga(parseInt(t)),be(),le())});n(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{if(_t)return;let t=parseInt(n(e.currentTarget).attr("quoteLength")??"1");t!==-2&&(t===-1&&(t=[0,1,2,3]),ho(t,!1,e.shiftKey),be(),le())});n(".pageTest").on("click","#testConfig .punctuationMode.textButton",()=>{_t||(Ea(!r.punctuation),be(),le())});n(".pageTest").on("click","#testConfig .numbersMode.textButton",()=>{_t||(ma(!r.numbers),be(),le())});n("header").on("click","nav #startTestButton, #logo",()=>{ce()==="test"&&le()});Te((e,t,a)=>{ce()==="test"&&(e==="language"&&(t!=null&&t.startsWith("arabic")&&Nq()&&vr(!0,!0),le()),e==="difficulty"&&!a&&le(),e==="customLayoutfluid"&&r.funbox.includes("layoutfluid")&&le(),e==="keymapMode"&&t==="next"&&r.mode!=="zen"&&setTimeout(()=>{Zo(Un([...R.getCurrent()],0))},0)),e==="lazyMode"&&!a&&(r.language.startsWith("arabic")&&Gq(t),t===!1&&(uc=!1))});KP((e,t)=>{e==="fail"&&t!==void 0&&ir(t),e==="finish"&&ei()});function qk(e){Tp.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.words}`}})}function Yq(e=!1){Tp.hide({clearModalChain:e})}function Xq(){var t;const e=parseInt((t=Tp.getModal().querySelector("input"))==null?void 0:t.value,10);e!==null&&!isNaN(e)&&e>=0&&isFinite(e)?ns(e)&&(be(),le(),e>2e3?g("Stay safe and take breaks!",0):e===0&&g("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7})):g("Custom word amount must be at least 1",0),Yq(!0)}const Tp=new fe({dialogId:"customWordAmountModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),Xq()})}});var zs=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),Vd=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),Qd=Vd();Vd().max(50);var hs=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var $p=o.enum(["normal","expert","master"]),Ii=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:$p,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),Zd=o.object({time:o.record(zs.describe("Number of seconds as string"),o.array(Ii)),words:o.record(zs.describe("Number of words as string"),o.array(Ii)),quote:o.record(zs,o.array(Ii)),custom:o.record(o.literal("custom"),o.array(Ii)),zen:o.record(o.literal("zen"),o.array(Ii))}),Jq=o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]),eB=o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]),tB=o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]),Lp=Zd.keyof(),Bk=o.union([zs,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})}),aB=o.enum(["off","slow","medium","fast"]),oB=o.enum(["off","esc","tab","enter"]),sB=o.union([o.literal(-3),o.literal(-2),o.literal(-1),o.literal(0),o.literal(1),o.literal(2),o.literal(3)]),nB=o.array(sB),rh=o.enum(["off","default","block","outline","underline","carrot","banana"]),iB=o.enum(["off","on","max"]),rB=o.enum(["off","below","replace"]),lB=o.enum(["off","bar","text","mini"]),Au=o.enum(["off","text","mini"]),cB=o.enum(["off","on","fav","light","dark","custom"]),dB=o.enum(["black","sub","text","main"]),uB=o.enum(["0.25","0.5","0.75","1"]),mB=o.enum(["off","word","letter"]),fB=o.enum(["off","static","react","next"]),pB=o.enum(["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]),gB=o.enum(["lowercase","uppercase","blank","dynamic"]),hB=o.enum(["always","layout","never"]),yB=o.number().min(.5).max(3.5).step(.1),bB=o.enum(["manual","on"]),vB=o.enum(["off","1","2","3","4"]),wB=o.enum(["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]),kB=o.number().min(0).max(1),CB=o.enum(["off","average","pb","tagPb","last","custom","daily"]),SB=o.tuple([o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"])]),xB=o.enum(["off","custom"]),TB=o.enum(["off","letter","word","next_word","next_two_words","next_three_words"]),$B=o.enum(["off","letter","word"]),LB=o.number().min(10).max(90),AB=o.enum(["wpm","cpm","wps","cps","wph"]),MB=o.enum(["off","result","on","sellout"]),EB=o.enum(["off","custom"]),PB=o.enum(["off","typing"]),IB=o.enum(["off","on","keymap"]),qB=o.enum(["cover","contain","max"]),BB=o.tuple([o.number(),o.number(),o.number(),o.number()]),DB=o.string().regex(/^[0-9a-zA-Z_#]+$/),FB=o.array(hs).min(1),WB=o.enum(["off","1","2","3","4"]),zB=o.enum(["off","fixed","flex"]),RB=o.enum(["off","speed","acc","both"]),Fa=o.string().regex(/^#([\da-f]{3}){1,2}$/i),OB=$p,Dk=o.tuple([Fa,Fa,Fa,Fa,Fa,Fa,Fa,Fa,Fa,Fa]),_B=o.array(Vd().max(50)),HB=o.string().max(100).regex(/[\w#]+/),jB=o.number().nonnegative(),NB=o.number().nonnegative(),GB=o.number().nonnegative().max(100),UB=o.number().nonnegative(),KB=o.number().int().nonnegative(),VB=o.number().int().nonnegative(),QB=o.string().max(50).regex(/^[a-zA-Z0-9_\-+.]+$/),Mu=Vd().max(50),ZB=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),YB=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),XB=o.number().positive(),JB=o.number().min(20).max(1e3).or(o.literal(0)),eD=o.string().url("Needs to be an URI.").regex(/^(https|http):\/\/.*/,"Unsupported protocol.").regex(/^[^`'"]*$/,"May not contain quotes.").regex(/.+(\.png|\.gif|\.jpeg|\.jpg)/gi,"Unsupported image format.").max(2048,"URL is too long.").or(o.literal("")),tD=o.object({theme:Mu,themeLight:Mu,themeDark:Mu,autoSwitchTheme:o.boolean(),customTheme:o.boolean(),customThemeColors:Dk,favThemes:_B,showKeyTips:o.boolean(),smoothCaret:aB,codeUnindentOnBackspace:o.boolean(),quickRestart:oB,punctuation:o.boolean(),numbers:o.boolean(),words:VB,time:KB,mode:Lp,quoteLength:nB,language:hs,fontSize:XB,freedomMode:o.boolean(),difficulty:OB,blindMode:o.boolean(),quickEnd:o.boolean(),caretStyle:rh,paceCaretStyle:rh,flipTestColors:o.boolean(),layout:YB,funbox:HB,confidenceMode:iB,indicateTypos:rB,timerStyle:lB,liveSpeedStyle:Au,liveAccStyle:Au,liveBurstStyle:Au,colorfulMode:o.boolean(),randomTheme:cB,timerColor:dB,timerOpacity:uB,stopOnError:mB,showAllLines:o.boolean(),keymapMode:fB,keymapStyle:pB,keymapLegendStyle:gB,keymapLayout:ZB,keymapShowTopRow:hB,keymapSize:yB,fontFamily:QB,smoothLineScroll:o.boolean(),alwaysShowDecimalPlaces:o.boolean(),alwaysShowWordsHistory:o.boolean(),singleListCommandLine:bB,capsLockWarning:o.boolean(),playSoundOnError:vB,playSoundOnClick:wB,soundVolume:kB,startGraphsAtZero:o.boolean(),showOutOfFocusWarning:o.boolean(),paceCaret:CB,paceCaretCustomSpeed:jB,repeatedPace:o.boolean(),accountChart:SB,minWpm:xB,minWpmCustomSpeed:NB,highlightMode:TB,tapeMode:$B,tapeMargin:LB,typingSpeedUnit:AB,ads:MB,hideExtraLetters:o.boolean(),strictSpace:o.boolean(),minAcc:EB,minAccCustom:GB,monkey:o.boolean(),repeatQuotes:PB,oppositeShiftMode:IB,customBackground:eD,customBackgroundSize:qB,customBackgroundFilter:BB,customLayoutfluid:DB,monkeyPowerLevel:WB,minBurst:zB,minBurstCustomSpeed:UB,burstHeatmap:o.boolean(),britishEnglish:o.boolean(),lazyMode:o.boolean(),showAverage:RB,maxLineWidth:JB,customPolyglot:FB}).strict();tD.partial();o.enum(["test","behavior","input","sound","caret","appearance","theme","hideElements","ads","hidden"]);var lh={a:["а","à","á","ạ","ą"],c:["с","ƈ","ċ"],d:["ԁ","ɗ"],e:["е","ẹ","ė","ė","é","è"],g:["ġ"],h:["һ"],i:["і","í","ì","ï"],j:["ј","ʝ"],k:["κ"],l:["ӏ","ḷ"],n:["ո"],o:["о","ο","օ","ȯ","ọ","ỏ","ơ","ö","ó","ò"],p:["р"],q:["զ"],s:["ʂ"],u:["υ","ս","ü","ú","ù"],v:["ν","ѵ"],x:["х","ҳ"],y:["у","ý"],z:["ʐ","ż"]};function aD(e){for(let t in lh)lh[t].forEach(a=>{e=e.replace(a,t)});return e}function oD(e,t){let a=e.toLowerCase().split(/[.,"/#!?$%^&*;:{}=\-_`~()\s\n]+/g).map(s=>{var i;return aD((i=sD(s))!=null?i:"")});return iD.some(s=>a.some(i=>i.startsWith(s)))}function sD(e){return e===void 0||e===""?e:e.replace(/[\u0300-\u036F]/g,"").trim().replace(/\n{3,}/g,`

`).replace(/\s{3,}/g,"  ")}function nD(e,t){return t.refine(a=>!oD(a),a=>({message:`Profanity detected. Please remove it. If you believe this is a mistake, please contact us. (${a})`}))}var iD=["miodec","bitly","niqqa","niqqer","ni99a","ni99er","niggas","niga","niger","retard","ahole","anus","ash0le","asholes","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","biatch","bitch","bitches","blow job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","carpet muncher","cawk","cawks","clit","cnts","cntz","cock","cockhead","cock-head","cocks","cocksucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagit","fags","fagz","faigs","flipping the bird","fudge packer","fukah","fuken","fuker","fukin","fukk","fukkah","fukken","fukker","fukkin","g00k","gayboy","gaygirl","gayz","god-damned","h00r","h0ar","h0re","jackoff","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","lezzian","lipshits","lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","phuc","phuck","phuk","phuker","phukker","poonani","pr1c","pr1ck","pr1k","puss","pussee","pussy","puuke","puuker","qweers","qweerz","qweir","recktum","rectum","retard","sadist","scank","schlong","semen","sex","sexy","sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","shitty","shity","shitz","shyt","shyte","shytty","shyty","skanck","skank","skankee","skankey","skanks","skanky","slut","sluts","slutty","slutz","son-of-a-bitch","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","wh00r","wh0re","whore","xrated","b!+ch","bitch","blowjob","clit","arschloch","shit","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","dyke","fuck","shit","amcik","andskota","arse","assrammer","ayir","bi7ch","bitch","bollock","breasts","butt-pirate","cabron","cazzo","chraa","chuj","cunt","daygo","dego","dick","dike","dupa","dziwka","ejackulate","ekrem","enculer","fag","fanculo","fanny","feces","felcher","ficken","flikker","foreskin","fotze","futkretzn","gook","guiena","h4x0r","helvete","hoer","honkey","huevon","injun","jizz","kanker","klootzak","kraut","knulle","kuksuger","kurac","kurwa","kusi","kyrpa","lesbo","mamhoon","masturbat","merd","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger","orospu","paska","perse","picka","pierdol","pillu","pimmel","piss","pizda","poontsee","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef","rautenberg","schaffer","scheiss","schlampe","schmuck","sh!t","sharmuta","sharmute","skurwysyn","sphencter","spierdalaj","splooge","suka","b00b","testicle","titt","twat","vittu","wank","wetback","wichser","zabourah"],Fk=o.object({_id:Qd,name:o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),pb:o.object({no:o.boolean(),yes:o.boolean()}).strict(),difficulty:o.record($p,o.boolean()),mode:o.record(Lp,o.boolean()),words:o.record(Jq.or(o.literal("custom")),o.boolean()),time:o.record(eB.or(o.literal("custom")),o.boolean()),quoteLength:o.record(tB,o.boolean()),punctuation:o.object({on:o.boolean(),off:o.boolean()}).strict(),numbers:o.object({on:o.boolean(),off:o.boolean()}).strict(),date:o.object({last_day:o.boolean(),last_week:o.boolean(),last_month:o.boolean(),last_3months:o.boolean(),all:o.boolean()}).strict(),tags:o.record(o.string(),o.boolean()),language:o.record(hs,o.boolean()),funbox:o.record(o.string(),o.boolean())}),rD=o.number().int().min(-11).max(12),lD=o.object({lastResultTimestamp:o.number().int().nonnegative(),length:o.number().int().nonnegative(),maxLength:o.number().int().nonnegative(),hourOffset:rD.optional()}).strict(),cD=o.object({_id:Qd,name:o.string(),personalBests:Zd}).strict();function qi(e){return nD("word",e).optional().transform(t=>t===null?void 0:t)}var Wk=o.object({bio:qi(o.string().max(250)).or(o.literal("")),keyboard:qi(o.string().max(75)).or(o.literal("")),socialProfiles:o.object({twitter:qi(o.string().max(20).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),github:qi(o.string().max(39).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),website:qi(o.string().url().max(200).startsWith("https://")).or(o.literal(""))}).strict().optional()}).strict(),dD=o.string().regex(/^[0-9a-zA-Z_-]+$/).max(16),uD=o.object({_id:Qd,name:dD,colors:Dk}).strict(),mD=o.object({startTimestamp:o.number().int().nonnegative(),expirationTimestamp:o.number().int().nonnegative().or(o.literal(-1).describe("lifetime premium"))}),fD=o.record(hs,o.record(zs.describe("quoteId as string"),o.number().nonnegative())),pD=o.record(Lp,o.record(Bk,o.record(hs,o.number().int().nonnegative()))),gD=o.object({rank:o.number().int().nonnegative().optional(),count:o.number().int().nonnegative()}),hD=o.object({time:o.record(Bk,o.record(hs,gD.optional()))}),zk=o.object({id:o.number().int().nonnegative(),selected:o.boolean().optional()}).strict(),yD=o.object({badges:o.array(zk)}).strict(),bD=o.boolean().describe("Admin for all languages if true").or(hs.describe("Admin for the given language")),vD=o.object({testsByDays:o.array(o.number().int().nonnegative().or(o.null())).describe("Number of tests by day. Last element of the array is on the date `lastDay`. `null` means no tests on that day."),lastDay:o.number().int().nonnegative().describe("Timestamp of the last day included in the test activity")}).strict();o.record(zs.describe("year"),o.array(o.number().int().nonnegative().nullable().describe("number of tests, position in the array is the day of the year")));var wD=o.record(hs,o.array(zs)),kD=o.object({name:o.string(),email:o.string().email(),uid:o.string(),addedAt:o.number().int().nonnegative(),personalBests:Zd,lastReultHashes:o.array(o.string()).optional(),completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().nonnegative().optional().describe("time typing in seconds"),streak:lD.optional(),xp:o.number().int().nonnegative().optional(),discordId:o.string().optional(),discordAvatar:o.string().optional(),tags:o.array(cD).optional(),profileDetails:Wk.optional(),customThemes:o.array(uD).optional(),premium:mD.optional(),isPremium:o.boolean().optional(),quoteRatings:fD.optional(),favoriteQuotes:wD.optional(),lbMemory:pD.optional(),allTimeLbs:hD,inventory:yD.optional(),banned:o.boolean().optional(),lbOptOut:o.boolean().optional(),verified:o.boolean().optional(),needsToChangeName:o.boolean().optional(),quoteMod:bD.optional(),resultFilterPresets:o.array(Fk).optional(),testActivity:vD.optional()}),CD=o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),SD=o.object({completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().int().nonnegative().optional()});kD.pick({uid:!0,name:!0,banned:!0,addedAt:!0,discordId:!0,discordAvatar:!0,xp:!0,lbOptOut:!0,isPremium:!0,inventory:!0,allTimeLbs:!0}).extend({typingStats:SD,personalBests:Zd.pick({time:!0,words:!0}),streak:o.number().int().nonnegative(),maxStreak:o.number().int().nonnegative(),details:Wk}).partial({inventory:!0,details:!0,allTimeLbs:!0,uid:!0});var Rk=o.enum(["xp","badge"]),xD=o.object({type:o.literal(Rk.enum.xp),item:o.number().int()}),TD=o.object({type:o.literal(Rk.enum.badge),item:zk}),$D=xD.or(TD);o.object({id:Qd,subject:o.string(),body:o.string(),timestamp:o.number().int().nonnegative(),read:o.boolean(),rewards:o.array($D)});o.enum(["Inappropriate name","Inappropriate bio","Inappropriate social links","Suspected cheating"]);const LD={_id:"default",name:"defaults",pb:{no:!0,yes:!0},difficulty:{normal:!0,expert:!0,master:!0},mode:{words:!0,time:!0,quote:!0,zen:!0,custom:!0},words:{10:!0,25:!0,50:!0,100:!0,custom:!0},time:{15:!0,30:!0,60:!0,120:!0,custom:!0},quoteLength:{short:!0,medium:!0,long:!0,thicc:!0},punctuation:{on:!0,off:!0},numbers:{on:!0,off:!0},date:{last_day:!1,last_week:!1,last_month:!1,last_3months:!1,all:!0},tags:{none:!0},language:{},funbox:{none:!0}},Mt=Ma(LD);function AD(e){try{const t={};for(const a of xo(Mt))if(a==="_id"){let s=e[a]??Mt[a];(s==="default-result-filters-id"||s==="")&&(s="default"),t[a]=s}else a==="name"?t[a]=e[a]??Mt[a]:t[a]={...Mt[a],...e[a]};return t}catch{return Mt}}const Ok=new jt({key:"resultFilters",schema:Fk,fallback:Mt,migrate:(e,t)=>py(e)?AD(e):Mt}),MD=new Set(["language","funbox","tags"]),rr={};let ee=Mt;function qo(){Ok.set(ee)}async function ED(){try{ee=Ok.get();const e={none:!1};Object.keys(Mt.tags).forEach(t=>{ee.tags[t]!==void 0?e[t]=ee.tags[t]:e[t]=!0}),ee.tags=e,qo()}catch{console.log("error in loading result filters"),ee=Mt,qo()}}async function Ap(){var s;const e=document.querySelector(".pageAccount .presetFilterButtons"),t=document.querySelector(".pageAccount .presetFilterButtons .filterBtns");if(!e||!t)return;t.innerHTML="";const a=((s=$())==null?void 0:s.filterPresets)??[];if(a.length>0){let i="";for(const l of a)i+=`<div class="filterPresets">
      <div class="select-filter-preset button" data-id="${l._id}">${l.name.replace(/_/g," ")}</div>
      <div class="button delete-filter-preset" data-id="${l._id}">
        <i class="fas fa-fw fa-trash"></i>
      </div>
    </div>`;t.innerHTML=i,e.classList.remove("hidden")}else e.classList.add("hidden")}async function PD(e){var a;const t=(a=$())==null?void 0:a.filterPresets.find(s=>s._id===e);t&&(ee=_D(t),qo(),Ro()),n(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active"),n(`.pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset[data-id=${e}]`).addClass("active")}function ID(e){const t=$();t&&gt({...t,filterPresets:[...t.filterPresets,Ma(e)]})}async function qD(e){e=e.replace(/ /g,"_"),de();const t=await F.users.addResultFilterPreset({body:{...ee,name:e}});Z(),t.status===200?(ID({...ee,name:e,_id:t.body.data}),Ap(),g("Filter preset created",1)):(g("Error creating filter preset: "+t.body.message,-1),console.log("error creating filter preset: "+t.body.message))}function BD(e){const t=$();if(!t)return;const a=[...t.filterPresets],s=a.findIndex(i=>i._id===e);s>-1&&a.splice(s,1),gt({...t,filterPresets:a})}async function DD(e){de();const t=await F.users.removeResultFilterPreset({params:{presetId:e}});Z(),t.status===200?(BD(e),Ap(),Ep(),g("Filter preset deleted",1)):(g("Error deleting filter preset: "+t.body.message,-1),console.log("error deleting filter preset",t.body.message))}function Mp(){n(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active")}function ti(){return ee}function Dm(e){return ee[e]}function Ue(e,t){return ee[e][t]}function FD(e,t,a){ee[e][t]=a}function Va(e,t){Object.keys(Dm(e)).forEach(a=>{ee[e][a]=t})}function WD(e){e.forEach(t=>{Mt.tags[t._id]=!0})}function Ep(){ee=Mt,qo()}function Ro(){var s,i,l,c,d;const e={};for(const u of xo(ti()))if(!(u==="_id"||u==="name")){e[u]={all:!0,array:[]};for(const m of xo(Dm(u))){const f=e[u];if(f===void 0)continue;const p=Ue(u,m);if(p===!0?(s=f.array)==null||s.push(m):f.all!==void 0&&(f.all=!1),MD.has(u)){const h=n(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] option[value="${m}"]`);p===!0?h.prop("selected",!0):h.prop("selected",!1)}else{let h;u==="date"?h=n(`.pageAccount .group.topFilters .filterGroup[group="${u}"] button[filter="${m}"]`):h=n(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] button[filter="${m}"]`),p===!0?h.addClass("active"):h.removeClass("active")}}}for(const[u,m]of Object.entries(rr)){const f=m,p=Dm(u),h=Object.values(p).every(v=>v===!0),y=f.store.getData(),b=n(`.pageAccount .group.filterButtons .filterGroup[group="${u}"] option[value="all"]`);if(h){b.prop("selected",!0);for(const v of y)"value"in v&&(v.value==="all"?v.selected=!0:v.selected=!1);f.store.setData(y),f.render.renderValues()}else b.prop("selected",!1);for(const v of y)"value"in v&&(p[v.value]===!0?v.selected=!0:(!h||v.value!=="all")&&(v.selected=!1));setTimeout(()=>{f.store.setData(y),h||f.render.renderValues(),f.render.renderOptions(y)},0)}function t(u){var f,p,h,y,b;let m="";return m+="<div class='group'>",u==="difficulty"?m+='<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>':u==="mode"?m+='<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>':u==="punctuation"?m+='<span aria-label="Punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i>':u==="numbers"?m+='<span aria-label="Numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i>':u==="words"?m+='<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>':u==="time"?m+='<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>':u==="date"?m+='<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>':u==="tags"?m+='<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>':u==="language"?m+='<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>':u==="funbox"&&(m+='<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>'),(f=e[u])!=null&&f.all?m+="all":u==="tags"?m+=(h=(p=e.tags)==null?void 0:p.array)==null?void 0:h.map(v=>{var k,M,q;if(v==="none")return v;const C=$();if(C===void 0)return v;const E=(k=C.tags)==null?void 0:k.filter(W=>W._id===v)[0];return E!==void 0?(q=(M=C.tags)==null?void 0:M.filter(W=>W._id===v)[0])==null?void 0:q.display:E}).join(", "):m+=(b=(y=e[u])==null?void 0:y.array)==null?void 0:b.join(", ").replace(/_/g," "),m+="</span></div>",m}let a="";a+=t("date"),a+='<div class="spacer"></div>',a+=t("mode"),a+='<div class="spacer"></div>',(l=(i=e.mode)==null?void 0:i.array)!=null&&l.includes("time")&&(a+=t("time"),a+='<div class="spacer"></div>'),(d=(c=e.mode)==null?void 0:c.array)!=null&&d.includes("words")&&(a+=t("words"),a+='<div class="spacer"></div>'),a+=t("difficulty"),a+='<div class="spacer"></div>',a+=t("punctuation"),a+='<div class="spacer"></div>',a+=t("numbers"),a+='<div class="spacer"></div>',a+=t("language"),a+='<div class="spacer"></div>',a+=t("funbox"),a+='<div class="spacer"></div>',a+=t("tags"),setTimeout(()=>{n(".pageAccount .group.chart .above").html(a)},0)}function zD(e,t){Mp();try{e==="date"&&Va("date",!1);const s=!ee[e][t];ee[e][t]=s,qo()}catch(a){g("Something went wrong toggling filter. Reverting to defaults.",0),console.log("toggling filter error"),console.error(a),Ep(),Ro()}}n(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click","button",e=>{const t=n(e.target).parents(".buttons").attr("group"),a=n(e.target).attr("filter");n(e.target).hasClass("allFilters")?(xo(ti()).forEach(s=>{s==="_id"||s==="name"||Va(s,!0)}),Va("date",!1),ee.date.all=!0):n(e.target).hasClass("noFilters")?xo(ti()).forEach(s=>{s==="_id"||s==="name"||s!=="date"&&Va(s,!1)}):n(e.target).is("button")&&(e.shiftKey?(Va(t,!1),ee[t][a]=!0):zD(t,a)),Ro(),qo()});n(".pageAccount .topFilters button.allFilters").on("click",()=>{Mp(),console.log(ti()),xo(ti()).forEach(e=>{e==="_id"||e==="name"||Va(e,!0)}),Va("date",!1),ee.date.all=!0,Ro(),qo()});n(".pageAccount .topFilters button.currentConfigFilter").on("click",()=>{var e,t;if(Mp(),xo(ti()).forEach(a=>{a==="_id"||a==="name"||Va(a,!1)}),ee.pb.no=!0,ee.pb.yes=!0,ee.difficulty[r.difficulty]=!0,ee.mode[r.mode]=!0,r.mode==="time")if([15,30,60,120].includes(r.time)){const a=`${r.time}`;ee.time[a]=!0}else ee.time.custom=!0;else if(r.mode==="words")if([10,25,50,100,200].includes(r.words)){const a=`${r.words}`;ee.words[a]=!0}else ee.words.custom=!0;else r.mode==="quote"&&["short","medium","long","thicc"].forEach((s,i)=>{r.quoteLength.includes(i)?ee.quoteLength[s]=!0:ee.quoteLength[s]=!1});if(r.punctuation?ee.punctuation.on=!0:ee.punctuation.off=!0,r.numbers?ee.numbers.on=!0:ee.numbers.off=!0,r.mode==="quote"&&/english.*/.test(r.language)?ee.language.english=!0:ee.language[r.language]=!0,r.funbox==="none")ee.funbox.none=!0;else for(const a of r.funbox.split("#"))ee.funbox[a]=!0;ee.tags.none=!0,(t=(e=$())==null?void 0:e.tags)==null||t.forEach(a=>{a.active===!0&&(ee.tags.none=!1,ee.tags[a._id]=!0)}),ee.date.all=!0,Ro(),qo()});n(".pageAccount .topFilters button.toggleAdvancedFilters").on("click",()=>{n(".pageAccount .filterButtons").slideToggle(250),n(".pageAccount .topFilters button.toggleAdvancedFilters").toggleClass("active")});function Eu(e,t=0){const a=rr[e];if(a===void 0)return;const s=a.render.content.list,i=s.children.item(t);s.scrollTop=i.offsetTop-s.offsetTop}function Pu(e,t,a){const s=t.some(l=>l.value==="all"),i=a.some(l=>l.value==="all");s?i?t.length<a.length&&(t=t.filter(l=>l.value!=="all")):t=t.filter(l=>l.value==="all"):i&&(t=[]),Va(e,!1);for(const l of t){if(l.value==="all"){Va(e,!0);break}FD(e,l.value,!0)}return Ro(),qo(),_k(),!1}let _k=()=>{};async function RD(e){var l;_k=e;let t;try{t=await Of()}catch(c){console.error(ae(c,"Failed to append language buttons"))}if(t){let c="";c+="<select class='languageSelect' group='language' placeholder='select a language' multiple>",c+="<option value='all'>all</option>";for(const u of t)c+=`<option value="${u}" filter="${u}">${$o(u)}</option>`;c+="</select>";const d=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.languages .select");d&&(d.innerHTML=c,rr.language=new nt({select:d.querySelector(".languageSelect"),settings:{showSearch:!0,placeholderText:"select a language",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(u,m)=>Pu("language",u,m),beforeOpen:()=>{Eu("language")}}}))}let a="";a+="<select class='funboxSelect' group='funbox' placeholder='select a funbox' multiple>",a+="<option value='all'>all</option>",a+="<option value='none'>no funbox</option>";for(const c of yd())a+=`<option value="${c.name}" filter="${c.name}">${c.name.replace(/_/g," ")}</option>`;a+="</select>";const s=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .select");s&&(s.innerHTML=a,rr.funbox=new nt({select:s.querySelector(".funboxSelect"),settings:{showSearch:!0,placeholderText:"select a funbox",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(c,d)=>Pu("funbox",c,d),beforeOpen:()=>{Eu("funbox")}}}));const i=$();if(i!==void 0&&(((l=i.tags)==null?void 0:l.length)??0)>0){n(".pageAccount .content .filterButtons .buttonsAndTitle.tags").removeClass("hidden");let c="";c+="<select class='tagsSelect' group='tags' placeholder='select a tag' multiple>",c+="<option value='all'>all</option>",c+="<option value='none'>no tag</option>";for(const u of i.tags)c+=`<option value="${u._id}" filter="${u.name}">${u.display}</option>`;c+="</select>";const d=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select");d&&(d.innerHTML=c,rr.tags=new nt({select:d.querySelector(".tagsSelect"),settings:{showSearch:!0,placeholderText:"select a tag",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(u,m)=>Pu("tags",u,m),beforeOpen:()=>{Eu("tags")}}}))}else n(".pageAccount .content .filterButtons .buttonsAndTitle.tags").addClass("hidden");Ap()}function OD(){n(".pageAccount .content .filterButtons .buttonsAndTitle.languages .buttons").empty(),n(".pageAccount .content .filterButtons .buttonsAndTitle.funbox .buttons").empty(),n(".pageAccount .content .filterButtons .buttonsAndTitle.tags .buttons").empty()}n(".group.presetFilterButtons .filterBtns").on("click",".filterPresets .delete-filter-preset",e=>{DD(n(e.currentTarget).data("id"))});function _D(e){const t=Ma(e);return Object.entries(Mt).forEach(a=>{const s=a[0],i=a[1];t[s]===void 0&&(t[s]=i)}),t}function HD(e){let t=[];for(let l=1;l<=e.wpm.length;l++)t.push(l.toString());e.wpm=e.wpm.slice(0,e.raw.length),e.err=e.err.slice(0,e.raw.length),t=t.slice(0,e.raw.length);const a=by(e.raw,1);sa.data.labels=t,sa.getDataset("wpm").data=e.wpm,sa.getDataset("raw").data=a,sa.getDataset("error").data=e.err;const s=Math.max(Math.max(...e.wpm),Math.max(...e.raw)),i=Math.min(Math.min(...e.wpm),Math.min(...e.raw));sa.getScale("wpm").max=Math.round(s),sa.getScale("raw").max=Math.round(s),r.startGraphsAtZero?(sa.getScale("wpm").min=0,sa.getScale("raw").min=0):(sa.getScale("wpm").min=Math.round(i),sa.getScale("raw").min=Math.round(i)),sa.updateColors()}function jD(e){HD(e),ND.show()}const ND=new fe({dialogId:"miniResultChartModal"});function GD(e){const t=e?"Profile":"Account",s=e?"":`<div class="buttonGroup"><button
  class="showAllButton"
  data-balloon-pos="left"
  aria-label="Show all personal bests"
>
  <i class="fas fa-ellipsis-v"></i>
</button></div>`;n(`.page${t} .profile .pbsWords`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">10 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">25 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">50 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">100 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${s}
  `),n(`.page${t} .profile .pbsTime`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">15 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">30 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">60 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">120 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${s}
  `)}function Fm(e,t=!1){if(GD(t),e===void 0)return;let a="";const s=t?"Profile":"Account";n(`.page${s} .profile .pbsTime`).html(""),n(`.page${s} .profile .pbsWords`).html("");const i=["15","30","60","120"],l=["10","25","50","100"];i.forEach(d=>{a+=ch(e,"time",d)});const c=t?"":`<div class="buttonGroup"><button
      class="showAllButton"
      data-balloon-pos="left"
      aria-label="Show all personal bests"
    >
      <i class="fas fa-ellipsis-v"></i>
    </button></div>`;n(`.page${s} .profile .pbsTime`).append(a+c),a="",l.forEach(d=>{a+=ch(e,"words",d)}),n(`.page${s} .profile .pbsWords`).append(a+c)}function ch(e,t,a){let s="",i="";const l=`${a} ${t==="time"?"seconds":"words"}`,c=r.typingSpeedUnit;try{const d=(e[t][a]??[]).sort((m,f)=>f.wpm-m.wpm)[0];if(d===void 0)throw new Error("No PB data found");const u=new Date(d.timestamp);d.timestamp!==void 0&&d.timestamp>0&&(i=oe(u,"dd MMM yyyy")),s=`<div class="quick">
      <div class="test">${l}</div>
      <div class="wpm">${N.typingSpeed(d.wpm,{showDecimalPlaces:!1})}</div>
      <div class="acc">${N.accuracy(d.acc,{showDecimalPlaces:!1})}</div>
    </div>
    <div class="fullTest">
      <div>${l}</div>
      <div>${N.typingSpeed(d.wpm,{suffix:` ${c}`})}</div>
      <div>${N.typingSpeed(d.raw,{suffix:" raw"})}</div>
      <div>${N.accuracy(d.acc,{suffix:" acc"})}</div>
      <div>${N.percentage(d.consistency,{suffix:" con"})}</div>
      <div>${i}</div>
    </div>`}catch{s=`<div class="quick">
    <div class="test">${l}</div>
    <div class="wpm">-</div>
    <div class="acc">-</div>
  </div>`}return`
  <div class="group">
  ${s}
  </div>
  `}function Gl(e=0){let t=e*36e5,a=Date.now();return _r(a,t)}function _r(e,t=0){return e-(e-t)%864e5}function UD(e,t=0){let a=t*36e5,s=_r(Date.now()-864e5,a),i=_r(e,a);return s===i}function KD(e,t=0){let a=t*36e5,s=_r(Date.now(),a),i=_r(e,a);return s===i}const Hk={1:{id:1,name:"Developer",description:"I made this",icon:"fa-laptop",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},2:{id:2,name:"Collaborator",description:"I helped make this",icon:"fa-code",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},3:{id:3,name:"Server Mod",description:"Discord server moderator",icon:"fa-hammer",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},4:{id:4,name:"OG Account",description:"First 1000 users on the site",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},5:{id:5,name:"OG Discordian",description:"First 1000 Discord server members",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},6:{id:6,name:"Supporter",description:"Donated money",icon:"fa-heart",color:"var(--text-color)",background:"var(--sub-color)"},7:{id:7,name:"Sugar Daddy",description:"Donated a lot of money",icon:"fa-gem",color:"var(--bg-color)",background:"var(--main-color)"},8:{id:8,name:"Monkey Supporter",description:"Donated more money",icon:"fa-heart",color:"var(--bg-color)",background:"var(--main-color)"},9:{id:9,name:"White Hat",description:"Reported critical vulnerabilities on the site",icon:"fa-user-secret",color:"var(--bg-color)",background:"var(--main-color)"},10:{id:10,name:"Bug Hunter",description:"Reported or helped track down bugs on the site",icon:"fa-bug",color:"var(--text-color)",background:"var(--sub-color)"},11:{id:11,name:"Content Creator",description:"Verified content creator",icon:"fa-video",color:"var(--text-color)",background:"var(--sub-color)"},12:{id:12,name:"Contributor",description:"Contributed to the site",icon:"fa-hands-helping",color:"var(--text-color)",background:"var(--sub-color)"},13:{id:13,name:"Mythical",description:"Yes, I'm actually this fast",icon:"fa-rocket",color:"white",customStyle:"animation: rgb-bg 10s linear infinite;"},14:{id:14,name:"All Year Long",description:"Reached a streak of 365 days",icon:"fa-fire",color:"var(--bg-color)",background:"var(--main-color)"}};function Hr(e,t=!1,a=!1,s=!1){const i=Hk[e];if(!i&&!s)return"";let l="";(i==null?void 0:i.background)!==void 0&&(l+=`background: ${i.background};`),(i==null?void 0:i.color)!==void 0&&(l+=`color: ${i.color};`),(i==null?void 0:i.customStyle)!==void 0&&(l+=i.customStyle);const c=(i==null?void 0:i.name)??"Badge Name Missing",d=(i==null?void 0:i.description)??"Badge Description Missing",u=(t?c+": ":"")+d;let m="";a||(m=`aria-label="${u}" data-balloon-pos="right"`);let f="";(i==null?void 0:i.icon)!==void 0?f=`<i class="fas ${t?"fa-fw":""} ${i.icon}"></i>`:f='<i class="fas fa-question"></i>';const p=`<div class="text">${c}</div>`;return`<div class="badge" ${m} style="${l}">${f}${t?"":p}</div>`}function VD(e){return Hk[e]}async function Uc(e,t){var k,M,q,W,x,L,D,K,J,ke,Je,Jt,uu,dn,bi,vi,wi,Tl,ki,bs,ao,$l,un,Ci,Si,xi,S,Oe,$e,ea,vs,oo,we;const a=e.charAt(0).toUpperCase()+e.slice(1),s=n(`.page${a} .profile`),i=n(`.page${a} .profile .details`);s.attr("uid",t.uid??""),s.attr("name",t.name??"");const l=t.banned===!0;if(i===void 0||t===void 0||t.name===void 0||t.addedAt===void 0)return;if(i.find(".placeholderAvatar").removeClass("hidden"),t.discordAvatar!==void 0&&t.discordId!==void 0&&!l?Jm(t.discordId,t.discordAvatar,256).then(ge=>{ge!==null&&(i.find(".placeholderAvatar").addClass("hidden"),i.find(".avatar").css("background-image",`url(${ge})`))}):i.find(".avatar").removeAttr("style"),(k=t.inventory)!=null&&k.badges&&!l){let ge="",Me="";for(const _e of t.inventory.badges)_e.selected===!0?ge=Hr(_e.id):Me+=Hr(_e.id,!0);i.find(".badges").empty().append(ge),i.find(".allBadges").empty().append(Me)}i.find(".name").text(t.name),i.find(".userFlags").html(el(t)),t.lbOptOut===!0&&(e==="profile"?s.find(".lbOptOutReminder").removeClass("hidden").text("Note: This account has opted out of the leaderboards, meaning their results aren't verified by the anticheat system and may not be legitimate."):s.find(".lbOptOutReminder").addClass("hidden")),setTimeout(()=>{Pp(e)},10);const c="Joined "+oe(t.addedAt??0,"dd MMM yyyy"),d=new Date(t.addedAt),u=Tn(new Date,d),m=`${u} day${u!==1?"s":""} ago`;i.find(".joined").text(c).attr("aria-label",m);let f="";if(t.streak&&(t==null?void 0:t.streak)>1?(i.find(".streak").text(`Current streak: ${t.streak} ${t.streak===1?"day":"days"}`),f=`Longest streak: ${t.maxStreak} ${t.maxStreak===1?"day":"days"}`):(i.find(".streak").text(""),f=""),e==="account"){const ge=(M=$())==null?void 0:M.results,Me=ge==null?void 0:ge[0],_e=t.streakHourOffset,yt=1e3*60*60*24;let et=Gl(_e)+yt;et<Date.now()&&(et+=yt);const It=Cy(et);if(console.debug("Streak hour offset"),console.debug("date.now()",Date.now(),new Date(Date.now())),console.debug("dayInMilis",yt),console.debug("difTarget",new Date(Gl(_e)+yt)),console.debug("timeDif",It),console.debug("DateTime.getCurrentDayTimestamp()",Gl(),new Date(Gl())),console.debug("profile.streakHourOffset",_e),Me!==void 0){const ws=KD(Me.timestamp,_e),ks=UD(Me.timestamp,_e);console.debug("lastResult.timestamp",Me.timestamp,new Date(Me.timestamp)),console.debug("isToday",ws),console.debug("isYesterday",ks);const st=_e?`(${_e>0?"+":""}${_e} offset)`:"";ws?(f+=`
Claimed today: yes`,f+=`
Come back in: ${It} ${st}`):ks?(f+=`
Claimed today: no`,f+=`
Streak lost in: ${It} ${st}`):(f+=`
Streak lost ${It} ${st} ago`,f+=`
It will be removed from your profile on the next result save`),console.debug(f),_e===void 0&&(f+=`

If the streak reset time doesn't line up with your timezone, you can change it in Account Settings > Account > Set streak hour offset.`)}}i.find(".streak").attr("aria-label",f).attr("data-balloon-break","");let p="",h="";t.typingStats.completedTests!==void 0&&t.typingStats.startedTests!==void 0&&(p=Math.floor(t.typingStats.completedTests/t.typingStats.startedTests*100).toString(),h=((t.typingStats.startedTests-t.typingStats.completedTests)/t.typingStats.completedTests).toFixed(1));const y=i.find(".typingStats");y.find(".started .value").text(((q=t.typingStats)==null?void 0:q.startedTests)??0),y.find(".completed .value").text(((W=t.typingStats)==null?void 0:W.completedTests)??0).attr("data-balloon-pos","up").attr("aria-label",`${p}% (${h} restarts per completed test)`),y.find(".timeTyping .value").text(rt(Math.round(((x=t.typingStats)==null?void 0:x.timeTyping)??0),!0,!0));let b=!1,v=!1,C=!1;if(!l&&(b=!!(((L=t.details)==null?void 0:L.bio)??""),i.find(".bio .value").text(((D=t.details)==null?void 0:D.bio)??""),v=!!(((K=t.details)==null?void 0:K.keyboard)??""),i.find(".keyboard .value").text(((J=t.details)==null?void 0:J.keyboard)??""),((Je=(ke=t.details)==null?void 0:ke.socialProfiles)==null?void 0:Je.github)!==void 0&&((uu=(Jt=t.details)==null?void 0:Jt.socialProfiles)==null?void 0:uu.github)!==""||((bi=(dn=t.details)==null?void 0:dn.socialProfiles)==null?void 0:bi.twitter)!==void 0&&((wi=(vi=t.details)==null?void 0:vi.socialProfiles)==null?void 0:wi.twitter)!==""||((ki=(Tl=t.details)==null?void 0:Tl.socialProfiles)==null?void 0:ki.website)!==void 0&&((ao=(bs=t.details)==null?void 0:bs.socialProfiles)==null?void 0:ao.website)!=="")){C=!0;const ge=i.find(".socials .value");ge.empty();const Me=(($l=t.details)==null?void 0:$l.socialProfiles.github)??"";Me&&ge.append(`<a href='https://github.com/${Gt(Me)}/' target="_blank" rel="nofollow me" aria-label="${Gt(Me)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-github"></i></a>`);const _e=((un=t.details)==null?void 0:un.socialProfiles.twitter)??"";_e&&ge.append(`<a href='https://x.com/${Gt(_e)}' target="_blank" rel="nofollow me" aria-label="${Gt(_e)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-twitter"></i></a>`);const yt=((Ci=t.details)==null?void 0:Ci.socialProfiles.website)??"",et=/^https?:\/\/(?:www\.)?([^/]+)/,It=((Si=yt==null?void 0:yt.match(et))==null?void 0:Si[1])??yt;yt&&ge.append(`<a href='${Gt(yt)}' target="_blank" rel="nofollow me" aria-label="${Gt(It??"")}" data-balloon-pos="up" class="textButton"><i class="fas fa-fw fa-globe"></i></a>`)}if(jk(t.xp??0),l)s.find(".leaderboardsPositions").addClass("hidden");else{s.find(".leaderboardsPositions").removeClass("hidden");const ge=((Oe=(S=(xi=t.allTimeLbs)==null?void 0:xi.time)==null?void 0:S["15"])==null?void 0:Oe.english)??null,Me=((vs=(ea=($e=t.allTimeLbs)==null?void 0:$e.time)==null?void 0:ea["60"])==null?void 0:vs.english)??null;ge===null&&Me===null?s.find(".leaderboardsPositions").addClass("hidden"):(ge!==null&&(s.find(".leaderboardsPositions .group.t15 .pos").text(N.rank(ge==null?void 0:ge.rank)),s.find(".leaderboardsPositions .group.t15 .topPercentage").text(dh(ge))),Me!==null&&(s.find(".leaderboardsPositions .group.t60 .pos").text(N.rank(Me==null?void 0:Me.rank)),s.find(".leaderboardsPositions .group.t60 .topPercentage").text(dh(Me))))}t.uid===((we=(oo=xe)==null?void 0:oo.currentUser)==null?void 0:we.uid)?s.find(".userReportButton").addClass("hidden"):s.find(".userReportButton").removeClass("hidden");const E=b||v;b?i.find(".bio").removeClass("hidden"):i.find(".bio").addClass("hidden"),v?i.find(".keyboard").removeClass("hidden"):i.find(".keyboard").addClass("hidden"),E?(i.find(".bioAndKeyboard").removeClass("hidden"),i.find(".sep2").removeClass("hidden")):(i.find(".bioAndKeyboard").addClass("hidden"),i.find(".sep2").addClass("hidden")),C?(i.find(".socials").removeClass("hidden"),i.find(".sep3").removeClass("hidden")):(i.find(".socials").addClass("hidden"),i.find(".sep3").addClass("hidden")),i.removeClass("none"),i.removeClass("bioAndKey"),i.removeClass("soc"),i.removeClass("both"),!C&&!E?i.addClass("none"):C&&!E?i.addClass("soc"):!C&&E?i.addClass("bioAndKey"):C&&E&&i.addClass("both")}function jk(e){const t=n(" .profile .details .levelAndBar");if(t==null)return;const a=hr(e),s=a.levelMaxXp,i=a.levelCurrentXp;t.find(".level").text(a.level).attr("aria-label",`${Ul(e)} total xp`),t.find(".xp").text(`${Ul(i)}/${Ul(s)}`).attr("aria-label",`${Ul(s-i)} xp until next level`),t.find(".xpBar .bar").css("width",`${i/s*100}%`),t.find(".xpBar").attr("aria-label",`${(i/s*100).toFixed(2)}%`)}function Pp(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;let a;if(e==="account"?a=n(".pageAccount .profile .details"):e==="profile"&&(a=n(".pageProfile .profile .details")),!a)return;const s=a.find(".user"),i=s.parent()[0],l=s[0],c=Kn(2);if(!l||!i)return;l.style.fontSize="10px";const d=i.clientWidth,u=l.clientWidth,f=d/u*10,p=Math.min(Math.max(f,10),c);l.style.fontSize=`${p}px`}const QD=ky(1e3,()=>{const e=ce();e&&["account","profile"].includes(e)&&Pp(e)});n(window).on("resize",()=>{QD()});function dh(e){return e.rank===void 0?"-":e.rank===1?"GOAT":"Top "+Q(e.rank/e.count*100)+"%"}function Ul(e){return e<1e3?Math.round(e).toString():vc(e)}let Nk;function Yd(){return Nk}async function ZD(){const e=await F.configuration.get();if(e.status!==200){console.error("Could not fetch configuration",e.body.message);return}else Nk=e.body.data??void 0}function Wm(){n(".pageAccount .resultBatches").addClass("hidden")}function YD(){n(".pageAccount .resultBatches").removeClass("hidden")}async function XD(){var f,p,h,y,b;const e=(f=$())==null?void 0:f.results;if(e===void 0){console.error("(Result batches) Results are missing but they should be available at the time of drawing the account page?"),Wm();return}JD();const t=((h=(p=$())==null?void 0:p.typingStats)==null?void 0:h.completedTests)??0,a=Math.round(e.length/t*100),s=((y=Yd())==null?void 0:y.results.limits)??{regularUser:0,premiumUser:0},i=(b=$())!=null&&b.isPremium?s.premiumUser:s.regularUser,l=Math.round((e==null?void 0:e.length)/i*100),c=n(".pageAccount .resultBatches .bars"),d={downloaded:{fill:c.find(".downloaded .fill"),rightText:c.find(".downloaded.rightText")},limit:{fill:c.find(".limit .fill"),rightText:c.find(".limit.rightText")}};d.downloaded.fill.css("width",Math.min(a,100)+"%"),d.downloaded.rightText.text(`${e==null?void 0:e.length} / ${t} (${a}%)`);const u=await fs();d.limit.fill.css({width:Math.min(l,100)+"%",background:wa(u.sub,u.error,yc(l,50,100,0,1))}),d.limit.rightText.text(`${e==null?void 0:e.length} / ${i} (${l}%)`),n(".pageAccount .resultBatches > .text").text(""),e.length>=t&&(zm(),uh("all results loaded")),e.length>=i&&(zm(),uh("limit reached"))}function zm(){n(".pageAccount .resultBatches button").prop("disabled",!0)}function JD(){n(".pageAccount .resultBatches button").prop("disabled",!1)}function uh(e){n(".pageAccount .resultBatches button").text(e)}function eF(){var s,i,l,c;if(!(((s=$())==null?void 0:s.isPremium)??!1)){Wm();return}const t=((l=(i=$())==null?void 0:i.typingStats)==null?void 0:l.completedTests)??0,a=((c=Yd())==null?void 0:c.results.maxBatchSize)??0;if(t<=a){Wm();return}YD()}let Bt;function tF(e,t){if(e===void 0){n("#testActivity").addClass("hidden");return}n("#testActivity").removeClass("hidden"),Bt=Kk(),Uk("current",(t==null?void 0:t.getFullYear())||2022),oF(e.firstDayOfWeek),Gk(e)}function Gk(e){const t=document.querySelector("#testActivity .activity");if(t===null)return;if(t.innerHTML="",e===void 0){mh([]),n("#testActivity .nodata").removeClass("hidden");return}mh(e.getMonths()),n("#testActivity .nodata").addClass("hidden");const a=document.querySelector("#testActivity .title");a!==null&&(a.innerHTML=e.getTotalTests()+" tests");for(const s of e.getDays()){const i=document.createElement("div");i.setAttribute("data-level",s.level),s.label!==void 0&&(i.setAttribute("aria-label",s.label),i.setAttribute("data-balloon-pos","up")),t.appendChild(i)}}function Uk(e,t){var l,c;const a=new Date().getFullYear(),s=[{text:"last 12 months",value:"current",selected:e==="current"}];for(let d=a;d>=t;d--)(s.length<2||(l=Yd())!=null&&l.users.premium.enabled&&((c=$())!=null&&c.isPremium))&&s.push({text:d.toString(),value:d.toString(),selected:d===e});const i=Kk();i.setData(s),s.length>1?i.enable():i.disable()}function mh(e){const t=document.querySelector("#testActivity .months");t.innerHTML=e.map(a=>`<div style="grid-column: span ${a.weeks}">${a.text}</div>`).join("")}function Kk(){return Bt!==void 0||(Bt=new nt({select:"#testActivity .yearSelect",settings:{showSearch:!1},events:{afterChange:async e=>{var s;Bt==null||Bt.disable();const t=(s=e[0])==null?void 0:s.value,a=await NA(t);Gk(a),((Bt==null?void 0:Bt.getData())??[]).length>1&&(Bt==null||Bt.enable())}}})),Bt}const aF=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function oF(e){const t=[];for(let s=0;s<7;s++)t.push(s%2!==e%2?aF[(e+s)%7]:void 0);const a=s=>{const i=s!==void 0?l=>l.substring(0,s):l=>l;return t.map(l=>l!==void 0?`<div><div class="text">${i(l)}</div></div>`:"<div></div>").join("")};n("#testActivity .daysFull").html(a()),n("#testActivity .days").html(a(3))}let bt=!1;function sF(){bt=!bt,bt&&console.log("filterDebug is on")}let De=[],Ls=0;function Xd(e){var a;if(De===void 0||De.length===0)return;let t;e&&e>Ls?t=Math.ceil(e/10)*10:t=Ls+10;for(let s=Ls;s<t;s++){const i=De[s];if(!i)continue;let l=i.difficulty;l===void 0&&(l="normal");let c=`<span aria-label="${(a=i.language)==null?void 0:a.replace("_"," ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;l==="normal"?c+=`<span aria-label="${i.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`:l==="expert"?c+=`<span aria-label="${i.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`:l==="master"&&(c+=`<span aria-label="${i.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`),i.punctuation&&(c+='<span aria-label="punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i></span>'),i.numbers&&(c+='<span aria-label="numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i></span>'),i.blindMode&&(c+='<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>'),i.lazyMode&&(c+='<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>'),i.funbox!=="none"&&i.funbox!==void 0&&(c+=`<span aria-label="${i.funbox.replace(/_/g," ").replace(/#/g,", ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`),i.chartData==="toolong"||i.testDuration>122?c+='<span class="miniResultChartButton disabled" aria-label="Graph history is not available for long tests" data-balloon-pos="up"><i class="fas fa-fw fa-chart-line"></i></span>':c+=`<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up" filteredResultsId="${s}"><i class="fas fa-fw fa-chart-line"></i></span>`;let d="no tags";i.tags!==void 0&&i.tags.length>0&&(d="",i.tags.forEach(C=>{var E,k;(k=(E=$())==null?void 0:E.tags)==null||k.forEach(M=>{C===M._id&&(d+=M.display+", ")})}),d=d.substring(0,d.length-2));let u;i.tags===void 0?u="[]":u=JSON.stringify(i.tags);const m=i.tags!==void 0&&i.tags.length>0,f=i.tags!==void 0&&i.tags.length>1?"fa-tags":"fa-tag",p=`<button class="textButton resultEditTagsButton ${m?"active":""}" data-result-id="${i._id}" data-tags='${u}' aria-label="${d}" data-balloon-pos="up"><i class="fas fa-fw ${f}"></i></button>`;let h="";i.isPb?h='<i class="fas fa-fw fa-crown"></i>':h="";const y=i.charStats.join("/"),b=i.mode==="custom"?"":i.mode2,v=new Date(i.timestamp);n(".pageAccount .history table tbody").append(`
    <tr class="resultRow" id="result-${s}">
    <td>${h}</td>
    <td>${N.typingSpeed(i.wpm,{showDecimalPlaces:!0})}</td>
    <td>${N.typingSpeed(i.rawWpm,{showDecimalPlaces:!0})}</td>
    <td>${N.percentage(i.acc,{showDecimalPlaces:!0})}</td>
    <td>${N.percentage(i.consistency,{showDecimalPlaces:!0})}</td>
    <td>${y}</td>
    <td>${i.mode} ${b}</td>
    <td class="infoIcons">${c}</td>
    <td>${p}</td>
    <td>${oe(v,"dd MMM yyyy")}<br>
    ${oe(v,"HH:mm")}
    </td>
    </tr>`)}Ls=t,Ls>=De.length?n(".pageAccount .loadMoreButton").addClass("hidden"):n(".pageAccount .loadMoreButton").removeClass("hidden")}async function nF(){await U.updateColors(),await Ee(0),await Yo.updateColors(),await Ee(0),await On.updateColors(),await Ee(0)}function iF(){n(".pageAccount .history table tbody").empty(),On.getDataset("count").data=[],Yo.getDataset("count").data=[],Yo.getDataset("avgWpm").data=[],U.getDataset("wpm").data=[],U.getDataset("pb").data=[],U.getDataset("acc").data=[],U.getDataset("wpmAvgTen").data=[],U.getDataset("accAvgTen").data=[],U.getDataset("wpmAvgHundred").data=[],U.getDataset("accAvgHundred").data=[]}let Kl=0,qt=[],bn=[];async function Vk(){var Ci,Si,xi;kc("Displaying stats..."),Ha(100),console.log("updating account page"),tl();const e=$();if(!e)return;Fm(e.personalBests),Uc("account",e),tF(e.testActivity,new Date(e.addedAt)),XD(),qt=[],bn=[];const t=[];Ls=0;let a=0,s="",i=0,l=0,c=0,d=0,u=0,m=0,f=0,p=0;const h={total:0,count:0,last10Total:0,last10Count:0,max:0};let y=0;Kl=0;let b=0,v=0,C=0,E=0;const k={},M=[],q=pt(r.typingSpeedUnit);De=[],n(".pageAccount .history table tbody").empty(),(Si=(Ci=$())==null?void 0:Ci.results)==null||Si.forEach(S=>{var ge,Me,_e,yt;try{if(!Ue("pb",S.isPb?"yes":"no")){bt&&console.log("skipping result due to pb filter",S);return}let et=S.difficulty;if(et===void 0&&(et="normal"),!Ue("difficulty",et)){bt&&console.log("skipping result due to difficulty filter",S);return}if(!Ue("mode",S.mode)){bt&&console.log("skipping result due to mode filter",S);return}if(S.mode==="time"){let Ve="custom";if(["15","30","60","120"].includes(`${S.mode2}`)&&(Ve=`${S.mode2}`),!Ue("time",Ve)){bt&&console.log("skipping result due to time filter",S);return}}else if(S.mode==="words"){let Ve="custom";if(["10","25","50","100","200"].includes(`${S.mode2}`)&&(Ve=`${S.mode2}`),!Ue("words",Ve)){bt&&console.log("skipping result due to word filter",S);return}}if(S.quoteLength!==null){let Ve;if(S.quoteLength===0?Ve="short":S.quoteLength===1?Ve="medium":S.quoteLength===2?Ve="long":S.quoteLength===3&&(Ve="thicc"),Ve!==void 0&&!Ue("quoteLength",Ve)){bt&&console.log("skipping result due to quoteLength filter",S);return}}let It=Ue("language",S.language??"english");if(S.language==="english_expanded"&&Ue("language","english_1k")&&(It=!0),!It){bt&&console.log("skipping result due to language filter",S);return}let ws="off";if(S.punctuation&&(ws="on"),!Ue("punctuation",ws)){bt&&console.log("skipping result due to punctuation filter",S);return}let ks="off";if(S.numbers&&(ks="on"),!Ue("numbers",ks)){bt&&console.log("skipping result due to numbers filter",S);return}if(S.funbox==="none"||S.funbox===void 0){if(!Ue("funbox","none")){bt&&console.log("skipping result due to funbox filter",S);return}}else{let Ve=0;for(const mn of S.funbox.split("#"))if(Ue("funbox",mn)){Ve++;break}if(Ve===0){bt&&console.log("skipping result due to funbox filter",S);return}}let st=!0;if(S.tags===void 0||S.tags.length===0)(((Me=(ge=$())==null?void 0:ge.tags)==null?void 0:Me.length)??0)>0?Ue("tags","none")&&(st=!1):st=!1;else{const Ve=(yt=(_e=$())==null?void 0:_e.tags)==null?void 0:yt.map(mn=>mn._id);if(Ve===void 0)return;S.tags.forEach(mn=>{st&&(Ve!=null&&Ve.includes(mn)?Ue("tags",mn)&&(st=!1):Ue("tags","none")&&(st=!1))})}if(st){bt&&console.log("skipping result due to tag filter",S);return}const ta=Math.abs(S.timestamp-Date.now())/1e3;let Xp=!0;if((Ue("date","all")||Ue("date","last_day")&&ta<=86400||Ue("date","last_week")&&ta<=604800||Ue("date","last_month")&&ta<=2592e3||Ue("date","last_3months")&&ta<=7776e3)&&(Xp=!1),Xp){bt&&console.log("skipping result due to date filter",S);return}De.push(S)}catch(et){g("Something went wrong when filtering. Resetting filters.",0),console.log(S),console.error(et),Ep(),Ro(),ai();return}y+=Math.round(S.wpm/60*S.testDuration);const Oe=new Date(S.timestamp);Oe.setSeconds(0),Oe.setMinutes(0),Oe.setHours(0),Oe.setMilliseconds(0);const $e=Oe.getTime(),ea=k[$e];ea!==void 0?(ea.amount++,ea.time+=S.testDuration+(S.incompleteTestSeconds??0)-(S.afkDuration??0),ea.totalWpm+=S.wpm,ea.totalAcc+=S.acc,ea.totalCon+=S.consistency??0):k[$e]={amount:1,time:S.testDuration+(S.incompleteTestSeconds??0)-(S.afkDuration??0),totalWpm:S.wpm,totalAcc:S.acc,totalCon:S.consistency??0};const vs=q.histogramDataBucketSize,oo=Math.floor(Math.round(q.fromWpm(S.wpm))/vs);if(M.length<=oo)for(let et=M.length;et<=oo;et++)M.push(0);M[oo]++;let we=0;if(S.testDuration===void 0&&S.mode2!=="custom"&&S.mode2!=="zen"?S.mode==="time"?we=parseInt(S.mode2):S.mode==="words"&&(we=parseInt(S.mode2)/S.wpm*60):we=parseFloat(S.testDuration),S.incompleteTestSeconds!==void 0?we+=S.incompleteTestSeconds:S.restartCount!==void 0&&S.restartCount>0&&(we+=we/4*S.restartCount),Kl+=we,d<10&&(d++,u+=S.wpm,p+=S.acc,S.consistency!==void 0&&(C+=S.consistency)),c++,S.consistency!==void 0&&(E++,v+=S.consistency,S.consistency>b&&(b=S.consistency)),S.rawWpm!==null&&(h.last10Count<10&&(h.last10Count++,h.last10Total+=S.rawWpm),h.total+=S.rawWpm,h.count++,S.rawWpm>h.max&&(h.max=S.rawWpm)),S.acc>m&&(m=S.acc),f+=S.acc,S.restartCount!==void 0&&(i+=S.restartCount),qt.push({x:De.length,y:Q(q.fromWpm(S.wpm)),wpm:Q(q.fromWpm(S.wpm)),acc:S.acc,mode:S.mode,mode2:S.mode2,punctuation:S.punctuation,language:S.language,timestamp:S.timestamp,difficulty:S.difficulty,raw:Q(q.fromWpm(S.rawWpm)),isPb:S.isPb??!1}),t.push(S.wpm),bn.push({x:De.length,y:S.acc,errorRate:100-S.acc}),S.wpm>a)if(a=S.wpm,S.mode==="custom")s=S.mode;else{const et=S.punctuation?",<br>with punctuation":"",It=S.numbers?",<br>with numbers":"";s=S.mode+" "+S.mode2+et+It}l+=S.wpm}),n(".pageAccount .group.history table thead tr td:nth-child(2)").text(r.typingSpeedUnit),await Ee(0),Xd();const W=[],x=[],L=q.historyStepSize;for(const S of Object.keys(k)){const Oe=parseInt(S),$e=k[Oe];$e!==void 0&&(W.push({x:Oe,y:$e.time/60,amount:$e.amount,avgWpm:Q($e.totalWpm/$e.amount),avgAcc:Q($e.totalAcc/$e.amount),avgCon:Q($e.totalCon/$e.amount)}),x.push({x:Oe,y:Q(q.fromWpm($e.totalWpm)/$e.amount)}))}const K=Yo.options.scales.avgWpm;K.title.text="Average "+r.typingSpeedUnit,K.ticks.stepSize=L,Yo.getDataset("count").data=W,Yo.getDataset("avgWpm").data=x;const J=[],ke=[],Je=q.histogramDataBucketSize,Jt=Je-(Je<=1?.01:1);M.forEach((S,Oe)=>{const $e=Oe*Je;ke.push(`${$e} - ${$e+Jt}`),J.push({x:$e,y:S})}),On.data.labels=ke,On.getDataset("count").data=J;const dn=U.options.scales.wpm;if(dn.title.text=q.fullUnitString,qt.length>0){let S=0;const Oe=[];for(let we=qt.length-1;we>=0;we--){const ge=qt[we];ge.y>S&&(S=ge.y,Oe.push(ge))}Oe.push({x:1,y:(xi=Hs(Oe))==null?void 0:xi.y});const $e=[],ea=[],vs=[],oo=[];for(let we=0;we<qt.length;we++){const ge=qt.slice(we,we+10),Me=bn.slice(we,we+10),_e=ge.reduce((st,{y:ta})=>st+ta,0)/ge.length,yt=Me.reduce((st,{y:ta})=>st+ta,0)/Me.length;$e.push({x:we+1,y:_e}),ea.push({x:we+1,y:yt});const et=qt.slice(we,we+100),It=bn.slice(we,we+100),ws=et.reduce((st,{y:ta})=>st+ta,0)/et.length,ks=It.reduce((st,{y:ta})=>st+ta,0)/It.length;vs.push({x:we+1,y:ws}),oo.push({x:we+1,y:ks})}U.getDataset("wpm").data=qt,U.getDataset("pb").data=Oe,U.getDataset("acc").data=bn,U.getDataset("wpmAvgTen").data=$e,U.getDataset("accAvgTen").data=ea,U.getDataset("wpmAvgHundred").data=vs,U.getDataset("accAvgHundred").data=oo,U.getScale("x").max=qt.length+1}const bi=qt.map(S=>S.y),vi=Math.min(...bi),wi=Math.max(...bi),Tl=isFinite(vi)?vi:0,ki=isFinite(wi)?wi:0,bs=Math.floor(ki)+(L-Math.floor(ki)%L);if(dn.max=bs,dn.ticks.stepSize=L,U.getScale("pb").max=bs,U.getScale("wpmAvgTen").max=bs,U.getScale("wpmAvgHundred").max=bs,r.startGraphsAtZero)U.getScale("wpm").min=0,U.getScale("pb").min=0,U.getScale("wpmAvgTen").min=0,U.getScale("wpmAvgHundred").min=0;else{const S=Math.floor(Tl/L)*L;U.getScale("wpm").min=S,U.getScale("pb").min=S,U.getScale("wpmAvgTen").min=S,U.getScale("wpmAvgHundred").min=S}qt===void 0||qt.length===0?(n(".pageAccount .group.noDataError").removeClass("hidden"),n(".pageAccount .group.chart").addClass("hidden"),n(".pageAccount .group.dailyActivityChart").addClass("hidden"),n(".pageAccount .group.histogramChart").addClass("hidden"),n(".pageAccount .group.aboveHistory").addClass("hidden"),n(".pageAccount .group.history").addClass("hidden"),n(".pageAccount .triplegroup.stats").addClass("hidden"),n(".pageAccount .group.estimatedWordsTyped").addClass("hidden")):(n(".pageAccount .group.noDataError").addClass("hidden"),n(".pageAccount .group.chart").removeClass("hidden"),n(".pageAccount .group.dailyActivityChart").removeClass("hidden"),n(".pageAccount .group.histogramChart").removeClass("hidden"),n(".pageAccount .group.aboveHistory").removeClass("hidden"),n(".pageAccount .group.history").removeClass("hidden"),n(".pageAccount .triplegroup.stats").removeClass("hidden"),n(".pageAccount .group.estimatedWordsTyped").removeClass("hidden")),n(".pageAccount .timeTotalFiltered .val").text(rt(Math.round(Kl),!0,!0));const ao=r.typingSpeedUnit;n(".pageAccount .highestWpm .title").text(`highest ${ao}`),n(".pageAccount .highestWpm .val").text(N.typingSpeed(a)),n(".pageAccount .averageWpm .title").text(`average ${ao}`),n(".pageAccount .averageWpm .val").text(N.typingSpeed(l/c)),n(".pageAccount .averageWpm10 .title").text(`average ${ao} (last 10 tests)`),n(".pageAccount .averageWpm10 .val").text(N.typingSpeed(u/d)),n(".pageAccount .highestRaw .title").text(`highest raw ${ao}`),n(".pageAccount .highestRaw .val").text(N.typingSpeed(h.max)),n(".pageAccount .averageRaw .title").text(`average raw ${ao}`),n(".pageAccount .averageRaw .val").text(N.typingSpeed(h.total/h.count)),n(".pageAccount .averageRaw10 .title").text(`average raw ${ao} (last 10 tests)`),n(".pageAccount .averageRaw10 .val").text(N.typingSpeed(h.last10Total/h.last10Count)),n(".pageAccount .highestWpm .mode").html(s),n(".pageAccount .testsTaken .val").text(c),n(".pageAccount .highestAcc .val").text(N.accuracy(m)),n(".pageAccount .avgAcc .val").text(N.accuracy(f/c)),n(".pageAccount .avgAcc10 .val").text(N.accuracy(p/d)),v===0||v===void 0?(n(".pageAccount .avgCons .val").text("-"),n(".pageAccount .avgCons10 .val").text("-")):(n(".pageAccount .highestCons .val").text(N.percentage(b)),n(".pageAccount .avgCons .val").text(N.percentage(v/E)),n(".pageAccount .avgCons10 .val").text(N.percentage(C/Math.min(d,E)))),n(".pageAccount .testsStarted .val").text(`${c+i}`),n(".pageAccount .testsCompleted .val").text(`${c}(${Math.floor(c/(c+i)*100)}%)`),n(".pageAccount .testsCompleted .avgres").text(`
    ${(i/c).toFixed(1)} restarts per completed test
  `);const $l=De.map(S=>S.wpm).reverse(),un=ex($l);if(un){const Oe=(un[1][1]-un[0][1])*(3600/Kl),$e=Oe>0?"+":"";n(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${$e+N.typingSpeed(Oe,{showDecimalPlaces:!0})} ${r.typingSpeedUnit}`)}n(".pageAccount .estimatedWordsTyped .val").text(y),(qt.length||bn.length)&&(TP(),U.options.animation=!1,U.update(),delete U.options.animation),await Ee(0),Yo.update(),On.update(),Ha(100,!0),gs(!1),Ja(n(".pageAccount .preloader"),n(".pageAccount .content"),250,async()=>{n(".page.pageAccount").css("height","unset")},async()=>{setTimeout(()=>{Pp("account")},10)})}async function Ip(e){const t=await vf(e);if(!t&&!Xe()){g("Could not get results - you are offline",-1,{duration:5});return}lI(),t&&Ro()}async function ai(){if(Ha(0,!0),$()===null)g("Missing account data. Please refresh.",-1),n(".pageAccount .preloader").html("Missing account data. Please refresh.");else{Ha(90),await Ip();try{await Ee(0),await Vk()}catch(e){console.error(e),g(`Something went wrong: ${e}`,-1)}}}function rF(e,t){var i,l;const a=[];if(t.length>0)for(const c of t)(l=(i=$())==null?void 0:i.tags)==null||l.forEach(d=>{c===d._id&&a.push(d.display)});const s=n(`.pageAccount .resultEditTagsButton[data-result-id='${e}']`);s.attr("data-tags",JSON.stringify(t)),t.length>0?(s.attr("aria-label",a.join(", ")),s.addClass("active"),t.length>1?s.html('<i class="fas fa-fw fa-tags"></i>'):s.html('<i class="fas fa-fw fa-tag"></i>')):(s.attr("aria-label","no tags"),s.removeClass("active"),s.html('<i class="fas fa-fw fa-tag"></i>'))}function ys(e,t,a=null){var d,u;if(n("td").removeClass("headerSorted"),n("td").children("i").remove(),n(t).addClass("headerSorted"),De.length<2)return;const s=e;let i=!0;a!==null?a?n(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>'):(i=!1,n(t).append('<i class="fas fa-sort-up" aria-hidden="true"></i>')):parseInt((d=De==null?void 0:De[0])==null?void 0:d[s])<=parseInt((u=De==null?void 0:De[De.length-1])==null?void 0:u[s])?(i=!0,n(t).append('<i class="fas fa-sort-down" aria-hidden="true"></i>')):(i=!1,n(t).append('<i class="fas fa-sort-up", aria-hidden="true"></i>'));const l=[],c=[];for(;l.length<De.length;){let m=Number.MAX_VALUE,f=-1,p=-1;for(const[h,y]of De.entries())i?y[s]>=f&&!c.includes(h)&&(f=y[s],p=h):y[s]<=m&&!c.includes(h)&&(m=y[s],p=h);l.push(De[p]),c.push(p)}De=l,n(".pageAccount .history table tbody").empty(),Ls=0,Xd()}n(".pageAccount button.toggleResultsOnChart").on("click",()=>{const e=r.accountChart;e[0]=e[0]==="on"?"off":"on",ol(e)});n(".pageAccount button.toggleAccuracyOnChart").on("click",()=>{const e=r.accountChart;e[1]=e[1]==="on"?"off":"on",ol(e)});n(".pageAccount button.toggleAverage10OnChart").on("click",()=>{const e=r.accountChart;e[2]=e[2]==="on"?"off":"on",ol(e)});n(".pageAccount button.toggleAverage100OnChart").on("click",()=>{const e=r.accountChart;e[3]=e[3]==="on"?"off":"on",ol(e)});n(".pageAccount .loadMoreButton").on("click",()=>{Xd()});n(".pageAccount #accountHistoryChart").on("click",()=>{var i;const e=H0;if(Xd(e),window===void 0)return;const t=n(window).height()??0,s=(((i=n(`#result-${e}`).offset())==null?void 0:i.top)??0)-t/2;n([document.documentElement,document.body]).animate({scrollTop:s},Be(500)),n(".resultRow").removeClass("active"),n(`#result-${e}`).addClass("active")});n(".pageAccount").on("click",".miniResultChartButton",async e=>{var l,c;const t=n(e.currentTarget);if(t.hasClass("loading")||t.hasClass("disabled"))return;const a=t.attr("filteredResultsId");if(a===void 0)return;const s=De[parseInt(a)];if(s===void 0)return;let i=s.chartData;if(i===void 0){t.addClass("loading"),t.attr("aria-label",null),t.html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>'),de();const d=await F.results.getById({params:{resultId:s._id}});if(Z(),t.html('<i class="fas fa-fw fa-chart-line"></i>'),t.removeClass("loading"),d.status!==200){g("Error fetching result: "+d.body.message,-1);return}i=d.body.data.chartData,s.chartData=i;const u=(c=(l=$())==null?void 0:l.results)==null?void 0:c.find(m=>m._id===s._id);if(u!==void 0&&(u.chartData=s.chartData),d.body.data.chartData==="toolong"){t.attr("aria-label","Graph history is not available for long tests"),t.attr("data-baloon-pos","up"),t.addClass("disabled"),g("Graph history is not available for long tests",0);return}}t.attr("aria-label","View graph"),jD(i)});n(".pageAccount .group.history").on("click",".history-wpm-header",()=>{ys("wpm",".history-wpm-header")});n(".pageAccount .group.history").on("click",".history-raw-header",()=>{ys("rawWpm",".history-raw-header")});n(".pageAccount .group.history").on("click",".history-acc-header",()=>{ys("acc",".history-acc-header")});n(".pageAccount .group.history").on("click",".history-correct-chars-header",()=>{ys("correctChars",".history-correct-chars-header")});n(".pageAccount .group.history").on("click",".history-incorrect-chars-header",()=>{ys("incorrectChars",".history-incorrect-chars-header")});n(".pageAccount .group.history").on("click",".history-consistency-header",()=>{ys("consistency",".history-consistency-header")});n(".pageAccount .group.history").on("click",".history-date-header",()=>{ys("timestamp",".history-date-header")});n(".pageAccount .group.history").on("click",".buttonsAndTitle .buttons button",()=>{ys("timestamp",".history-date-header",!0)});n(".pageAccount .group.topFilters, .pageAccount .filterButtons").on("click","button",()=>{setTimeout(()=>{ai()},0)});n(".pageAccount .group.presetFilterButtons").on("click",".filterBtns .filterPresets .select-filter-preset",async e=>{await PD(n(e.target).data("id")),ai()});n(".pageAccount .content .group.aboveHistory .exportCSV").on("click",()=>{V1(De)});n(".pageAccount .profile").on("click",".details .copyLink",()=>{const e=$();if(!e)return;const{name:t}=e,a=`${location.origin}/profile/${t}`;navigator.clipboard.writeText(a).then(function(){g("URL Copied to clipboard",0)},function(){alert("Failed to copy using the Clipboard API. Here's the link: "+a)})});n(".pageAccount button.loadMoreResults").on("click",async()=>{var t,a;const e=((a=(t=$())==null?void 0:t.results)==null?void 0:a.length)??0;de(),zm(),await Ip(e),await Vk(),Z()});Te(e=>{ce()==="account"&&e==="typingSpeedUnit"&&ai()});const lF=new Pa({id:"account",element:n(".page.pageAccount"),path:"/account",afterHide:async()=>{iF(),OD(),Et("pageAccount")},beforeShow:async()=>{Zt("pageAccount","main");const e=$();(e==null?void 0:e.results)===void 0&&(n(".pageLoading .fill, .pageAccount .fill").css("width","0%"),n(".pageAccount .content").addClass("hidden"),n(".pageAccount .preloader").removeClass("hidden"),await ab()),await RD(ai),Ro(),await Ee(0),Uk("current",e!==void 0?new Date(e.addedAt).getFullYear():2020),ai().then(()=>{var t,a;nF(),n(".pageAccount .content .accountVerificatinNotice").remove(),((a=(t=xe)==null?void 0:t.currentUser)==null?void 0:a.emailVerified)===!1&&n(".pageAccount .content").prepend('<div class="accountVerificatinNotice"><i class="fas icon fa-exclamation-triangle"></i><p>Your email address is still not verified</p><button class="sendVerificationEmail">resend verification email</button></div>'),eF()})}});n(()=>{Ht("pageAccount")});const Fe={resultId:"",startingTags:[],tags:[],source:"accountPage"};function Qk(e,t,a){if(!Xe()){g("You are offline",0,{duration:2});return}if(e===""){g("Failed to show edit result tags modal: result id is empty",-1);return}Fe.resultId=e,Fe.startingTags=[...t],Fe.tags=[...t],Fe.source=a,qp.show({beforeAnimation:async()=>{cF(),Zk()}})}function fh(){qp.hide()}function cF(){var a,s;const e=qp.getModal().querySelector(".buttons");if(e===null){g("Failed to append buttons to edit result tags modal: could not find buttons element",-1);return}const t=new Set([...((a=$())==null?void 0:a.tags.map(i=>i._id))??[],...Fe.tags]);e.innerHTML="";for(const i of t){const l=(s=$())==null?void 0:s.tags.find(d=>d._id===i),c=document.createElement("button");c.classList.add("toggleTag"),c.setAttribute("data-tag-id",i),c.innerHTML=(l==null?void 0:l.display)??"unknown tag",c.addEventListener("click",d=>{dF(i),Zk()}),e.appendChild(c)}}function Zk(){for(const e of n("#editResultTagsModal .modal .buttons button")){const t=n(e).attr("data-tag-id")??"";Fe.tags.includes(t)?n(e).addClass("active"):n(e).removeClass("active")}}function dF(e){Fe.tags.includes(e)?Fe.tags=Fe.tags.filter(t=>t!==e):Fe.tags.push(e)}async function uF(){var a,s,i;de();const e=await F.results.updateTags({body:{resultId:Fe.resultId,tagIds:Fe.tags}});if(Z(),Fe.tags=Fe.tags.filter(l=>l!==void 0),e.status!==200){g("Failed to update result tags: "+e.body.message,-1);return}const t=((a=e.body.data)==null?void 0:a.tagPbs)??[];g("Tags updated",1,{duration:2}),(i=(s=$())==null?void 0:s.results)==null||i.forEach(l=>{l._id===Fe.resultId&&(l.tags=Fe.tags)}),Fe.source==="accountPage"?rF(Fe.resultId,Fe.tags):Fe.source==="resultPage"&&dq(Fe.tags,t)}const qp=new fe({dialogId:"editResultTagsModal",setup:async e=>{var t;(t=e.querySelector("button.saveButton"))==null||t.addEventListener("click",a=>{if(Q1(Fe.startingTags,Fe.tags)){fh();return}fh(),uF()})}});function Yk(e){const t=/((-\s*)?\d+(\.\d+)?\s*[hms]?)/g,a=[...e.toLowerCase().matchAll(t)].map(s=>{const i=s[0],l=parseFloat(i.replace(/\s+/g,""));return i.includes("h")?3600*l:i.includes("m")?60*l:l}).reduce((s,i)=>s+i,0);return Math.floor(a)}function mF(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),s=e%3600%60,i=[];return t>0&&i.push(`${t} hour${t===1?"":"s"}`),a>0&&i.push(`${a} minute${a===1?"":"s"}`),s>0&&i.push(`${s} second${s===1?"":"s"}`),i.length===3?`${i[0]}, ${i[1]} and ${i[2]}`:i.length===2?`${i[0]} and ${i[1]}`:`${i[0]}`}function Xk(){const e=n("#customTestDurationModal input").val(),t=Yk(e);let a="";t<0?a="Negative time? Really?":t===0?a="Infinite test":a=mF(t),n("#customTestDurationModal .preview").text(a)}function Jk(e){eC.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.time}`,Xk()}})}function fF(e=!1){eC.hide({clearModalChain:e})}function pF(){const e=Yk(n("#customTestDurationModal input").val());if(e!==null&&!isNaN(e)&&e>=0&&isFinite(e))Ga(e),be(),le(),e>=1800?g("Stay safe and take breaks!",0):e===0&&g("Infinite time! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});else{g("Custom time must be a positive number or zero",0);return}fF(!0)}async function gF(e){var t;e.addEventListener("submit",a=>{a.preventDefault(),pF()}),(t=e.querySelector("input"))==null||t.addEventListener("input",a=>{Xk()})}const eC=new fe({dialogId:"customTestDurationModal",setup:gF}),hF=Zr.recaptchaSiteKey,Co={};function gi(e,t,a){if(Co[t]!==void 0&&Co[t]!==null)return;const s=grecaptcha.render(e,{sitekey:hF,callback:a});Co[t]=s}function Bo(e){Co[e]===void 0||Co[e]===null||grecaptcha.reset(Co[e])}function bl(e){return Co[e]===void 0||Co[e]===null?"":grecaptcha.getResponse(Co[e])}class jr{constructor(t,a){this.textareaElement=t,this.maxLength=a,this.textareaElement.attr("maxlength",this.maxLength.toString()),this.textareaElement.parent().hasClass("textareaWithCounter")||n(this.textareaElement).wrap('<div class="textareaWithCounter"></div>'),this.parentElement=n(this.textareaElement).parent(".textareaWithCounter"),this.parentElement.find(".char-counter").length===0?(this.counterElement=n('<span class="char-counter"></span>'),this.parentElement.append(this.counterElement)):this.counterElement=this.parentElement.find(".char-counter"),this.updateCounter(),this.textareaElement.on("input",()=>this.updateCounter())}updateCounter(){const t=this.maxLength,a=this.textareaElement.val().length,s=t-a;this.counterElement.text(`${a}/${t}`);const i=s/this.maxLength*100;this.counterElement.removeClass("warning"),this.counterElement.removeClass("error"),i===0?this.counterElement.addClass("error"):i<10&&this.counterElement.addClass("warning")}setMaxLength(t){this.maxLength=t,this.updateCounter()}}let ph=!1;async function yF(){if(ph)return;const e=await _f();for(const t of e)t.name!=="swiss_german"&&n("#quoteSubmitModal .newQuoteLanguage").append(`<option value="${t.name}">${t.name.replace(/_/g," ")}</option>`);ph=!0}let _i;async function bF(){const e=n("#quoteSubmitModal .newQuoteText").val(),t=n("#quoteSubmitModal .newQuoteSource").val(),a=n("#quoteSubmitModal .newQuoteLanguage").val(),s=bl("submitQuote");if(!e||!t||!a){g("Please fill in all fields",0);return}de();const i=await F.quotes.add({body:{text:e,source:t,language:a,captcha:s}});if(Z(),i.status!==200){g("Failed to submit quote: "+i.body.message,-1);return}g("Quote submitted.",1),n("#quoteSubmitModal .newQuoteText").val(""),n("#quoteSubmitModal .newQuoteSource").val(""),Bo("submitQuote")}async function vF(e){tC.show({...e,mode:"dialog",focusFirstInput:!0,afterAnimation:async()=>{gi(document.querySelector("#quoteSubmitModal .g-recaptcha"),"submitQuote"),await yF(),_i=new nt({select:"#quoteSubmitModal .newQuoteLanguage"}),n("#quoteSubmitModal .newQuoteLanguage").val(ja(r.language)),n("#quoteSubmitModal .newQuoteLanguage").trigger("change"),n("#quoteSubmitModal input").val(""),new jr(n("#quoteSubmitModal .newQuoteText"),250)}})}function wF(e){tC.hide({clearModalChain:e})}async function kF(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{bF(),wF(!0)})}async function CF(){Bo("submitQuote"),_i==null||_i.destroy(),_i=void 0}const tC=new fe({dialogId:"quoteSubmitModal",setup:kF,cleanup:CF});let ds=[];function Jd(){n("#quoteApproveModal .quotes").empty(),ds.forEach((e,t)=>{const a=n(`
      <div class="quote" data-id="${t}" data-db-id="${e._id}">
        <textarea class="text">${e.text}</textarea>
        <input type="text" class="source" placeholder="Source" value="${e.source}">
        <div class="buttons">
          <button disabled class="textButton undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></button>
          <button class="textButton refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></button>
          <button class="textButton approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></button>
          <button class="textButton edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></button>
        </div>
        <div class="bottom">
          <div class="length ${e.text.length<60?"red":""}"><i class="fas fa-fw fa-ruler"></i>${e.text.length}</div>
          <div class="language"><i class="fas fa-fw fa-globe-americas"></i>${e.language}</div>
          <div class="timestamp"><i class="fas fa-fw fa-calendar"></i>${oe(new Date(e.timestamp),"dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);n("#quoteApproveModal .quotes").append(a),a.find(".source").on("input",()=>{n(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),n(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),n(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden")}),a.find(".text").on("input",()=>{n(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),n(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),n(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden"),aC(t)}),a.find(".undo").on("click",()=>{xF(t)}),a.find(".approve").on("click",()=>{TF(t,e._id)}),a.find(".refuse").on("click",()=>{$F(t,e._id)}),a.find(".edit").on("click",()=>{LF(t,e._id)})})}function aC(e){var a;const t=(a=n(`#quoteApproveModal .quote[data-id=${e}] .text`).val())==null?void 0:a.length;n(`#quoteApproveModal .quote[data-id=${e}] .length`).html(`<i class="fas fa-fw fa-ruler"></i>${t}`),t<60?n(`#quoteApproveModal .quote[data-id=${e}] .length`).addClass("red"):n(`#quoteApproveModal .quote[data-id=${e}] .length`).removeClass("red")}async function oC(){de();const e=await F.quotes.get();if(Z(),e.status!==200){g("Failed to get new quotes: "+e.body.message,-1);return}ds=e.body.data??[],Jd()}async function SF(e){MF.show({...e,beforeAnimation:async()=>{ds=[],oC()}})}function Bp(e){const t=n(`#quoteApproveModal .quotes .quote[data-id=${e}]`);t.find("button").prop("disabled",!1),t.find(".edit").hasClass("hidden")&&t.find(".undo").prop("disabled",!0)}function xF(e){var t,a;n(`#quoteApproveModal .quote[data-id=${e}] .text`).val(((t=ds[e])==null?void 0:t.text)??""),n(`#quoteApproveModal .quote[data-id=${e}] .source`).val(((a=ds[e])==null?void 0:a.source)??""),n(`#quoteApproveModal .quote[data-id=${e}] .undo`).prop("disabled",!0),n(`#quoteApproveModal .quote[data-id=${e}] .approve`).removeClass("hidden"),n(`#quoteApproveModal .quote[data-id=${e}] .edit`).addClass("hidden"),aC(e)}async function TF(e,t){if(!confirm("Are you sure?"))return;const a=n(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),de();const s=await F.quotes.approveSubmission({body:{quoteId:t}});if(Z(),s.status!==200){Bp(e),a.find("textarea, input").prop("disabled",!1),g("Failed to approve quote: "+s.body.message,-1);return}g(`Quote approved. ${s.body.message??""}`,1),ds.splice(e,1),Jd()}async function $F(e,t){if(!confirm("Are you sure?"))return;const a=n(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),de();const s=await F.quotes.rejectSubmission({body:{quoteId:t}});if(Z(),s.status!==200){Bp(e),a.find("textarea, input").prop("disabled",!1),g("Failed to refuse quote: "+s.body.message,-1);return}g("Quote refused.",1),ds.splice(e,1),Jd()}async function LF(e,t){if(!confirm("Are you sure?"))return;const a=n(`#quoteApproveModal .quote[data-id=${e}] .text`).val(),s=n(`#quoteApproveModal .quote[data-id=${e}] .source`).val(),i=n(`#quoteApproveModal .quotes .quote[data-id=${e}]`);i.find("button").prop("disabled",!0),i.find("textarea, input").prop("disabled",!0),de();const l=await F.quotes.approveSubmission({body:{quoteId:t,editText:a,editSource:s}});if(Z(),l.status!==200){Bp(e),i.find("textarea, input").prop("disabled",!1),g("Failed to approve quote: "+l.body.message,-1);return}g(`Quote edited and approved. ${l.body.message??""}`,1),ds.splice(e,1),Jd()}async function AF(e){var t;(t=e.querySelector("button.refreshList"))==null||t.addEventListener("click",()=>{n("#quoteApproveModal .quotes").empty(),oC()})}const MF=new fe({dialogId:"quoteApproveModal",setup:AF}),jn={quoteToReport:void 0,reasonSelect:void 0};async function sC(e,t){nC.show({mode:"dialog",...t,beforeAnimation:async()=>{var i;gi(document.querySelector("#quoteReportModal .g-recaptcha"),"quoteReportModal");const a=r.language==="swiss_german"?"german":r.language,{quotes:s}=await Qt.getQuotes(a);jn.quoteToReport=s.find(l=>l.id===e),n("#quoteReportModal .quote").text((i=jn.quoteToReport)==null?void 0:i.text),n("#quoteReportModal .reason").val("Grammatical error"),n("#quoteReportModal .comment").val(""),jn.reasonSelect=new nt({select:"#quoteReportModal .reason",settings:{showSearch:!1}}),new jr(n("#quoteReportModal .comment"),250)}})}async function EF(e=!1){nC.hide({clearModalChain:e})}async function PF(){var u;const e=bl("quoteReportModal");if(!e){g("Please complete the captcha");return}const t=(u=jn.quoteToReport)==null?void 0:u.id.toString(),a=ja(r.language),s=n("#quoteReportModal .reason").val(),i=n("#quoteReportModal .comment").val(),l=e;if(t===void 0||t===""){g("Please select a quote");return}if(!s){g("Please select a valid report reason");return}if(!i){g("Please provide a comment");return}const c=i.length-250;if(c>0){g(`Report comment is ${c} character(s) too long`);return}de();const d=await F.quotes.report({body:{quoteId:t,quoteLanguage:a,reason:s,comment:i,captcha:l}});if(Z(),d.status!==200){g("Failed to report quote: "+d.body.message,-1);return}g("Report submitted. Thank you!",1),EF(!0)}async function IF(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await PF()})}async function qF(){var e;Bo("quoteReportModal"),(e=jn.reasonSelect)==null||e.destroy(),jn.reasonSelect=void 0}const nC=new fe({dialogId:"quoteReportModal",setup:IF,cleanup:qF}),BF={fuzzyMatchSensitivity:.2,scoreForSimilarMatch:.5,scoreForExactMatch:1};function DF(e,t){return t===0?0:Math.log10(e/t)}const gh=.4;function FF(e,t){return gh+(1-gh)*(t.termFrequencies[e]/t.maxTermFrequency)}function hh(e){return e.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g)??[]}const WF=(e,t,a=BF)=>{const s={},i={};e.forEach((d,u)=>{const m=hh(t(d)),f={id:u,termFrequencies:{},maxTermFrequency:0};let p=0;m.forEach(h=>{var b,v;const y=sg(h);Object.hasOwn(i,y)||(i[y]=new Set),(b=i[y])==null||b.add(h),Object.hasOwn(s,y)||(s[y]=new Set),(v=s[y])==null||v.add(f),y in f.termFrequencies||(f.termFrequencies[y]=0),f.termFrequencies[y]++,p=Math.max(p,f.termFrequencies[y])}),f.maxTermFrequency=p});const l=Object.keys(s);return{query:d=>{const u={results:[],matchedQueryTerms:[]},m=new Set(hh(d).map(y=>sg(y)));if(m.size===0)return u;const f=new Map,p=new Set;m.forEach(y=>{l.forEach(b=>{var k;const{similarity:v}=MS(y,b),C=b===y,E=v>=1-a.fuzzyMatchSensitivity;if(C||E){const M=s[b],q=DF(e.length,M.size);M.forEach(W=>{const x=f.get(W.id)??0,L=FF(b,W),D=C?a.scoreForExactMatch:0,K=E?a.scoreForSimilarMatch:0,ke=(D+K)*q*L;f.set(W.id,x+ke)}),(k=i[b])==null||k.forEach(W=>{p.add(W)})}})});const h=[...f].sort((y,b)=>b[1]-y[1]).map(y=>e[y[0]]);return u.results=h,u.matchedQueryTerms=[...p],u}}},Iu={},qu=100;let Xo=1;function zF(e,t,a){if(e in Iu)return Iu[e];const s=WF(t,a);return Iu[e]=s,s}function Bu(e,t){return t.length===0?e:cM(e,'.,"/#!$%^&*;:{}=-_`~() '.split("")).map(i=>t.find(c=>i.startsWith(c))!==void 0?`<span class="highlight">${i}</span>`:i).join("")}function RF(e){const t=n("#quoteSearchModal .quoteLengthFilter").val();if(t.length===0)return e;const a=new Set(t.map(i=>parseInt(i,10)));return e.filter(i=>a.has(i.group))}function OF(e){const t=document.querySelector(".toggleFavorites").classList.contains("active");return e.filter(s=>t?Qt.isQuoteFavorite(s):!0)}function _F(e,t){let a;e.length<101?a="short":e.length<301?a="medium":e.length<601?a="long":a="thicc";const s=!j(),i=!s&&Qt.isQuoteFavorite(e);return`
  <div class="searchResult" data-quote-id="${e.id}">

    <div class="text">
      ${Bu(e.text,t)}
    </div>

    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${Bu(e.id.toString(),t)}
      </span>
    </div>

    <div class="length">
      <div class="sub">length</div>
      ${a}
    </div>

    <div class="source">
      <div class="sub">source</div>
      ${Bu(e.source,t)}
    </div>

    <div class="textButton report ${s&&"hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>

    <div class="textButton favorite ${s&&"hidden"}" aria-label="Favorite quote" data-balloon-pos="left">
      <i class="${i?"fas":"far"} fa-heart favorite"></i>
    </div>

  </div>
  `}async function Kc(e){var p,h;const{quotes:t}=await Qt.getQuotes(r.language),a=zF(r.language,t,y=>`${y.text} ${y.id} ${y.source}`),{results:s,matchedQueryTerms:i}=a.query(e),l=RF(OF(e===""?t:s)),c=n("#quoteSearchResults");c.empty();const d=Math.ceil(l.length/qu);if(Xo>=d?n("#quoteSearchPageNavigator .nextPage").prop("disabled",!0):n("#quoteSearchPageNavigator .nextPage").prop("disabled",!1),Xo<=1?n("#quoteSearchPageNavigator .prevPage").prop("disabled",!0):n("#quoteSearchPageNavigator .prevPage").prop("disabled",!1),l.length===0){n("#quoteSearchModal  .pageInfo").html("No search results");return}const u=(Xo-1)*qu,m=Math.min(Xo*qu,l.length);n("#quoteSearchModal  .pageInfo").html(`${u+1} - ${m} of ${l.length}`),l.slice(u,m).forEach(y=>{const b=_F(y,i);c.append(b)});const f=tn.getModal().querySelectorAll(".searchResult");for(const y of f){const b=parseInt(y.dataset.quoteId);(p=y.querySelector(".textButton.favorite"))==null||p.addEventListener("click",v=>{if(v.stopPropagation(),b===void 0||isNaN(b)){g("Could not toggle quote favorite: quote id is not a number",-1);return}NF(`${b}`)}),(h=y.querySelector(".textButton.report"))==null||h.addEventListener("click",v=>{if(v.stopPropagation(),b===void 0||isNaN(b)){g("Could not open quote report modal: quote id is not a number",-1);return}sC(b,{modalChain:tn})}),y.addEventListener("click",v=>{bf(b),jF(b)})}}let Hi;async function iC(e){tn.show({...e,focusFirstInput:!0,beforeAnimation:async()=>{var a,s,i;j()?(n("#quoteSearchModal .goToQuoteSubmit").removeClass("hidden"),n("#quoteSearchModal .toggleFavorites").removeClass("hidden")):(n("#quoteSearchModal .goToQuoteSubmit").addClass("hidden"),n("#quoteSearchModal .toggleFavorites").addClass("hidden")),((a=$())==null?void 0:a.quoteMod)!==void 0&&(((s=$())==null?void 0:s.quoteMod)===!0||((i=$())==null?void 0:i.quoteMod)!=="")?n("#quoteSearchModal .goToQuoteApprove").removeClass("hidden"):n("#quoteSearchModal .goToQuoteApprove").addClass("hidden"),Hi=new nt({select:"#quoteSearchModal .quoteLengthFilter",settings:{showSearch:!1,placeholderText:"filter by length",contentLocation:tn.getModal()},data:[{text:"short",value:"0"},{text:"medium",value:"1"},{text:"long",value:"2"},{text:"thicc",value:"3"}]})},afterAnimation:async()=>{const t=n("#quoteSearchModal input").val();Xo=1,Kc(t)}})}function HF(e=!1){tn.hide({clearModalChain:e})}function jF(e){if(isNaN(e)&&(e=parseInt(document.getElementById("searchBox").value)),e!==null&&!isNaN(e)&&e>=0)ho(-2,!1),bf(e),be();else{g("Quote ID must be at least 1",0);return}le(),HF(!0)}const Du=Pt(250,()=>{const e=document.getElementById("searchBox").value;Xo=1,Kc(e)});async function NF(e){const t=r.language;if(t===""||e===""){g("Could not get quote stats!",-1);return}const a={language:t,id:parseInt(e,10)},s=Qt.isQuoteFavorite(a),i=n(`#quoteSearchModal .searchResult[data-quote-id=${e}] .textButton.favorite i`);if($())if(s)try{de(),await Qt.setQuoteFavorite(a,!1),Z(),i.removeClass("fas").addClass("far")}catch(c){Z();const d=ae(c,"Failed to remove quote from favorites");g(d,-1)}else try{de(),await Qt.setQuoteFavorite(a,!0),Z(),i.removeClass("far").addClass("fas")}catch(c){Z();const d=ae(c,"Failed to add quote to favorites");g(d,-1)}}async function GF(e){var t,a,s,i,l,c,d;(t=e.querySelector(".searchBox"))==null||t.addEventListener("input",u=>{Du()}),(a=e.querySelector("button.toggleFavorites"))==null||a.addEventListener("click",u=>{j()&&(n(u.target).toggleClass("active"),Du())}),(s=e.querySelector(".goToQuoteApprove"))==null||s.addEventListener("click",u=>{SF({modalChain:tn})}),(i=e.querySelector(".goToQuoteSubmit"))==null||i.addEventListener("click",async u=>{var p;de();const m=await F.quotes.isSubmissionEnabled(),f=(m.status===200&&((p=m.body.data)==null?void 0:p.isEnabled))??!1;if(Z(),!f){g("Quote submission is disabled temporarily due to a large submission queue.",0,{duration:5});return}vF({modalChain:tn})}),(l=e.querySelector(".quoteLengthFilter"))==null||l.addEventListener("change",Du),(c=e.querySelector(".nextPage"))==null||c.addEventListener("click",()=>{const u=document.getElementById("searchBox").value;Xo++,Kc(u)}),(d=e.querySelector(".prevPage"))==null||d.addEventListener("click",()=>{const u=document.getElementById("searchBox").value;Xo--,Kc(u)})}async function UF(){Hi==null||Hi.destroy(),Hi=void 0}const tn=new fe({dialogId:"quoteSearchModal",setup:GF,cleanup:UF}),rC={homeKeys:{display:"home keys",getIncludeString:e=>{const t=e.keys.row3.slice(0,4),a=e.keys.row3.slice(6,10);return[...t,...a]},getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row4,s=e.keys.row3.slice(10),i=e.keys.row3.slice(4,6);return[...t,...i,...s,...a]}},leftHand:{display:"left hand",getIncludeString:e=>{const t=e.keys.row2.slice(0,5),a=e.keys.row3.slice(0,5),s=e.keys.row4.slice(0,5);return[...t,...a,...s]},getExcludeString:e=>{const t=e.keys.row2.slice(5),a=e.keys.row3.slice(5),s=e.keys.row4.slice(5);return[...t,...a,...s]}},rightHand:{display:"right hand",getIncludeString:e=>{const t=e.keys.row2.slice(5),a=e.keys.row3.slice(5),s=e.keys.row4.slice(4);return[...t,...a,...s]},getExcludeString:e=>{const t=e.keys.row2.slice(0,5),a=e.keys.row3.slice(0,5),s=e.keys.row4.slice(0,4);return[...t,...a,...s]}},homeRow:{display:"home row",getIncludeString:e=>e.keys.row3,getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row4;return[...t,...a]}},topRow:{display:"top row",getIncludeString:e=>e.keys.row2,getExcludeString:e=>{const t=e.keys.row3,a=e.keys.row4;return[...t,...a]}},bottomRow:{display:"bottom row",getIncludeString:e=>e.keys.row4,getExcludeString:e=>{const t=e.keys.row2,a=e.keys.row3;return[...t,...a]}}};async function KF(){n("#wordFilterModal .languageInput").empty(),n("#wordFilterModal .layoutInput").empty(),n("wordFilterModal .presetInput").empty();let e;try{e=await Of()}catch(t){console.error(ae(t,"Failed to initialise word filter popup language list"));return}e.forEach(t=>{const a=t.replace(/_/gi," ");n("#wordFilterModal .languageInput").append(`
        <option value=${t}>${a}</option>
      `)});for(const t of kd){const a=t.replace(/_/gi," ");n("#wordFilterModal .layoutInput").append(`
      <option value=${t}>${a}</option>
    `)}for(const[t,a]of Object.entries(rC))n("#wordFilterModal .presetInput").append(`<option value=${t}>${a.display}</option>`)}let ji,Ni,Gi;async function VF(e){Nn.show({...e,beforeAnimation:async t=>{ji=new nt({select:"#wordFilterModal .languageInput",settings:{contentLocation:t}}),Ni=new nt({select:"#wordFilterModal .layoutInput",settings:{contentLocation:Nn.getModal()}}),Gi=new nt({select:"#wordFilterModal .presetInput",settings:{contentLocation:Nn.getModal()}}),n("#wordFilterModal .loadingIndicator").removeClass("hidden"),lC()}})}function QF(e){Nn.hide({...e})}async function ZF(e){let t=n("#wordFilterModal .wordIncludeInput").val();t=Jp(t==null?void 0:t.trim()),t=t.replace(/\s+/gi,"|");const a=new RegExp(t,"i");let s=n("#wordFilterModal .wordExcludeInput").val();s=Jp(s.trim()),s=s.replace(/\s+/gi,"|");const i=new RegExp(s,"i"),l=[];let c;try{c=await ci(e)}catch(p){return g(ae(p,"Failed to filter language words"),-1),[]}const d=n("#wordFilterModal .wordMaxInput").val(),u=n("#wordFilterModal .wordMinInput").val();let m,f;d===""?m=999:m=parseInt(d),u===""?f=1:f=parseInt(u);for(const p of c.words){const h=a.test(p),y=i.test(p);(h&&!y||h&&s==="")&&p.length<=m&&p.length>=f&&l.push(p)}return l}async function yh(e){const t=n("#wordFilterModal .languageInput").val(),a=await ZF(t);if(a.length===0){g("No words found",0),lC();return}const s=a.join(di()?"|":" ");QF({modalChainData:{text:s,set:e}})}function bh(){for(const e of Nn.getModal().querySelectorAll("button"))e.setAttribute("disabled","true")}function lC(){for(const e of Nn.getModal().querySelectorAll("button"))e.removeAttribute("disabled")}async function YF(){await KF(),n("#wordFilterModal button.generateButton").on("click",async()=>{const e=n("#wordFilterModal .presetInput").val(),t=n("#wordFilterModal .layoutInput").val(),a=rC[e];if(a===void 0){g(`Preset ${e} not found`,-1);return}const s=await Ds(t);n("#wordIncludeInput").val(a.getIncludeString(s).map(i=>i[0]).join(" ")),n("#wordExcludeInput").val(a.getExcludeString(s).map(i=>i[0]).join(" "))}),n("#wordFilterModal button.addButton").on("click",()=>{n("#wordFilterModal .loadingIndicator").removeClass("hidden"),bh(),setTimeout(()=>{yh(!1)},0)}),n("#wordFilterModal button.setButton").on("click",()=>{n("#wordFilterModal .loadingIndicator").removeClass("hidden"),bh(),setTimeout(()=>{yh(!0)},0)})}async function XF(){ji==null||ji.destroy(),Ni==null||Ni.destroy(),Gi==null||Gi.destroy(),ji=void 0,Ni=void 0,Gi=void 0}const Nn=new fe({dialogId:"wordFilterModal",setup:YF,cleanup:XF});class H{constructor(t,a,s,i,l){if(this.configName=t,this.configValue=r[t],this.mode=s,this.configFunction=a,this.setCallback=i,this.updateCallback=l,this.updateUI(),this.mode==="select"){const c=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] select`);c==null||c.addEventListener("change",d=>{const u=n(d.target);u.hasClass("disabled")||u.hasClass("no-auto-handle")||this.setValue(u.val())})}else if(this.mode==="button")n(".pageSettings").on("click",`.section[data-config-name='${this.configName}'] button`,c=>{const d=n(c.currentTarget);if(d.hasClass("disabled")||d.hasClass("no-auto-handle"))return;const u=d.attr("data-config-value");if(u===void 0||u===""){console.error(`Failed to handle settings button click for ${t}: data-${t} is missing or empty.`),g("Button is missing data property. Please report this.",-1);return}let m=u;m==="true"&&(m=!0),m==="false"&&(m=!1),this.setValue(m)});else if(this.mode==="range"){const c=document.querySelector(`.pageSettings .section[data-config-name=${this.configName}] input[type=range]`);if(!c){g(`Failed to find range element for ${t}`,-1);return}const d=Pt(250,u=>{this.setValue(u)});c.addEventListener("input",u=>{const m=n(u.target);if(m.hasClass("disabled")||m.hasClass("no-auto-handle"))return;const f=parseFloat(m.val());this.updateUI(f),d(f)})}}setValue(t){this.configFunction(t),this.updateUI(),this.setCallback&&this.setCallback()}updateUI(t){if(this.configValue=t??r[this.configName],n(`.pageSettings .section[data-config-name='${this.configName}'] button`).removeClass("active"),this.mode==="select"){const a=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] select`);if(a===null)return;a.value=this.configValue;const s=a.slim;s==null||s.store.setSelectedBy("value",[this.configValue]),s==null||s.render.renderValues(),s==null||s.render.renderOptions(s.store.getData())}else if(this.mode==="button")n(`.pageSettings .section[data-config-name='${this.configName}'] button[data-config-value='${this.configValue}']`).addClass("active");else if(this.mode==="range"){const a=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] input[type=range]`),s=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] .value`);if(a===null||s===null)return;a.value=this.configValue,s.textContent=`${this.configValue.toFixed(1)}`}this.updateCallback&&this.updateCallback()}}const cC=new jt({key:"activeTags",schema:o.array(Lv),fallback:[]});function vl(){var t,a;const e=[];(a=(t=$())==null?void 0:t.tags)==null||a.forEach(s=>{s.active===!0&&e.push(s._id)}),cC.set(e)}function JF(e=!1){var a;const t=$();t&&(t.tags=(a=t.tags)==null?void 0:a.map(s=>(s.active=!1,s)),gt(t),cs(),e||vl())}function eW(e,t,a=!1){var i;const s=$();s&&(s.tags=(i=s.tags)==null?void 0:i.map(l=>(l._id===e&&(l.active=t),l)),gt(s),cs(),a||vl())}function dC(e,t=!1){var a,s;(s=(a=$())==null?void 0:a.tags)==null||s.forEach(i=>{i._id===e&&(i.active===void 0?i.active=!0:i.active=!i.active)}),cs(),t||vl()}function tW(){const e=cC.get();for(const t of e)dC(t,!0);vl()}async function aW(e){var s,i;const t=$();if(!t)return;const a=(s=t.presets)==null?void 0:s.find(l=>l._id===e);if(a!==void 0){if(vh(a)){const l={...im(),...rb(a.config)};await Qn(pr(l))}else await Qn(pr(a.config));if((!vh(a)||(i=a.settingGroups)!=null&&i.includes("behavior"))&&(JF(!0),a.config.tags)){for(const l of a.config.tags)eW(l,!0,!1);vl()}le(),g("Preset applied",1,{duration:2}),li()}}function vh(e){return e.settingGroups!==void 0&&e.settingGroups!==null}async function oW(e){var s;const t=$();if(!t)return;const a=(s=t.presets)==null?void 0:s.find(i=>i._id===e);if(a===void 0){g("Preset not found",0);return}return a}function sW(){var t;let e=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&kt!==null&&(e=kt),document.querySelectorAll(".pageSettings .section.themes .theme").forEach(a=>{a.classList.remove("active")}),(t=document.querySelector(`.pageSettings .section.themes .theme[theme='${e}']`))==null||t.classList.add("active")}function oi(e,t,a=!1,s=!1){if(a){const u=e.find("input.color").attr("id");u===void 0&&console.error("Could not find color ID!"),!s&&u!==void 0&&document.documentElement.style.setProperty(u,t);const m=e.find("label");m.val(t),m.attr("value",t),m.attr("for")!=="--bg-color"&&m.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t);return}const i=[{rule:/\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,start:"rgb(",end:")"},{rule:/\b[A-Z, a-z, 0-9]{6}\b/,start:"#",end:""},{rule:/\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,start:"hsl(",end:")"}];t=t.replace("°","");for(const u of i)if(t.match(u.rule)){t=u.start+t+u.end;break}n(".colorConverter").css("color",t);const l=FM(n(".colorConverter").css("color"));if(l===void 0)return;t=l;const c=e.find("input.color").attr("id");c===void 0&&console.error("Could not find color ID!"),!s&&c!==void 0&&document.documentElement.style.setProperty(c,t);const d=e.find("label");d.val(t),d.attr("value",t),d.attr("for")!=="--bg-color"&&d.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t)}async function Nr(){var e;if(r.customTheme){const t=n(".pageSettings .section.themes .allCustomThemes.buttons").empty(),a=n(".pageSettings .section.themes .addCustomThemeButton");if(j())n(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton").text("save as new");else{n(".pageSettings .section.themes .customThemeEdit #saveCustomThemeButton").text("save");return}a.removeClass("hidden"),(((e=$())==null?void 0:e.customThemes)??[]).forEach(i=>{const l=i.colors[0],c=i.colors[1];t.append(`<div class="customTheme button" customThemeId='${i._id}' 
        style="color:${c};background:${l}">
        <div class="editButton"><i class="fas fa-pen"></i></div>
        <div class="text">${i.name.replace(/_/g," ")}</div>
        <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
        </div>`)})}else{const t=document.querySelector(".pageSettings .section.themes .favThemes.buttons");t.innerHTML="";let a="";const s=document.querySelector(".pageSettings .section.themes .allThemes.buttons");s.innerHTML="";let i="",l=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&kt!==null&&(l=kt);let c;try{c=await RM()}catch(d){g(ae(d,"Failed to refresh theme buttons"),-1);return}if(r.favThemes.length>0){t.style.marginBottom="1rem",t.style.marginTop="1rem";for(const d of c)if(r.favThemes.includes(d.name)){const u=l===d.name?"active":"";a+=`<div class="theme button ${u}" theme='${d.name}' style="background: ${d.bgColor}; color: ${d.mainColor};outline: 0 solid ${d.mainColor};">
            <div class="favButton active"><i class="fas fa-star"></i></div>
            <div class="text">${d.name.replace(/_/g," ")}</div>
            <div class="themeBubbles" style="background: ${d.bgColor};outline: 0.25rem solid ${d.bgColor};">
              <div class="themeBubble" style="background: ${d.mainColor}"></div>
              <div class="themeBubble" style="background: ${d.subColor}"></div>
              <div class="themeBubble" style="background: ${d.textColor}"></div>
            </div>
            </div>
            `}t.innerHTML=a}else t.style.marginBottom="0",t.style.marginTop="0";for(const d of c){if(r.favThemes.includes(d.name))continue;const u=l===d.name?"active":"";i+=`<div class="theme button ${u}" theme='${d.name}' style="background: ${d.bgColor}; color: ${d.mainColor};outline: 0 solid ${d.mainColor};">
        <div class="favButton"><i class="far fa-star"></i></div>
        <div class="text">${d.name.replace(/_/g," ")}</div>
        <div class="themeBubbles" style="background: ${d.bgColor};outline: 0.25rem solid ${d.bgColor};">
          <div class="themeBubble" style="background: ${d.mainColor}"></div>
          <div class="themeBubble" style="background: ${d.subColor}"></div>
          <div class="themeBubble" style="background: ${d.textColor}"></div>
        </div>
        </div>
        `}s.innerHTML=i}}function nW(e=!1){n(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((t,a)=>{const s=r.customThemeColors[Io.indexOf(n(a).find("input.color").attr("id"))];oi(n(a),s,!1,e)})}function iW(e){if(r.favThemes.includes(e))nm(r.favThemes.filter(t=>t!==e));else{const t=r.favThemes;t.push(e),nm(t)}li()}function rW(){const e=[];for(const t of Io)e.push(n(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"));wr(e),g("Custom theme saved",1)}function Rm(e=!1){const t=n(".pageSettings .section.themes .tabs button[data-tab='preset']"),a=n(".pageSettings .section.themes .tabs button[data-tab='custom']");r.customTheme?(t.removeClass("active"),(!a.hasClass("active")||e)&&(a.addClass("active"),Nr()),Ja(n('.pageSettings [tabContent="preset"]'),n('.pageSettings [tabContent="custom"]'),250)):(a.removeClass("active"),(!t.hasClass("active")||e)&&(t.addClass("active"),Nr()),Ja(n('.pageSettings [tabContent="custom"]'),n('.pageSettings [tabContent="preset"]'),250))}n(".pageSettings .section.themes .tabs button").on("click",e=>{n(".pageSettings .section.themes .tabs button").removeClass("active");const t=n(e.currentTarget);t.addClass("active"),t.attr("data-tab")==="preset"?yo(!1):yo(!0)});n(".pageSettings").on("click"," .section.themes .customTheme.button",e=>{var s,i;if(n(e.target).hasClass("delButton")||n(e.target).hasClass("editButton"))return;const t=n(e.currentTarget).attr("customThemeId")??"",a=(i=(s=$())==null?void 0:s.customThemes)==null?void 0:i.find(l=>l._id===t);if(a===void 0){console.error("Could not find custom theme in snapshot for id ",t);return}wr(a.colors)});n(".pageSettings").on("click",".section.themes .theme .favButton",e=>{const t=n(e.currentTarget).parents(".theme.button").attr("theme");t!==void 0?iW(t):console.error("Could not find the theme attribute attached to the button clicked!")});n(".pageSettings").on("click",".section.themes .theme.button",e=>{const t=n(e.currentTarget).attr("theme");!n(e.target).hasClass("favButton")&&t!==void 0&&yw(t)});n(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input",e=>{const t=n(e.currentTarget).attr("id"),a=n(e.currentTarget).val();oi(n(".colorPicker #"+t).parent(),a,!0)});n(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change",e=>{const t=n(e.currentTarget).attr("id"),a=n(e.currentTarget).val();oi(n(".colorPicker #"+t).parent(),a)});n(".pageSettings .section.themes .tabContainer .customTheme input.input").on("blur",e=>{if(e.target.id==="name")return;const t=n(e.currentTarget).attr("id"),a=n(e.currentTarget).val();oi(n(".colorPicker #"+t).parent(),a)}).on("keypress",function(e){if(e.target.id!=="name"&&e.code==="Enter"){n(this).attr("disabled","disabled");const t=n(e.currentTarget).attr("id"),a=n(e.currentTarget).val();oi(n(".colorPicker #"+t).parent(),a),n(this).removeAttr("disabled")}});n(".pageSettings #loadCustomColorsFromPreset").on("click",async()=>{await Q0(r.theme),Io.forEach(t=>{document.documentElement.style.setProperty(t,"")}),K0();const e=await fs();Io.forEach(t=>{let a;t==="--bg-color"?a=e.bg:t==="--main-color"?a=e.main:t==="--sub-color"?a=e.sub:t==="--sub-alt-color"?a=e.subAlt:t==="--caret-color"?a=e.caret:t==="--text-color"?a=e.text:t==="--error-color"?a=e.error:t==="--error-extra-color"?a=e.errorExtra:t==="--colorful-error-color"?a=e.colorfulError:t==="--colorful-error-extra-color"&&(a=e.colorfulErrorExtra),oi(n(".colorPicker #"+t).parent(),a)})});n(".pageSettings #saveCustomThemeButton").on("click",async()=>{if(rW(),j()){const e={name:"custom",colors:r.customThemeColors};de();const t=await qA(e);Z(),t&&Rm(!0)}else Rm(!0)});Te(e=>{e==="theme"&&ce()==="settings"&&sW()});const lo={mode:"import",value:""};function uC(e,t){lo.mode=e,lo.value="",mc.show({focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{var s,i,l,c;a.querySelector("input").value=lo.value,lo.mode==="export"?((s=a.querySelector("button"))==null||s.classList.add("hidden"),(i=a.querySelector("input"))==null||i.setAttribute("readonly","true")):lo.mode==="import"&&((l=a.querySelector("button"))==null||l.classList.remove("hidden"),(c=a.querySelector("input"))==null||c.removeAttribute("readonly"))}})}const mc=new fe({dialogId:"importExportSettingsModal",setup:async e=>{var t;(t=e.querySelector("input"))==null||t.addEventListener("input",a=>{lo.value=a.target.value}),e==null||e.addEventListener("submit",async a=>{if(a.preventDefault(),lo.mode==="import"){if(lo.value===""){mc.hide();return}try{const s=ri(lo.value,gM.strip());await Qn(pr(s))}catch(s){g("Failed to import settings: incorrect data schema",0),console.error(s),mc.hide();return}g("Settings imported",1),li(),mc.hide()}})}});let lr,cr;const z={};async function lW(){await Wf,z.smoothCaret=new H("smoothCaret",rw,"button"),z.codeUnindentOnBackspace=new H("codeUnindentOnBackspace",lw,"button"),z.difficulty=new H("difficulty",_a,"button"),z.quickRestart=new H("quickRestart",uw,"button"),z.showAverage=new H("showAverage",Xv,"button"),z.keymapMode=new H("keymapMode",na,"button",()=>{var e;(e=z.showLiveWpm)==null||e.updateUI()},()=>{r.keymapMode==="off"?(n(".pageSettings .section[data-config-name='keymapStyle']").addClass("hidden"),n(".pageSettings .section[data-config-name='keymapLayout']").addClass("hidden"),n(".pageSettings .section[data-config-name='keymapLegendStyle']").addClass("hidden"),n(".pageSettings .section[data-config-name='keymapShowTopRow']").addClass("hidden"),n(".pageSettings .section[data-config-name='keymapSize']").addClass("hidden")):(n(".pageSettings .section[data-config-name='keymapStyle']").removeClass("hidden"),n(".pageSettings .section[data-config-name='keymapLayout']").removeClass("hidden"),n(".pageSettings .section[data-config-name='keymapLegendStyle']").removeClass("hidden"),n(".pageSettings .section[data-config-name='keymapShowTopRow']").removeClass("hidden"),n(".pageSettings .section[data-config-name='keymapSize']").removeClass("hidden"))}),z.keymapMatrix=new H("keymapStyle",Sw,"button"),z.keymapLayout=new H("keymapLayout",Qo,"select"),z.keymapLegendStyle=new H("keymapLegendStyle",Cw,"button"),z.keymapShowTopRow=new H("keymapShowTopRow",xw,"button"),z.keymapSize=new H("keymapSize",sl,"range"),z.showKeyTips=new H("showKeyTips",iw,"button",void 0,()=>{r.showKeyTips?n(".pageSettings .tip").removeClass("hidden"):n(".pageSettings .tip").addClass("hidden")}),z.freedomMode=new H("freedomMode",fw,"button",()=>{var e;(e=z.confidenceMode)==null||e.updateUI()}),z.strictSpace=new H("strictSpace",Vv,"button"),z.oppositeShiftMode=new H("oppositeShiftMode",Qv,"button"),z.confidenceMode=new H("confidenceMode",pw,"button",()=>{var e,t;(e=z.freedomMode)==null||e.updateUI(),(t=z.stopOnError)==null||t.updateUI()}),z.indicateTypos=new H("indicateTypos",gw,"button"),z.hideExtraLetters=new H("hideExtraLetters",Jv,"button"),z.blindMode=new H("blindMode",Pv,"button"),z.quickEnd=new H("quickEnd",jv,"button"),z.repeatQuotes=new H("repeatQuotes",Gv,"button"),z.ads=new H("ads",Nv,"button"),z.alwaysShowWordsHistory=new H("alwaysShowWordsHistory",Ov,"button"),z.britishEnglish=new H("britishEnglish",kw,"button"),z.singleListCommandLine=new H("singleListCommandLine",_v,"button"),z.capsLockWarning=new H("capsLockWarning",Hv,"button"),z.flipTestColors=new H("flipTestColors",Uv,"button"),z.showOutOfFocusWarning=new H("showOutOfFocusWarning",Bv,"button"),z.colorfulMode=new H("colorfulMode",Kv,"button"),z.startGraphsAtZero=new H("startGraphsAtZero",cw,"button"),z.autoSwitchTheme=new H("autoSwitchTheme",hw,"button"),z.randomTheme=new H("randomTheme",ww,"button"),z.stopOnError=new H("stopOnError",Af,"button",()=>{var e;(e=z.confidenceMode)==null||e.updateUI()}),z.soundVolume=new H("soundVolume",Ev,"range"),z.playSoundOnError=new H("playSoundOnError",Av,"button",()=>{r.playSoundOnError!=="off"&&Pd()}),z.playSoundOnClick=new H("playSoundOnClick",Mv,"button",()=>{r.playSoundOnClick!=="off"&&Mo("KeyQ")}),z.showAllLines=new H("showAllLines",br,"button"),z.paceCaret=new H("paceCaret",Dv,"button"),z.repeatedPace=new H("repeatedPace",Fv,"button"),z.minWpm=new H("minWpm",Wv,"button"),z.minAcc=new H("minAcc",zv,"button"),z.minBurst=new H("minBurst",Rv,"button"),z.smoothLineScroll=new H("smoothLineScroll",dw,"button"),z.lazyMode=new H("lazyMode",vr,"button"),z.layout=new H("layout",ro,"select"),z.language=new H("language",Us,"select"),z.fontSize=new H("fontSize",Sd,"button"),z.maxLineWidth=new H("maxLineWidth",nl,"button"),z.caretStyle=new H("caretStyle",Zv,"button"),z.paceCaretStyle=new H("paceCaretStyle",Yv,"button"),z.timerStyle=new H("timerStyle",ew,"button"),z.liveSpeedStyle=new H("liveSpeedStyle",tw,"button"),z.liveAccStyle=new H("liveAccStyle",aw,"button"),z.liveBurstStyle=new H("liveBurstStyle",ow,"button"),z.highlightMode=new H("highlightMode",Ko,"button"),z.tapeMode=new H("tapeMode",qf,"button"),z.tapeMargin=new H("tapeMargin",Cd,"button"),z.timerOpacity=new H("timerOpacity",nw,"button"),z.timerColor=new H("timerColor",sw,"button"),z.fontFamily=new H("fontFamily",mw,"button",void 0,()=>{const e=n(".pageSettings .section[data-config-name='fontFamily'] .buttons button[data-config-value='custom']");n(".pageSettings .section[data-config-name='fontFamily'] .buttons .active").length===0?(e.addClass("active"),e.text(`Custom (${r.fontFamily.replace(/_/g," ")})`)):e.text("Custom")}),z.alwaysShowDecimalPlaces=new H("alwaysShowDecimalPlaces",Iv,"button"),z.typingSpeedUnit=new H("typingSpeedUnit",qv,"button"),z.customBackgroundSize=new H("customBackgroundSize",Bf,"button")}function cW(){var e,t;n(".pageSettings .section.themes .favThemes.buttons").empty(),n(".pageSettings .section.themes .allThemes.buttons").empty(),n(".pageSettings .section.themes .allCustomThemes.buttons").empty(),n(".pageSettings .section[data-config-name='funbox'] .buttons").empty(),n(".pageSettings .section[data-config-name='fontFamily'] .buttons").empty();for(const a of document.querySelectorAll(".pageSettings select"))(t=(e=a==null?void 0:a.slim)==null?void 0:e.destroy)==null||t.call(e)}let wh=!1;async function dW(){var E;r.showKeyTips?n(".pageSettings .tip").removeClass("hidden"):n(".pageSettings .tip").addClass("hidden");let e;try{e=await _f()}catch(k){console.error(ae(k,"Failed to initialize settings language picker"))}const t=document.querySelector(".pageSettings .section[data-config-name='language'] select");new nt({select:t,data:kh(e??[],k=>k===r.language),settings:{searchPlaceholder:"search"}});const a=document.querySelector(".pageSettings .section[data-config-name='layout'] select"),s=document.querySelector(".pageSettings .section[data-config-name='keymapLayout'] select");let i='<option value="default">off</option>',l='<option value="overrideSync">emulator sync</option>';for(const k of kd){const M=`<option value="${k}">${k.replace(/_/g," ")}</option>`;k.toString()!=="korean"&&(i+=M),k.toString()!=="default"&&(l+=M)}a.innerHTML=i,s.innerHTML=l,new nt({select:a}),new nt({select:s});let c;try{c=await Rf()}catch(k){console.error(ae(k,"Failed to load themes into dropdown boxes"))}const d=document.querySelector(".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light"),u=document.querySelector(".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark");let m="",f="";if(c)for(const k of c){const M=`<option value="${k.name}" ${k.name===r.themeLight?"selected":""}>${k.name.replace(/_/g," ")}</option>`;m+=M;const q=`<option value="${k.name}" ${k.name===r.themeDark?"selected":""}>${k.name.replace(/_/g," ")}</option>`;f+=q}d.innerHTML=m,u.innerHTML=f,new nt({select:d,events:{afterChange:k=>{var M;bw((M=k[0])==null?void 0:M.value)}}}),new nt({select:u,events:{afterChange:k=>{var M;vw((M=k[0])==null?void 0:M.value)}}});const p=document.querySelector(".pageSettings .section[data-config-name='funbox'] .buttons");p.innerHTML=`<div class="funbox button" data-config-value='none'>none</div>`;let h="";for(const k of yd())k.name==="mirror"?h+=`<div class="funbox button" data-config-value='${k.name}' aria-label="${k.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1);">${k.name.replace(/_/g," ")}</div>`:k.name==="upside_down"?h+=`<div class="funbox button" data-config-value='${k.name}' aria-label="${k.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1) scaleY(-1); z-index:1;">${k.name.replace(/_/g," ")}</div>`:k.name==="underscore_spaces"?h+=`<div class="funbox button" data-config-value='${k.name}' aria-label="${k.description}" data-balloon-pos="up" data-balloon-length="fit">${k.name}</div>`:h+=`<div class="funbox button" data-config-value='${k.name}' aria-label="${k.description}" data-balloon-pos="up" data-balloon-length="fit">${k.name.replace(/_/g," ")}</div>`;p.innerHTML=h;let y=!0;const b=document.querySelector(".pageSettings .section[data-config-name='fontFamily'] .buttons");b.innerHTML="";let v="",C;try{C=await HM()}catch(k){console.error(ae(k,"Failed to update fonts settings buttons"))}if(C){for(const k of C){let M=k.name;M==="Helvetica"&&(M="Comic Sans MS"),(k.systemFont??!1)===!1&&(M+=" Preview");const q=r.fontFamily===k.name?" active":"",W=k.display!==void 0?k.display:k.name;r.fontFamily===k.name&&(y=!1),v+=`<button class="${q}" style="font-family:${M}" data-config-value="${k.name.replace(/ /g,"_")}">${W}</button>`}v+=y?`<button class="no-auto-handle active" data-config-value="custom">Custom (${r.fontFamily.replace(/_/g," ")})</button>`:'<button class="no-auto-handle" data-config-value="custom"">Custom</button>',b.innerHTML=v}if(n(".pageSettings .section[data-config-name='customBackgroundSize'] input").val(r.customBackground),yC(),n(".pageSettings .section[data-config-name='fontSize'] input").val(r.fontSize),n(".pageSettings .section[data-config-name='maxLineWidth'] input").val(r.maxLineWidth),n(".pageSettings .section[data-config-name='keymapSize'] input").val(r.keymapSize),lr===void 0){const k=document.querySelector(".pageSettings .section[data-config-name='customLayoutfluid'] select");lr=new nt({select:k,settings:{keepOrder:!0},events:{afterChange:M=>{const q=M.map(W=>W.value).join("#");q!==r.customLayoutfluid&&Tw(q)}}})}if(cr===void 0){const k=document.querySelector(".pageSettings .section[data-config-name='customPolyglot'] select");cr=new nt({select:k,data:kh(e??[],M=>r.customPolyglot.includes(M)),events:{afterChange:M=>{const q=M.map(W=>W.value);q.toSorted()!==r.customPolyglot.toSorted()&&$w(q)}}})}if(n(".pageSettings .section[data-config-name='tapeMargin'] input").val(r.tapeMargin),Vc(!0),!wh)await lW(),wh=!0;else for(const k of Object.keys(z))(E=z[k])==null||E.updateUI();Vc(!1),await Nr(),await Wf}function mC(){n(".pageSettings .section.needsAccount").addClass("hidden")}function uW(){n(".pageSettings .section.needsAccount").removeClass("hidden"),pC(),gC()}function fC(){n(".pageSettings .section[data-config-name='funbox'] .button").removeClass("active"),n(".pageSettings .section[data-config-name='funbox'] .button").removeClass("disabled"),yd().forEach(e=>{!Cf(Eo(),e.name)&&!r.funbox.split("#").includes(e.name)&&n(`.pageSettings .section[data-config-name='funbox'] .button[data-config-value='${e.name}']`).addClass("disabled")}),r.funbox.split("#").forEach(e=>{n(`.pageSettings .section[data-config-name='funbox'] .button[data-config-value='${e}']`).addClass("active")})}function pC(){var e,t;if(j()&&$()){const a=n(".pageSettings .section.tags .tagsList").empty();(t=(e=$())==null?void 0:e.tags)==null||t.forEach(s=>{a.append(`

      <div class="buttons tag" data-id="${s._id}" data-name="${s.name}" data-display="${s.display}">
        <button class="tagButton ${s.active?"active":""}" active="${s.active}">
          ${s.display}
        </button>
        <button class="clearPbButton" aria-label="clear tags personal bests" data-balloon-pos="left" >
          <i class="fas fa-crown fa-fw"></i>
        </button>
        <button class="editButton" aria-label="rename tag" data-balloon-pos="left" >
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton" aria-label="remove tag"  data-balloon-pos="left" >
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>

      `)}),n(".pageSettings .section.tags").removeClass("hidden")}else n(".pageSettings .section.tags").addClass("hidden")}function gC(){var e,t;if(j()&&$()){const a=n(".pageSettings .section.presets .presetsList").empty();(t=(e=$())==null?void 0:e.presets)==null||t.forEach(s=>{a.append(`
      <div class="buttons preset" data-id="${s._id}" data-name="${s.name}" data-display="${s.display}">
        <button class="presetButton">${s.display}</button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>
      
      `)}),n(".pageSettings .section.presets").removeClass("hidden")}else n(".pageSettings .section.presets").addClass("hidden")}async function Jo(e=!0){var i;if(e)for(const l of Object.keys(z))(i=z[l])==null||i.updateUI();pC(),gC(),fC(),await Ee(0),Rm(!0),nW(!0),n(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val(pt(r.typingSpeedUnit).fromWpm(r.paceCaretCustomSpeed)),n(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val(pt(r.typingSpeedUnit).fromWpm(r.minWpmCustomSpeed)),n(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val(r.minAccCustom),n(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val(pt(r.typingSpeedUnit).fromWpm(r.minBurstCustomSpeed)),r.autoSwitchTheme?n(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").removeClass("hidden"):n(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").addClass("hidden"),r.customBackground!==""?n(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden"):n(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden"),yC(),n(".pageSettings .section[data-config-name='customBackgroundSize'] input").val(r.customBackground),j()?uW():mC(),V0();const t=window.navigator.userAgent.toLowerCase(),a=t.includes("mac")&&!t.includes("firefox")?"cmd":"ctrl",s=r.quickRestart==="esc"?"tab":"esc";n(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (<key>${s}</key> or <key>${a}</key> + <key>shift</key> + <key>p</key>)`),lr!==void 0&&lr.getSelected().join("#")!==r.customLayoutfluid&&lr.setData(mW()),cr!==void 0&&cr.getSelected()!==r.customPolyglot&&cr.setSelected(r.customPolyglot)}function hC(e){const t=n(`.pageSettings .settingsGroup.${e}`);t.stop(!0,!0).slideToggle(250).toggleClass("slideup"),t.hasClass("slideup")?n(`.pageSettings .sectionGroupTitle[group=${e}]`).addClass("rotateIcon"):n(`.pageSettings .sectionGroupTitle[group=${e}]`).removeClass("rotateIcon")}function yC(){const e=n(".pageSettings .section[data-config-name='customBackgroundSize'] button.remove");r.customBackground!==void 0&&r.customBackground.length>0?e.removeClass("hidden"):e.addClass("hidden")}n(".pageSettings .section[data-config-name='paceCaret']").on("focusout","input.customPaceCaretSpeed",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val()),t=pt(r.typingSpeedUnit).toWpm(e);Mf(t)});n(".pageSettings .section[data-config-name='paceCaret']").on("click","button.save",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed").val()),t=pt(r.typingSpeedUnit).toWpm(e);Mf(t)});n(".pageSettings .section[data-config-name='minWpm']").on("focusout","input.customMinWpmSpeed",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val()),t=pt(r.typingSpeedUnit).toWpm(e);Ef(t)});n(".pageSettings .section[data-config-name='minWpm']").on("click","button.save",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed").val()),t=pt(r.typingSpeedUnit).toWpm(e);Ef(t)});n(".pageSettings .section[data-config-name='minAcc']").on("focusout","input.customMinAcc",()=>{Pf(parseInt(n(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val()))});n(".pageSettings .section[data-config-name='minAcc']").on("click","button.save",()=>{Pf(parseInt(n(".pageSettings .section[data-config-name='minAcc'] input.customMinAcc").val()))});n(".pageSettings .section[data-config-name='minBurst']").on("focusout","input.customMinBurst",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val()),t=pt(r.typingSpeedUnit).toWpm(e);If(t)});n(".pageSettings .section[data-config-name='minBurst']").on("click","button.save",()=>{const e=parseInt(n(".pageSettings .section[data-config-name='minBurst'] input.customMinBurst").val()),t=pt(r.typingSpeedUnit).toWpm(e);If(t)});n(".pageSettings .section[data-config-name='funbox']").on("click",".button",e=>{const t=n(e.currentTarget).attr("data-config-value");mP(t),fC()});n(".pageSettings .section.tags").on("click",".tagsList .tag .tagButton",e=>{const t=e.currentTarget,a=n(t).parent(".tag").attr("data-id");dC(a),n(t).toggleClass("active")});n(".pageSettings .section.presets").on("click",".presetsList .preset .presetButton",async e=>{const t=e.currentTarget,a=n(t).parent(".preset").attr("data-id");await aW(a),Jo()});n("#importSettingsButton").on("click",()=>{uC("import")});n("#exportSettingsButton").on("click",()=>{const e=JSON.stringify(r);navigator.clipboard.writeText(e).then(function(){g("JSON Copied to clipboard",0)},function(){uC("export")})});n(".pageSettings .sectionGroupTitle").on("click",e=>{hC(n(e.currentTarget).attr("group"))});n(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton button.save").on("click",()=>{var a;const e=n(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").val(),t=vd.safeParse(e);if(!t.success){g(`Invalid custom background URL (${(a=t.error.issues[0])==null?void 0:a.message})`,0);return}il(e)});n(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton button.remove").on("click",()=>{il("")});n(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").on("keypress",e=>{var t;if(e.key==="Enter"){const a=n(".pageSettings .section[data-config-name='customBackgroundSize'] .inputAndButton input").val(),s=vd.safeParse(a);if(!s.success){g(`Invalid custom background URL (${(t=s.error.issues[0])==null?void 0:t.message})`,0);return}il(a)}});n(".pageSettings .section[data-config-name='fontSize'] .inputAndButton button.save").on("click",()=>{Sd(parseFloat(n(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&Sd(parseFloat(n(".pageSettings .section[data-config-name='fontSize'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='tapeMargin'] .inputAndButton button.save").on("click",()=>{Cd(parseFloat(n(".pageSettings .section[data-config-name='tapeMargin'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='tapeMargin'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&Cd(parseFloat(n(".pageSettings .section[data-config-name='tapeMargin'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton button.save").on("click",()=>{nl(parseFloat(n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton input").on("focusout",()=>{nl(parseFloat(n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&nl(parseFloat(n(".pageSettings .section[data-config-name='maxLineWidth'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton button.save").on("click",()=>{sl(parseFloat(n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("focusout",()=>{sl(parseFloat(n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&sl(parseFloat(n(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&g("Saved",1,{duration:1})});n(".pageSettings .quickNav .links a").on("click",e=>{const t=e.target.innerText;n(`.pageSettings .settingsGroup.${t}`).hasClass("slideup")&&hC(t)});let bC=!1;function Vc(e){bC=e}function kh(e,t){return e.map(a=>({label:a.name,options:a.languages.map(s=>({text:$o(s),value:s,selected:t(s)}))}))}function mW(){const e=r.customLayoutfluid.split("#");return[...e,...kd.filter(t=>!e.includes(t))].map(t=>({text:t.replace(/_/g," "),value:t,selected:e.includes(t)}))}Te((e,t)=>{e==="fullConfigChange"&&Vc(!0),e==="fullConfigChangeFinished"&&Vc(!1),e==="themeLight"?n(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light option[value="${t}"]`).attr("selected","true"):e==="themeDark"&&n(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark option[value="${t}"]`).attr("selected","true"),!(bC||e==="saveToLocalStorage")&&ce()==="settings"&&e!=="theme"&&Jo()});const fW=new Pa({id:"settings",element:n(".page.pageSettings"),path:"/settings",afterHide:async()=>{cW(),Et("pageSettings")},beforeShow:async()=>{Zt("pageSettings","main"),await dW(),await Jo(!1)}});n(async()=>{Ht("pageSettings")});class Oo{constructor(t,a){var i;this.inputElement=t,n(this.inputElement).wrap('<div class="inputAndIndicator"></div>'),this.parentElement=n(this.inputElement).parent(".inputAndIndicator"),this.options=a,this.currentStatus=null;let s='<div class="statusIndicator">';for(const[l,c]of Object.entries(a))s+=`
      <div
        class="indicator level${c.level} hidden"
        data-option-id="${l}"
        
        ${(((i=c.message)==null?void 0:i.length)??0)>27?'data-balloon-length="large"':""}
        data-balloon-pos="left"
        ${c.message??""?`aria-label="${c.message}"`:""}
      >
        <i class="fas fa-fw ${c.icon} ${c.spinIcon?"fa-spin":""}"></i>
      </div>
      `;s+="</div>",this.parentElement.append(s)}hide(){this.parentElement.find(".statusIndicator div").addClass("hidden"),this.currentStatus=null,n(this.inputElement).css("padding-right","0.5em")}show(t,a){this.hide(),this.currentStatus=t;const s=this.parentElement.find(`[data-option-id="${t}"]`);s.removeClass("hidden"),a!==void 0&&a!==""&&(a.length>20?s.attr("data-balloon-length","large"):s.removeAttr("data-balloon-length"),s.attr("aria-label",a)),n(this.inputElement).css("padding-right","2.1em")}get(){return this.currentStatus}}const pW=["gmaill.com","gamil.com","gmali.com","gnail.com","gmil.com","gamail.com","hotmai.com","gmial.com","hotmal.com","yaho.com","outlokk.com","gmil.com","hotmial.com","yahooo.com","otulook.com","gamil.com","hotnail.com","yaoo.com","outlok.com","gmail.cmo","hotmail.cmo","yahho.com","outloook.com","gmaail.com","hottmail.com","yaho.com","outllok.com","gmai.com","hotmil.com","yhaoo.com","outlookk.com","gmil.com","htmial.com","yaahoo.com","otlook.com","gamail.com","hotnail.com","yaoho.com","outlok.com","gemail.com","hotmiall.com","yahhoo.com","outloookk.com","gmal.com","hottmail.com","yahio.com","outlokkk.com",".comm",".con",".cmo",".coom",".cim",".vom","-online.de","-tonline.de","acor.de","aecor.de","ahoo.de","al.com","ao.com","aol.cm","aol.con","aol.ocm","aol.om","aoll.com","apl.com","arco.de","arocr.de","aror.de","feenet.de","freeenet.de","freeent.de","freeet.de","freemet.de","freeneet.de","freent.de","frenet.de","gm.de","gm.net","gm.xde","gmc.de","gmx.ded","gmx.dw","gmxx.de","gmy.de","gx.de","hmx.de","homail.de","hotmai.de","hotmal.de","mx.de","mx.net","@otmail.com","r-online.de","rcor.de","reenet.de","t--online.de","t-0nline.de","t-nline.de","t-oline.de","t-omline.de","t-onine.de","t-onlien.de","t-onliine.de","t-onlin.de","t-onlinde.de","t-onlinr.de","t-onlione.de","t-onlline.de","t-onlne.de","t-onlone.de","t.-online.de","t.online.de","tonline.de","wb.de","we.de","web.ded","web.dw","wed.de","weeb.de","wen.de","wweb.de","yaho.de","yahooo.de","yaoo.de","yhoo.de","yahhoo.de","icoud.com","icloud.cim","icloud.con","icloud.ocm","icloud.om","icloud.cm"];var ye=o.object({message:o.string()}),gW=ye.extend({validationErrors:o.array(o.string())}),En=ye,Ch=En.extend({errorId:o.string(),uid:o.string().optional()});function eu(e){return ye.extend({data:e.nullable()})}function Xt(e){return ye.extend({data:e})}var hW={400:En.describe("Generic client error"),401:En.describe("Authentication required but not provided or invalid"),403:En.describe("Operation not permitted"),422:gW.describe("Request validation failed"),429:En.describe("Rate limit exceeded"),500:Ch.describe("Generic server error"),503:Ch.describe("Endpoint disabled or server is under maintenance")},So=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),tu=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),eo=tu();tu().max(50);var Ia=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var Dp=o.enum(["normal","expert","master"]),xn=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:Dp,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),au=o.object({time:o.record(So.describe("Number of seconds as string"),o.array(xn)),words:o.record(So.describe("Number of words as string"),o.array(xn)),quote:o.record(So,o.array(xn)),custom:o.record(o.literal("custom"),o.array(xn)),zen:o.record(o.literal("zen"),o.array(xn))}),yW=o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]),bW=o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]),vW=o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]),wl=au.keyof(),ou=o.union([So,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})}),wW=o.enum(["off","slow","medium","fast"]),kW=o.enum(["off","esc","tab","enter"]),CW=o.union([o.literal(-3),o.literal(-2),o.literal(-1),o.literal(0),o.literal(1),o.literal(2),o.literal(3)]),SW=o.array(CW),Sh=o.enum(["off","default","block","outline","underline","carrot","banana"]),xW=o.enum(["off","on","max"]),TW=o.enum(["off","below","replace"]),$W=o.enum(["off","bar","text","mini"]),Fu=o.enum(["off","text","mini"]),LW=o.enum(["off","on","fav","light","dark","custom"]),AW=o.enum(["black","sub","text","main"]),MW=o.enum(["0.25","0.5","0.75","1"]),EW=o.enum(["off","word","letter"]),PW=o.enum(["off","static","react","next"]),IW=o.enum(["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]),qW=o.enum(["lowercase","uppercase","blank","dynamic"]),BW=o.enum(["always","layout","never"]),DW=o.number().min(.5).max(3.5).step(.1),FW=o.enum(["manual","on"]),WW=o.enum(["off","1","2","3","4"]),zW=o.enum(["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]),RW=o.number().min(0).max(1),OW=o.enum(["off","average","pb","tagPb","last","custom","daily"]),_W=o.tuple([o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"])]),HW=o.enum(["off","custom"]),jW=o.enum(["off","letter","word","next_word","next_two_words","next_three_words"]),NW=o.enum(["off","letter","word"]),GW=o.number().min(10).max(90),UW=o.enum(["wpm","cpm","wps","cps","wph"]),KW=o.enum(["off","result","on","sellout"]),VW=o.enum(["off","custom"]),QW=o.enum(["off","typing"]),ZW=o.enum(["off","on","keymap"]),YW=o.enum(["cover","contain","max"]),XW=o.tuple([o.number(),o.number(),o.number(),o.number()]),JW=o.string().regex(/^[0-9a-zA-Z_#]+$/),ez=o.array(Ia).min(1),tz=o.enum(["off","1","2","3","4"]),az=o.enum(["off","fixed","flex"]),oz=o.enum(["off","speed","acc","both"]),Wa=o.string().regex(/^#([\da-f]{3}){1,2}$/i),sz=Dp,Fp=o.tuple([Wa,Wa,Wa,Wa,Wa,Wa,Wa,Wa,Wa,Wa]),nz=o.array(tu().max(50)),iz=o.string().max(100).regex(/[\w#]+/),rz=o.number().nonnegative(),lz=o.number().nonnegative(),cz=o.number().nonnegative().max(100),dz=o.number().nonnegative(),uz=o.number().int().nonnegative(),mz=o.number().int().nonnegative(),fz=o.string().max(50).regex(/^[a-zA-Z0-9_\-+.]+$/),Wu=tu().max(50),pz=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),gz=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),hz=o.number().positive(),yz=o.number().min(20).max(1e3).or(o.literal(0)),bz=o.string().url("Needs to be an URI.").regex(/^(https|http):\/\/.*/,"Unsupported protocol.").regex(/^[^`'"]*$/,"May not contain quotes.").regex(/.+(\.png|\.gif|\.jpeg|\.jpg)/gi,"Unsupported image format.").max(2048,"URL is too long.").or(o.literal("")),vz=o.object({theme:Wu,themeLight:Wu,themeDark:Wu,autoSwitchTheme:o.boolean(),customTheme:o.boolean(),customThemeColors:Fp,favThemes:nz,showKeyTips:o.boolean(),smoothCaret:wW,codeUnindentOnBackspace:o.boolean(),quickRestart:kW,punctuation:o.boolean(),numbers:o.boolean(),words:mz,time:uz,mode:wl,quoteLength:SW,language:Ia,fontSize:hz,freedomMode:o.boolean(),difficulty:sz,blindMode:o.boolean(),quickEnd:o.boolean(),caretStyle:Sh,paceCaretStyle:Sh,flipTestColors:o.boolean(),layout:gz,funbox:iz,confidenceMode:xW,indicateTypos:TW,timerStyle:$W,liveSpeedStyle:Fu,liveAccStyle:Fu,liveBurstStyle:Fu,colorfulMode:o.boolean(),randomTheme:LW,timerColor:AW,timerOpacity:MW,stopOnError:EW,showAllLines:o.boolean(),keymapMode:PW,keymapStyle:IW,keymapLegendStyle:qW,keymapLayout:pz,keymapShowTopRow:BW,keymapSize:DW,fontFamily:fz,smoothLineScroll:o.boolean(),alwaysShowDecimalPlaces:o.boolean(),alwaysShowWordsHistory:o.boolean(),singleListCommandLine:FW,capsLockWarning:o.boolean(),playSoundOnError:WW,playSoundOnClick:zW,soundVolume:RW,startGraphsAtZero:o.boolean(),showOutOfFocusWarning:o.boolean(),paceCaret:OW,paceCaretCustomSpeed:rz,repeatedPace:o.boolean(),accountChart:_W,minWpm:HW,minWpmCustomSpeed:lz,highlightMode:jW,tapeMode:NW,tapeMargin:GW,typingSpeedUnit:UW,ads:KW,hideExtraLetters:o.boolean(),strictSpace:o.boolean(),minAcc:VW,minAccCustom:cz,monkey:o.boolean(),repeatQuotes:QW,oppositeShiftMode:ZW,customBackground:bz,customBackgroundSize:YW,customBackgroundFilter:XW,customLayoutfluid:JW,monkeyPowerLevel:tz,minBurst:az,minBurstCustomSpeed:dz,burstHeatmap:o.boolean(),britishEnglish:o.boolean(),lazyMode:o.boolean(),showAverage:oz,maxLineWidth:yz,customPolyglot:ez}).strict();vz.partial();o.enum(["test","behavior","input","sound","caret","appearance","theme","hideElements","ads","hidden"]);var xh={a:["а","à","á","ạ","ą"],c:["с","ƈ","ċ"],d:["ԁ","ɗ"],e:["е","ẹ","ė","ė","é","è"],g:["ġ"],h:["һ"],i:["і","í","ì","ï"],j:["ј","ʝ"],k:["κ"],l:["ӏ","ḷ"],n:["ո"],o:["о","ο","օ","ȯ","ọ","ỏ","ơ","ö","ó","ò"],p:["р"],q:["զ"],s:["ʂ"],u:["υ","ս","ü","ú","ù"],v:["ν","ѵ"],x:["х","ҳ"],y:["у","ý"],z:["ʐ","ż"]};function wz(e){for(let t in xh)xh[t].forEach(a=>{e=e.replace(a,t)});return e}function kz(e,t){let a=e.toLowerCase().split(/[.,"/#!?$%^&*;:{}=\-_`~()\s\n]+/g).map(s=>{var i;return wz((i=Cz(s))!=null?i:"")});return Sz.some(s=>a.some(i=>t==="word"?i.startsWith(s):i.includes(s)))}function Cz(e){return e===void 0||e===""?e:e.replace(/[\u0300-\u036F]/g,"").trim().replace(/\n{3,}/g,`

`).replace(/\s{3,}/g,"  ")}function vC(e,t){return t.refine(a=>!kz(a,e),a=>({message:`Profanity detected. Please remove it. If you believe this is a mistake, please contact us. (${a})`}))}var Sz=["miodec","bitly","niqqa","niqqer","ni99a","ni99er","niggas","niga","niger","retard","ahole","anus","ash0le","asholes","assh0le","assh0lez","asshole","assholes","assholz","asswipe","azzhole","bassterds","bastard","bastards","bastardz","basterds","basterdz","biatch","bitch","bitches","blow job","boffing","butthole","buttwipe","c0ck","c0cks","c0k","carpet muncher","cawk","cawks","clit","cnts","cntz","cock","cockhead","cock-head","cocks","cocksucker","cock-sucker","crap","cum","cunt","cunts","cuntz","dick","dild0","dild0s","dildo","dildos","dilld0","dilld0s","dominatricks","dominatrics","dominatrix","dyke","enema","f u c k","f u c k e r","fag","fag1t","faget","fagg1t","faggit","faggot","fagit","fags","fagz","faigs","flipping the bird","fudge packer","fukah","fuken","fuker","fukin","fukk","fukkah","fukken","fukker","fukkin","g00k","gayboy","gaygirl","gayz","god-damned","h00r","h0ar","h0re","jackoff","japs","jerk-off","jisim","jiss","jizm","jizz","knob","knobs","knobz","kunt","kunts","kuntz","lezzian","lipshits","lipshitz","masochist","masokist","massterbait","masstrbait","masstrbate","masterbaiter","masterbate","masterbates","n1gr","nastt","nigger;","nigur;","niiger;","niigr;","orafis","orgasim;","orgasm","orgasum","oriface","orifice","orifiss","peeenus","peeenusss","peenus","peinus","pen1s","penas","penis","penis-breath","penus","penuus","phuc","phuck","phuk","phuker","phukker","poonani","pr1c","pr1ck","pr1k","puss","pussee","pussy","puuke","puuker","qweers","qweerz","qweir","recktum","rectum","retard","sadist","scank","schlong","semen","sex","sexy","sh!t","sh1t","sh1ter","sh1ts","sh1tter","sh1tz","shit","shits","shitter","shitty","shity","shitz","shyt","shyte","shytty","shyty","skanck","skank","skankee","skankey","skanks","skanky","slut","sluts","slutty","slutz","son-of-a-bitch","turd","va1jina","vag1na","vagiina","vagina","vaj1na","vajina","vullva","vulva","wh00r","wh0re","whore","xrated","b!+ch","bitch","blowjob","clit","arschloch","shit","asshole","b!tch","b17ch","b1tch","bastard","bi+ch","boiolas","buceta","c0ck","cawk","chink","cipa","clits","cum","cunt","dildo","dirsa","ejakulate","fatass","fcuk","fux0r","hoer","hore","jism","kawk","l3itch","l3i+ch","masturbate","masterbat","masterbat3","motherfucker","s.o.b.","mofo","nazi","nigga","nigger","nutsack","phuck","pimpis","pusse","pussy","scrotum","sh!t","shemale","shi+","sh!+","slut","smut","teets","tits","boobs","b00bs","teez","testical","testicle","titt","w00se","jackoff","wank","whoar","whore","dyke","fuck","shit","amcik","andskota","arse","assrammer","ayir","bi7ch","bitch","bollock","breasts","butt-pirate","cabron","cazzo","chraa","chuj","cunt","daygo","dego","dick","dike","dupa","dziwka","ejackulate","ekrem","enculer","fag","fanculo","fanny","feces","felcher","ficken","flikker","foreskin","fotze","futkretzn","gook","guiena","h4x0r","helvete","hoer","honkey","huevon","injun","jizz","kanker","klootzak","kraut","knulle","kuksuger","kurac","kurwa","kusi","kyrpa","lesbo","mamhoon","masturbat","merd","mibun","monkleigh","mouliewop","muie","mulkku","muschi","nazis","nepesaurio","nigger","orospu","paska","perse","picka","pierdol","pillu","pimmel","piss","pizda","poontsee","porn","p0rn","pr0n","preteen","pula","pule","puta","puto","qahbeh","queef","rautenberg","schaffer","scheiss","schlampe","schmuck","sh!t","sharmuta","sharmute","skurwysyn","sphencter","spierdalaj","splooge","suka","b00b","testicle","titt","twat","vittu","wank","wetback","wichser","zabourah"],wC=o.object({_id:eo,name:o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),pb:o.object({no:o.boolean(),yes:o.boolean()}).strict(),difficulty:o.record(Dp,o.boolean()),mode:o.record(wl,o.boolean()),words:o.record(yW.or(o.literal("custom")),o.boolean()),time:o.record(bW.or(o.literal("custom")),o.boolean()),quoteLength:o.record(vW,o.boolean()),punctuation:o.object({on:o.boolean(),off:o.boolean()}).strict(),numbers:o.object({on:o.boolean(),off:o.boolean()}).strict(),date:o.object({last_day:o.boolean(),last_week:o.boolean(),last_month:o.boolean(),last_3months:o.boolean(),all:o.boolean()}).strict(),tags:o.record(o.string(),o.boolean()),language:o.record(Ia,o.boolean()),funbox:o.record(o.string(),o.boolean())}),kC=o.number().int().min(-11).max(12),CC=o.object({lastResultTimestamp:o.number().int().nonnegative(),length:o.number().int().nonnegative(),maxLength:o.number().int().nonnegative(),hourOffset:kC.optional()}).strict(),Wp=o.object({_id:eo,name:o.string(),personalBests:au}).strict();function Bi(e){return vC("word",e).optional().transform(t=>t===null?void 0:t)}var su=o.object({bio:Bi(o.string().max(250)).or(o.literal("")),keyboard:Bi(o.string().max(75)).or(o.literal("")),socialProfiles:o.object({twitter:Bi(o.string().max(20).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),github:Bi(o.string().max(39).regex(/^[0-9a-zA-Z_.-]+$/)).or(o.literal("")),website:Bi(o.string().url().max(200).startsWith("https://")).or(o.literal(""))}).strict().optional()}).strict(),SC=o.string().regex(/^[0-9a-zA-Z_-]+$/).max(16),nu=o.object({_id:eo,name:SC,colors:Fp}).strict(),xz=o.object({startTimestamp:o.number().int().nonnegative(),expirationTimestamp:o.number().int().nonnegative().or(o.literal(-1).describe("lifetime premium"))}),Tz=o.record(Ia,o.record(So.describe("quoteId as string"),o.number().nonnegative())),$z=o.record(wl,o.record(ou,o.record(Ia,o.number().int().nonnegative()))),Lz=o.object({rank:o.number().int().nonnegative().optional(),count:o.number().int().nonnegative()}),Az=o.object({time:o.record(ou,o.record(Ia,Lz.optional()))}),xC=o.object({id:o.number().int().nonnegative(),selected:o.boolean().optional()}).strict(),Mz=o.object({badges:o.array(xC)}).strict(),Ez=o.boolean().describe("Admin for all languages if true").or(Ia.describe("Admin for the given language")),TC=o.object({testsByDays:o.array(o.number().int().nonnegative().or(o.null())).describe("Number of tests by day. Last element of the array is on the date `lastDay`. `null` means no tests on that day."),lastDay:o.number().int().nonnegative().describe("Timestamp of the last day included in the test activity")}).strict(),Pz=o.record(So.describe("year"),o.array(o.number().int().nonnegative().nullable().describe("number of tests, position in the array is the day of the year"))),$C=o.record(Ia,o.array(So)),iu=o.object({name:o.string(),email:o.string().email(),uid:o.string(),addedAt:o.number().int().nonnegative(),personalBests:au,lastReultHashes:o.array(o.string()).optional(),completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().nonnegative().optional().describe("time typing in seconds"),streak:CC.optional(),xp:o.number().int().nonnegative().optional(),discordId:o.string().optional(),discordAvatar:o.string().optional(),tags:o.array(Wp).optional(),profileDetails:su.optional(),customThemes:o.array(nu).optional(),premium:xz.optional(),isPremium:o.boolean().optional(),quoteRatings:Tz.optional(),favoriteQuotes:$C.optional(),lbMemory:$z.optional(),allTimeLbs:Az,inventory:Mz.optional(),banned:o.boolean().optional(),lbOptOut:o.boolean().optional(),verified:o.boolean().optional(),needsToChangeName:o.boolean().optional(),quoteMod:Ez.optional(),resultFilterPresets:o.array(wC).optional(),testActivity:TC.optional()}),LC=o.string().regex(/^[0-9a-zA-Z_.-]+$/).max(16),Iz=o.object({completedTests:o.number().int().nonnegative().optional(),startedTests:o.number().int().nonnegative().optional(),timeTyping:o.number().int().nonnegative().optional()}),qz=iu.pick({uid:!0,name:!0,banned:!0,addedAt:!0,discordId:!0,discordAvatar:!0,xp:!0,lbOptOut:!0,isPremium:!0,inventory:!0,allTimeLbs:!0}).extend({typingStats:Iz,personalBests:au.pick({time:!0,words:!0}),streak:o.number().int().nonnegative(),maxStreak:o.number().int().nonnegative(),details:su}).partial({inventory:!0,details:!0,allTimeLbs:!0,uid:!0}),AC=o.enum(["xp","badge"]),Bz=o.object({type:o.literal(AC.enum.xp),item:o.number().int()}),Dz=o.object({type:o.literal(AC.enum.badge),item:xC}),Fz=Bz.or(Dz),Wz=o.object({id:eo,subject:o.string(),body:o.string(),timestamp:o.number().int().nonnegative(),read:o.boolean(),rewards:o.array(Fz)}),zz=o.enum(["Inappropriate name","Inappropriate bio","Inappropriate social links","Suspected cheating"]),si=o.string().email(),Rz=Xt(iu.extend({inboxUnreadSize:o.number().int().nonnegative()})),hi=vC("substring",o.string().min(1).max(16).regex(/^[\da-zA-Z_-]+$/,"Can only contain lower/uppercase letters, underscore and minus.")),Oz=o.object({email:si.optional(),name:hi,uid:o.string().optional(),captcha:o.string()}),_z=o.object({name:hi}),Hz=o.object({name:hi}),jz=o.object({mode:wl,mode2:ou,language:Ia,rank:o.number().int().nonnegative()}),Nz=o.object({newEmail:si,previousEmail:si}),Gz=o.object({newPassword:o.string().min(6)}),Uz=o.object({mode:wl,mode2:ou.optional()}),Kz=eu(xn),Vz=wC,Qz=Xt(eo.describe("Id of the created result filter preset")),Zz=o.object({presetId:eo}),Yz=Xt(o.array(Wp)),Xz=o.object({tagName:LC}),Jz=Xt(Wp),eR=o.object({tagId:eo,newName:LC}),Th=o.object({tagId:eo}),tR=Xt(o.array(nu)),aR=o.object({name:SC,colors:Fp}),oR=Xt(nu.pick({_id:!0,name:!0})),sR=o.object({themeId:eo}),nR=o.object({themeId:eo,theme:nu.pick({name:!0,colors:!0})}),iR=Xt(o.object({url:o.string().url()})),rR=o.object({tokenType:o.string(),accessToken:o.string(),state:o.string().length(20)}),lR=Xt(iu.pick({discordId:!0,discordAvatar:!0})),cR=Xt(iu.pick({completedTests:!0,startedTests:!0,timeTyping:!0})),dR=o.object({hourOffset:kC}),uR=Xt($C),mR=o.object({language:Ia,quoteId:So}),fR=o.object({language:Ia,quoteId:So}),pR=o.object({uidOrName:o.string()}),gR=o.object({isUid:o.string().length(0).transform(e=>e==="").or(o.boolean()).default(!1)}),hR=Xt(qz),yR=su.extend({selectedBadgeId:o.number().int().nonnegative().optional().or(o.literal(-1).describe("no badge selected"))}),bR=Xt(su),vR=Xt(o.object({inbox:o.array(Wz),maxMail:o.number().int()})),wR=o.object({mailIdsToDelete:o.array(o.string().uuid()).min(1).optional(),mailIdsToMarkRead:o.array(o.string().uuid()).min(1).optional()}),kR=o.object({uid:o.string(),reason:zz,comment:o.string().regex(/^([.]|[^/<>])+$/).max(250).optional().or(o.string().length(0)),captcha:o.string()}),CR=o.object({captcha:o.string(),email:si}),SR=eu(Pz),xR=eu(TC),TR=eu(CC),za=xt();za.router({get:{summary:"get user",description:"Get a user's data.",method:"GET",path:"",responses:{200:Rz},metadata:{rateLimit:"userGet"}},create:{summary:"create user",description:"Creates a new user",method:"POST",path:"/signup",body:Oz.strict(),responses:{200:ye},metadata:{rateLimit:"userSignup",requireConfiguration:{path:"users.signUp",invalidMessage:"Sign up is temporarily disabled"}}},getNameAvailability:{summary:"check name",description:"Checks to see if a username is available",method:"GET",path:"/checkName/:name",pathParams:_z.strict(),responses:{200:ye.describe("Name is available"),409:ye.describe("Name is not available")},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userCheckName"}},delete:{summary:"delete user",description:"Deletes a user's account",method:"DELETE",path:"",body:za.noBody(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userDelete"}},reset:{summary:"reset user",description:"Completely resets a user's account to a blank state",method:"PATCH",path:"/reset",body:za.noBody(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userReset"}},updateName:{summary:"update username",description:"Updates a user's name",method:"PATCH",path:"/name",body:Hz.strict(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateName"}},updateLeaderboardMemory:{summary:"update lbMemory",description:"Updates a user's cached leaderboard state",method:"PATCH",path:"/leaderboardMemory",body:jz.strict(),responses:{200:ye},metadata:{rateLimit:"userUpdateLBMemory"}},updateEmail:{summary:"update email",description:"Updates a user's email",method:"PATCH",path:"/email",body:Nz.strict(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateEmail"}},updatePassword:{summary:"update password",description:"Updates a user's email",method:"PATCH",path:"/password",body:Gz.strict(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userUpdateEmail"}},getPersonalBests:{summary:"get personal bests",description:"Get user's personal bests",method:"GET",path:"/personalBests",query:Uz.strict(),responses:{200:Kz},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userGet"}},deletePersonalBests:{summary:"delete personal bests",description:"Deletes a user's personal bests",method:"DELETE",path:"/personalBests",body:za.noBody(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userClearPB"}},optOutOfLeaderboards:{summary:"leaderboards opt out",description:"Opt out of the leaderboards",method:"POST",path:"/optOutOfLeaderboards",body:za.noBody(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0},rateLimit:"userOptOutOfLeaderboards"}},addResultFilterPreset:{summary:"add result filter preset",description:"Add a result filter preset",method:"POST",path:"/resultFilterPresets",body:Vz.strict(),responses:{200:Qz},metadata:{rateLimit:"userCustomFilterAdd",requireConfiguration:{path:"results.filterPresets.enabled",invalidMessage:"Result filter presets are not available at this time."}}},removeResultFilterPreset:{summary:"remove result filter preset",description:"Remove a result filter preset",method:"DELETE",path:"/resultFilterPresets/:presetId",pathParams:Zz.strict(),body:za.noBody(),responses:{200:ye},metadata:{rateLimit:"userCustomFilterRemove",requireConfiguration:{path:"results.filterPresets.enabled",invalidMessage:"Result filter presets are not available at this time."}}},getTags:{summary:"get tags",description:"Get the users tags",method:"GET",path:"/tags",responses:{200:Yz},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userTagsGet"}},createTag:{summary:"add tag",description:"Add a tag for the current user",method:"POST",path:"/tags",body:Xz.strict(),responses:{200:Jz},metadata:{rateLimit:"userTagsAdd"}},editTag:{summary:"edit tag",description:"Edit a tag",method:"PATCH",path:"/tags",body:eR.strict(),responses:{200:ye},metadata:{rateLimit:"userTagsEdit"}},deleteTag:{summary:"delete tag",description:"Delete a tag",method:"DELETE",path:"/tags/:tagId",pathParams:Th.strict(),body:za.noBody(),responses:{200:ye},metadata:{rateLimit:"userTagsRemove"}},deleteTagPersonalBest:{summary:"delete tag PBs",description:"Delete personal bests of a tag",method:"DELETE",path:"/tags/:tagId/personalBest",pathParams:Th.strict(),body:za.noBody(),responses:{200:ye},metadata:{rateLimit:"userTagsClearPB"}},getCustomThemes:{summary:"get custom themes",description:"Get custom themes for the current user",method:"GET",path:"/customThemes",responses:{200:tR},metadata:{rateLimit:"userCustomThemeGet"}},addCustomTheme:{summary:"add custom themes",description:"Add a custom theme for the current user",method:"POST",path:"/customThemes",body:aR.strict(),responses:{200:oR},metadata:{rateLimit:"userCustomThemeAdd"}},deleteCustomTheme:{summary:"delete custom themes",description:"Delete a custom theme",method:"DELETE",path:"/customThemes",body:sR.strict(),responses:{200:ye},metadata:{rateLimit:"userCustomThemeRemove"}},editCustomTheme:{summary:"edit custom themes",description:"Edit a custom theme",method:"PATCH",path:"/customThemes",body:nR.strict(),responses:{200:ye},metadata:{rateLimit:"userCustomThemeEdit"}},getDiscordOAuth:{summary:"discord oauth",description:"Start OAuth authentication with discord",method:"GET",path:"/discord/oauth",responses:{200:iR},metadata:{rateLimit:"userDiscordLink",requireConfiguration:{path:"users.discordIntegration.enabled",invalidMessage:"Discord integration is not available at this time"}}},linkDiscord:{summary:"link with discord",description:"Links a user's account with a discord account",method:"POST",path:"/discord/link",body:rR.strict(),responses:{200:lR},metadata:{rateLimit:"userDiscordLink",requireConfiguration:{path:"users.discordIntegration.enabled",invalidMessage:"Discord integration is not available at this time"}}},unlinkDiscord:{summary:"unlink discord",description:"Unlinks a user's account with a discord account",method:"POST",path:"/discord/unlink",body:za.noBody(),responses:{200:ye},metadata:{rateLimit:"userDiscordUnlink"}},getStats:{summary:"get stats",description:"Gets a user's typing stats data",method:"GET",path:"/stats",responses:{200:cR},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userGet"}},setStreakHourOffset:{summary:"set streak hour offset",description:"Sets a user's streak hour offset",method:"POST",path:"/setStreakHourOffset",body:dR.strict(),responses:{200:ye},metadata:{rateLimit:"setStreakHourOffset"}},getFavoriteQuotes:{summary:"get favorite quotes",description:"Gets a user's favorite quotes",method:"GET",path:"/favoriteQuotes",responses:{200:uR},metadata:{rateLimit:"quoteFavoriteGet"}},addQuoteToFavorites:{summary:"add favorite quotes",description:"Add a quote to the user's favorite quotes",method:"POST",path:"/favoriteQuotes",body:mR.strict(),responses:{200:ye},metadata:{rateLimit:"quoteFavoritePost"}},removeQuoteFromFavorites:{summary:"remove favorite quotes",description:"Remove a quote to the user's favorite quotes",method:"DELETE",path:"/favoriteQuotes",body:fR.strict(),responses:{200:ye},metadata:{rateLimit:"quoteFavoriteDelete"}},getProfile:{summary:"get profile",description:"Gets a user's profile",method:"GET",path:"/:uidOrName/profile",pathParams:pR.strict(),query:gR.strict(),responses:{200:hR,404:En.describe("User not found")},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userProfileGet",requireConfiguration:{path:"users.profiles.enabled",invalidMessage:"Profiles are not available at this time"}}},updateProfile:{summary:"update profile",description:"Update a user's profile",method:"PATCH",path:"/profile",body:yR.strict(),responses:{200:bR},metadata:{rateLimit:"userProfileUpdate",requireConfiguration:{path:"users.profiles.enabled",invalidMessage:"Profiles are not available at this time"}}},getInbox:{summary:"get inbox",description:"Gets the user's inbox",method:"GET",path:"/inbox",responses:{200:vR},metadata:{rateLimit:"userMailGet",requireConfiguration:{path:"users.inbox.enabled",invalidMessage:"Your inbox is not available at this time."}}},updateInbox:{summary:"update inbox",description:"Updates the user's inbox",method:"PATCH",body:wR.strict(),path:"/inbox",responses:{200:ye},metadata:{rateLimit:"userMailUpdate",requireConfiguration:{path:"users.inbox.enabled",invalidMessage:"Your inbox is not available at this time."}}},report:{summary:"report user",description:"Report a user",method:"POST",path:"/report",body:kR.strict(),responses:{200:ye},metadata:{rateLimit:"quoteReportSubmit",requirePermission:"canReport",requireConfiguration:{path:"quotes.reporting.enabled",invalidMessage:"User reporting is unavailable."}}},verificationEmail:{summary:"send verification email",description:"Send a verification email",method:"GET",path:"/verificationEmail",responses:{200:ye},metadata:{authenticationOptions:{noCache:!0},rateLimit:"userRequestVerificationEmail"}},forgotPasswordEmail:{summary:"send forgot password email",description:"Send a forgot password email",method:"POST",path:"/forgotPasswordEmail",body:CR.strict(),responses:{200:ye},metadata:{authenticationOptions:{isPublic:!0},rateLimit:"userForgotPasswordEmail"}},revokeAllTokens:{summary:"revoke all tokens",description:"Revoke all tokens for the current user.",method:"POST",path:"/revokeAllTokens",body:za.noBody(),responses:{200:ye},metadata:{authenticationOptions:{requireFreshToken:!0,noCache:!0},rateLimit:"userRevokeAllTokens"}},getTestActivity:{summary:"get test activity",description:"Get user's test activity",method:"GET",path:"/testActivity",responses:{200:SR},metadata:{rateLimit:"userTestActivity"}},getCurrentTestActivity:{summary:"get current test activity",description:"Get test activity for the last up to 372 days for the current user ",method:"GET",path:"/currentTestActivity",responses:{200:xR},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userCurrentTestActivity"}},getStreak:{summary:"get streak",description:"Get user's streak data",method:"GET",path:"/streak",responses:{200:TR},metadata:{authenticationOptions:{acceptApeKeys:!0},rateLimit:"userStreak"}}},{pathPrefix:"/users",strictStatusCodes:!0,metadata:{openApiTags:"users"},commonResponses:hW});function zp(){n(".page.pageLogin .register.side button").prop("disabled",!1)}function kl(){n(".page.pageLogin .register.side button").prop("disabled",!0)}function Rt(){n(".pageLogin input").prop("disabled",!1),n(".pageLogin button").prop("disabled",!1)}function Rp(){n(".pageLogin input").prop("disabled",!0),n(".pageLogin button").prop("disabled",!0)}function Op(){n(".pageLogin .preloader").removeClass("hidden")}function Wt(){n(".pageLogin .preloader").addClass("hidden")}const At=()=>{co.get()!=="available"||Qa.get()!=="valid"&&Qa.get()!=="typo"&&Qa.get()!=="edu"||ni.get()!=="match"||es.get()!=="good"||ii.get()!=="match"?kl():zp()},$R=Pt(1e3,async()=>{var s;const e=n(".page.pageLogin .register.side .usernameInput").val();if(!e){At();return}const t=hi.safeParse(e);if(!t.success){co.show("unavailable",(s=t.error.errors[0])==null?void 0:s.message),At();return}const a=await F.users.getNameAvailability({params:{name:e}});a.status===200?co.show("available",a.body.message):a.status===422?co.show("unavailable",a.body.message):a.status===409?co.show("taken",a.body.message):(co.show("unavailable",a.body.message),g("Failed to check name availability: "+a.body.message,-1)),At()}),LR=()=>{const e=n(".page.pageLogin .register.side .emailInput").val(),t=/@.*(student|education|school|\.edu$|\.edu\.|\.ac\.|\.sch\.)/i,a=pW.some(s=>e.endsWith(s));o.string().email().safeParse(e).success?a?Qa.show("typo","Please check your email address, it may contain a typo."):t.test(e)?Qa.show("edu","Some education emails will fail to receive our messages, or disable the account as soon as you graduate. Consider using a personal email address."):Qa.show("valid"):Qa.show("invalid","Please enter a valid email address."),At()},MC=()=>{const e=n(".page.pageLogin .register.side .emailInput").val(),t=n(".page.pageLogin .register.side .verifyEmailInput").val();e===t?ni.show("match"):ni.show("mismatch"),At()},EC=()=>{const e=n(".page.pageLogin .register.side .passwordInput").val();ef(e)?es.show("good","Password is good"):e.length<8?es.show("short","Password must be at least 8 characters"):e.length>64?es.show("long","Password must be at most 64 characters"):es.show("weak","Password must contain at least one capital letter, number, and special character"),At()},PC=()=>{const e=n(".page.pageLogin .register.side .passwordInput").val(),t=n(".page.pageLogin .register.side .verifyPasswordInput").val();e===t?ii.show("match"):ii.show("mismatch"),At()},co=new Oo(n(".page.pageLogin .register.side input.usernameInput"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},taken:{icon:"fa-user",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),Qa=new Oo(n(".page.pageLogin .register.side input.emailInput"),{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},typo:{icon:"fa-exclamation-triangle",level:1},edu:{icon:"fa-exclamation-triangle",level:1}}),ni=new Oo(n(".page.pageLogin .register.side input.verifyEmailInput"),{match:{icon:"fa-check",level:1},mismatch:{icon:"fa-times",level:-1}}),es=new Oo(n(".page.pageLogin .register.side input.passwordInput"),{good:{icon:"fa-check",level:1},short:{icon:"fa-times",level:-1},long:{icon:"fa-times",level:-1},weak:{icon:"fa-times",level:-1}}),ii=new Oo(n(".page.pageLogin .register.side input.verifyPasswordInput"),{match:{icon:"fa-check",level:1},mismatch:{icon:"fa-times",level:-1}});n(".page.pageLogin .register.side .usernameInput").on("input",()=>{setTimeout(()=>{if(n(".page.pageLogin .register.side .usernameInput").val()===""){co.hide();return}else co.show("checking"),$R()},1)});n(".page.pageLogin .register.side .emailInput").on("input",()=>{const e=n(".page.pageLogin .register.side .emailInput").val(),t=n(".page.pageLogin .register.side .verifyEmailInput").val();if(!e&&!t){Qa.hide(),ni.hide();return}LR(),MC()});n(".page.pageLogin .register.side .verifyEmailInput").on("input",()=>{const e=n(".page.pageLogin .register.side .emailInput").val(),t=n(".page.pageLogin .register.side .verifyEmailInput").val();if(!e&&!t){Qa.hide(),ni.hide();return}MC()});n(".page.pageLogin .register.side .passwordInput").on("input",()=>{const e=n(".page.pageLogin .register.side .passwordInput").val(),t=n(".page.pageLogin .register.side .verifyPasswordInput").val();if(!e&&!t){es.hide(),ii.hide();return}EC(),PC()});n(".page.pageLogin .register.side .verifyPasswordInput").on("input",()=>{const e=n(".page.pageLogin .register.side .passwordInput").val(),t=n(".page.pageLogin .register.side .verifyPasswordInput").val();if(!e&&!t){es.hide(),ii.hide();return}EC(),PC()});const AR=new Pa({id:"login",element:n(".page.pageLogin"),path:"/login",afterHide:async()=>{n(".pageLogin input").val(""),co.hide(),Qa.hide(),ni.hide(),es.hide(),ii.hide(),Et("pageLogin")},beforeShow:async()=>{Zt("pageLogin","main"),Rt(),kl()}});n(()=>{Ht("pageLogin")});let{promise:IC,resolve:Om}=an();async function MR(){await qC.show({mode:"dialog",beforeAnimation:async e=>{({promise:IC,resolve:Om}=an()),Bo("register"),gi(e.querySelector(".g-recaptcha"),"register",t=>{Om(t),_m()})}})}function _m(e=!1){e&&Om(void 0),qC.hide()}const qC=new fe({dialogId:"registerCaptchaModal",customEscapeHandler:async()=>{_m(!0)},customWrapperClickHandler:async()=>{_m(!0)}});async function ER(e){const t=ka;if(t===null)return;Kq(e);const a=await F.results.add({body:{result:t}});if(a.status!==200){g("Failed to save last result: "+a.body.message,-1);return}const s=Ma(t);s._id=a.body.data.insertedId,a.body.data.isPb&&(s.isPb=!0),mb(s),fb(1,s.testDuration+s.incompleteTestSeconds-s.afkDuration),Pk(),g(`Last test result saved ${a.body.data.isPb?"(new pb!)":""}`,1)}function PR(){Gr.getModal().querySelector(".result").innerHTML=`
  <div class="group wpm">
        <div class="sub">wpm</div>
        <div class="val">-</div>
      </div>
      <div class="group acc">
        <div class="sub">accuracy</div>
        <div class="val">-</div>
      </div>
      <div class="group raw">
        <div class="sub">raw</div>
        <div class="val">-</div>
      </div>
      <div class="group con">
        <div class="sub">consistency</div>
        <div class="val">-</div>
      </div>
      <div class="group chardata">
        <div class="sub">characters</div>
        <div class="val">-</div>
      </div>
      <div class="group testType">
        <div class="sub">test type</div>
        <div class="val">-</div>
      </div>`}function IR(){const e=ka;vn("wpm",e.wpm),vn("acc",e.acc+"%"),vn("raw",e.rawWpm),vn("con",e.consistency+"%"),vn("chardata",e.charStats.join("/"));let t=e.mode+" "+e.mode2;t+="<br>"+e.language,e.numbers&&(t+="<br>numbers"),e.punctuation&&(t+="<br>punctuation"),e.blindMode&&(t+="<br>blind"),e.lazyMode&&(t+="<br>lazy"),e.funbox!=="none"&&(t+="<br>"+e.funbox.replace(/_/g," ").replace(/#/g,", ")),e.difficulty!=="normal"&&(t+="<br>"+e.difficulty),e.tags.length>0&&(t+="<br>"+e.tags.length+" tags"),vn("testType",t,!0)}function vn(e,t,a=!1){a?n(Gr.getModal()).find(`.group.${e} .val`).html(`${t}`):n(Gr.getModal()).find(`.group.${e} .val`).text(t)}function qR(){if(!ka){g("Failed to show last signed out result modal: no last result",-1);return}PR(),Gr.show({beforeAnimation:async()=>{IR()}})}function $h(){Gr.hide()}const Gr=new fe({dialogId:"lastSignedOutResult",setup:async e=>{var t,a;(t=e.querySelector("button.save"))==null||t.addEventListener("click",async s=>{var i,l;ER((l=(i=xe)==null?void 0:i.currentUser)==null?void 0:l.uid),$h()}),(a=e.querySelector("button.discard"))==null||a.addEventListener("click",s=>{Pk(),g("Last test result discarded",0),$h()})},customWrapperClickHandler:()=>{}});async function BR(e){if(!e)return;const t=new URLSearchParams(e.slice(1));if(t.has("access_token")){history.replaceState(null,"","/");const a=t.get("access_token"),s=t.get("token_type"),i=t.get("state");de();const l=await F.users.linkDiscord({body:{tokenType:s,accessToken:a,state:i}});if(Z(),l.status!==200){g("Failed to link Discord: "+l.body.message,-1);return}if(l.body.data===null){g("Failed to link Discord: data returned was null",-1);return}g(l.body.message,1);const c=$();if(!c)return;const{discordId:d,discordAvatar:u}=l.body.data;d!==void 0?c.discordId=d:c.discordAvatar=u,gt(c),$c(d,u)}}const DR=o.object({c:Tf,i:o.string().optional(),s:Sf.optional(),f:xf.optional()});function FR(e){const t=tf("customTheme",e);if(t===null)return;let a;try{a=ri(atob(t),DR)}catch(m){console.log("Custom theme URL decoding failed",m),g("Failed to load theme from URL: "+m.message,0);return}let s,i,l,c;if(Array.isArray(a.c)&&a.c.length===10?(s=a.c,i=a.i,l=a.s,c=a.f):Array.isArray(a)&&a.length===10&&(s=a),s===void 0||s.length!==10){g("Failed to load theme from URL: no colors found",0);return}const d=r.customTheme,u=r.customThemeColors;try{wr(s),g("Custom theme applied",1),i!==void 0&&l!==void 0&&c!==void 0&&(il(i),Bf(l),Df(c)),r.customTheme||yo(!0)}catch(m){g("Something went wrong. Reverting to previous state.",0),console.error(m),yo(d),wr(u)}}const WR=o.tuple([Tv.nullable(),bM.nullable(),Gw.partial({pipeDelimiter:!0,limit:!0,mode:!0}).extend({isTimeRandom:o.boolean().optional(),isWordRandom:o.boolean().optional(),word:o.number().int().optional(),time:o.number().int().optional(),delimiter:o.string().optional()}).nullable(),o.boolean().nullable(),o.boolean().nullable(),o.string().nullable(),xv.nullable(),o.string().nullable()]);function zR(e){const t=tf("testSettings",e);if(t===null)return;let a;try{const c=ES.decompressFromURI(t)??"";a=ri(c,WR)}catch(c){console.error("Failed to parse test settings:",c),g("Failed to load test settings from URL: "+c.message,0);return}const s={};a[0]!==null&&(dt(a[0],!0),s.mode=a[0]);const i=a[0]??r.mode;if(a[1]!==null&&(i==="time"?Ga(parseInt(a[1],10),!0):i==="words"?ns(parseInt(a[1],10),!0):i==="quote"&&(ho(-2,!1),bf(parseInt(a[1],10)),be()),s.mode2=a[1]),a[2]!==null){const c=a[2];Lo(c.text),c.limit!==void 0?(xa(c.limit.mode),Ua(c.limit.value)):(c.isWordRandom?xa("word"):c.isTimeRandom&&xa("time"),c.word!==void 0?Ua(c.word):c.time!==void 0&&Ua(c.time)),c.pipeDelimiter?Vs(c.pipeDelimiter):c.delimiter==="|"&&Vs(!0),Zn(c.mode??"repeat"),s["custom text settings"]=""}a[3]!==null&&(Ea(a[3],!0),s.punctuation=a[3]?"on":"off"),a[4]!==null&&(ma(a[4],!0),s.numbers=a[4]?"on":"off"),a[5]!==null&&(Us(a[5],!0),s.language=a[5]),a[6]!==null&&(_a(a[6],!0),s.difficulty=a[6]),a[7]!==null&&(fo(a[7],!0),s.funbox=a[7]),le({nosave:!0});let l="";Object.keys(s).forEach(c=>{const d=s[c];d!==void 0&&(l+=`${c}${Gt(d?": "+d:"")}<br>`)}),l!==""&&g("Settings applied from URL:<br><br>"+l,1,{duration:10,allowHTML:!0})}function RR(e){const t=(tf("challenge",e)??"").toLowerCase();t!==""&&(g("Loading challenge",0),uI(t).then(a=>{a&&(g("Challenge loaded",1),le({nosave:!0}))}).catch(a=>{g("Failed to load challenge",-1),console.error(a)}))}let Aa=[],BC=0,po=[],Rs=[];const ss={notifications:[],psas:[]};function zu(){DC(!1),WC.hide({afterAnimation:async()=>{var c;n("#alertsPopup .notificationHistory .list").empty(),n("#alertsPopup .psas .list").empty();const e=[];let t=0;if(po.length===0&&Rs.length===0)return;const a=await F.users.updateInbox({body:{mailIdsToMarkRead:po.length>0?po:void 0,mailIdsToDelete:Rs.length>0?Rs:void 0}}),s=a.status,i=a.body.message;if(s!==200){g(`Failed to update inbox: ${i}`,-1);return}const l=Aa.filter(d=>d.rewards.length>0&&po.includes(d.id)).map(d=>d.rewards).reduce(function(d,u){return d.concat(u)},[]);for(const d of l)if(d.type==="xp")t+=d.item;else if(d.type==="badge"){const u=VD(d.item.id);u&&(e.push(u.name),HA(d.item))}if(e.length>0&&g(`New badge${e.length>1?"s":""} unlocked: ${e.join(", ")}`,1,{duration:5,customTitle:"Reward",customIcon:"gift"}),t>0){const d=((c=$())==null?void 0:c.xp)??0;vb(d,t),jk(d+t),pb(t)}}})}async function OR(){WC.show({beforeAnimation:async()=>{j()?(n("#alertsPopup .accountAlerts").removeClass("hidden"),n("#alertsPopup .separator.accountSeparator").removeClass("hidden"),n("#alertsPopup .accountAlerts .list").html(`
          <div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`)):(n("#alertsPopup .accountAlerts").addClass("hidden"),n("#alertsPopup .separator.accountSeparator").addClass("hidden")),Aa=[],Rs=[],po=[],NR(),jR()},afterAnimation:async()=>{j()&&_R()}})}async function _R(){if(!Xe()){n("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    You are offline
    </div>
    `);return}const e=await F.users.getInbox();if(e.status===503){n("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Account inboxes are temporarily unavailable
    </div>
    `);return}else if(e.status!==200){n("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Error getting inbox: ${e.body.message} Please try again later
    </div>
    `);return}const t=e.body.data;if(Aa=t.inbox,_p(),Aa.length===0){n("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `);return}BC=t.maxMail,FC(),n("#alertsPopup .accountAlerts .list").empty();for(const a of Aa){!a.read&&a.rewards.length===0&&po.push(a.id);let s="";a.rewards.length>0&&!a.read&&(s=`<div class="rewards">
        <i class="fas fa-fw fa-gift"></i>
        <span>${a.rewards.length}</span>
      </div>`),n("#alertsPopup .accountAlerts .list").append(`
    
      <div class="item" data-id="${a.id}">
        <div class="indicator ${a.read?"":"main"}"></div>
        <div class="timestamp">${Cy(new Date(a.timestamp))} ago</div>
        <div class="title">${a.subject}</div>
        <div class="body">
          ${a.body}

${s}
        </div>
        <div class="buttons">
          ${a.rewards.length>0&&!a.read?'<button class="markReadAlert textButton" aria-label="Claim" data-balloon-pos="left"><i class="fas fa-gift"></i></button>':""}
          ${a.rewards.length>0&&a.read||a.rewards.length===0?'<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>':""}
        </div>
      </div>
    
    `)}}function HR(e,t){ss.psas.push({message:e,level:t})}function jR(){if(ss.psas.length===0)n("#alertsPopup .psas .list").html('<div class="nothing">Nothing to show</div>');else{n("#alertsPopup .psas .list").empty();for(const e of ss.psas){const{message:t,level:a}=e;let s="";a===-1?s="error":a===1?s="main":a===0&&(s="sub"),n("#alertsPopup .psas .list").prepend(`
        <div class="item">
        <div class="indicator ${s}"></div>
        <div class="body">
          ${Gt(t)}
        </div>
      </div>
      `)}}}function NR(){if(ss.notifications.length===0)n("#alertsPopup .notificationHistory .list").html('<div class="nothing">Nothing to show</div>');else{n("#alertsPopup .notificationHistory .list").empty();for(const e of ss.notifications){const{message:t,level:a,customTitle:s}=e;let i="Notice",l="sub";a===-1?(l="error",i="Error"):a===1&&(l="main",i="Success"),s!==void 0&&(i=s),n("#alertsPopup .notificationHistory .list").prepend(`
      <div class="item">
      <div class="indicator ${l}"></div>
      <div class="title">${i}</div>
      <div class="body">
        ${Gt(t)}
      </div>
    </div>
    `)}}}function DC(e){e?n("header nav .showAlerts .notificationBubble").removeClass("hidden"):n("header nav .showAlerts .notificationBubble").addClass("hidden")}function FC(){n("#alertsPopup .accountAlerts .title .right").text(`${Aa.length}/${BC}`)}function Lh(e){Rs.push(e),n(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`).remove(),n("#alertsPopup .accountAlerts .list .item").length===0&&n("#alertsPopup .accountAlerts .list").html(`
    <div class="nothing">
    Nothing to show
    </div>
    `),_p(),FC()}function Ah(e){po.push(e);const t=n(`#alertsPopup .accountAlerts .list .item[data-id="${e}"]`);_p(),t.find(".indicator").removeClass("main"),t.find(".buttons").empty(),t.find(".buttons").append('<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>'),t.find(".rewards").animate({opacity:0,height:0,marginTop:0},250,"easeOutCubic",()=>{t.find(".rewards").remove()})}function _p(){const e=n("#alertsPopup .accountAlerts .claimAll"),t=n("#alertsPopup .accountAlerts .deleteAll");if(e.addClass("hidden"),t.addClass("hidden"),Aa.length>0){let a=0;for(const s of Aa)!s.read&&!po.includes(s.id)&&(a+=s.rewards.length);a>0?e.removeClass("hidden"):t.removeClass("hidden")}Rs.length===Aa.length&&t.addClass("hidden")}n("header nav .showAlerts").on("click",()=>{OR()});tx((e,t,a)=>{ss.notifications.push({message:e,level:t,customTitle:a}),ss.notifications.length>25&&ss.notifications.shift()});const WC=new fe({dialogId:"alertsPopup",customAnimations:{show:{modal:{from:{marginRight:"-10rem"},to:{marginRight:"0"},easing:"easeOutCirc"}},hide:{modal:{from:{marginRight:"0"},to:{marginRight:"-10rem"},easing:"easeInCirc"}}},customEscapeHandler:()=>{zu()},customWrapperClickHandler:()=>{zu()},setup:async()=>{n("#alertsPopup .accountAlerts").on("click",".claimAll",()=>{for(const e of Aa)!e.read&&!po.includes(e.id)&&Ah(e.id)}),n("#alertsPopup .accountAlerts").on("click",".deleteAll",()=>{for(const e of Aa)Rs.includes(e.id)||Lh(e.id)}),n("#alertsPopup .mobileClose").on("click",()=>{zu()}),n("#alertsPopup .accountAlerts .list").on("click",".item .buttons .deleteAlert",e=>{const t=n(e.currentTarget).closest(".item").attr("data-id");Lh(t)}),n("#alertsPopup .accountAlerts .list").on("click",".item .buttons .markReadAlert",e=>{const t=n(e.currentTarget).closest(".item").attr("data-id");Ah(t)})}});function GR(){if(!Xe()){g("You are offline",0,{duration:2});return}Ur.show({focusFirstInput:!0,beforeAnimation:async e=>{var t,a,s,i;((t=$())==null?void 0:t.streakHourOffset)!==void 0?((a=e.querySelector("input"))==null||a.remove(),(s=e.querySelector(".preview"))==null||s.remove(),(i=e.querySelector("button"))==null||i.remove(),e.querySelector(".text").textContent="You have already set your streak hour offset."):(e.querySelector("input").value="0",zC())}})}function zC(){var i;const e=parseInt((i=Ur.getModal().querySelector("input"))==null?void 0:i.value,10),t=Ur.getModal().querySelector(".preview"),a=new Date;a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0);const s=new Date;s.setUTCHours(0),s.setUTCMinutes(0),s.setUTCSeconds(0),s.setUTCMilliseconds(0),s.setHours(s.getHours()- -1*e),t.innerHTML=`
    <div class="row"><div>Current local reset time:</div><div>${a.toLocaleTimeString()}</div></div>
    <div class="row"><div>New local reset time:</div><div>${s.toLocaleTimeString()}</div></div>
  `}function UR(){Ur.hide()}async function KR(){var a;const e=parseInt((a=Ur.getModal().querySelector("input"))==null?void 0:a.value,10);if(isNaN(e)){g("Streak hour offset must be a number",0);return}if(e<-11||e>12){g("Streak hour offset must be between -11 and 12",0);return}de();const t=await F.users.setStreakHourOffset({body:{hourOffset:e}});if(Z(),t.status!==200)g("Failed to set streak hour offset: "+t.body.message,-1);else{g("Streak hour offset set",1);const s=$();s.streakHourOffset=e,gt(s),UR()}}const Ur=new fe({dialogId:"streakHourOffsetModal",setup:async e=>{var t,a;(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{zC()}),(a=e.querySelector("button"))==null||a.addEventListener("click",()=>{KR()})}});function Vl({tagname:e,classes:t,attributes:a,innerHTML:s}){let i=`<${e}`;return t!==void 0&&(i+=` class="${t.join(" ")}"`),a!==void 0&&(i+=" "+Object.entries(a).filter(l=>l[1]!==void 0).sort((l,c)=>l[0].localeCompare(c[0])).map(l=>l[1]===!0?`${l[0]}`:`${l[0]}="${l[1]}"`).join(" ")),s!==void 0?i+=`>${s}</${e}>`:i+=" />",i}class ve{constructor(t){this.parameters=[],this.id=t.id,this.execFn=t.execFn,this.title=t.title,this.inputs=t.inputs??[],this.text=t.text,this.textAllowHtml=t.textAllowHtml??!1,this.wrapper=Di.getWrapper(),this.element=Di.getModal(),this.modal=Di,this.buttonText=t.buttonText,this.beforeInitFn=t.beforeInitFn,this.beforeShowFn=t.beforeShowFn,this.canClose=t.canClose??!0,this.onlineOnly=t.onlineOnly??!1,this.hideCallsExec=t.hideCallsExec??!1,this.showLabels=t.showLabels??!1}reset(){this.element.innerHTML=`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <button type="submit" class="submitButton"></button>`}init(){const t=n(this.element);t.find("input").val(""),this.reset(),t.attr("data-popup-id",this.id),t.find(".title").text(this.title),this.textAllowHtml?t.find(".text").html(this.text??""):t.find(".text").text(this.text??""),this.initInputs(),this.buttonText===""?t.find(".submitButton").remove():t.find(".submitButton").text(this.buttonText),(this.text??"")===""?t.find(".text").addClass("hidden"):t.find(".text").removeClass("hidden")}initInputs(){const t=n(this.element);if(this.inputs.every(i=>i.hidden)||this.inputs.length===0){t.find(".inputs").addClass("hidden");return}const s=t.find(".inputs");this.showLabels&&s.addClass("withLabel"),this.inputs.forEach((i,l)=>{var p,h,y,b;const c=`${this.id}_${l}`;this.showLabels&&!i.hidden&&s.append(`<label for="${c}">${i.label??""}</label>`);const d=i.type==="textarea"?"textarea":"input",u=i.hidden?["hidden"]:void 0,m={id:c,placeholder:i.placeholder??"",autocomplete:"off"};if(i.type!=="textarea"&&(m.value=((p=i.initVal)==null?void 0:p.toString())??"",m.type=i.type),!i.hidden&&!i.optional&&(m.required=!0),i.disabled&&(m.disabled=!0),i.type==="textarea")s.append(Vl({tagname:d,classes:u,attributes:m,innerHTML:i.initVal}));else if(i.type==="checkbox"){let v=Vl({tagname:d,classes:u,attributes:m});i.description!==void 0&&(v+=`<span>${i.description}</span>`),this.showLabels?v=`<div>${v}</div>`:v=`
          <label class="checkbox">
            ${v}
            <div>${i.label}</div>
          </label>
        `,s.append(v)}else if(i.type==="range")s.append(`
          <div>
            ${Vl({tagname:d,classes:u,attributes:{...m,min:i.min.toString(),max:i.max.toString(),step:(h=i.step)==null?void 0:h.toString(),oninput:"this.nextElementSibling.innerHTML = this.value"}})}
            <span>${i.initVal??""}</span>
          </div>
          `);else{switch(i.type){case"text":case"password":case"email":break;case"datetime-local":{i.min!==void 0&&(m.min=oe(i.min,"yyyy-MM-dd'T'HH:mm:ss")),i.max!==void 0&&(m.max=oe(i.max,"yyyy-MM-dd'T'HH:mm:ss")),i.initVal!==void 0&&(m.value=oe(i.initVal,"yyyy-MM-dd'T'HH:mm:ss"));break}case"date":{i.min!==void 0&&(m.min=oe(i.min,"yyyy-MM-dd")),i.max!==void 0&&(m.max=oe(i.max,"yyyy-MM-dd")),i.initVal!==void 0&&(m.value=oe(i.initVal,"yyyy-MM-dd"));break}case"number":{m.min=(y=i.min)==null?void 0:y.toString(),m.max=(b=i.max)==null?void 0:b.toString();break}}s.append(Vl({tagname:d,classes:u,attributes:m}))}const f=document.querySelector("#"+m.id);if(i.oninput!==void 0&&(f.oninput=i.oninput),i.currentValue=()=>f.type==="checkbox"?f.checked?"true":"false":f.value,i.validation!==void 0){const v=new Oo(f,{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});i.indicator=v;const C=Pt(1e3,async k=>{var q,W;const M=await((W=(q=i.validation)==null?void 0:q.isValid)==null?void 0:W.call(q,k,this));f.value===k&&(M===!0?v.show("valid"):v.show("invalid",M))}),E=async k=>{var M,q;if(k===void 0||k===""){v.hide();return}if(((M=i.validation)==null?void 0:M.schema)!==void 0){const W=i.validation.schema.safeParse(k);if(!W.success){v.show("invalid",W.error.errors.map(x=>x.message).join(", "));return}}if(((q=i.validation)==null?void 0:q.isValid)!==void 0){v.show("checking"),C(k);return}v.show("valid")};f.oninput=async k=>{var q;const M=k.target.value;await E(M),(q=i.oninput)==null||q.call(i,k)}}}),t.find(".inputs").removeClass("hidden")}exec(){if(!this.canClose)return;if(this.inputs.filter(a=>a.hidden!==!0&&a.optional!==!0).some(a=>a.currentValue()===void 0||a.currentValue()==="")){g("Please fill in all fields",0);return}if(this.inputs.some(a=>{var s;return((s=a.indicator)==null?void 0:s.get())==="invalid"})){g("Please solve all validation errors",0);return}this.disableInputs(),de();const t=this.inputs.map(a=>a.currentValue());this.execFn(this,...t).then(a=>{Z(),(a.showNotification??!0)&&g(a.message,a.status,a.notificationOptions),a.status===1?this.hide(!0,a.hideOptions).then(()=>{a.afterHide&&a.afterHide()}):(this.enableInputs(),n(n("#simpleModal").find("input")[0]).trigger("focus"))})}disableInputs(){n("#simpleModal input").prop("disabled",!0),n("#simpleModal button").prop("disabled",!0),n("#simpleModal textarea").prop("disabled",!0),n("#simpleModal .checkbox").addClass("disabled")}enableInputs(){n("#simpleModal input").prop("disabled",!1),n("#simpleModal button").prop("disabled",!1),n("#simpleModal textarea").prop("disabled",!1),n("#simpleModal .checkbox").removeClass("disabled")}show(t=[],a){if(this.onlineOnly&&!Xe()){g("You are offline",0,{duration:2});return}Os=this,this.parameters=t,Di.show({focusFirstInput:!0,...a,beforeAnimation:async()=>{var s,i;(s=this.beforeInitFn)==null||s.call(this,this),this.init(),(i=this.beforeShowFn)==null||i.call(this,this)}})}async hide(t,a){this.canClose&&(this.hideCallsExec&&!t?this.exec():(Os=null,await Di.hide(a)))}}function Mh(){if(Os){Os.hide();return}}let Os=null;const Di=new fe({dialogId:"simpleModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),Os==null||Os.exec()})},customEscapeHandler:e=>{Mh()},customWrapperClickHandler:e=>{Mh()}}),VR=new ve({id:"editApeKey",title:"Edit Ape key",inputs:[{type:"text",placeholder:"name",initVal:""}],buttonText:"edit",onlineOnly:!0,execFn:async(e,t)=>{const a=await F.apeKeys.save({params:{apeKeyId:e.parameters[0]??""},body:{name:t}});return a.status!==200?{status:-1,message:"Failed to update key: "+a.body.message}:{status:1,message:"Key updated",hideOptions:{clearModalChain:!0}}}}),QR=new ve({id:"deleteApeKey",title:"Delete Ape key",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>{const t=await F.apeKeys.delete({params:{apeKeyId:e.parameters[0]??""}});return t.status!==200?{status:-1,message:"Failed to delete key: "+t.body.message}:(_s==null||_s(),{status:1,message:"Key deleted",hideOptions:{clearModalChain:!0}})}}),ZR=new ve({id:"viewApeKey",title:"Ape key",inputs:[{type:"textarea",disabled:!0,placeholder:"key",initVal:""}],textAllowHtml:!0,text:`
    This is your new Ape Key. Please keep it safe. You will only see it once!<br><br>
    <strong>Note:</strong> Ape Keys are disabled by default, you need to enable them before they can be used.`,buttonText:"close",hideCallsExec:!0,execFn:async e=>({status:1,message:"Key generated",showNotification:!1,hideOptions:{clearModalChain:!0}}),beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},beforeShowFn:e=>{e.canClose=!1,n("#simpleModal textarea").css("height","110px"),n("#simpleModal .submitButton").addClass("hidden"),setTimeout(()=>{e.canClose=!0,n("#simpleModal .submitButton").removeClass("hidden")},5e3)}}),YR=new ve({id:"generateApeKey",title:"Generate new Ape key",inputs:[{type:"text",placeholder:"Name",initVal:""}],buttonText:"generate",onlineOnly:!0,execFn:async(e,t)=>{const a=await F.apeKeys.add({body:{name:t,enabled:!1}});if(a.status!==200)return{status:-1,message:"Failed to generate key: "+a.body.message};const s=a.body.data,i=e.modal.getPreviousModalInChain();return _s==null||_s(),{status:1,message:"Key generated",hideOptions:{clearModalChain:!0,animationMode:"modalOnly"},afterHide:()=>{ZR.show([s.apeKey],{modalChain:i,animationMode:"modalOnly"})}}}});let Pn={};const RC=n("#pageAccountSettings .tab[data-tab='api']");async function XR(){JR();const e=await F.apeKeys.get();return e.status!==200?e.body.message==="You have lost access to ape keys, please contact support"?(_C=!0,HC(),!1):(g("Error getting ape keys: "+e.body.message,-1),!1):(Pn=e.body.data,!0)}function JR(){const e=RC.find("table tbody");e.empty(),e.append("<tr><td colspan='6' style='text-align: center;font-size:1rem;'><i class='fas fa-spin fa-circle-notch'></i></td></tr>")}function OC(){var s,i,l;const e=Pn;if(e==null)return;const t=RC.find("table tbody");t.empty();const a=Object.keys(e);if(a.length===0){t.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");return}a.forEach(c=>{const d=e[c];t.append(`
      <tr keyId="${c}">
        <td>
          <button class="textButton toggleActive" style="font-size: 1.25rem">
            ${d.enabled?'<i class="fas fa-fw fa-check-square"></i>':'<i class="far fa-fw fa-square"></i>'}
          </button>
        </td>
        <td>${d.name}</td>
        <td>${oe(new Date(d.createdOn),"dd MMM yyyy HH:mm")}</td>
        <td>${oe(new Date(d.modifiedOn),"dd MMM yyyy HH:mm")}</td>
        <td>${d.lastUsedOn===-1?"-":oe(new Date(d.lastUsedOn),"dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <button class="editButton">
              <i class="fas fa-fw fa-pen"></i>
            </button>
            <button class="deleteButton">
              <i class="fas fa-fw fa-trash-alt"></i>
            </button>
          </div>
        </td>
      </tr>
    `)});for(const c of t.find("tr")){const d=c.getAttribute("keyid");(s=c.querySelector("button.toggleActive"))==null||s.addEventListener("click",u=>{eO(d)}),(i=c.querySelector("button.deleteButton"))==null||i.addEventListener("click",u=>{QR.show([d],{})}),(l=c.querySelector("button.editButton"))==null||l.addEventListener("click",u=>{VR.show([d],{})})}}async function eO(e){const t=Pn==null?void 0:Pn[e];if(!t||Pn===void 0)return;de();const a=await F.apeKeys.save({params:{apeKeyId:e},body:{enabled:!t.enabled}});if(Z(),a.status!==200){g("Failed to update key: "+a.body.message,-1);return}t.enabled=!t.enabled,OC(),t.enabled?g("Key active",1):g("Key inactive",1)}let _s,_C=!1;async function HC(e){if(_C){n(".pageAccountSettings .tab[data-tab='api'] table").remove(),n(".pageAccountSettings .section.apeKeys .buttons").remove(),n(".pageAccountSettings .section.apeKeys .lostAccess").removeClass("hidden");return}_s=e,await XR(),OC()}n(".pageAccountSettings").on("click","#generateNewApeKey",()=>{YR.show([],{})});const ie=n(".page.pageAccountSettings"),fc={activeTab:"general"};function tO(){if(ie.find(".section.passwordAuthSettings button").addClass("hidden"),ie.find(".section.googleAuthSettings button").addClass("hidden"),ie.find(".section.githubAuthSettings button").addClass("hidden"),!j())return;const e=ld(),t=e.providerData.some(i=>i.providerId==="password"),a=e.providerData.some(i=>i.providerId==="google.com"),s=e.providerData.some(i=>i.providerId==="github.com");t?(ie.find(".section.passwordAuthSettings #emailPasswordAuth").removeClass("hidden"),ie.find(".section.passwordAuthSettings #passPasswordAuth").removeClass("hidden"),(a||s)&&ie.find(".section.passwordAuthSettings #removePasswordAuth").removeClass("hidden")):ie.find(".section.passwordAuthSettings #addPasswordAuth").removeClass("hidden"),a?(ie.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("hidden"),t||s?ie.find(".section.googleAuthSettings #removeGoogleAuth").removeClass("disabled"):ie.find(".section.googleAuthSettings #removeGoogleAuth").addClass("disabled")):ie.find(".section.googleAuthSettings #addGoogleAuth").removeClass("hidden"),s?(ie.find(".section.githubAuthSettings #removeGithubAuth").removeClass("hidden"),t||a?ie.find(".section.githubAuthSettings #removeGithubAuth").removeClass("disabled"):ie.find(".section.githubAuthSettings #removeGithubAuth").addClass("disabled")):ie.find(".section.githubAuthSettings #addGithubAuth").removeClass("hidden")}function aO(){var e;if(!j())ie.find(".section.discordIntegration").addClass("hidden");else{if(!$())return;ie.find(".section.discordIntegration").removeClass("hidden"),((e=$())==null?void 0:e.discordId)===void 0?(ie.find(".section.discordIntegration .buttons").removeClass("hidden"),ie.find(".section.discordIntegration .info").addClass("hidden")):(ie.find(".section.discordIntegration .buttons").addClass("hidden"),ie.find(".section.discordIntegration .info").removeClass("hidden"))}}function jC(){Ja(ie.find(".tab.active"),ie.find(`.tab[data-tab="${fc.activeTab}"]`),250,async()=>{},async()=>{ie.find(".tab").removeClass("active"),ie.find(`.tab[data-tab="${fc.activeTab}"]`).addClass("active")}),ie.find("button").removeClass("active"),ie.find(`button[data-tab="${fc.activeTab}"]`).addClass("active")}function oO(){ie.find(".section.optOutOfLeaderboards .optedOut").addClass("hidden"),ie.find(".section.optOutOfLeaderboards .buttons").removeClass("hidden"),ie.find(".section.setStreakHourOffset .info").addClass("hidden"),ie.find(".section.setStreakHourOffset .buttons").removeClass("hidden");const e=$();if((e==null?void 0:e.lbOptOut)===!0&&(ie.find(".section.optOutOfLeaderboards .optedOut").removeClass("hidden"),ie.find(".section.optOutOfLeaderboards .buttons").addClass("hidden")),(e==null?void 0:e.streakHourOffset)!==void 0){ie.find(".section.setStreakHourOffset .info").removeClass("hidden");const t=(e==null?void 0:e.streakHourOffset)>0?"+":"";ie.find(".section.setStreakHourOffset .info span").text(t+(e==null?void 0:e.streakHourOffset)),ie.find(".section.setStreakHourOffset .buttons").addClass("hidden")}}function _o(){ce()==="accountSettings"&&(tO(),aO(),oO(),HC(_o),jC())}n(".page.pageAccountSettings").on("click",".tabs button",e=>{fc.activeTab=n(e.target).data("tab"),jC()});n(".page.pageAccountSettings .section.discordIntegration .getLinkAndGoToOauth").on("click",()=>{de(),F.users.getDiscordOAuth().then(e=>{e.status===200?window.open(e.body.data.url,"_self"):g("Failed to get OAuth from discord: "+e.body.message,-1)})});n(".page.pageAccountSettings #setStreakHourOffset").on("click",()=>{GR()});const sO=new Pa({id:"accountSettings",display:"Account Settings",element:ie,path:"/account-settings",afterHide:async()=>{Et("pageAccountSettings")},beforeShow:async()=>{Zt("pageAccountSettings","main"),_o()}});n(()=>{Ht("pageAccountSettings")});const NC=[];function nO(e){NC.push(e)}function iO(e,t){NC.forEach(a=>{try{a(e,t)}catch(s){console.error("Google Sign Up event subscriber threw an error"),console.error(s)}})}let Qc=!1;function GC(){n(".scrollToTopButton").addClass("invisible"),Qc=!1}function rO(){n(".scrollToTopButton").removeClass("invisible"),Qc=!0}n(document).on("click",".scrollToTopButton",()=>{n(".scrollToTopButton").addClass("invisible"),window.scrollTo({top:0,behavior:gy()?"instant":"smooth"})});n(window).on("scroll",()=>{if(ce()==="test")return;const t=window.scrollY;!Qc&&t>100?rO():Qc&&t<100&&GC()});const lO=new Pa({id:"test",element:n(".page.pageTest"),path:"/",beforeHide:async()=>{be(),le(),Mn(),cs(),n("#wordsInput").trigger("focusout")},afterHide:async()=>{Gc(!0)},beforeShow:async()=>{Gc(!1),F0(),be(),le({noAnim:!0}),GI(),vp(),Nc(),GC()}});function cO(){n(".pageAbout .contributors").empty(),n(".pageAbout .supporters").empty(),_n.getDataset("count").data=[],_n.updateColors()}let Zc,Uo;function dO(){var e;if(Zc){_n.updateColors();const t=fO(Zc);_n.data.labels=t.labels,_n.getDataset("count").data=t.data}if(Uo){const t=Math.round(Uo.timeTyping),a=PS({start:0,end:t*1e3});n(".pageAbout #totalTimeTypingStat .val").text(((e=a.years)==null?void 0:e.toString())??""),n(".pageAbout #totalTimeTypingStat .valSmall").text("years"),n(".pageAbout #totalTimeTypingStat").attr("aria-label",fu(Math.round(t/3600))+" hours");const s=ig(Uo.testsStarted);n(".pageAbout #totalStartedTestsStat .val").text(s.rounded<10?s.roundedTo2:s.rounded),n(".pageAbout #totalStartedTestsStat .valSmall").text(s.orderOfMagnitude),n(".pageAbout #totalStartedTestsStat").attr("aria-label",fu(Uo.testsStarted)+" tests");const i=ig(Uo.testsCompleted);n(".pageAbout #totalCompletedTestsStat .val").text(i.rounded<10?i.roundedTo2:i.rounded),n(".pageAbout #totalCompletedTestsStat .valSmall").text(i.orderOfMagnitude),n(".pageAbout #totalCompletedTestsStat").attr("aria-label",fu(Uo.testsCompleted)+" tests")}}async function uO(){if(Zc&&Uo)return;if(!Xe()){g("Cannot update all time stats - offline",0);return}const e=await F.public.getSpeedHistogram({query:{language:"english",mode:"time",mode2:"60"}});e.status===200?Zc=e.body.data:g(`Failed to get global speed stats for histogram: ${e.body.message}`,-1);const t=await F.public.getTypingStats();t.status===200?Uo=t.body.data:g(`Failed to get global typing stats: ${e.body.message}`,-1)}async function mO(){let e;try{e=await NM()}catch(c){g(ae(c,"Failed to get supporters"),-1),e=[]}let t;try{t=await GM()}catch(c){g(ae(c,"Failed to get contributors"),-1),t=[]}uO().then(()=>{dO()});const a=document.querySelector(".pageAbout .supporters");let s="";for(const c of e)s+=`<div>${c}</div>`;a&&(a.innerHTML=s);const i=document.querySelector(".pageAbout .contributors");let l="";for(const c of t)l+=`<div>${c}</div>`;i&&(i.innerHTML=l)}function fO(e){const t=[],a=[],s=Object.keys(e).sort((i,l)=>parseInt(i,10)-parseInt(l,10));for(const[i,l]of s.entries()){const c=s[i+1],d=parseInt(l,10);if(t.push({x:d,y:e[d]}),a.push(`${d} - ${d+9}`),c!==void 0&&d+10!==parseInt(c,10))for(let u=d+10;u<parseInt(c,10);u+=10)t.push({x:u,y:0}),a.push(`${u} - ${u+9}`)}return{data:t,labels:a}}const pO=new Pa({id:"about",element:n(".page.pageAbout"),path:"/about",afterHide:async()=>{cO(),Et("pageAbout")},beforeShow:async()=>{Zt("pageAbout","main"),mO()}});n(()=>{Ht("pageAbout")});const Yc={userUid:void 0,lbOptOut:void 0};let Ui;async function gO(e){if(!j()){g("You must be logged in to submit a report",0);return}UC.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async t=>{gi(t.querySelector(".g-recaptcha"),"userReportModal");const{name:a}=e;Yc.userUid=e.uid,Yc.lbOptOut=e.lbOptOut,t.querySelector(".user").textContent=a,t.querySelector(".reason").value="Inappropriate name",t.querySelector(".comment").value="",Ui=new nt({select:t.querySelector(".reason"),settings:{showSearch:!1,contentLocation:t}})}}),new jr(n("#userReportModal .comment"),250)}async function hO(){UC.hide()}async function yO(){const e=bl("userReportModal");if(!e){g("Please complete the captcha");return}const t=n("#userReportModal .reason").val(),a=n("#userReportModal .comment").val(),s=e;if(!t){g("Please select a valid report reason");return}if(!a){g("Please provide a comment");return}if(t==="Suspected cheating"&&Yc.lbOptOut){g("You cannot report this user for suspected cheating as they have opted out of the leaderboards.",0,{duration:10});return}const i=a.length-250;if(i>0){g(`Report comment is ${i} character(s) too long`);return}de();const l=await F.users.report({body:{uid:Yc.userUid,reason:t,comment:a,captcha:s}});if(Z(),l.status!==200){g("Failed to report user: "+l.body.message,-1);return}g("Report submitted. Thank you!",1),hO()}const UC=new fe({dialogId:"userReportModal",setup:async e=>{var t;(t=e.querySelector("button"))==null||t.addEventListener("click",()=>{yO()})},cleanup:async()=>{Ui==null||Ui.destroy(),Ui=void 0,Bo("userReportModal")}});function Eh(){n(".page.pageProfile .preloader").removeClass("hidden"),n(".page.pageProfile .profile").html(`
      <div class="details none">
        <div class="avatarAndName">
          <div class="avatars">
            <div class="placeholderAvatar">
              <i class="fas fa-user-circle"></i>
            </div>
            <div class="avatar"></div>
          </div>
          <div>
             <div class="user">
              <div class="name">-</div>
              <div class="userFlags"></div>
            </div>
            <div class="badges"></div>
            <div class="allBadges"></div>
            <div class="joined" data-balloon-pos="up">-</div>
	          <div class="streak" data-balloon-pos="up">-</div>
          </div>
          <div class="levelAndBar">
            <div class="level" data-balloon-pos="up">-</div>
            <div class="xpBar" data-balloon-pos="up">
              <div class="bar" style="width: 0%;"></div>
            </div>
            <div class="xp" data-balloon-pos="up">-/-</div>
          </div>
        </div>
        <div class="separator sep1"></div>
        <div class="typingStats vertical">
          <div class="started">
            <div class="title">tests started</div>
            <div class="value">-</div>
          </div>
          <div class="completed">
            <div class="title">tests completed</div>
            <div class="value">-</div>
          </div>
          <div class="timeTyping">
            <div class="title">time typing</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep2 hidden"></div>

        <div class="bioAndKeyboard vertical hidden">
          <div class="bio">
            <div class="title">bio</div>
            <div class="value">-</div>
          </div>
          <div class="keyboard hidden">
            <div class="title">keyboard</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep3 hidden"></div>

        <div class="socials big hidden">
          <div class="title">socials</div>
          <div class="value">-</div>
        </div>
        <div class="buttonGroup">
          <button
            class="userReportButton"
            data-balloon-pos="left"
            aria-label="Report user"
          >
            <i class="fas fa-flag"></i>
          </button>
        </div>
      </div>
      <div class="leaderboardsPositions">
        <div class="title">All-Time English Leaderboards</div>
        <div class="group t15">
          <div class="testType">15 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
        <div class="group t60">
          <div class="testType">60 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
      </div>
      <div class="pbsWords">
        <div class="group">
          <div class="quick">
            <div class="test">10 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">25 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">50 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">100 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div>
      <div class="pbsTime">
        <div class="group">
          <div class="quick">
            <div class="test">15 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">30 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">60 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">120 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div><div class="lbOptOutReminder hidden"></div>`)}async function bO(e){const t=Z1("isUid");if(e.data)n(".page.pageProfile .preloader").addClass("hidden"),await Uc("profile",e.data),Fm(e.data.personalBests,!0);else if(e.uidOrName!==void 0&&e.uidOrName!==""){const a=await F.users.getProfile({params:{uidOrName:e.uidOrName},query:{isUid:t}});if(n(".page.pageProfile .preloader").addClass("hidden"),a.status===404){const s=t?"User not found":`User ${e.uidOrName} not found`;n(".page.pageProfile .preloader").addClass("hidden"),n(".page.pageProfile .error").removeClass("hidden"),n(".page.pageProfile .error .message").text(s)}else if(a.status===200)window.history.replaceState(null,"",`/profile/${a.body.data.name}`),await Uc("profile",a.body.data),Fm(a.body.data.personalBests,!0);else{g("Failed to load profile: "+a.body.message,-1);return}}else g("Missing update parameter!",-1)}n(".page.pageProfile").on("click",".profile .userReportButton",()=>{const e=n(".page.pageProfile .profile").attr("uid")??"",t=n(".page.pageProfile .profile").attr("name")??"",a=(n(".page.pageProfile .profile").attr("lbOptOut")??"false")==="true";gO({uid:e,name:t,lbOptOut:a})});const vO=new Pa({id:"profile",element:n(".page.pageProfile"),path:"/profile",afterHide:async()=>{Et("pageProfile"),Eh()},beforeShow:async e=>{var a;Zt("pageProfile","main");const t=((a=e==null?void 0:e.params)==null?void 0:a.uidOrName)??"";t?(n(".page.pageProfile .preloader").removeClass("hidden"),n(".page.pageProfile .search").addClass("hidden"),n(".page.pageProfile .content").removeClass("hidden"),Eh(),bO({uidOrName:t,data:e==null?void 0:e.data})):(n(".page.pageProfile .preloader").addClass("hidden"),n(".page.pageProfile .search").removeClass("hidden"),n(".page.pageProfile .content").addClass("hidden"))}});Ht("pageProfile");const wO=new Pa({id:"profileSearch",element:n(".page.pageProfileSearch"),path:"/profile",afterHide:async()=>{Et("pageProfileSearch")},beforeShow:async()=>{Zt("pageProfileSearch","main"),n(".page.pageProfileSearch input").val("")},afterShow:async()=>{n(".page.pageProfileSearch input").trigger("focus")}}),kO=new Pa({id:"404",element:n(".page.page404"),path:"/404",afterHide:async()=>{Et("page404")},beforeShow:async()=>{Zt("page404","main")}});Ht("page404");const CO=o.enum(["allTime","weekly","daily"]),Ru="EEEE, do MMMM yyyy",Ph="EEEE, do MMMM yyyy HH:mm",w={loading:!0,updating:!1,type:"allTime",mode2:"15",data:null,userData:null,page:0,pageSize:50,title:"All-time English Time 15 Leaderboard",discordAvatarUrls:new Map,scrollToUserAfterFill:!1,goToUserPage:!1},KC=o.object({type:CO,mode2:o.enum(["15","60"]).optional(),language:o.string().optional(),yesterday:o.boolean().optional(),lastWeek:o.boolean().optional()}),VC=KC.extend({page:o.number(),goToUserPage:o.boolean()}).partial(),QC=new jt({key:"leaderboardSelector",schema:KC,fallback:{type:"allTime",mode2:"15"}});function ru(){const e=w.type==="allTime"?"All-time":w.type==="weekly"?"Weekly XP":"Daily",t=w.type==="daily"?Gs(w.language):w.type==="allTime"?"English":"",a=w.type==="allTime"?` Time ${w.mode2}`:w.type==="daily"?` Time ${w.mode2}`:"";if(w.title=`${e} ${t} ${a} Leaderboard`,n(".page.pageLeaderboards .bigtitle >.text").text(w.title),n(".page.pageLeaderboards .bigtitle .subtext").addClass("hidden"),n(".page.pageLeaderboards .bigtitle button").addClass("hidden"),n(".page.pageLeaderboards .bigtitle .subtext .divider").addClass("hidden"),w.type==="daily"){n(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),n(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").removeClass("hidden"),n(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),w.yesterday?n(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-forward"></i>
            show today
        `):n(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-backward"></i>
            show yesterday
        `);let s=qS(new uo);w.yesterday&&(s=BS(s)),Wh(oe(s,Ru)+" UTC",Ql(s),Ql(Sy(s)))}else if(w.type==="weekly"){n(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),n(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").removeClass("hidden"),n(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),w.lastWeek?n(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-forward"></i>
            show this week
        `):n(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-backward"></i>
            show last week
        `);let s=DS(new uo,{weekStartsOn:1});w.lastWeek&&(s=FS(s,7));const i=xy(s,{weekStartsOn:1}),l=`${oe(s,Ru)} - ${oe(i,Ru)} UTC`;Wh(l,Ql(s),Ql(i))}}async function Cl(e=!1){var l;e?(w.updating=!0,w.error=void 0):(w.loading=!0,w.error=void 0,w.data=null,w.userData=null),us();const t=(c,d,u)=>({rank:async()=>d({query:u}),data:async()=>c({query:{...u,page:w.page,pageSize:w.pageSize}})});let a;if(w.type==="allTime")a=t(F.leaderboards.get,F.leaderboards.getRank,{language:"english",mode:"time",mode2:w.mode2});else if(w.type==="daily")a=t(F.leaderboards.getDaily,F.leaderboards.getDailyRank,{language:w.language,mode:"time",mode2:w.mode2,daysBefore:w.yesterday?1:void 0});else if(w.type==="weekly")a=t(F.leaderboards.getWeeklyXp,F.leaderboards.getWeeklyXpRank,{weeksBefore:w.lastWeek?1:void 0});else throw new Error("unknown state type");if((!j()||w.userData!==null)&&(a.rank=void 0),w.goToUserPage&&a.rank!==void 0){w.goToUserPage=!1;const c=await a.rank();c!==void 0&&c.status===200&&c.body.data!==null&&(w.userData=c.body.data,w.page=Math.floor((w.userData.rank-1)/w.pageSize),yi()),a.rank=void 0}const[s,i]=await Promise.all([a.data(),(l=a.rank)==null?void 0:l.call(a)]);if(s.status===200?(w.data=s.body.data.entries,w.count=s.body.data.count,w.pageSize=s.body.data.pageSize,w.type==="daily"&&(w.minWpm=s.body.data.minWpm)):(w.data=null,w.error="Something went wrong",g("Failed to get leaderboard: "+s.body.message,-1)),w.userData===null&&i!==void 0&&(i.status===200?i.body.data!==null&&(w.userData=i.body.data):(w.userData=null,w.error="Something went wrong",g("Failed to get rank: "+i.body.message,-1))),w.data!==null){const c=w.data.filter(d=>!w.discordAvatarUrls.has(d.uid));xO(c).then(d=>{w.discordAvatarUrls=new Map([...w.discordAvatarUrls,...d]),ZC()})}w.loading=!1,w.updating=!1,us(),!e&&j()&&YC()}function SO(){const e=n(".page.pageLeaderboards .titleAndButtons .jumpButtons");e.find("button").removeClass("active");const t=Math.ceil(w.count/w.pageSize);if(t<=1?e.find("button").addClass("disabled"):e.find("button").removeClass("disabled"),w.page===0?(e.find("button[data-action='previousPage']").addClass("disabled"),e.find("button[data-action='firstPage']").addClass("disabled")):(e.find("button[data-action='previousPage']").removeClass("disabled"),e.find("button[data-action='firstPage']").removeClass("disabled")),j()){const a=e.find("button[data-action='userPage']");if(!w.userData)a.addClass("disabled");else{const s=Math.floor((w.userData.rank-1)/w.pageSize);w.page===s?a.addClass("disabled"):a.removeClass("disabled")}}w.page>=t-1?e.find("button[data-action='nextPage']").addClass("disabled"):e.find("button[data-action='nextPage']").removeClass("disabled")}async function xO(e){const t=await Promise.allSettled(e.map(async s=>({uid:s.uid,url:await Jm(s.discordId,s.discordAvatar)}))),a=new Map;return t.forEach(s=>{s.status==="fulfilled"&&s.value.url!==null&&a.set(s.value.uid,s.value.url)}),a}function ZC(){const e=n(".page.pageLeaderboards table .lbav");for(const t of e){const a=n(t).siblings(".entryName").attr("uid"),s=w.discordAvatarUrls.get(a);s!==void 0?n(t).html(`<div class="avatar" style="background-image:url(${s})"></div>`):n(t).html('<div class="avatarPlaceholder"><i class="fas fa-user-circle"></i></div>')}}function TO(e,t=!1){let a='<div class="avatarPlaceholder"><i class="fas fa-user-circle"></i></div>';e.discordAvatar!==void 0&&(a='<div class="avatarPlaceholder"><i class="fas fa-circle-notch fa-spin"></i></div>');const s=t?"me":"",i={wpm:N.typingSpeed(e.wpm,{showDecimalPlaces:!0}),acc:N.percentage(e.acc,{showDecimalPlaces:!0}),raw:N.typingSpeed(e.raw,{showDecimalPlaces:!0}),con:N.percentage(e.consistency,{showDecimalPlaces:!0})};return`
    <tr class="${s}" data-uid="${e.uid}">
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="lbav">${a}</div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${el(e)}
            ${e.badgeId?Hr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat narrow">
      ${i.wpm}
        <div class="sub">${i.acc}</div>
      </td>
      </td>
      <td class="stat narrow">
      ${i.raw}
        <div class="sub">${i.con}</div>
      </td>
      <td class="stat wide">${i.wpm}</td>
      <td class="stat wide">${i.acc}</td>
      <td class="stat wide">${i.raw}</td>
      <td class="stat wide">${i.con}</td>
      <td class="date">${oe(e.timestamp,"dd MMM yyyy")}<div class="sub">${oe(e.timestamp,"HH:mm")}</div></td>
    </tr>
  `}function $O(e,t=!1){let a='<div class="avatarPlaceholder"><i class="fas fa-user-circle"></i></div>';e.discordAvatar!==void 0&&(a='<div class="avatarPlaceholder"><i class="fas fa-circle-notch fa-spin"></i></div>');const s=t?"me":"",i=RS(e.lastActivityTimestamp,{addSuffix:!0});return`
    <tr class="${s}" data-uid="${e.uid}">
      <td>${e.rank===1?'<i class="fas fa-fw fa-crown"></i>':e.rank}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="lbav">${a}</div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${el(e)}
            ${e.badgeId?Hr(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat wide">${e.totalXp<1e3?e.totalXp:vc(e.totalXp)}</td>
      <td class="stat wide">${rt(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      <td class="stat narrow">
      ${e.totalXp<1e3?e.totalXp:vc(e.totalXp)}
      <div class="sub">${rt(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      </td>
      <td class="date" data-balloon-pos="left"  aria-label="${i}">
        ${oe(e.lastActivityTimestamp,"dd MMM yyyy")}
        <div class="sub">
          ${oe(e.lastActivityTimestamp,"HH:mm")}
        </div>
      </td>
    </tr>
  `}function LO(){var t,a,s,i;const e=n(".page.pageLeaderboards table tbody");if(e.empty(),n(".page.pageLeaderboards table thead").addClass("hidden"),w.type==="allTime"||w.type==="daily"?n(".page.pageLeaderboards table thead.allTimeAndDaily").removeClass("hidden"):w.type==="weekly"&&n(".page.pageLeaderboards table thead.weekly").removeClass("hidden"),w.data===null||w.data.length===0){e.append('<tr><td colspan="7" class="empty">No data</td></tr>'),n(".page.pageLeaderboards table").removeClass("hidden");return}if(w.type==="allTime"||w.type==="daily")for(const l of w.data){const c=((a=(t=xe)==null?void 0:t.currentUser)==null?void 0:a.uid)===l.uid;e.append(TO(l,c))}else if(w.type==="weekly")for(const l of w.data){const c=((i=(s=xe)==null?void 0:s.currentUser)==null?void 0:i.uid)===l.uid;e.append($O(l,c))}n(".page.pageLeaderboards table").removeClass("hidden")}function Ih(){var s,i,l,c;if(w.type!=="allTime"||w.userData===null)return null;const e=((c=(l=(i=(s=$())==null?void 0:s.lbMemory)==null?void 0:i.time)==null?void 0:l[w.mode2])==null?void 0:c.english)??0,t=w.userData.rank,a=e-t;return a!==0&&OA("time",w.mode2,"english",t,!0),a}function YC(){var e,t,a,s;if(j()&&((e=$())==null?void 0:e.lbOptOut)===!0){n(".page.pageLeaderboards .bigUser").html('<div class="warning">You have opted out of the leaderboards.</div>');return}if(j()&&((t=$())==null?void 0:t.banned)===!0){n(".page.pageLeaderboards .bigUser").html('<div class="warning">Your account is banned</div>');return}if(j()&&(((s=(a=$())==null?void 0:a.typingStats)==null?void 0:s.timeTyping)??0)<7200){n(".page.pageLeaderboards .bigUser").html('<div class="warning">Your account must have 2 hours typed to be placed on the leaderboard.</div>');return}if(j()&&w.type==="daily"&&w.userData===null){let i="Not qualified";w.yesterday||(i+=` (min speed required: ${N.typingSpeed(w.minWpm,{showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`})})`),n(".page.pageLeaderboards .bigUser").html(`<div class="warning">${i}</div>`);return}if(j()&&w.userData===null){n(".page.pageLeaderboards .bigUser").html('<div class="warning">Not qualified</div>');return}if(w.data!==null){if(w.type==="allTime"||w.type==="daily"){if(!w.userData||!w.count){n(".page.pageLeaderboards .bigUser").addClass("hidden"),n(".page.pageLeaderboards .tableAndUser > .divider").removeClass("hidden");return}const i=w.userData;let c=`Top ${(i.rank/w.count*100).toFixed(2)}%`;i.rank===1&&(c="GOAT");const d=Ih();let u;d===null?u="":d===0?u=" ( = since you last checked)":d>0?u=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(d)} since you last checked
      )`:u=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(d)} since you last checked
        )`;const m={wpm:N.typingSpeed(i.wpm,{showDecimalPlaces:!0}),acc:N.percentage(i.acc,{showDecimalPlaces:!0}),raw:N.typingSpeed(i.raw,{showDecimalPlaces:!0}),con:N.percentage(i.consistency,{showDecimalPlaces:!0})},f=`
          <div class="rank">${i.rank===1?'<i class="fas fa-fw fa-crown"></i>':i.rank}</div>
        <div class="userInfo">
          <div class="top">You (${c})</div>
          <div class="bottom">${u}</div>
        </div>
        <div class="stat wide">
          <div class="title">${r.typingSpeedUnit}</div>
          <div class="value">${m.wpm}</div>
        </div>
        <div class="stat wide">
          <div class="title">accuracy</div>
          <div class="value">${m.acc}</div>
        </div>
        <div class="stat wide">
          <div class="title">raw</div>
          <div class="value">${m.raw}</div>
        </div>
        <div class="stat wide">
          <div class="title">consistency</div>
          <div class="value">${m.con}</div>
        </div>
        <div class="stat wide">
          <div class="title">date</div>
          <div class="value">${oe(i.timestamp,"dd MMM yyyy HH:mm")}</div>
        </div>


        <div class="stat narrow">
          <div>${m.wpm}</div>
          <div class="sub">${m.acc}</div>
        </div>
        <div class="stat narrow">
          <div>${m.raw}</div>
          <div class="sub">${m.con}</div>
        </div>
        <div class="stat narrow">
          <div>${oe(i.timestamp,"dd MMM yyyy")}</div>
          <div class="sub">${oe(i.timestamp,"HH:mm")}</div>
        </div>
        `;n(".page.pageLeaderboards .bigUser").html(f)}else if(w.type==="weekly"){if(!w.userData||!w.count){n(".page.pageLeaderboards .bigUser").addClass("hidden");return}const i=w.userData;let c=`Top ${(i.rank/w.count*100).toFixed(2)}%`;i.rank===1&&(c="GOAT");const d=Ih();let u;d===null?u="":d===0?u=" ( = since you last checked)":d>0?u=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(d)} since you last checked
      )`:u=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(d)} since you last checked
        )`;const m={xp:i.totalXp<1e3?i.totalXp:vc(i.totalXp),time:rt(Math.round(i.timeTypedSeconds),!0,!0,":")},f=`
          <div class="rank">${i.rank===1?'<i class="fas fa-fw fa-crown"></i>':i.rank}</div>
        <div class="userInfo">
          <div class="top">You (${c})</div>
          <div class="bottom">${u}</div>
        </div>
        <div class="stat wide">
          <div class="title">xp gained</div>
          <div class="value">${m.xp}</div>
        </div>
        <div class="stat wide">
          <div class="title">time typed</div>
          <div class="value">${m.time}</div>
        </div>
        <div class="stat narrow">
          <div>${m.xp}</div>
          <div class="sub">${m.time}</div>
        </div>
        <div class="stat wide">
          <div class="title">last activity</div>
          <div class="value">${oe(i.lastActivityTimestamp,"dd MMM yyyy HH:mm")}</div>
        </div>
        <div class="stat narrow">
          <div>${oe(i.lastActivityTimestamp,"dd MMM yyyy")}</div>
          <div class="sub">${oe(i.lastActivityTimestamp,"HH:mm")}</div>
        </div>
        `;n(".page.pageLeaderboards .bigUser").html(f)}n(".page.pageLeaderboards .bigUser").removeClass("hidden"),n(".page.pageLeaderboards .tableAndUser > .divider").addClass("hidden")}}function us(){var e;if(n(".page.pageLeaderboards .loading").addClass("hidden"),n(".page.pageLeaderboards .updating").addClass("hidden"),n(".page.pageLeaderboards .error").addClass("hidden"),w.error!==void 0){n(".page.pageLeaderboards .error").removeClass("hidden"),n(".page.pageLeaderboards .error p").text(w.error),Fh();return}if(w.updating){Dh(),n(".page.pageLeaderboards .updating").removeClass("hidden");return}else if(w.loading){Dh(),n(".page.pageLeaderboards .bigUser").addClass("hidden"),n(".page.pageLeaderboards .titleAndButtons").addClass("hidden"),n(".page.pageLeaderboards .loading").removeClass("hidden"),n(".page.pageLeaderboards table").addClass("hidden");return}else Fh();if(j()?n(".page.pageLeaderboards .needAuth").removeClass("hidden"):n(".page.pageLeaderboards .needAuth").addClass("hidden"),w.data===null){g("Data is null");return}n(".page.pageLeaderboards .titleAndButtons").removeClass("hidden"),SO(),AO(),LO();for(const t of document.querySelectorAll(".page.pageLeaderboards .speedUnit"))t.innerHTML=r.typingSpeedUnit;if(w.scrollToUserAfterFill){const t=n(window).height()??0,s=(((e=n(".tableAndUser .me").offset())==null?void 0:e.top)??0)-t/2;n([document.documentElement,document.body]).animate({scrollTop:s},Be(500)),w.scrollToUserAfterFill=!1}}function XC(){const e=n(".page.pageLeaderboards .buttonGroup.typeButtons");e.find("button").removeClass("active"),e.find(`button[data-type=${w.type}]`).addClass("active")}function Xc(){n(".page.pageLeaderboards .buttonGroup.secondary").addClass("hidden"),n(".page.pageLeaderboards .buttons .divider").addClass("hidden"),n(".page.pageLeaderboards .buttons .divider2").addClass("hidden"),w.type==="allTime"&&(n(".page.pageLeaderboards .buttonGroup.modeButtons").removeClass("hidden"),n(".page.pageLeaderboards .buttons .divider").removeClass("hidden"),n(".page.pageLeaderboards .buttons .divider2").addClass("hidden"),Bh()),w.type==="daily"&&(n(".page.pageLeaderboards .buttonGroup.modeButtons").removeClass("hidden"),n(".page.pageLeaderboards .buttonGroup.languageButtons").removeClass("hidden"),n(".page.pageLeaderboards .buttons .divider").removeClass("hidden"),n(".page.pageLeaderboards .buttons .divider2").removeClass("hidden"),Bh(),PO())}let Hm;function qh(){if(w.type==="daily"){const e=ng(new Date,Sy(new uo));n(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+rt(e,!0))}else if(w.type==="allTime"){const e=new Date,t=14-e.getMinutes()%15,a=60-e.getSeconds(),s=t*60+a;n(".page.pageLeaderboards .titleAndButtons .timer").text("Next update in: "+rt(s,!0))}else if(w.type==="weekly"){const e=xy(new uo,{weekStartsOn:1}),t=ng(new Date,e);n(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+rt(t,!0,!0,":",!0,!0))}}function AO(){let e=!0;(w.type==="daily"&&w.yesterday||w.type==="weekly"&&w.lastWeek)&&(e=!1),e?n(".page.pageLeaderboards .titleAndButtons .timer").removeClass("invisible"):n(".page.pageLeaderboards .titleAndButtons .timer").addClass("invisible")}function MO(){qh(),Hm=setInterval(()=>{qh()},1e3)}function EO(){clearInterval(Hm),Hm=void 0,n(".page.pageLeaderboards .titleAndButtons .timer").text("-")}function Bh(){if(w.type!=="allTime"&&w.type!=="daily")return;const e=n(".page.pageLeaderboards .buttonGroup.modeButtons");e.find("button").removeClass("active"),e.find(`button[data-mode=${w.mode2}]`).addClass("active")}function PO(){if(w.type!=="daily")return;const e=n(".page.pageLeaderboards .buttonGroup.languageButtons");e.find("button").removeClass("active"),e.find(`button[data-language=${w.language}]`).addClass("active")}function Dh(){n(".page.pageLeaderboards button").prop("disabled",!0)}function Fh(){n(".page.pageLeaderboards button").prop("disabled",!1)}function IO(e){e<0||e===w.page||JC("goToPage",e)}function JC(e,t){var a,s;if(e==="firstPage")w.page=0;else if(e==="previousPage"&&w.page>0){const i=Math.ceil(w.count/w.pageSize);w.page>i?w.page=i-1:w.page-=1}else if(e==="nextPage")w.page+=1;else if(e==="goToPage"&&t!==void 0)w.page=t;else if(e==="userPage"){if(j()&&((a=xe)==null?void 0:a.currentUser)){const l=(s=w.userData)==null?void 0:s.rank;if(l){const c=Math.floor((l-1)/w.pageSize);if(w.page===c)return;w.page=c,w.scrollToUserAfterFill=!0}}}else return;yi(),Cl(!0),us()}function qO(e){w.type==="daily"&&e==="toggleYesterday"?w.yesterday=!w.yesterday:w.type==="weekly"&&e==="toggleLastWeek"&&(w.lastWeek=!w.lastWeek),yi(),Cl(),us(),ru()}function yi(){if(w.goToUserPage)return;const e={};e.type=w.type,w.type==="allTime"?e.mode2=w.mode2:w.type==="daily"?(e.language=w.language,e.mode2=w.mode2,w.yesterday&&(e.yesterday=!0)):w.type==="weekly"&&w.lastWeek&&(e.lastWeek=!0),e.page=w.page+1;const t=WS({schema:VC,data:e}),a=`${window.location.pathname}?${t.toString()}`;window.history.replaceState({},"",a),QC.set(w)}function BO(){const e=new URLSearchParams(window.location.search);if(e.size===0){Object.assign(w,QC.get());return}const t=IS({schema:VC,input:e});if(!t.success)return;const a=t.data;a.type!==void 0&&(w.type=a.type),w.type==="allTime"?a.mode2&&(w.mode2=a.mode2):w.type==="daily"?(a.language!==void 0&&(w.language=a.language),w.language===void 0&&(w.language="english"),a.mode2!==void 0&&(w.mode2=a.mode2),a.yesterday!==void 0&&(w.yesterday=a.yesterday)):w.type==="weekly"&&a.lastWeek!==void 0&&(w.lastWeek=a.lastWeek),a.page!==void 0&&(w.page=a.page-1,w.page<0&&(w.page=0)),a.goToUserPage&&(w.goToUserPage=!0)}function Ql(e){return zS(e,new Date().getTimezoneOffset())}function Wh(e,t,a){const s=`local time 
`+oe(t,Ph)+` - 
`+oe(a,Ph),i=n(".page.pageLeaderboards .bigtitle .subtext > .text");i.text(`${e}`),i.attr("aria-label",s)}n(".page.pageLeaderboards .jumpButtons button").on("click",function(){const e=n(this).data("action");e!=="goToPage"&&JC(e)});n(".page.pageLeaderboards .bigtitle button").on("click",function(){const e=n(this).data("action");qO(e)});n(".page.pageLeaderboards .buttonGroup.typeButtons").on("click","button",function(){const e=n(this).data("type");w.type!==e&&(w.type=e,w.type==="daily"&&(w.language="english",w.yesterday=!1),w.type==="weekly"&&(w.lastWeek=!1),w.data=null,w.page=0,Cl(),XC(),ru(),Xc(),us(),yi())});n(".page.pageLeaderboards .buttonGroup.secondary").on("click","button",function(){const e=n(this).attr("data-mode"),t=n(this).data("language");if(e!==void 0&&(w.type==="allTime"||w.type==="daily")){if(w.mode2===e)return;w.mode2=e,w.page=0}else if(t!==void 0&&w.type==="daily"){if(w.language===t)return;w.language=t,w.page=0}else return;w.data=null,Cl(),Xc(),ru(),us(),yi()});const DO=new Pa({id:"leaderboards",element:n(".page.pageLeaderboards"),path:"/leaderboards",afterHide:async()=>{Et("pageLeaderboards"),EO()},beforeShow:async()=>{Zt("pageLeaderboards","main"),BO(),MO(),XC(),ru(),Xc(),us(),yi(),Cl(!1)},afterShow:async()=>{Xc()}});n(async()=>{Ht("pageLeaderboards")});Te(e=>{ce()==="leaderboards"&&e==="typingSpeedUnit"&&(us(),YC(),ZC())});async function ba(e,t={}){return t={...{force:!1},...t},new Promise(s=>{if(mr()){console.debug(`change page to ${e} stopped, page transition is true`),s(!1);return}if(!t.force&&ce()===e){console.debug(`change page ${e} stoped, page already active`),s(!1);return}else console.log(`changing page ${e}`);const i={loading:kA,test:lO,settings:fW,about:pO,account:lF,login:AR,profile:vO,profileSearch:wO,404:kO,accountSettings:sO,leaderboards:DO},l=i[ce()],c=i[e];l==null||l.beforeHide().then(()=>{js(!0),n(".page").removeClass("active"),Ja(l.element,c.element,250,async()=>{js(!1),c.element.addClass("active"),s(!0),await(c==null?void 0:c.afterShow()),II()},async()=>{if(c.id==="test")eg();else{const d=c.display??al(c.id);eg(`${d} | Monkeytype`)}gs(!1),I2(c.id),await(l==null?void 0:l.afterHide()),await(c==null?void 0:c.beforeShow({params:t.params,data:t.data}))})})})}function FO(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}function WO(e){const t=e.result.slice(1),s=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(i=>i[1]).map((i,l)=>[i,t[l]]);return Object.fromEntries(s)}const zO={path:"404",load:()=>{ba("404")}},RO=[{path:"/",load:()=>{ba("test")}},{path:"/verify",load:()=>{ba("test")}},{path:"/leaderboards",load:()=>{ba("leaderboards")}},{path:"/about",load:()=>{ba("about")}},{path:"/settings",load:()=>{ba("settings")}},{path:"/login",load:()=>{if(!xe){ft("/");return}if(j()){ft("/account");return}ba("login")}},{path:"/account",load:(e,t)=>{if(!xe){ft("/");return}ba("account",{data:t.data})}},{path:"/account-settings",load:(e,t)=>{if(!xe){ft("/");return}if(!j()){ft("/login");return}ba("accountSettings",{data:t.data})}},{path:"/profile",load:e=>{ba("profileSearch")}},{path:"/profile/:uidOrName",load:(e,t)=>{ba("profile",{force:!0,params:{uidOrName:e.uidOrName},data:t.data})}}];function ft(e=window.location.pathname+window.location.search,t={}){if(_t||Ys||mr()){console.debug(`navigate: ${e} ignored, page is busy (testRestarting: ${_t}, resultCalculating: ${Ys}, pageTransition: ${mr()})`);return}e=e.replace(/\/$/,""),e===""&&(e="/"),history.pushState(null,"",e),e1(t)}async function e1(e={}){const a=RO.map(s=>({route:s,result:location.pathname.match(FO(s.path))})).find(s=>s.result!==null);if(a===void 0){zO.load({},{});return}a.route.load(WO(a),e)}window.addEventListener("popstate",()=>{e1()});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{const t=e==null?void 0:e.target;t.matches("[router-link]")&&(t!=null&&t.href)&&(e.preventDefault(),ft(t.href))})});const Hp=new jt({key:"confirmedPSAs",schema:o.array(Lv),fallback:[]});function OO(){Hp.set([])}function t1(){return Hp.get()}function _O(e){const t=t1();t.push(e),Hp.set(t)}async function HO(){const e=await F.psas.get();if(e.status===500){{const s=(await(await fetch("https://monkeytype.instatus.com/summary.json")).json()).activeMaintenances[0];s!==void 0&&s.status==="INPROGRESS"?Bn(`Server is currently offline for scheduled maintenance. <a target= '_blank' href='${s.url}'>Check the status page</a> for more info.`,-1,"bullhorn",!0,void 0,!0):Bn("Looks like the server is experiencing unexpected down time.<br>Check the <a target= '_blank' href='https://monkeytype.instatus.com/'>status page</a> for more information.",-1,"exclamation-triangle",!1,void 0,!0)}return null}else{if(e.status===503)return Bn("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Check the status page</a> for more info.",-1,"bullhorn",!0,void 0,!0),null;if(e.status!==200)return null}return e.body.data}async function jO(){const e=await HO();if(e===null)return;if(e.length===0){OO();return}const t=t1();e.forEach(a=>{if(a.date){const s=new Date(a.date),i=a.date-Date.now(),l=rt(i/1e3,!1,!1,"text",!1,!0);a.message=a.message.replace("{dateDifference}",l),a.message=a.message.replace("{dateNoTime}",oe(s,"dd MMM yyyy")),a.message=a.message.replace("{date}",oe(s,"dd MMM yyyy HH:mm"))}HR(a.message,a.level??-1),!(t.includes(a._id)&&!(a.sticky??!1))&&Bn(a.message,a.level,"bullhorn",a.sticky,()=>{_O(a._id)},!0)})}const jp=new OS,Np=new _S;async function a1(){if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}de(),n(".sendVerificationEmail").prop("disabled",!0);const e=await F.users.verificationEmail();n(".sendVerificationEmail").prop("disabled",!1),e.status!==200?(Z(),g("Failed to request verification email: "+e.body.message,-1)):(Z(),g("Verification email sent",1))}async function NO(){try{console.log("getting account data"),window.location.pathname!=="/account"?Ha(90):Ha(45),kc("Downloading user data..."),await ab(),await IA()}catch(a){if(console.error(a),ua(!1),Rt(),n("header nav .view-account").css("opacity",1),a instanceof Ri)a.responseCode===429&&(g("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).",0,{duration:0}),g("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.",0,{duration:0})),g("Failed to get user data: "+a.message,-1);else{const s=ae(a,"Failed to get user data");g(s,-1)}return!1}ce()==="loading"?Ha(100):Ha(45),kc("Applying settings...");const e=$();wf(e),DC(e.inboxUnreadSize>0),KI(),WD(e.tags),Promise.all([Of(),yd()]).then(a=>{const[s,i]=a;s.forEach(l=>{Mt.language[l]=!0}),i.forEach(l=>{Mt.funbox[l.name]=!0}),ED()}).catch(a=>{console.log(ae(a,"Something went wrong while loading the filters"))}),e.needsToChangeName&&Bn("You need to update your account name. <a class='openNameChange'>Click here</a> to change it and learn more about why.",-1,void 0,!0,void 0,!0);const t=JSON.stringify(r)===JSON.stringify(e.config);if(r===void 0||!t){console.log("no local config or local and db configs are different - applying db"),await Qn(e.config),li(!0);for(const a of ht("applyGlobalCSS"))a.functions.applyGlobalCSS()}return ua(!1),tW(),window.location.pathname==="/account"&&(Ha(90),await Ip()),window.location.pathname==="/login"?ft("/account"):ft(),!0}async function Sl(e){js(!1),ua(!0),await NO()||cn(),Wt(),ka!==null&&qR()}async function zh(e,t){const a=window.location.search,s=window.location.hash;console.debug("account controller ready"),e?(jO(),console.debug(`auth state changed, user ${t?"true":"false"}`),console.debug(t),t?await Sl():(window.location.pathname==="/account"&&window.history.replaceState("","","/login"),js(!1),ft())):(console.debug("auth not initialised or not connected"),window.location.pathname==="/account"&&window.history.replaceState("","","/login"),js(!1),ft()),FR(a),zR(a),RR(a),BR(s),_o()}let lu;var ry;xe&&Xe()?lu=(ry=xe)==null?void 0:ry.onAuthStateChanged(function(e){zh(!0,e)}):n(()=>{zh(!1,null)});async function GO(e,t){if(xe===void 0){g("Authentication uninitialized",-1);return}if(!Xe()){g("You are offline",0,{duration:2});return}if(lu(),Op(),Rp(),kl(),e===""||t===""){g("Please fill in all fields",0),Wt(),Rt(),zp();return}const a=n(".pageLogin .login #rememberMe input").prop("checked")?Ty:$y;return await Ly(xe,a),HS(xe,e,t).then(async s=>{await Sl(s.user)}).catch(function(s){console.error(s);let i=ae(s,"Failed to sign in with email and password");s instanceof Ay&&(s.code==="auth/wrong-password"?i="Incorrect password":s.code==="auth/user-not-found"?i="User not found":s.code==="auth/invalid-email"?i="Invalid email format (make sure you are using your email to login - not your username)":s.code==="auth/invalid-credential"&&(i="Email/password is incorrect or your account does not have password authentication enabled.")),g(i,-1),Wt(),Rt(),At()})}async function o1(e){if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}if(!Xe()){g("You are offline",0,{duration:2});return}Op(),Rp(),kl(),lu();const t=n(".pageLogin .login #rememberMe input").prop("checked")?Ty:$y;await Ly(xe,t),NS(xe,e).then(async a=>{var s;(s=af(a))!=null&&s.isNewUser?iO(a,!0):await Sl(a.user)}).catch(a=>{console.log(a);let s=ae(a,"Failed to sign in with popup");a instanceof Ay&&(a.code==="auth/wrong-password"?s="Incorrect password":a.code==="auth/user-not-found"?s="User not found":a.code==="auth/invalid-email"?s="Invalid email format (make sure you are using your email to login - not your username)":a.code==="auth/popup-closed-by-user"?s="":a.code==="auth/popup-blocked"?s="Sign in popup was blocked by the browser. Check the address bar for a blocked popup icon, or update your browser settings to allow popups.":a.code==="auth/user-cancelled"?s="":a.code==="auth/account-exists-with-different-credential"&&(s="Account already exists, but its using a different authentication method. Try signing in with a different method")),s!==""&&g(s,-1),Wt(),Rt(),At()})}async function UO(){return o1(jp)}async function KO(){return o1(Np)}async function VO(){return s1("Google",jp)}async function QO(){return s1("GitHub",Np)}async function s1(e,t){if(!Xe()){g("You are offline",0,{duration:2});return}if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}de(),j()&&GS(ld(),t).then(function(){Z(),g(`${e} authentication added`,1),_o()}).catch(function(a){Z();const s=ae(a,`Failed to add ${e} authentication`);g(s,-1)})}function cn(){if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}j()&&xe.signOut().then(function(){g("Signed out",0,{duration:2}),mC(),wf(void 0),ft("/login"),gt(void 0),setTimeout(()=>{VI()},125)}).catch(function(e){const t=ae(e,"Failed to sign out");g(t,-1)})}async function ZO(){if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}if(!Xe()){g("You are offline",0,{duration:2});return}await MR();const e=await IC;if(e===void 0||e===""){g("Please complete the captcha",-1);return}Rp(),kl(),Op();const t=n(".pageLogin .register input")[0].value,a=n(".pageLogin .register input")[1].value,s=n(".pageLogin .register input")[2].value,i=n(".pageLogin .register input")[3].value,l=n(".pageLogin .register input")[4].value;if(t===""||a===""||s===""||i===""){Wt(),Rt(),At(),g("Please fill in all fields",0);return}if(!a.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)){g("Invalid email",0),Wt(),Rt(),At();return}if(a!==s){g("Emails do not match",0),Wt(),Rt(),At();return}if(i!==l){g("Passwords do not match",0),Wt(),Rt(),At();return}if(!ef(i)){g("Password must contain at least one capital letter, number, a special character and must be between 8 and 64 characters long",0,{duration:4}),Wt(),Rt(),At();return}lu();try{const c=await jS(xe,a,i),d=await F.users.create({body:{name:t,captcha:e,email:a,uid:c.user.uid}});if(d.status!==200)throw new Error(`Failed to sign in: ${d.body.message}`);await My(c.user,{displayName:t}),await a1(),Wt(),await Sl(c.user),g("Account created",1)}catch(c){let d=ae(c,"Failed to create account");c instanceof Error&&"code"in c&&c.code==="auth/email-already-in-use"&&(d=ae({message:"Email already in use"},"Failed to create account")),g(d,-1),Wt(),Rt(),At(),cn();return}}n(".pageLogin .login form").on("submit",e=>{e.preventDefault();const t=n(".pageLogin .login input")[0].value??"",a=n(".pageLogin .login input")[1].value??"";GO(t,a)});n(".pageLogin .login button.signInWithGoogle").on("click",()=>{UO()});n(".pageLogin .login button.signInWithGitHub").on("click",()=>{KO()});n("nav .accountButtonAndMenu .menu button.signOut").on("click",()=>{if(xe===void 0){g("Authentication uninitialized",-1,{duration:3});return}cn()});n(".pageLogin .register form").on("submit",e=>{e.preventDefault(),ZO()});n(".pageAccountSettings").on("click","#addGoogleAuth",()=>{VO()});n(".pageAccountSettings").on("click","#addGithubAuth",()=>{QO()});n(".pageAccount").on("click",".sendVerificationEmail",()=>{if(!Xe()){g("You are offline",0,{duration:2});return}a1()});const Re={updateEmail:void 0,updateName:void 0,updatePassword:void 0,removeGoogleAuth:void 0,removeGithubAuth:void 0,removePasswordAuth:void 0,addPasswordAuth:void 0,deleteAccount:void 0,resetAccount:void 0,optOutOfLeaderboards:void 0,applyCustomFont:void 0,resetPersonalBests:void 0,resetSettings:void 0,revokeAllTokens:void 0,unlinkDiscord:void 0,editApeKey:void 0,deleteCustomText:void 0,deleteCustomTextLong:void 0,resetProgressCustomTextLong:void 0,updateCustomTheme:void 0,deleteCustomTheme:void 0,devGenerateData:void 0,lbGoToPage:void 0};function YO(e){const a=["password","github.com","google.com"].filter(s=>s!==e);for(const s of a)if(cu(s))return s}function to(){return cu("password")}function XO(){return cu("github.com")}function JO(){return cu("google.com")}function cu(e){var t,a;return((a=(t=xe)==null?void 0:t.currentUser)==null?void 0:a.providerData.some(s=>s.providerId===e))||!1}async function ya(e){if(xe===void 0)return{status:-1,message:"Authentication is not initialized"};if(!j())return{status:-1,message:"User is not signed in"};const t=ld(),a=YO(e.excludeMethod);try{if(a===void 0)return{status:-1,message:"Failed to reauthenticate: there is no valid authentication present on the account."};if(a==="password"){if(e.password===void 0)return{status:-1,message:"Failed to reauthenticate using password: password missing."};const s=Ey.credential(t.email,e.password);await KS(t,s)}else await VS(t,a==="github.com"?Np:jp);return{status:1,message:"Reauthenticated",user:t}}catch(s){const i=s;return i.code==="auth/wrong-password"?{status:0,message:"Incorrect password"}:i.code==="auth/invalid-credential"?{status:0,message:"Password is incorrect or your account does not have password authentication enabled."}:{status:-1,message:"Failed to reauthenticate: "+((i==null?void 0:i.message)??JSON.stringify(s))}}}Re.updateEmail=new ve({id:"updateEmail",title:"Update email",inputs:[{placeholder:"Password",type:"password",initVal:""},{type:"text",placeholder:"New email",initVal:"",validation:{schema:si}},{type:"text",placeholder:"Confirm new email",initVal:"",validation:{schema:si,isValid:async(e,t)=>{var a,s;return e===((s=(a=t.inputs)==null?void 0:a[1])==null?void 0:s.currentValue())||"Emails don't match"}}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,s)=>{if(a!==s)return{status:0,message:"Emails don't match"};const i=await ya({password:t});if(i.status!==1)return{status:i.status,message:i.message};const l=await F.users.updateEmail({body:{newEmail:a,previousEmail:i.user.email}});return l.status!==200?{status:-1,message:"Failed to update email: "+l.body.message}:(cn(),{status:1,message:"Email updated"})},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});Re.removeGoogleAuth=new ve({id:"removeGoogleAuth",title:"Remove Google authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const a=await ya({password:t,excludeMethod:"google.com"});if(a.status!==1)return{status:a.status,message:a.message};try{await of(a.user,"google.com")}catch(s){return{status:-1,message:ae(s,"Failed to unlink Google account")}}return _o(),Do(3),{status:1,message:"Google authentication removed"}},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],XO()||(e.buttonText="",e.text="Password or GitHub authentication is not enabled")))}});Re.removeGithubAuth=new ve({id:"removeGithubAuth",title:"Remove GitHub authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const a=await ya({password:t,excludeMethod:"github.com"});if(a.status!==1)return{status:a.status,message:a.message};try{await of(a.user,"github.com")}catch(s){return{status:-1,message:ae(s,"Failed to unlink GitHub account")}}return _o(),Do(3),{status:1,message:"GitHub authentication removed"}},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],JO()||(e.buttonText="",e.text="Password or Google authentication is not enabled")))}});Re.removePasswordAuth=new ve({id:"removePaswordAuth",title:"Remove Password authentication",inputs:[{type:"checkbox",label:"I understand I will lose access to my Monkeytype account if my Google/GitHub account is lost or disabled."}],onlineOnly:!0,buttonText:"reauthenticate to remove",execFn:async e=>{const t=await ya({excludeMethod:"password"});if(t.status!==1)return{status:t.status,message:t.message};try{await of(t.user,"password")}catch(a){return{status:-1,message:ae(a,"Failed to remove password authentication")}}return _o(),Do(3),{status:1,message:"Password authentication removed"}},beforeInitFn:()=>{j()}});Re.updateName=new ve({id:"updateName",title:"Update name",inputs:[{placeholder:"password",type:"password",initVal:""},{placeholder:"new name",type:"text",initVal:"",validation:{schema:hi,isValid:async e=>(await F.users.getNameAvailability({params:{name:e}})).status===200?!0:"Name not available"}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{const s=await ya({password:t});if(s.status!==1)return{status:s.status,message:s.message};const i=await F.users.updateName({body:{name:a}});if(i.status!==200)return{status:-1,message:"Failed to update name: "+i.body.message};const l=$();return l&&(l.name=a,gt(l),l.needsToChangeName&&Do(2),wf(l)),{status:1,message:"Name updated"}},beforeInitFn:e=>{if(!j())return;const t=$();t&&(to()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to update"),t.needsToChangeName===!0&&(e.text="You need to change your account name. This might be because you have a duplicate name, no account name or your name is not allowed (contains whitespace or invalid characters). Sorry for the inconvenience."))}});Re.updatePassword=new ve({id:"updatePassword",title:"Update password",inputs:[{placeholder:"current password",type:"password",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,s)=>{if(a!==s)return{status:0,message:"New passwords don't match"};if(a===t)return{status:0,message:"New password must be different from previous password"};if(!ef(a))return{status:0,message:"New password must contain at least one capital letter, number, a special character and must be between 8 and 64 characters long"};const i=await ya({password:t});if(i.status!==1)return{status:i.status,message:i.message};const l=await F.users.updatePassword({body:{newPassword:a}});return l.status!==200?{status:-1,message:"Failed to update password: "+l.body.message}:(cn(),{status:1,message:"Password updated"})},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});Re.addPasswordAuth=new ve({id:"addPasswordAuth",title:"Add password authentication",inputs:[{placeholder:"email",type:"email",initVal:""},{placeholder:"confirm email",type:"email",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"reauthenticate to add",onlineOnly:!0,execFn:async(e,t,a,s,i)=>{if(t!==a)return{status:0,message:"Emails don't match"};if(s!==i)return{status:0,message:"Passwords don't match"};const l=await ya({password:s});if(l.status!==1)return{status:l.status,message:l.message};try{const d=Ey.credential(t,s);await US(l.user,d)}catch(d){return{status:-1,message:ae(d,"Failed to add password authentication")}}const c=await F.users.updateEmail({body:{newEmail:t,previousEmail:l.user.email}});return c.status!==200?{status:-1,message:"Password authentication added but updating the database email failed. This shouldn't happen, please contact support. Error: "+c.body.message}:(_o(),{status:1,message:"Password authentication added"})}});Re.deleteAccount=new ve({id:"deleteAccount",title:"Delete account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"delete",onlineOnly:!0,execFn:async(e,t)=>{const a=await ya({password:t});if(a.status!==1)return{status:a.status,message:a.message};g("Deleting all data...",0);const s=await F.users.delete();return s.status!==200?{status:-1,message:"Failed to delete user data: "+s.body.message}:(Do(3),{status:1,message:"Account deleted, goodbye"})},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="reauthenticate to delete"))}});Re.resetAccount=new ve({id:"resetAccount",title:"Reset account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await ya({password:t});if(a.status!==1)return{status:a.status,message:a.message};g("Resetting settings...",0),await Ff(),g("Resetting account...",0);const s=await F.users.reset();return s.status!==200?{status:-1,message:"Failed to reset account: "+s.body.message}:(Do(3),{status:1,message:"Account reset"})},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});Re.optOutOfLeaderboards=new ve({id:"optOutOfLeaderboards",title:"Opt out of leaderboards",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to opt out of leaderboards?",buttonText:"opt out",onlineOnly:!0,execFn:async(e,t)=>{const a=await ya({password:t});if(a.status!==1)return{status:a.status,message:a.message};const s=await F.users.optOutOfLeaderboards();return s.status!==200?{status:-1,message:"Failed to opt out: "+s.body.message}:(Do(3),{status:1,message:"Leaderboards opt out successful"})},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="reauthenticate to opt out"))}});Re.applyCustomFont=new ve({id:"applyCustomFont",title:"Custom font",inputs:[{type:"text",placeholder:"Font name",initVal:""}],text:"Make sure you have the font installed on your computer before applying",buttonText:"apply",execFn:async(e,t)=>{var a;return(a=z.fontFamily)==null||a.setValue(t.replace(/\s/g,"_")),{status:1,message:"Font applied"}}});Re.resetPersonalBests=new ve({id:"resetPersonalBests",title:"Reset personal bests",inputs:[{placeholder:"password",type:"password",initVal:""}],buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await ya({password:t});if(a.status!==1)return{status:a.status,message:a.message};const s=await F.users.deletePersonalBests();if(s.status!==200)return{status:-1,message:"Failed to reset personal bests: "+s.body.message};const i=$();return i?(i.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},{status:1,message:"Personal bests reset"}):{status:-1,message:"Failed to reset personal bests: no snapshot"}},beforeInitFn:e=>{j()&&(to()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});Re.resetSettings=new ve({id:"resetSettings",title:"Reset settings",text:"Are you sure you want to reset all your settings?",buttonText:"reset",onlineOnly:!0,execFn:async()=>(await Ff(),{status:1,message:"Settings reset"})});Re.revokeAllTokens=new ve({id:"revokeAllTokens",title:"Revoke all tokens",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to do this? This will log you out of all devices.",buttonText:"revoke all",onlineOnly:!0,execFn:async(e,t)=>{const a=await ya({password:t});if(a.status!==1)return{status:a.status,message:a.message};const s=await F.users.revokeAllTokens();return s.status!==200?{status:-1,message:"Failed to revoke tokens: "+s.body.message}:(Do(3),{status:1,message:"Tokens revoked"})},beforeInitFn:e=>{!j()||!$()||to()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to revoke all tokens")}});Re.unlinkDiscord=new ve({id:"unlinkDiscord",title:"Unlink Discord",text:"Are you sure you want to unlink your Discord account?",buttonText:"unlink",onlineOnly:!0,execFn:async()=>{const e=$();if(!e)return{status:-1,message:"Failed to unlink Discord: no snapshot"};const t=await F.users.unlinkDiscord();return t.status!==200?{status:-1,message:"Failed to unlink Discord: "+t.body.message}:(e.discordAvatar=void 0,e.discordId=void 0,$c(void 0,void 0),gt(e),_o(),{status:1,message:"Discord unlinked"})}});Re.deleteCustomText=new ve({id:"deleteCustomText",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(Uw(e.parameters[0],!1),ls("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});Re.deleteCustomTextLong=new ve({id:"deleteCustomTextLong",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(Uw(e.parameters[0],!0),ls("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});Re.resetProgressCustomTextLong=new ve({id:"resetProgressCustomTextLong",title:"Reset progress for custom text",text:"Are you sure?",buttonText:"reset",execFn:async e=>{dm(e.parameters[0],0);const t=Pc(e.parameters[0],!0);return Lo(t),{status:1,message:"Custom text progress reset"}},beforeInitFn:e=>{e.text=`Are you sure you want to reset your progress for custom text ${e.parameters[0]}?`}});Re.updateCustomTheme=new ve({id:"updateCustomTheme",title:"Update custom theme",inputs:[{type:"text",placeholder:"name",initVal:""},{type:"checkbox",initVal:!1,label:"Update custom theme to current colors",optional:!0}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{var u;const s=$();if(!s)return{status:-1,message:"Failed to update custom theme: no snapshot"};const i=(u=s.customThemes)==null?void 0:u.find(m=>m._id===e.parameters[0]);if(i===void 0)return{status:-1,message:"Failed to update custom theme: theme not found"};let l=[];if(a==="true")for(const m of Io)l.push(n(`.pageSettings .customTheme .customThemeEdit #${m}[type='color']`).attr("value"));else l=i.colors;const c={name:t.replaceAll(" ","_"),colors:l};return await BA(i._id,c)?(wr(l),Nr(),{status:1,message:"Custom theme updated"}):{status:-1,message:"Failed to update custom theme"}},beforeInitFn:e=>{var s;const t=$();if(!t)return;const a=(s=t.customThemes)==null?void 0:s.find(i=>i._id===e.parameters[0]);a&&(e.inputs[0].initVal=a.name)}});Re.deleteCustomTheme=new ve({id:"deleteCustomTheme",title:"Delete custom theme",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>(await DA(e.parameters[0]),Nr(),{status:1,message:"Custom theme deleted"})});Re.devGenerateData=new ve({id:"devGenerateData",title:"Generate data",showLabels:!0,inputs:[{type:"text",label:"username",placeholder:"username",oninput:e=>{const t=e.target,a=document.querySelector("#devGenerateData_1 + span");a.innerHTML=`if checked, user will be created with ${t.value}@example.com and password: password`},validation:{schema:hi}},{type:"checkbox",label:"create user",description:"if checked, user will be created with {username}@example.com and password: password",optional:!0},{type:"date",label:"first test",optional:!0},{type:"date",label:"last test",max:new Date,optional:!0},{type:"range",label:"min tests per day",initVal:0,min:0,max:200,step:10},{type:"range",label:"max tests per day",initVal:50,min:0,max:200,step:10}],buttonText:"generate (might take a while)",execFn:async(e,t,a,s,i,l,c)=>{const d={username:t,createUser:a==="true"};s!==void 0&&s.length>0&&(d.firstTestTimestamp=Date.parse(s)),i!==void 0&&i.length>0&&(d.lastTestTimestamp=Date.parse(i)),l!==void 0&&l.length>0&&(d.minTestsPerDay=Number.parseInt(l)),c!==void 0&&c.length>0&&(d.maxTestsPerDay=Number.parseInt(c));const u=await F.dev.generateData({body:d});return{status:u.status===200?1:-1,message:u.body.message,hideOptions:{clearModalChain:!0}}}});Re.lbGoToPage=new ve({id:"lbGoToPage",title:"Go to page",inputs:[{type:"number",placeholder:"Page number"}],buttonText:"Go",execFn:async(e,t)=>{const a=parseInt(t,10);return isNaN(a)||a<1?{status:0,message:"Invalid page number"}:(IO(a-1),{status:1,message:"Navigating to page "+a,showNotification:!1})}});function Ne(e,t=[],a={}){const s=Re[e];if(s===void 0){g("Failed to show popup - popup is not defined",-1);return}s.show(t,a)}n(".pageAccountSettings").on("click","#unlinkDiscordButton",()=>{Ne("unlinkDiscord")});n(".pageAccountSettings").on("click","#removeGoogleAuth",()=>{Ne("removeGoogleAuth")});n(".pageAccountSettings").on("click","#removeGithubAuth",()=>{Ne("removeGithubAuth")});n(".pageAccountSettings").on("click","#removePasswordAuth",()=>{Ne("removePasswordAuth")});n("#resetSettingsButton").on("click",()=>{Ne("resetSettings")});n(".pageAccountSettings").on("click","#revokeAllTokens",()=>{Ne("revokeAllTokens")});n(".pageAccountSettings").on("click","#resetPersonalBestsButton",()=>{Ne("resetPersonalBests")});n(".pageAccountSettings").on("click","#updateAccountName",()=>{Ne("updateName")});n("#bannerCenter").on("click",".banner .text .openNameChange",()=>{Ne("updateName")});n(".pageAccountSettings").on("click","#addPasswordAuth",()=>{Ne("addPasswordAuth")});n(".pageAccountSettings").on("click","#emailPasswordAuth",()=>{Ne("updateEmail")});n(".pageAccountSettings").on("click","#passPasswordAuth",()=>{Ne("updatePassword")});n(".pageAccountSettings").on("click","#deleteAccount",()=>{Ne("deleteAccount")});n(".pageAccountSettings").on("click","#resetAccount",()=>{Ne("resetAccount")});n(".pageAccountSettings").on("click","#optOutOfLeaderboardsButton",()=>{Ne("optOutOfLeaderboards")});n(".pageSettings").on("click",".section.themes .customTheme .delButton",e=>{const a=n(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Ne("deleteCustomTheme",[a])});n(".pageSettings").on("click",".section.themes .customTheme .editButton",e=>{const a=n(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Ne("updateCustomTheme",[a],{focusFirstInput:"focusAndSelect"})});n(".pageSettings").on("click",".section[data-config-name='fontFamily'] button[data-config-value='custom']",()=>{Ne("applyCustomFont")});async function n1(){const e=um(),t=n("#savedTextsModal .list").empty();let a="";if(e.length===0)a+="<div>No saved custom texts found</div>";else for(const c of e)a+=`<div class="savedText" data-name="${Gt(c)}">
      <div class="button name">${Gt(c)}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;t.html(a);const s=um(!0),i=n("#savedTextsModal .listLong").empty();let l="";if(s.length===0)l+="<div>No saved long custom texts found</div>";else for(const c of s)l+=`<div class="savedLongText" data-name="${Gt(c)}">
      <div class="button name">${Gt(c)}</div>
      <div class="button ${jf(c)<=0?"disabled":""} resetProgress">reset</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;i.html(l),n("#savedTextsModal .list .savedText .button.delete").on("click",c=>{const d=n(c.target).closest(".savedText").data("name");if(d===void 0){g("Failed to show delete modal: no name found",-1);return}Ne("deleteCustomText",[d],{modalChain:dr})}),n("#savedTextsModal .listLong .savedLongText .button.delete").on("click",c=>{const d=n(c.target).closest(".savedLongText").data("name");if(d===void 0){g("Failed to show delete modal: no name found",-1);return}Ne("deleteCustomTextLong",[d],{modalChain:dr})}),n("#savedTextsModal .listLong .savedLongText .button.resetProgress").on("click",c=>{const d=n(c.target).closest(".savedLongText").data("name");if(d===void 0){g("Failed to show delete modal: no name found",-1);return}Ne("resetProgressCustomTextLong",[d],{modalChain:dr})}),n("#savedTextsModal .list .savedText .button.name").on("click",c=>{const d=n(c.target).text();ls(d,!1);const u=Oh(d,!1);Rh({modalChainData:{text:u,long:!1}})}),n("#savedTextsModal .listLong .savedLongText .button.name").on("click",c=>{const d=n(c.target).text();ls(d,!0);const u=Oh(d,!0);Rh({modalChainData:{text:u,long:!0}})})}async function e_(e){dr.show({...e,beforeAnimation:async()=>{n1()}})}function Rh(e){dr.hide({...e})}function Oh(e,t){let a=Pc(e,t);return t&&(a=a.slice(jf(e))),a.join(" ")}async function t_(){}const dr=new fe({dialogId:"savedTextsModal",setup:t_,showOptionsWhenInChain:{beforeAnimation:async()=>{n1()}}});let wt;const Jc={textToSave:[]};async function a_(e){Jc.textToSave=[],i1.show({...e,beforeAnimation:async(t,a)=>{Jc.textToSave=(a==null?void 0:a.text)??[],n("#saveCustomTextModal .textName").val(""),n("#saveCustomTextModal .isLongText").prop("checked",!1),n("#saveCustomTextModal button.save").prop("disabled",!0)}})}function o_(){i1.hide()}function s_(){const e=n("#saveCustomTextModal .textName").val(),t=n("#saveCustomTextModal .isLongText").prop("checked");return e?Jc.textToSave.length===0?(g("Custom text can't be empty",0),!1):l2(e,Jc.textToSave,t)?(ls(e,t),g("Custom text saved",1),!0):(g("Error saving custom text",-1),!1):(g("Custom text needs a name",0),!1)}function n_(){const e=n("#saveCustomTextModal .textName").val(),t=n("#saveCustomTextModal .isLongText").prop("checked");e?um(t).includes(e)?(wt==null||wt.show("unavailable"),n("#saveCustomTextModal button.save").prop("disabled",!0)):(wt==null||wt.show("available"),n("#saveCustomTextModal button.save").prop("disabled",!1)):(wt==null||wt.hide(),n("#saveCustomTextModal button.save").prop("disabled",!0))}const _h=Pt(500,n_);async function i_(e){var t,a;wt=new Oo(n("#saveCustomTextModal .textName"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},loading:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),e.addEventListener("submit",s=>{s.preventDefault(),s_()&&o_()}),(t=e.querySelector(".textName"))==null||t.addEventListener("input",s=>{s.target.value.length>0&&(wt==null||wt.show("loading"),_h())}),(a=e.querySelector(".isLongText"))==null||a.addEventListener("input",s=>{s.target.value.length>0&&(wt==null||wt.show("loading"),_h())})}const i1=new fe({dialogId:"saveCustomTextModal",setup:i_}),Y="#customTextModal .modal",A={textarea:cl().join(di()?"|":" "),longCustomTextWarning:!1,challengeWarning:!1,customTextMode:"simple",customTextLimits:{word:"",time:"",section:""},removeFancyTypographyEnabled:!0,replaceControlCharactersEnabled:!0,customTextPipeDelimiter:!1,replaceNewlines:"off",removeZeroWidthCharactersEnabled:!0};function Nt(){n(`${Y} .inputs .group[data-id="mode"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="mode"] button[value="${A.customTextMode}"]`).addClass("active"),n(`${Y} .inputs .group[data-id="limit"] input.words`).addClass("hidden"),n(`${Y} .inputs .group[data-id="limit"] input.sections`).addClass("hidden"),n(`${Y} .inputs .group[data-id="limit"] input.words`).val(A.customTextLimits.word),n(`${Y} .inputs .group[data-id="limit"] input.time`).val(A.customTextLimits.time),n(`${Y} .inputs .group[data-id="limit"] input.sections`).val(A.customTextLimits.section),A.customTextLimits.word!==""&&n(`${Y} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),A.customTextLimits.section!==""&&n(`${Y} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),A.customTextPipeDelimiter?(n(`${Y} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),n(`${Y} .inputs .group[data-id="limit"] input.words`).addClass("hidden")):(n(`${Y} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),n(`${Y} .inputs .group[data-id="limit"] input.sections`).addClass("hidden")),A.customTextMode==="simple"?(n(`${Y} .inputs .group[data-id="limit"]`).addClass("disabled"),n(`${Y} .inputs .group[data-id="limit"] input`).val(""),n(`${Y} .inputs .group[data-id="limit"] input`).prop("disabled",!0)):(n(`${Y} .inputs .group[data-id="limit"]`).removeClass("disabled"),n(`${Y} .inputs .group[data-id="limit"] input`).prop("disabled",!1)),n(`${Y} .inputs .group[data-id="fancy"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="fancy"] button[value="${A.removeFancyTypographyEnabled}"]`).addClass("active"),n(`${Y} .inputs .group[data-id="control"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="control"] button[value="${A.replaceControlCharactersEnabled}"]`).addClass("active"),n(`${Y} .inputs .group[data-id="zeroWidth"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="zeroWidth"] button[value="${A.removeZeroWidthCharactersEnabled}"]`).addClass("active"),n(`${Y} .inputs .group[data-id="delimiter"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="delimiter"] button[value="${A.customTextPipeDelimiter}"]`).addClass("active"),n(`${Y} .inputs .group[data-id="newlines"] button`).removeClass("active"),n(`${Y} .inputs .group[data-id="newlines"] button[value="${A.replaceNewlines}"]`).addClass("active"),n(`${Y} textarea`).val(A.textarea),A.longCustomTextWarning?(n(`${Y} .longCustomTextWarning`).removeClass("hidden"),n(`${Y} .randomWordsCheckbox input`).prop("checked",!1),n(`${Y} .delimiterCheck input`).prop("checked",!1),n(`${Y} .typographyCheck`).prop("checked",!0),n(`${Y} .replaceNewlineWithSpace input`).prop("checked",!1),n(`${Y} .inputs`).addClass("disabled")):(n(`${Y} .longCustomTextWarning`).addClass("hidden"),n(`${Y} .inputs`).removeClass("disabled")),A.challengeWarning?(n(`${Y} .challengeWarning`).removeClass("hidden"),n(`${Y} .randomWordsCheckbox input`).prop("checked",!1),n(`${Y} .delimiterCheck input`).prop("checked",!1),n(`${Y} .typographyCheck`).prop("checked",!0),n(`${Y} .replaceNewlineWithSpace input`).prop("checked",!1),n(`${Y} .inputs`).addClass("disabled")):(n(`${Y} .challengeWarning`).addClass("hidden"),n(`${Y} .inputs`).removeClass("disabled"))}async function r1(e,t){if(A.customTextMode=er(),A.customTextMode==="repeat"&&je()==="word"&&qe()===cl().length&&(A.customTextMode="simple"),A.customTextLimits.word="",A.customTextLimits.time="",A.customTextLimits.section="",je()==="word"?A.customTextLimits.word=`${qe()}`:je()==="time"?A.customTextLimits.time=`${qe()}`:je()==="section"&&(A.customTextLimits.section=`${qe()}`),A.customTextPipeDelimiter=di(),A.longCustomTextWarning=Po()??!1,(t==null?void 0:t.text)!==void 0){t.long!==!0&&Po()&&(ls("",void 0),g("Disabled long custom text progress tracking",0,{duration:5}),A.longCustomTextWarning=!1);const a=t.set??!0?t.text:A.textarea+" "+t.text;A.textarea=a,A.customTextMode="simple",A.customTextLimits.word=`${ed().length}`,A.customTextLimits.time="",A.customTextLimits.section=""}Nt()}async function l1(){!A.challengeWarning&&!A.longCustomTextWarning&&n(`${Y} textarea`).trigger("focus")}function c1(e){A.textarea=cl().join(di()?"|":" ").replace(/^ +/gm,""),ur.show({...e,beforeAnimation:r1,afterAnimation:l1})}function jm(){ur.hide()}function r_(){var t;const e=(t=n("#fileInput")[0].files)==null?void 0:t[0];if(e){if(e.type!=="text/plain"){g("File is not a text file",-1,{duration:5});return}const a=new FileReader;a.readAsText(e,"UTF-8"),a.onload=s=>{var l;const i=(l=s.target)==null?void 0:l.result;A.textarea=i,Nt(),n("#fileInput").val("")},a.onerror=()=>{g("Failed to read file",-1,{duration:5})}}}function ed(){let e=A.textarea;return e===""?[]:(e=e.normalize().trim(),e=e.replace(/[\u2000-\u200A\u202F\u205F\u00A0]/g," "),A.removeZeroWidthCharactersEnabled&&(e=e.replace(/[\u200B-\u200D\u2060\uFEFF]/g,"")),A.replaceControlCharactersEnabled&&(e=e.replace(/([^\\]|^)\\t/gm,"$1	"),e=e.replace(/\\n/g,` 
`),e=e.replace(/([^\\]|^)\\n/gm,`$1
`),e=e.replace(/\\\\t/gm,"\\t"),e=e.replace(/\\\\n/gm,"\\n")),e=e.replace(/ +/gm," "),e=e.replace(/( *(\r\n|\r|\n) *)/g,`
 `),A.removeFancyTypographyEnabled&&(e=Cb(e)),A.replaceNewlines!=="off"&&(A.replaceNewlines==="periodSpace"?(e=e.replace(/\n/gm,". "),e=e.replace(/\.\. /gm,". "),e=e.replace(/ +/gm," ")):(e=e.replace(/\n/gm," "),e=e.replace(/ +/gm," "))),e.split(A.customTextPipeDelimiter?"|":" ").filter(a=>a!==""))}function l_(){if(A.textarea===""){g("Text cannot be empty",0);return}if([A.customTextLimits.word,A.customTextLimits.time,A.customTextLimits.section].filter(t=>t!=="").length>1){g("You can only specify one limit",0,{duration:5});return}if(A.customTextMode!=="simple"&&A.customTextLimits.word===""&&A.customTextLimits.time===""&&A.customTextLimits.section===""){g("You need to specify a limit",0,{duration:5});return}(A.customTextLimits.section==="0"||A.customTextLimits.word==="0"||A.customTextLimits.time==="0")&&g("Infinite test! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});const e=ed();A.customTextMode==="simple"?(Zn("repeat"),A.customTextLimits.word=`${e.length}`,A.customTextLimits.time="",A.customTextLimits.section=""):Zn(A.customTextMode),Vs(A.customTextPipeDelimiter),Lo(e),A.customTextMode==="simple"&&A.customTextPipeDelimiter?(xa("section"),Ua(e.length)):A.customTextLimits.word!==""?(xa("word"),Ua(parseInt(A.customTextLimits.word))):A.customTextLimits.time!==""?(xa("time"),Ua(parseInt(A.customTextLimits.time))):A.customTextLimits.section!==""&&(xa("section"),Ua(parseInt(A.customTextLimits.section))),sk(),be(),r.mode!=="custom"&&dt("custom"),le(),jm()}function c_(){let e=A.textarea.split(A.customTextPipeDelimiter?" ":"|").join(A.customTextPipeDelimiter?"|":" ");e=e.replace(/\n /g,`
`),A.textarea=e}async function d_(e){var s,i,l,c,d,u,m,f,p,h;(s=e.querySelector("#fileInput"))==null||s.addEventListener("change",r_);const t=e.querySelectorAll(".group[data-id='mode'] button");for(const y of t)y.addEventListener("click",b=>{if(A.customTextMode=b.target.value,A.customTextMode==="simple"){const v=ed();A.customTextLimits.word=`${v.length}`,A.customTextLimits.time="",A.customTextLimits.section=""}Nt()});for(const y of e.querySelectorAll(".group[data-id='fancy'] button"))y.addEventListener("click",b=>{A.removeFancyTypographyEnabled=b.target.value==="true",Nt()});for(const y of e.querySelectorAll(".group[data-id='control'] button"))y.addEventListener("click",b=>{A.replaceControlCharactersEnabled=b.target.value==="true",Nt()});for(const y of e.querySelectorAll(".group[data-id='zeroWidth'] button"))y.addEventListener("click",b=>{A.removeZeroWidthCharactersEnabled=b.target.value==="true",Nt()});for(const y of e.querySelectorAll(".group[data-id='delimiter'] button"))y.addEventListener("click",b=>{A.customTextPipeDelimiter=b.target.value==="true",A.customTextPipeDelimiter&&A.customTextLimits.word!==""&&(A.customTextLimits.word=""),!A.customTextPipeDelimiter&&A.customTextLimits.section!==""&&(A.customTextLimits.section=""),c_(),Nt()});for(const y of e.querySelectorAll(".group[data-id='newlines'] button"))y.addEventListener("click",b=>{A.replaceNewlines=b.target.value,Nt()});(i=e.querySelector(".group[data-id='limit'] input.words"))==null||i.addEventListener("input",y=>{A.customTextLimits.word=y.target.value,A.customTextLimits.time="",A.customTextLimits.section="",Nt()}),(l=e.querySelector(".group[data-id='limit'] input.time"))==null||l.addEventListener("input",y=>{A.customTextLimits.time=y.target.value,A.customTextLimits.word="",A.customTextLimits.section="",Nt()}),(c=e.querySelector(".group[data-id='limit'] input.sections"))==null||c.addEventListener("input",y=>{A.customTextLimits.section=y.target.value,A.customTextLimits.word="",A.customTextLimits.time="",Nt()});const a=e.querySelector("textarea");a==null||a.addEventListener("input",y=>{A.textarea=y.target.value}),a==null||a.addEventListener("keydown",y=>{if(y.key!=="Tab")return;y.preventDefault();const b=y.target,v=b.selectionStart,C=b.selectionEnd;b.value=b.value.substring(0,v)+"	"+b.value.substring(C),b.selectionStart=b.selectionEnd=v+1,A.textarea=b.value}),a==null||a.addEventListener("keypress",y=>{if(A.longCustomTextWarning||A.challengeWarning){y.preventDefault();return}y.code==="Enter"&&y.ctrlKey&&n(`${Y} .button.apply`).trigger("click"),Po()&&np()!==""&&(ls("",void 0),A.longCustomTextWarning=!1,g("Disabled long custom text progress tracking",0,{duration:5}))}),(d=e.querySelector(".button.apply"))==null||d.addEventListener("click",()=>{l_()}),(u=e.querySelector(".button.wordfilter"))==null||u.addEventListener("click",()=>{VF({modalChain:ur})}),(m=e.querySelector(".button.showSavedTexts"))==null||m.addEventListener("click",()=>{e_({modalChain:ur})}),(f=e.querySelector(".button.saveCustomText"))==null||f.addEventListener("click",()=>{a_({modalChain:ur,modalChainData:{text:ed()}})}),(p=e.querySelector(".longCustomTextWarning"))==null||p.addEventListener("click",()=>{A.longCustomTextWarning=!1,Nt()}),(h=e.querySelector(".challengeWarning"))==null||h.addEventListener("click",()=>{A.challengeWarning=!1,Nt()})}const ur=new fe({dialogId:"customTextModal",setup:d_,customEscapeHandler:async()=>{jm()},customWrapperClickHandler:async()=>{jm()},showOptionsWhenInChain:{beforeAnimation:r1,afterAnimation:l1}});function d1(){const e=n("#mobileTestConfigModal");if(e.find("button").removeClass("active"),e.find(`.modeGroup button[data-mode='${r.mode}']`).addClass("active"),e.find(".timeGroup").addClass("hidden"),e.find(".wordsGroup").addClass("hidden"),e.find(".quoteGroup").addClass("hidden"),e.find(".customGroup").addClass("hidden"),e.find(`.${r.mode}Group`).removeClass("hidden"),r.punctuation?e.find(".punctuation").addClass("active"):e.find(".punctuation").removeClass("active"),r.numbers?e.find(".numbers").addClass("active"):e.find(".numbers").removeClass("active"),r.mode==="time")e.find(`.timeGroup button[data-time='${r.time}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="words")e.find(`.wordsGroup button[data-words='${r.words}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="quote"){for(const t of r.quoteLength)e.find(`.quoteGroup button[data-quoteLength='${t}']`).addClass("active");e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")}else r.mode==="zen"?(e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")):r.mode==="custom"&&(e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled"))}function u_(){Ki.show({beforeAnimation:async()=>{d1()}})}async function m_(e){var c,d,u;const t=e.querySelectorAll(".wordsGroup button");for(const m of t)m.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-words");if(h==="custom")qk({modalChain:Ki});else if(h!==void 0){const y=parseInt(h);ns(y),be(),le()}});const a=e.querySelectorAll(".modeGroup button");for(const m of a)m.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-mode");h!==r.mode&&(dt(h),be(),le())});const s=e.querySelectorAll(".timeGroup button");for(const m of s)m.addEventListener("click",f=>{const h=f.currentTarget.getAttribute("data-time");if(h==="custom")Jk({modalChain:Ki});else if(h!==void 0){const y=parseInt(h);Ga(y),be(),le()}});const i=e.querySelectorAll(".quoteGroup button");for(const m of i)m.addEventListener("click",f=>{const p=f.currentTarget,h=parseInt(p.getAttribute("data-quoteLength")??"0",10);if(h===-2)iC({modalChain:Ki});else{let y=h;h===-1&&(y=[0,1,2,3]),ho(y,!1,f.shiftKey),be(),le()}});(c=e.querySelector(".customChange"))==null||c.addEventListener("click",()=>{c1({modalChain:Ki})}),(d=e.querySelector(".punctuation"))==null||d.addEventListener("click",()=>{Ea(!r.punctuation),be(),le()}),(u=e.querySelector(".numbers"))==null||u.addEventListener("click",()=>{ma(!r.numbers),be(),le()});const l=e.querySelectorAll("button");for(const m of l)m.addEventListener("click",()=>{d1()})}const Ki=new fe({dialogId:"mobileTestConfigModal",setup:m_}),ts={missed:"words",slow:!1},wn="#practiseWordsModal .modal";function Ou(){n(`${wn} .group[data-id="missed"] button`).removeClass("active"),n(`${wn} .group[data-id="missed"] button[value="${ts.missed}"]`).addClass("active"),n(`${wn} .group[data-id="slow"] button`).removeClass("active"),n(`${wn} .group[data-id="slow"] button[value="${ts.slow}"]`).addClass("active"),ts.missed==="off"&&!ts.slow?n(`${wn} .start`).prop("disabled",!0):n(`${wn} .start`).prop("disabled",!1)}async function f_(e){var t;for(const a of e.querySelectorAll(".group[data-id='missed'] button"))a.addEventListener("click",s=>{ts.missed=s.target.value,Ou()});for(const a of e.querySelectorAll(".group[data-id='slow'] button"))a.addEventListener("click",s=>{ts.slow=s.target.value==="true",Ou()});(t=e.querySelector(".start"))==null||t.addEventListener("click",()=>{Hh()}),e.addEventListener("submit",a=>{a.preventDefault(),Hh()}),Ou()}function p_(e){u1.show(e)}function g_(e=!1){u1.hide({clearModalChain:e})}function Hh(){JE(ts.missed,ts.slow),g_(!0),le({practiseMissed:!0})}const u1=new fe({dialogId:"practiseWordsModal",setup:f_});n(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=n(e.currentTarget).attr("commands");t!==void 0&&(await nn()).show({subgroupOverride:t})});n(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=n(e.currentTarget).attr("commandId");t!==void 0&&(await nn()).show({commandOverride:t})});n(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{n(e.currentTarget).attr("wordCount")==="custom"&&qk()});n(".pageTest").on("click","#testConfig .time .textButton",e=>{n(e.currentTarget).attr("timeconfig")==="custom"&&Jk()});n(".pageTest").on("click",".tags .editTagsButton",()=>{var e,t;if((((t=(e=$())==null?void 0:e.tags)==null?void 0:t.length)??0)>0){const a=n(".pageTest .tags .editTagsButton").attr("data-result-id"),s=n(".pageTest .tags .editTagsButton").attr("data-active-tag-ids"),i=s===""?[]:s.split(",");Qk(a,i,"resultPage")}});n(".pageTest").on("click","#mobileTestConfigButton",()=>{u_()});n(".pageTest #rateQuoteButton").on("click",async()=>{if(re===null){g("Failed to show quote rating popup: no quote",-1);return}hI(re)});n(".pageTest #reportQuoteButton").on("click",async()=>{if(re===null){g("Failed to show quote report popup: no quote",-1);return}sC(re==null?void 0:re.id)});n(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{parseInt(n(e.currentTarget).attr("quoteLength")??"0")===-2&&iC()});n(".pageTest").on("click","#testConfig .customText .textButton",()=>{c1()});n(".pageTest").on("click","#practiseWordsButton",()=>{if(r.mode==="zen"){g("Practice words is unsupported in zen mode",0);return}p_()});n(".pageTest #dailyLeaderboardRank").on("click",async()=>{ft(`/leaderboards?type=daily&language=${r.language}&mode2=${Qr(r,null)}&goToUserPage=true`)});var ly;(ly=document.querySelector("#pageAbout #supportMeAboutButton"))==null||ly.addEventListener("click",()=>{Aw()});var cy;(cy=document.querySelector("#pageAbout #contactPopupButton2"))==null||cy.addEventListener("click",()=>{Ew()});const Gp={includeBackground:!1};function h_(){Nm.show({beforeAnimation:async e=>{e.querySelector("input[type='checkbox']").checked=!1,Gp.includeBackground=!1}})}async function y_(){const e={c:Io.map(t=>n(`.pageSettings .customTheme .customThemeEdit #${t}[type='color']`).attr("value"))};return Gp.includeBackground&&(e.i=r.customBackground,e.s=r.customBackgroundSize,e.f=r.customBackgroundFilter),window.location.origin+"?customTheme="+btoa(JSON.stringify(e))}async function b_(){const e=await y_();try{await navigator.clipboard.writeText(e),g("URL Copied to clipboard",1),Nm.hide()}catch{g("Looks like we couldn't copy the link straight to your clipboard. Please copy it manually.",0,{duration:5}),Gm.show({modalChain:Nm,focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{a.querySelector("input").value=e}})}}const Nm=new fe({dialogId:"shareCustomThemeModal",setup:async e=>{var t,a;(t=e.querySelector("button"))==null||t.addEventListener("click",b_),(a=e.querySelector("input[type='checkbox']"))==null||a.addEventListener("change",s=>{Gp.includeBackground=s.target.checked})}}),Gm=new fe({dialogId:"shareCustomThemeUrlModal",customEscapeHandler:async()=>{await Gm.hide({clearModalChain:!0})},customWrapperClickHandler:async()=>{await Gm.hide({clearModalChain:!0})}}),v_=o.object({security:o.boolean(),analytics:o.boolean()}),m1=new jt({key:"acceptedCookies",schema:v_,fallback:void 0});function _u(e){m1.set(e)}function w_(){m1.get()===void 0&&f1()}function f1(e){Kr.show({beforeAnimation:async()=>{e&&p1()},afterAnimation:async()=>{Vt("cookiesModal")||Kr.destroy()}})}function p1(){var e,t;(e=Kr.getModal().querySelector(".main"))==null||e.classList.add("hidden"),(t=Kr.getModal().querySelector(".settings"))==null||t.classList.remove("hidden")}async function Hu(){Kr.hide({afterAnimation:async()=>{Bd()}})}const Kr=new fe({dialogId:"cookiesModal",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{},setup:async e=>{var t,a,s,i,l;(t=e.querySelector(".acceptAll"))==null||t.addEventListener("click",()=>{_u({security:!0,analytics:!0}),tm(),Hu()}),(a=e.querySelector(".rejectAll"))==null||a.addEventListener("click",()=>{_u({security:!0,analytics:!1}),Hu()}),(s=e.querySelector(".openSettings"))==null||s.addEventListener("click",()=>{p1()}),(i=e.querySelector(".cookie.ads .textButton"))==null||i.addEventListener("click",()=>{try{BI()}catch{console.error("Failed to open ad consent UI"),g("Failed to open Ad consent popup. Do you have an ad or cookie popup blocker enabled?",-1)}}),(l=e.querySelector(".acceptSelected"))==null||l.addEventListener("click",()=>{const c=e.querySelector(".cookie.analytics input").checked;_u({security:!0,analytics:c}),Hu(),c&&tm()})}});var pc=o.string().regex(/^\d+$/,'Needs to be a number or a number represented as a string e.g. "10".').or(o.number().transform(String)),du=()=>o.string().regex(/^[a-zA-Z0-9_]+$/),k_=du(),C_=du().max(50),g1=o.string().max(50).regex(/^[a-zA-Z0-9_+]+$/,"Can only contain letters [a-zA-Z0-9_+]");o.string().nullable().optional().transform(e=>e??void 0);o.number().nonnegative().max(100);o.number().nonnegative().max(420);o.enum(["repeat","random","shuffle"]);o.enum(["word","time","section"]);var h1=o.enum(["normal","expert","master"]),Fi=o.object({acc:o.number().nonnegative().max(100),consistency:o.number().nonnegative().max(100),difficulty:h1,lazyMode:o.boolean().optional(),language:o.string().max(100).regex(/[\w+]+/),punctuation:o.boolean().optional(),numbers:o.boolean().optional(),raw:o.number().nonnegative(),wpm:o.number().nonnegative(),timestamp:o.number().nonnegative()}),S_=o.object({time:o.record(pc.describe("Number of seconds as string"),o.array(Fi)),words:o.record(pc.describe("Number of words as string"),o.array(Fi)),quote:o.record(pc,o.array(Fi)),custom:o.record(o.literal("custom"),o.array(Fi)),zen:o.record(o.literal("zen"),o.array(Fi))});o.union([o.literal("10"),o.literal("25"),o.literal("50"),o.literal("100")]);o.union([o.literal("15"),o.literal("30"),o.literal("60"),o.literal("120")]);o.union([o.literal("short"),o.literal("medium"),o.literal("long"),o.literal("thicc")]);var x_=S_.keyof();o.union([pc,pa("zen"),pa("custom")],{errorMap:()=>({message:'Needs to be either a number, "zen" or "custom".'})});var T_=o.enum(["off","slow","medium","fast"]),$_=o.enum(["off","esc","tab","enter"]),L_=o.union([o.literal(-3),o.literal(-2),o.literal(-1),o.literal(0),o.literal(1),o.literal(2),o.literal(3)]),A_=o.array(L_),jh=o.enum(["off","default","block","outline","underline","carrot","banana"]),M_=o.enum(["off","on","max"]),E_=o.enum(["off","below","replace"]),P_=o.enum(["off","bar","text","mini"]),ju=o.enum(["off","text","mini"]),I_=o.enum(["off","on","fav","light","dark","custom"]),q_=o.enum(["black","sub","text","main"]),B_=o.enum(["0.25","0.5","0.75","1"]),D_=o.enum(["off","word","letter"]),F_=o.enum(["off","static","react","next"]),W_=o.enum(["staggered","alice","matrix","split","split_matrix","steno","steno_matrix"]),z_=o.enum(["lowercase","uppercase","blank","dynamic"]),R_=o.enum(["always","layout","never"]),O_=o.number().min(.5).max(3.5).step(.1),__=o.enum(["manual","on"]),H_=o.enum(["off","1","2","3","4"]),j_=o.enum(["off","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]),N_=o.number().min(0).max(1),G_=o.enum(["off","average","pb","tagPb","last","custom","daily"]),U_=o.tuple([o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"]),o.enum(["on","off"])]),K_=o.enum(["off","custom"]),V_=o.enum(["off","letter","word","next_word","next_two_words","next_three_words"]),Q_=o.enum(["off","letter","word"]),Z_=o.number().min(10).max(90),Y_=o.enum(["wpm","cpm","wps","cps","wph"]),X_=o.enum(["off","result","on","sellout"]),J_=o.enum(["off","custom"]),e5=o.enum(["off","typing"]),t5=o.enum(["off","on","keymap"]),a5=o.enum(["cover","contain","max"]),o5=o.tuple([o.number(),o.number(),o.number(),o.number()]),s5=o.string().regex(/^[0-9a-zA-Z_#]+$/),n5=o.array(g1).min(1),i5=o.enum(["off","1","2","3","4"]),r5=o.enum(["off","fixed","flex"]),l5=o.enum(["off","speed","acc","both"]),Ra=o.string().regex(/^#([\da-f]{3}){1,2}$/i),c5=h1,d5=o.tuple([Ra,Ra,Ra,Ra,Ra,Ra,Ra,Ra,Ra,Ra]),u5=o.array(du().max(50)),m5=o.string().max(100).regex(/[\w#]+/),f5=o.number().nonnegative(),p5=o.number().nonnegative(),g5=o.number().nonnegative().max(100),h5=o.number().nonnegative(),y5=o.number().int().nonnegative(),b5=o.number().int().nonnegative(),v5=o.string().max(50).regex(/^[a-zA-Z0-9_\-+.]+$/),Nu=du().max(50),w5=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),k5=o.string().max(50).regex(/^[a-zA-Z0-9\-_]+$/gi),C5=o.number().positive(),S5=o.number().min(20).max(1e3).or(o.literal(0)),x5=o.string().url("Needs to be an URI.").regex(/^(https|http):\/\/.*/,"Unsupported protocol.").regex(/^[^`'"]*$/,"May not contain quotes.").regex(/.+(\.png|\.gif|\.jpeg|\.jpg)/gi,"Unsupported image format.").max(2048,"URL is too long.").or(o.literal("")),T5=o.object({theme:Nu,themeLight:Nu,themeDark:Nu,autoSwitchTheme:o.boolean(),customTheme:o.boolean(),customThemeColors:d5,favThemes:u5,showKeyTips:o.boolean(),smoothCaret:T_,codeUnindentOnBackspace:o.boolean(),quickRestart:$_,punctuation:o.boolean(),numbers:o.boolean(),words:b5,time:y5,mode:x_,quoteLength:A_,language:g1,fontSize:C5,freedomMode:o.boolean(),difficulty:c5,blindMode:o.boolean(),quickEnd:o.boolean(),caretStyle:jh,paceCaretStyle:jh,flipTestColors:o.boolean(),layout:k5,funbox:m5,confidenceMode:M_,indicateTypos:E_,timerStyle:P_,liveSpeedStyle:ju,liveAccStyle:ju,liveBurstStyle:ju,colorfulMode:o.boolean(),randomTheme:I_,timerColor:q_,timerOpacity:B_,stopOnError:D_,showAllLines:o.boolean(),keymapMode:F_,keymapStyle:W_,keymapLegendStyle:z_,keymapLayout:w5,keymapShowTopRow:R_,keymapSize:O_,fontFamily:v5,smoothLineScroll:o.boolean(),alwaysShowDecimalPlaces:o.boolean(),alwaysShowWordsHistory:o.boolean(),singleListCommandLine:__,capsLockWarning:o.boolean(),playSoundOnError:H_,playSoundOnClick:j_,soundVolume:N_,startGraphsAtZero:o.boolean(),showOutOfFocusWarning:o.boolean(),paceCaret:G_,paceCaretCustomSpeed:f5,repeatedPace:o.boolean(),accountChart:U_,minWpm:K_,minWpmCustomSpeed:p5,highlightMode:V_,tapeMode:Q_,tapeMargin:Z_,typingSpeedUnit:Y_,ads:X_,hideExtraLetters:o.boolean(),strictSpace:o.boolean(),minAcc:J_,minAccCustom:g5,monkey:o.boolean(),repeatQuotes:e5,oppositeShiftMode:t5,customBackground:x5,customBackgroundSize:a5,customBackgroundFilter:o5,customLayoutfluid:s5,monkeyPowerLevel:i5,minBurst:r5,minBurstCustomSpeed:h5,burstHeatmap:o.boolean(),britishEnglish:o.boolean(),lazyMode:o.boolean(),showAverage:l5,maxLineWidth:S5,customPolyglot:n5}).strict(),$5=T5.partial(),Nh=o.enum(["test","behavior","input","sound","caret","appearance","theme","hideElements","ads","hidden"]),L5=o.string().regex(/^[0-9a-zA-Z_-]+$/).max(16),A5=o.enum(["full","partial"]),M5=o.array(Nh).min(1).superRefine((e,t)=>{Nh.options.forEach(a=>{e.filter(s=>s===a).length>1&&t.addIssue({code:o.ZodIssueCode.custom,message:"No duplicates allowed."})})}),E5=o.object({_id:k_,name:L5,settingGroups:M5.nullable().optional(),config:$5.extend({tags:o.array(C_).optional()})});E5.partial({config:!0,settingGroups:!0});const he={presetType:"full",checkboxes:new Map(wd.options.map(e=>[e,!0])),setPresetToCurrent:!1};function Gu(e,t,a){if(!Xe()){g("You are offline",0,{duration:2});return}b1.show({focusFirstInput:!0,beforeAnimation:async()=>{n("#editPresetModal .modal .text").addClass("hidden"),q5(),e==="add"?(n("#editPresetModal .modal").attr("data-action","add"),n("#editPresetModal .modal .popupTitle").html("Add new preset"),n("#editPresetModal .modal .submit").html("add"),n("#editPresetModal .modal input").val(""),n("#editPresetModal .modal input").removeClass("hidden"),n("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),n("#editPresetModal .modal .inputs").removeClass("hidden"),n("#editPresetModal .modal .presetType").removeClass("hidden"),n("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),he.presetType="full"):e==="edit"&&t!==void 0&&a!==void 0?(n("#editPresetModal .modal").attr("data-action","edit"),n("#editPresetModal .modal").attr("data-preset-id",t),n("#editPresetModal .modal .popupTitle").html("Edit preset"),n("#editPresetModal .modal .submit").html("save"),n("#editPresetModal .modal input").val(a),n("#editPresetModal .modal input").removeClass("hidden"),n("#editPresetModal .modal label.changePresetToCurrentCheckbox").removeClass("hidden"),n("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),he.setPresetToCurrent=!1,await y1()):e==="remove"&&t!==void 0&&a!==void 0&&(n("#editPresetModal .modal").attr("data-action","remove"),n("#editPresetModal .modal").attr("data-preset-id",t),n("#editPresetModal .modal .popupTitle").html("Delete preset"),n("#editPresetModal .modal .submit").html("delete"),n("#editPresetModal .modal input").addClass("hidden"),n("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),n("#editPresetModal .modal .text").removeClass("hidden"),n("#editPresetModal .modal .deletePrompt").text(`Are you sure you want to delete the preset ${a}?`),n("#editPresetModal .modal .inputs").addClass("hidden"),n("#editPresetModal .modal .presetType").addClass("hidden"),n("#editPresetModal .modal .presetNameTitle").addClass("hidden")),Up()}})}async function P5(e){for(const a of he.checkboxes.keys())he.checkboxes.set(a,!1);const t=await oW(e);if(t===void 0){g("Preset not found",-1);return}if(t.settingGroups===void 0||t.settingGroups===null){he.presetType="full";for(const a of he.checkboxes.keys())he.checkboxes.set(a,!0)}else he.presetType="partial",t.settingGroups.forEach(a=>he.checkboxes.set(a,!0));he.setPresetToCurrent=!1,Up()}function I5(){wd.options.forEach(t=>{const a=n(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${t}"] input`);a.on("change",s=>{he.checkboxes.set(t,a.prop("checked"))})});const e=n("#editPresetModal .modal .changePresetToCurrentCheckbox input");e.on("change",async()=>{he.setPresetToCurrent=e.prop("checked"),await y1()})}function q5(){function e(a){return a.replace(/([a-z])([A-Z])/g,"$1 $2")}const t=n("#editPresetModal .modal .inputs .checkboxList").empty();wd.options.forEach(a=>{const s=e(a),i=`<label class="checkboxTitlePair" data-id="${a}">
              <input type="checkbox" />
              <div class="title">${s}</div>
              </label>`;t.append(i)});for(const a of he.checkboxes.keys())he.checkboxes.set(a,!0);I5()}function Up(){wd.options.forEach(e=>{n(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${e}"] input`).prop("checked",he.checkboxes.get(e))}),n("#editPresetModal .modal .presetType button").removeClass("active"),n(`#editPresetModal .modal .presetType button[value="${he.presetType}"]`).addClass("active"),n("#editPresetModal .modal .partialPresetGroups").removeClass("hidden"),he.presetType==="full"&&n("#editPresetModal .modal .partialPresetGroups").addClass("hidden")}async function y1(){if(n("#editPresetModal .modal label.changePresetToCurrentCheckbox input").prop("checked",he.setPresetToCurrent),he.setPresetToCurrent){const e=n("#editPresetModal .modal").attr("data-preset-id");await P5(e),n("#editPresetModal .modal .inputs").removeClass("hidden"),n("#editPresetModal .modal .presetType").removeClass("hidden")}else n("#editPresetModal .modal .inputs").addClass("hidden"),n("#editPresetModal .modal .presetType").addClass("hidden")}function B5(){b1.hide()}async function D5(){var u;const e=n("#editPresetModal .modal").attr("data-action"),t=n("#editPresetModal .modal input").val(),a=t.replaceAll(" ","_"),s=n("#editPresetModal .modal").attr("data-preset-id"),i=n("#editPresetModal .modal label input").prop("checked"),l=((u=$())==null?void 0:u.presets)??[];if(e===void 0)return;if(["add","edit"].includes(e)&&he.presetType==="partial"&&Array.from(he.checkboxes.values()).every(m=>!m)){g("At least one setting group must be active while saving partial presets",0);return}if(["add","edit"].includes(e)&&a.replace(/^_+|_+$/g,"").length===0){g("Preset name cannot be empty",0);return}if(B5(),de(),e==="add"){const m=Gh(),f=Uu(),p=await F.presets.add({body:{name:a,config:m,...he.presetType==="partial"&&{settingGroups:f}}});p.status!==200||p.body.data===null?g("Failed to add preset: "+p.body.message.replace(a,t),-1):(g("Preset added",1,{duration:2}),l.push({name:a,config:m,...he.presetType==="partial"&&{settingGroups:f},display:t,_id:p.body.data.presetId}))}else if(e==="edit"){const m=l.filter(y=>y._id===s)[0];if(m===void 0){g("Preset not found",-1);return}const f=Gh(),p=he.presetType==="partial"?Uu():null,h=await F.presets.save({body:{_id:s,name:a,...i&&{config:f,settingGroups:p}}});h.status!==200?g("Failed to edit preset: "+h.body.message,-1):(g("Preset updated",1),m.name=a,m.display=a.replace(/_/g," "),i&&(m.config=f,he.presetType==="partial"?m.settingGroups=Uu():m.settingGroups=null))}else if(e==="remove"){const m=await F.presets.delete({params:{presetId:s}});m.status!==200?g("Failed to remove preset: "+m.body.message,-1):(g("Preset removed",1),l.forEach((f,p)=>{f._id===s&&l.splice(p,1)}))}Jo(),Z()}function F5(e){return hM[e]}function W5(e){const t={},a=Ot();return Object.keys(a).filter(s=>{const i=F5(s);return i===null?!1:he.checkboxes.get(i)===!0}).forEach(s=>{const i=s,l=e[i]!==void 0?e[i]:a[i];t[i]=l}),t}function Uu(){return Array.from(he.checkboxes.entries()).filter(([,e])=>e).map(([e])=>e)}function Gh(){var i;const e=he.presetType==="partial"?W5(im()):im(),a=(((i=$())==null?void 0:i.tags)??[]).filter(l=>l.active).map(l=>l._id),s=he.presetType==="full"||he.checkboxes.get("behavior")===!0;return{...e,...s&&{tags:a}}}async function z5(e){e.addEventListener("submit",t=>{t.preventDefault(),D5()}),A5.options.forEach(t=>{const a=e.querySelector(`.presetType button[value="${t}"]`);a!==null&&a.addEventListener("click",()=>{he.presetType=t,Up()})})}const b1=new fe({dialogId:"editPresetModal",setup:z5}),Um=e=>e.replaceAll(" ","_"),Uh=async e=>{const t=CD.safeParse(Um(e));return t.success?!0:t.error.errors.map(a=>a.message).join(", ")},R5={add:new ve({id:"addTag",title:"Add new tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Uh}}],onlineOnly:!0,buttonText:"add",execFn:async(e,t)=>{var i,l;const a=Um(t),s=await F.users.createTag({body:{tagName:a}});return s.status!==200?{status:-1,message:"Failed to add tag: "+s.body.message.replace(a,t)}:((l=(i=$())==null?void 0:i.tags)==null||l.push({display:t,name:s.body.data.name,_id:s.body.data._id,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}}}),Jo(),{status:1,message:"Tag added"})}}),edit:new ve({id:"editTag",title:"Edit tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:Uh}}],onlineOnly:!0,buttonText:"save",beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},execFn:async(e,t)=>{var l,c;const a=Um(t),s=e.parameters[1],i=await F.users.editTag({body:{tagId:s,newName:a}});return i.status!==200?{status:-1,message:"Failed to edit tag: "+i.body.message}:((c=(l=$())==null?void 0:l.tags)==null||c.forEach(d=>{d._id===s&&(d.name=a,d.display=t)}),Jo(),{status:1,message:"Tag updated"})}}),remove:new ve({id:"removeTag",title:"Delete tag",onlineOnly:!0,buttonText:"delete",beforeInitFn:e=>{e.text=`Are you sure you want to delete tag ${e.parameters[0]} ?`},execFn:async e=>{var s,i;const t=e.parameters[1],a=await F.users.deleteTag({params:{tagId:t}});return a.status!==200?{status:-1,message:"Failed to remove tag: "+a.body.message}:((i=(s=$())==null?void 0:s.tags)==null||i.forEach((l,c)=>{var d,u;l._id===t&&((u=(d=$())==null?void 0:d.tags)==null||u.splice(c,1))}),Jo(),{status:1,message:"Tag removed"})}}),clearPb:new ve({id:"clearTagPb",title:"Clear personal bests",onlineOnly:!0,buttonText:"clear",beforeInitFn:e=>{e.text=`Are you sure you want to clear personal bests for tag ${e.parameters[0]} ?`},execFn:async e=>{const t=e.parameters[1],a=await F.users.deleteTagPersonalBest({params:{tagId:t}});return a.status!==200?{status:-1,message:"Failed to clear tag pb: "+a.body.message}:(Jo(),{status:1,message:"Tag PB cleared"})}})};function Zl(e,t,a,s){const i={modalChain:s,focusFirstInput:"focusAndSelect"};e!=="add"&&(a===void 0||t===void 0)||R5[e].show([a??"",t??""],i)}const fa=document.querySelector("#pageSettings");var dy;(dy=fa==null?void 0:fa.querySelector("#shareCustomThemeButton"))==null||dy.addEventListener("click",()=>{h_()});var uy;(uy=fa==null?void 0:fa.querySelector(".section.updateCookiePreferences button"))==null||uy.addEventListener("click",()=>{f1(!0)});var my;(my=fa==null?void 0:fa.querySelector(".section.presets"))==null||my.addEventListener("click",e=>{var a,s,i,l;const t=e.target;if(t.classList.contains("addPresetButton"))Gu("add");else if(t.classList.contains("editButton")){const c=(a=t.parentElement)==null?void 0:a.getAttribute("data-id"),d=(s=t.parentElement)==null?void 0:s.getAttribute("data-display");if(c===void 0||d===void 0||c===""||d===""||c===null||d===null){g("Failed to edit preset: Could not find preset id or name",-1);return}Gu("edit",c,d)}else if(t.classList.contains("removeButton")){const c=(i=t.parentElement)==null?void 0:i.getAttribute("data-id"),d=(l=t.parentElement)==null?void 0:l.getAttribute("data-display");if(c===void 0||d===void 0||c===""||d===""||c===null||d===null){g("Failed to remove preset: Could not find preset id or name",-1);return}Gu("remove",c,d)}});var fy;(fy=fa==null?void 0:fa.querySelector(".section.tags"))==null||fy.addEventListener("click",e=>{var a,s,i,l,c,d;const t=e.target;if(t.classList.contains("addTagButton"))Zl("add");else if(t.classList.contains("editButton")){const u=(a=t.parentElement)==null?void 0:a.getAttribute("data-id"),m=(s=t.parentElement)==null?void 0:s.getAttribute("data-display");if(u===void 0||m===void 0||u===""||m===""||u===null||m===null){g("Failed to edit tag: Could not find tag id or name",-1);return}Zl("edit",u,m)}else if(t.classList.contains("clearPbButton")){const u=(i=t.parentElement)==null?void 0:i.getAttribute("data-id"),m=(l=t.parentElement)==null?void 0:l.getAttribute("data-display");if(u===void 0||m===void 0||u===""||m===""||u===null||m===null){g("Failed to clear tag PB: Could not find tag id or name",-1);return}Zl("clearPb",u,m)}else if(t.classList.contains("removeButton")){const u=(c=t.parentElement)==null?void 0:c.getAttribute("data-id"),m=(d=t.parentElement)==null?void 0:d.getAttribute("data-display");if(u===void 0||m===void 0||u===""||m===""||u===null||m===null){g("Failed to remove tag: Could not find tag id or name",-1);return}Zl("remove",u,m)}});function O5(e){var c;const t=w1.getModal();t.querySelector("table tbody").innerHTML="",t.querySelector("table thead tr td").textContent=e,t.querySelector("table thead tr td span.unit").textContent=r.typingSpeedUnit;const a=$();if(!a)return;const s=(c=a.personalBests)==null?void 0:c[e];if(s===void 0)return;const i=[];Object.keys(s).forEach(function(d){let u=s[d]??[];u=u.sort(function(m,f){return f.wpm-m.wpm}),u.forEach(function(m){m.mode2=d,i.push(m)})});let l;i.forEach(d=>{var f;let u='-<br><span class="sub">-</span>';const m=new Date(d.timestamp);d.timestamp&&(u=oe(m,"dd MMM yyyy")+"<br><div class='sub'>"+oe(m,"HH:mm")+"</div>"),(f=t.querySelector("table tbody"))==null||f.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${l===d.mode2?"":d.mode2}</td>
        <td>
          ${N.typingSpeed(d.wpm)}
          <br />
          <span class="sub">${N.accuracy(d.acc)}</span>
        </td>
        <td>
          ${N.typingSpeed(d.raw)}
          <br />
          <span class="sub">${N.percentage(d.consistency)}</span>
        </td>
        <td>${d.difficulty}</td>
        <td>${d.language?$o(d.language):"-"}</td>
        <td>${d.punctuation?'<i class="fas fa-check"></i>':""}</td>
        <td>${d.numbers?'<i class="fas fa-check"></i>':""}</td>
        <td>${d.lazyMode?'<i class="fas fa-check"></i>':""}</td>
        <td>${u}</td>
      </tr>
    `),l=d.mode2})}function v1(e){w1.show({beforeAnimation:async()=>{O5(e)}})}const w1=new fe({dialogId:"pbTablesModal"});function _5(){if(!Xe()){g("You are offline",0,{duration:2});return}x1.show({beforeAnimation:async()=>{j5(),N5()}})}function H5(){x1.hide({afterAnimation:async()=>{const e=$();e&&Uc("account",e)}})}const Kp=n("#editProfileModal .bio"),Vp=n("#editProfileModal .keyboard"),k1=n("#editProfileModal .twitter"),C1=n("#editProfileModal .github"),S1=n("#editProfileModal .website"),Yl=n("#editProfileModal .badgeSelectionContainer");let In=-1;function j5(){var l;const e=$();if(!e)return;const t=((l=e.inventory)==null?void 0:l.badges)??[],{bio:a,keyboard:s,socialProfiles:i}=e.details??{};In=-1,Kp.val(a??""),Vp.val(s??""),k1.val((i==null?void 0:i.twitter)??""),C1.val((i==null?void 0:i.github)??""),S1.val((i==null?void 0:i.website)??""),Yl.html(""),t==null||t.forEach(c=>{c.selected&&(In=c.id);const d=Hr(c.id,!1,!0),u=`<button type="button" class="badgeSelectionItem ${c.selected?"selected":""}" selection-id=${c.id}>${d}</button>`;Yl.append(u)}),Yl.prepend(`<button type="button" class="badgeSelectionItem ${In===-1?"selected":""}" selection-id=-1>
      <div class="badge">
        <i class="fas fa-frown-open"></i>
        <div class="text">none</div>
      </div>
    </button>`),n(".badgeSelectionItem").on("click",({currentTarget:c})=>{const d=n(c).attr("selection-id");In=parseInt(d,10),Yl.find(".badgeSelectionItem").removeClass("selected"),n(c).addClass("selected")})}function N5(){new jr(Kp,250),new jr(Vp,75)}function G5(){const e=Kp.val()??"",t=Vp.val()??"",a=k1.val()??"",s=C1.val()??"",i=S1.val()??"";return{bio:e,keyboard:t,socialProfiles:{twitter:a,github:s,website:i}}}async function U5(){var l,c,d,u,m;const e=$();if(!e)return;const t=G5(),a=39;if(((l=t.socialProfiles)==null?void 0:l.github)!==void 0&&((c=t.socialProfiles)==null?void 0:c.github.length)>a){g(`GitHub username exceeds maximum allowed length (${a} characters).`,-1);return}const s=20;if(((d=t.socialProfiles)==null?void 0:d.twitter)!==void 0&&((u=t.socialProfiles)==null?void 0:u.twitter.length)>s){g(`Twitter username exceeds maximum allowed length (${s} characters).`,-1);return}de();const i=await F.users.updateProfile({body:{...t,selectedBadgeId:In}});if(Z(),i.status!==200){g("Failed to update profile: "+i.body.message,-1);return}e.details=i.body.data??t,(m=e.inventory)==null||m.badges.forEach(f=>{f.id===In?f.selected=!0:delete f.selected}),g("Profile updated",1),H5()}const x1=new fe({dialogId:"editProfileModal",setup:async e=>{e.addEventListener("submit",async t=>{t.preventDefault(),await U5()})}});function K5(e){T1.show({...e,focusFirstInput:!0,beforeAnimation:async t=>{t.querySelector("input").value=""}})}function V5(e=!1){T1.hide({clearModalChain:e})}function Q5(){const e=n("#newFilterPresetModal input").val();if(e===""){g("Name cannot be empty",0);return}qD(e),V5(!0)}async function Z5(e){e.addEventListener("submit",t=>{t.preventDefault(),Q5()})}const T1=new fe({dialogId:"newFilterPresetModal",setup:Z5}),xl=document.querySelector("#pageAccount");n(xl).on("click",".pbsTime .showAllButton",()=>{v1("time")});n(xl).on("click",".pbsWords .showAllButton",()=>{v1("words")});n(xl).on("click",".editProfileButton",()=>{if(!j()){g("You must be logged in to edit your profile",0);return}const e=$();if(!e){g("Failed to open edit profile modal: No user snapshot found",-1);return}if(e.banned===!0){g("Banned users cannot edit their profile",0);return}_5()});const Y5=o.array(o.string());n(xl).on("click",".group.history .resultEditTagsButton",e=>{const t=n(e.target).attr("data-result-id"),a=n(e.target).attr("data-tags");Qk(t??"",ri(a??"[]",Y5),"accountPage")});n(xl).find("button.createFilterPresetBtn").on("click",()=>{K5()});const Ku=document.getElementById("pageLeaderboards");for(const e of(Ku==null?void 0:Ku.querySelectorAll(".jumpButtons button[data-action='goToPage']"))??[])e==null||e.addEventListener("click",()=>{Ne("lbGoToPage")});function X5(){Qp.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async e=>{Bo("forgotPasswordModal"),gi(e.querySelector(".g-recaptcha"),"forgotPasswordModal",async()=>{await $1()})}})}async function $1(){const e=bl("forgotPasswordModal");if(!e){g("Please complete the captcha");return}const t=Qp.getModal().querySelector("input").value.trim();if(!t){g("Please enter your email address"),Bo("forgotPasswordModal");return}if(!o.string().email().safeParse(t).success){g("Please enter a valid email address"),Bo("forgotPasswordModal");return}de(),F.users.forgotPasswordEmail({body:{email:t,captcha:e}}).then(i=>{if(Z(),i.status!==200){g("Failed to send password reset email: "+i.body.message,-1);return}g(i.body.message,1,{duration:5})}),Km()}function Km(){Qp.hide()}async function J5(e){var t;(t=e.querySelector("button"))==null||t.addEventListener("click",async()=>{await $1()})}const Qp=new fe({dialogId:"forgotPasswordModal",setup:J5,customEscapeHandler:async()=>{Km()},customWrapperClickHandler:async()=>{Km()}}),e3=document.querySelector("#pageLogin");n(e3).on("click","#forgotPasswordButton",()=>{X5()});let Ft;function t3(e){L1.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async()=>{Bo("googleSignUpModal"),gi(n("#googleSignUpModal .captcha")[0],"googleSignUpModal"),s3(),Zp(),Ft=e}})}async function td(){L1.hide({afterAnimation:async()=>{var e;Ft!==void 0&&(g("Sign up process cancelled",0,{duration:5}),Wt(),Rt(),(e=af(Ft))!=null&&e.isNewUser&&(await F.users.delete(),await Ft.user.delete()),cn(),Ft=void 0)}})}async function a3(){var a;if(!Ft){g("Missing user credential. Please close the popup and try again.",-1);return}const e=bl("googleSignUpModal");if(!e){g("Please complete the captcha",0);return}n3(),Zp(),de();const t=n("#googleSignUpModal input").val();try{if(t.length===0)throw new Error("Name cannot be empty");const s=await F.users.create({body:{name:t,captcha:e}});if(s.status!==200)throw new Error(`Failed to create user: ${s.body.message}`);s.status===200&&(await My(Ft.user,{displayName:t}),await QS(Ft.user),g("Account created",1),Rt(),Wt(),await Sl(Ft.user),Ft=void 0,Z(),td())}catch(s){console.log(s);const i=ae(s,"Failed to sign in with Google");g(i,-1),Wt(),Rt(),zp(),Ft&&((a=af(Ft))!=null&&a.isNewUser)&&(await F.users.delete(),await Ft.user.delete()),cn(),Ft=void 0,td(),Z();return}}function o3(){n("#googleSignUpModal button").prop("disabled",!1)}function Zp(){n("#googleSignUpModal button").prop("disabled",!0)}function s3(){n("#googleSignUpModal input").prop("disabled",!1)}function n3(){n("#googleSignUpModal input").prop("disabled",!0)}const qn=new Oo(n("#googleSignUpModal input"),{available:{icon:"fa-check",level:1},unavailable:{icon:"fa-times",level:-1},taken:{icon:"fa-user",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}}),i3=Pt(1e3,async()=>{const e=n("#googleSignUpModal input").val();if(!e)return;const t=await F.users.getNameAvailability({params:{name:e}});t.status===200?(qn.show("available",t.body.message),o3()):t.status===422?qn.show("unavailable",t.body.message):t.status===409?qn.show("taken",t.body.message):(qn.show("unavailable"),g("Failed to check name availability: "+t.body.message,-1))});async function r3(e){var t;e.addEventListener("submit",a=>{a.preventDefault(),a3()}),(t=e.querySelector("input"))==null||t.addEventListener("input",()=>{if(Zp(),n("#googleSignUpModal input").val()===""){qn.hide();return}else qn.show("checking"),i3()})}nO((e,t)=>{e!==void 0&&t&&t3(e)});const L1=new fe({dialogId:"googleSignUpModal",setup:r3,customEscapeHandler:async()=>{td()},customWrapperClickHandler:async()=>{td()}}),A1=console.log,l3=console.warn,c3=console.error,M1=new jt({key:"debugLogs",schema:o.boolean(),fallback:!1});let Vi=M1.get();function d3(){Vi=!Vi,E1(`Debug logs ${Vi?"enabled":"disabled"}`),M1.set(Vi)}function E1(...e){A1("%cINFO","background:#4CAF50;color: #111;padding:0 5px;border-radius:10px",...e)}function u3(...e){l3("%cWRN","background:#FFC107;color: #111;padding:0 5px;border-radius:10px",...e)}function m3(...e){c3("%cERR","background:#F44336;color: #111;padding:0 5px;border-radius:10px",...e)}function f3(...e){Vi&&A1("%cDEBG","background:#2196F3;color: #111;padding:0 5px;border-radius:10px",...e)}console.log=E1;console.warn=u3;console.error=m3;console.debug=f3;let Vm=!1;function p3(e){document.documentElement.style.setProperty("--font",'"'+e.replace(/_/g," ")+'", "Roboto Mono", "Vazirmatn"'),T0(),Vm=!0}function Z3(){Vm&&(p3(r.fontFamily),Vm=!1)}function g3(){const e=window.navigator.userAgent.toLowerCase(),t=e.includes("mac")&&!e.includes("firefox")?"cmd":"ctrl",a=r.quickRestart==="esc"?"tab":"esc";n("footer .keyTips").html(`
    ${r.quickRestart==="off"?"<key>tab</key> + <key>enter</key>":`<key>${r.quickRestart}</key>`} - restart test<br>
    <key>${a}</key> or <key>${t}</key>+<key>shift</key>+<key>p</key> - command line`)}window.addEventListener("keydown",function(e){e.code==="Space"&&e.target===document.body&&e.preventDefault()});window.addEventListener("beforeunload",e=>{rd(r.mode,r.words,r.time,rn(),Po()??!1)||Ge&&(e.preventDefault(),e.returnValue="")});const h3=Pt(250,()=>{Ao(),ce()==="test"&&!ze&&(r.tapeMode!=="off"?Fd():M0(),setTimeout(()=>{ap(),n("#wordsInput").is(":focus")&&Zw()},250))}),y3=ky(250,()=>{dl()});n(window).on("resize",()=>{y3(),h3()});Te(e=>{e==="quickRestart"&&g3()});const P1=new jt({key:"accountSettingsMessageDismissed",schema:o.boolean(),fallback:!1});P1.get()&&n(".pageSettings .accountSettingsNotice").remove();n(".pageSettings .accountSettingsNotice .dismissAndGo").on("click",()=>{P1.set(!0),ft("/account-settings"),n(".pageSettings .accountSettingsNotice").remove()});let Qm=!1;const b3=new RegExp("\\p{P}","u");async function v3(e){function t(m,f){let p=m.shiftKey;const h=Qm&&f.length>2?2:0,y=!b3.test(f.slice(h,h+2));Yn&&y&&(p=!m.shiftKey);const b=f[(p?1:0)+h]??"",v=f[p?1:0]??"",C=f[0];return b||v||C}let a;try{a=await Ds(r.layout)}catch(m){return g(ae(m,"Failed to emulate event"),-1),null}Eo().includes("layout_mirror")&&(a=Uf(a));let i=[];if(a.type==="ansi"?i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="iso"?i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="matrix"&&(i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]),!i.includes(e.code))return null;const l=a.keys,c=l.row1.concat(l.row2).concat(l.row3).concat(l.row4).concat(l.row5),d=i.indexOf(e.code);if(d===-1)return e.code.includes("Numpad")?e.key:null;const u=t(e,c[d]??"");return u!==void 0?u:null}function I1(e){const t=e.code==="AltLeft"&&navigator.userAgent.includes("Mac");e.code!=="AltRight"&&!t||(e.type==="keydown"&&(Qm=!0),e.type==="keyup"&&(Qm=!1))}n(document).on("keydown",I1);n(document).on("keyup",I1);const q1=["MediaTrackNext","MediaTrackPrevious","MediaPlayPause","AudioVolumeUp","AudioVolumeDown","AudioVolumeMute","Home","End"],w3=["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","OS","NumLock","ScrollLock","Scroll","Shift","Super","Symbol","SymbolLock"];let ad=!1,od=!0,Vu=!1,B1,Qu=0,sd=!1;const Kh=document.getElementById("wordsInput"),D1=document.getElementById("koInputVisual");function Za(e){e!==Kh.value&&(Kh.value=e)}function gc(){var t;const e=Q(pl());if(isNaN(e)||nP(e),r.keymapMode==="next"&&r.mode!=="zen")if(!r.language.startsWith("korean"))Zo(R.getCurrent().charAt(T.current.length).toString());else{const a=it.disassemble(R.getCurrent(),!0),s=it.disassemble(T.current,!0),i=s.length-1;if(s[i]){const l=s[i].length;try{const c=a[i][l]??a[s.length][l-a[i].length];Zo(c)}catch{Zo("")}}else{const l=(t=a==null?void 0:a[0])==null?void 0:t[0];l!==void 0&&Zo(l)}}}function F1(){var s,i,l,c;if(!Ge)return;const e=te-Ze;if(T.getHistory().length===0||e===0)return;const t=document.querySelectorAll("#words > .word");if(T.getHistory(te-1)===R.get(te-1)&&!r.freedomMode||(s=t[e-1])!=null&&s.classList.contains("hidden")||r.confidenceMode==="on"||r.confidenceMode==="max")return;const a=(l=(i=t[e])==null?void 0:i.children[0])==null?void 0:l.classList.contains("incorrect");if(r.stopOnError==="letter"&&a&&Ta(),T.current=T.popHistory(),at.popHistory(),ln("nospace")&&(T.current=T.current.slice(0,-1),Za(" "+T.current+" ")),TA(),Dd(!0),jc(R.getCurrent()),Ta(),r.mode==="zen"){gl();const d=((c=document.querySelector("#words"))==null?void 0:c.children)??[];for(let u=d.length-1;u>=0;u--){const m=d[u];if(m.classList.contains("newline")||m.classList.contains("beforeNewline")||m.classList.contains("afterNewline"))m.remove();else break}}Ao(),Fs("backWord")}async function Vh(){var u,m;if(!Ge||T.current===""||Ws()&&r.language.startsWith("chinese"))return;const e=R.getCurrent();for(const f of ht("handleSpace"))f.functions.handleSpace();ad=!0;const t=W0();sP(Math.round(t)),Hw(t);const a=ln("nospace"),s=e===T.current||r.mode==="zen";if(Sk(s,!0),Fw(s),s)r.stopOnError==="letter"&&Ta(),th(!0,e),T.pushHistory(),Lg(),jc(R.getCurrent()),lm(),cm(te),a||Mo(),Fs("submitCorrectWord");else{a||(r.playSoundOnError==="off"||r.blindMode?Mo():Pd()),Rw(R.getCurrent()),Dw();const f=T.current.length;if(f<=R.getCurrent().length&&(f>=at.current.length?at.current+="_":at.current=at.current.substring(0,f)+"_"+at.current.substring(f+1)),r.stopOnError!=="off"){if(r.difficulty==="expert"||r.difficulty==="master"){ir("difficulty");return}r.stopOnError==="word"&&(ad=!1,Fs("incorrectLetter","_"),Ta(),Ao());return}th(!1,e),r.blindMode?r.highlightMode!=="off"&&OE(te-Ze):RE(te-Ze),T.pushHistory(),Lg(),jc(R.getCurrent()),lm(),cm(te),Fs("submitErrorWord"),(r.difficulty==="expert"||r.difficulty==="master")&&ir("difficulty")}at.pushHistory();const i=te===R.length;if(xp()&&i){ei();return}let l;r.mode==="zen"?l=T.current.length:l=R.getCurrent().length;const c=Y1(r.minBurstCustomSpeed,l);if(r.minBurst==="fixed"&&t<r.minBurstCustomSpeed||r.minBurst==="flex"&&t<c){ir("min burst");return}r.keymapMode==="react"&&b0(" ",!0),(r.mode==="words"||r.mode==="custom"||r.mode==="quote"||r.mode==="zen")&&gl(),i?(sd=!0,de(),await ih(),Z(),sd=!1):ih(),Dd(),Ao();const d=r.mode==="time"||r.mode==="custom"&&je()==="time"||r.mode==="custom"&&qe()===0;if(!r.showAllLines||d){const f=Math.floor(((u=document.querySelectorAll("#words .word")[te-Ze-1])==null?void 0:u.offsetTop)??0);let p;try{p=Math.floor(((m=document.querySelectorAll("#words .word")[te-Ze])==null?void 0:m.offsetTop)??0)}catch{p=0}p>f&&sp(f)}}function W1(e,t){if(!od)return!1;if(r.mode==="zen")return!0;if(T.getKoreanStatus()){const l=it.disassemble(R.getCurrent())[t];return l===void 0?!1:l===e}const a=R.getCurrent()[t];if(a===void 0)return!1;if(a===e)return!0;const s=zo("isCharCorrect");return s?s.functions.isCharCorrect(e,a):!!(r.language.startsWith("russian")&&(e==="ё"||e==="е"||e==="e")&&(a==="ё"||a==="е"||a==="e")||(e==="’"||e==="‘"||e==="'"||e==="ʼ"||e==="׳"||e==="ʻ")&&(a==="’"||a==="‘"||a==="'"||a==="ʼ"||a==="׳"||a==="ʻ")||(e==='"'||e==="”"||e==="“"||e==="„")&&(a==='"'||a==="”"||a==="“"||a==="„")||(e==="–"||e==="—"||e==="-")&&(a==="-"||a==="–"||a==="—"))}function Kt(e,t,a){var v;if(Ys||ze)return;if(e==="…"&&R.getCurrent()[t]!=="…"){for(let C=0;C<3;C++)Kt(".",t+C);return}if(e==="œ"&&R.getCurrent()[t]!=="œ"){Kt("o",t),Kt("e",t+1);return}if(e==="æ"&&R.getCurrent()[t]!=="æ"){Kt("a",t),Kt("e",t+1);return}console.debug("Handling char",e,t,a);const s=performance.now(),i=T.getKoreanStatus();for(const C of ht("handleChar"))e=C.functions.handleChar(e);const l=ln("nospace");if(e!==`
`&&e!=="	"&&/\s/.test(e)){if(l)return;if(Vh(),r.difficulty!=="normal"||r.strictSpace&&r.mode!=="zen"||r.stopOnError==="word"&&t>0){if(ad){ad=!1;return}}else return}if(r.mode!=="zen"&&R.getCurrent()[t]!==`
`&&e===`
`||!Ge&&!Vq(s))return;gs(!0),Vw();const c=W1(e,t);let d;if(c&&r.mode!=="zen"&&(e=i?it.disassemble(R.getCurrent())[t]??"":R.getCurrent().charAt(t)),!c&&e===`
`){if(T.current==="")return;e=" "}if(T.current===""&&JM(s),i||r.language.startsWith("korean")?(d=(a??"").slice(1),D1.innerText=d.slice(-1)):r.language.startsWith("chinese")?d=(a??"").slice(1):d=T.current.substring(0,t)+e+T.current.substring(t+1),!c&&Ws()&&!r.language.startsWith("korean")){T.current=d,Ta(),Ao();return}if(Sk(c),Fw(c),c||(Dw(),Rw(R.getCurrent())),rE(r.mode==="zen"?e:R.getCurrent()[t]??"",c),c||r.playSoundOnError==="off"||r.blindMode?Mo():Pd(),r.keymapMode==="react"&&b0(e,c),r.difficulty!=="master")if(od)Qu=0;else{Qu++,Qu>=5&&g("Opposite shift mode is on.",0,{important:!0,customTitle:"Reminder"});return}if(at.current==="")at.current+=i?it.disassemble(d).join(""):d;else{const C=i?it.disassemble(at.current).length:at.current.length;t>=C?at.current+=i?it.disassemble(e).concat():e:c||(at.current=at.current.substring(0,t)+e+at.current.substring(t+1))}if(lm(),cm(te),r.difficulty!=="master"&&r.stopOnError==="letter"&&!c){r.blindMode||Ta(T.current+e);return}Fs(c?"correctLetter":"incorrectLetter",e);const u=(v=document.querySelectorAll("#words .word"))==null?void 0:v[te-Ze];if((i?it.disassemble(T.current).length:T.current.length)===1&&te===0&&(u==null||u.offsetTop,void 0),r.mode==="zen"&&t<30||r.mode!=="zen"&&d.length<R.getCurrent().length+20?T.current=d:console.error("Hitting word limit"),!c&&r.difficulty==="master"){ir("difficulty");return}if(r.mode!=="zen"){const C=R.getCurrent(),k=te===R.length-1,M=xp(),q=C===T.current,W=r.quickEnd&&!r.language.startsWith("korean")&&C.length===T.current.length&&r.stopOnError==="off",x=r.language.startsWith("chinese");if(k&&M&&(q||W)&&(!x||a!==void 0&&t+2===a.length)){ei();return}}const f=u==null?void 0:u.offsetTop;Ta();const p=u==null?void 0:u.offsetTop;f<p&&!bm&&T.current.length>1&&(r.mode==="zen"?r.showAllLines||sp(f):(T.current=T.current.slice(0,-1),Ta())),(l&&T.current.length===R.getCurrent().length||e===`
`&&c)&&Vh();const h=R.getCurrent(),y=/^\t+/.test(R.getCurrent()),b=h[T.current.length]==="	";setTimeout(()=>{if(c&&r.language.startsWith("code")&&y&&b){const C=new KeyboardEvent("keydown",{key:"Tab",code:"Tab"});document.dispatchEvent(C)}},0),e!==`
`&&Ao()}function k3(e,t){if(Ys){e.preventDefault();return}let a=!1;(r.mode==="zen"&&!e.shiftKey||kr&&!e.shiftKey)&&(a=!0);const s=Vt("commandLineWrapper")||t;if(r.quickRestart==="esc"){if(s||ce()==="login")return;if(e.preventDefault(),!ze&&a){Kt("	",T.current.length),Za(" "+T.current);return}}else if(r.quickRestart==="tab"){if(s||ce()==="login")return;if(ce()!=="test"){ft("/");return}if(e.shiftKey?be():Sr(),!ze&&a){e.preventDefault(),Kt("	",T.current.length),Za(" "+T.current);return}le({event:e})}else{if(s||ce()!=="test"||ze)return;if(a){e.preventDefault(),Kt("	",T.current.length),Za(" "+T.current);return}setTimeout(()=>{var i;((i=document.activeElement)==null?void 0:i.id)!=="wordsInput"&&gs(!1)},0)}}n("#wordsInput").on("keydown",e=>{const t=ce()==="test",a=Vt("commandLineWrapper"),s=Vt("leaderboardsWrapper"),i=id();t&&!a&&!s&&!i&&!ze&&e.key!=="Enter"&&!sd||e.preventDefault()});let Zu=-1;n(document).on("keydown",async e=>{var d,u;if(ce()==="loading"){console.debug("Ignoring keydown event on loading page.");return}if(q1.includes(e.key)){console.debug(`Key ${e.key} is on the list of ignored keys. Stopping keydown event.`),e.preventDefault();return}for(const m of ht("handleKeydown"))m.functions.handleKeydown(e);const t=n("#wordsInput").is(":focus"),a=ce()==="test",s=Vt("commandLineWrapper"),i=Vt("leaderboardsWrapper"),l=id(),c=a&&!s&&!i&&!l&&!ze&&(t||e.key!=="Enter")&&!sd;if(c&&!t&&!["Enter"," ","Escape","Tab",...w3].includes(e.key)&&(Bd(),r.showOutOfFocusWarning&&!e.ctrlKey&&!e.metaKey&&e.preventDefault()),e.key==="Tab"&&k3(e,l),e.key==="Escape"&&r.quickRestart==="esc"){if(Vt("commandLineWrapper")||l)return;if(ce()!=="test"){ft("/");return}e.shiftKey?be():Sr(),le({event:e})}if(e.key==="Enter"&&r.quickRestart==="enter"){const m=document.activeElement;if((m==null?void 0:m.tagName)==="BUTTON"||(m==null?void 0:m.tagName)==="A"||(m==null?void 0:m.classList.contains("button"))||(m==null?void 0:m.classList.contains("textButton"))||(m==null?void 0:m.tagName)==="INPUT"&&(m==null?void 0:m.id)!=="wordsInput"||Vt("commandLineWrapper")||l)return;if(ce()!=="test"){ft("/");return}if(ze){le({event:e});return}r.mode==="zen"||(!Cr&&!r.funbox.includes("58008")||(Cr||r.funbox.includes("58008"))&&e.shiftKey)&&(e.shiftKey?be():Sr(),le({event:e}))}if(c){if(!((d=e.originalEvent)!=null&&d.isTrusted)||_t){e.preventDefault();return}if(Bw(),e.key==="Backspace"){if(Mo(),/INPUT|SELECT|TEXTAREA/i.test(e.target.tagName)||e.preventDefault(),r.confidenceMode==="max"){e.preventDefault();return}r.codeUnindentOnBackspace&&T.current.length>0&&/^\t*$/.test(T.current)&&r.language.startsWith("code")&&W1(T.current.slice(-1),T.current.length-1)&&(T.getHistory(te-1)!==R.get(te-1)||r.freedomMode)&&(T.current="",await Ta())}if(e.key==="Backspace"&&T.current.length===0&&(F1(),T.current&&Za(" "+T.current+" ")),e.key==="Enter")if(e.shiftKey){if(r.mode==="zen")ei();else if(!rd(r.mode,r.words,r.time,rn(),Po()??!1)){const m=Date.now()-Zu;Zu===-1||m>200?(Zu=Date.now(),m>=5e3&&g("Please double tap shift+enter to confirm bail out",0,{important:!0,duration:5})):(ib(!0),ei())}}else Kt(`
`,T.current.length),Za(" "+T.current),gc();if(e.key==="Dead"&&!Ws()){Mo();const m=(u=document.querySelectorAll("#words .word"))==null?void 0:u[te-Ze],f=T.current.length,p=m==null?void 0:m.querySelectorAll("letter")[f];p&&p.classList.toggle("dead")}if(r.oppositeShiftMode!=="off")if(r.oppositeShiftMode==="keymap"&&r.keymapLayout!=="overrideSync"){let m=await Ds(r.keymapLayout).catch(()=>{});if(m===void 0){g("Failed to load keymap layout",-1);return}Eo().includes("layout_mirror")&&(m=Uf(m));const p=Yw(e.key,m);od=p===void 0?!0:mm(p)}else od=mm(e.code);for(const m of ht("preventDefaultEvent"))await m.functions.preventDefaultEvent(e)&&(e.preventDefault(),Kt(e.key,T.current.length),gc(),Za(" "+T.current));if(r.layout!=="default"&&!(e.ctrlKey||e.altKey&&window.navigator.platform.search("Linux")>-1)){const m=await v3(e);m!==null&&(e.preventDefault(),Kt(m,T.current.length),gc(),Za(" "+T.current))}B1=e.key==="Backspace"||e.key==="delete"}});n("#wordsInput").on("keydown",e=>{var a;if((a=e.originalEvent)!=null&&a.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}NP(e),e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const s=e.code===""||e.which===231?"NoCode":e.code;t2(t,s)},0)});n("#wordsInput").on("keyup",e=>{var a;if((a=e.originalEvent)!=null&&a.repeat){console.log("spacing debug keydown STOPPED - repeat",e.key,e.code,e.which);return}e.code==="NumpadEnter"&&r.funbox.includes("58008")&&(e.code="Space"),e.code.includes("Arrow")&&r.funbox.includes("arrows")&&(e.code="NoCode");const t=performance.now();setTimeout(()=>{const s=e.code===""||e.which===231?"NoCode":e.code;Ww(t,s)},0)});n("#wordsInput").on("keyup",e=>{var t;if(!((t=e.originalEvent)!=null&&t.isTrusted)||_t){e.preventDefault();return}GP(e),q1.includes(e.key)});n("#wordsInput").on("beforeinput",e=>{var t;(t=e.originalEvent)!=null&&t.isTrusted&&e.target.value===""&&(e.target.value=" ")});n("#wordsInput").on("input",e=>{var u;if(!((u=e.originalEvent)!=null&&u.isTrusted)||_t){e.target.value=" ";return}if(id()){e.preventDefault();return}Bw(),(r.layout==="default"||r.layout==="korean")&&e.target.value.normalize().match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)&&T.setKoreanStatus(!0);const a=T.getKoreanStatus(),s=r.language.startsWith("chinese"),i=e.target.value.normalize(),l=a?it.disassemble(i).join("").slice(1):i.slice(1),c=a?it.disassemble(T.current).join(""):T.current;if(a&&!B1&&(Vu||i.slice(1).length<T.current.length&&it.disassemble(T.current.slice(-1)).length>1)){Vu=!Vu;return}if(r.layout!=="default"&&l.length>=c.length){Za(" "+c);return}if(i.length===0&&c.length===0)F1();else if(l.length<c.length){if(s)if(c.length-l.length<=2&&c.startsWith(c))T.current=l;else{let m=0;for(;l[m]===c[m];)m++;let f=0;r.stopOnError!=="word"&&/.+ .+/.test(l)&&(f=l.indexOf(" ")+1);for(let p=m;p<l.length;p++)Kt(l[p],p-f,i)}else if(a){const m=e.target.value.normalize().slice(1);T.current=m,D1.innerText=m.slice(-1)}else T.current=l;Ta(),Ao(),Ws()||((e==null?void 0:e.originalEvent).inputType==="deleteWordBackward"?Fs("setLetterIndex",0):Fs("setLetterIndex",c.length-1))}if(l!==c){let m=0;for(;l[m]===c[m];)m++;let f=0;r.stopOnError!=="word"&&/.+ .+/.test(l)&&(f=l.indexOf(" ")+1);for(let p=m;p<l.length;p++)Kt(l[p],p-f,i)}Za(" "+T.current),gc();const d=Ws();setTimeout(()=>{const m=Ws();d!==m&&Ta(),e.target.selectionStart!==e.target.value.length&&(!Go.test(e.target.value)||(e.target.selectionStart??0)<e.target.value.search(Go))&&(e.target.selectionStart=e.target.selectionEnd=e.target.value.length)},0)});n("#wordsInput").on("focus",e=>{e.target.selectionStart=e.target.selectionEnd=e.target.value.length});n("#wordsInput").on("copy paste",e=>{e.preventDefault()});n("#wordsInput").on("select selectstart",e=>{e.preventDefault()});n("#wordsInput").on("keydown",e=>{e.key.startsWith("Arrow")&&e.preventDefault()});n("#wordsInput").on("compositionstart",()=>{r.layout==="default"&&(Xf(!0),x2(T.current.length))});n("#wordsInput").on("compositionend",()=>{r.layout==="default"&&Xf(!1)});const C3=new jt({key:"merchBannerClosed",schema:o.boolean(),fallback:!1});function S3(){C3.get()}n(async()=>{await Wf,w_(),n("body").css("transition","background .25s, transform .05s"),S3();for(const e of ht("applyGlobalCSS"))e.functions.applyGlobalCSS();n("#app").css("opacity","0").removeClass("hidden").stop(!0,!0).animate({opacity:1},Be(250)),Xe()&&ZD().then(()=>{var e;(e=Yd())!=null&&e.users.signUp||(iM(),n(".register").addClass("hidden"),n(".login").addClass("hidden"),n(".disabledNotification").removeClass("hidden"))}),bq(),new ZS("https://keymash.io/")});n("#nocss .requestedStylesheets").html("Requested stylesheets:<br>"+[...document.querySelectorAll("link[rel=stylesheet")].map(e=>e.href).filter(e=>/\/css\/style/gi.test(e)).join("<br>"));n("#nocss .requestedJs").html("Requested Javascript files:<br>"+[...document.querySelectorAll("script")].map(e=>e.src).filter(e=>/(\/js\/mon|\/js\/vendor)/gi.test(e)).join("<br>")+"<br><br>Client version:<br>"+Zr.clientVersion);window.navigator.userAgent.toLowerCase().includes("mac")?n("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >
      Cmd
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `):n("#nocss .keys").html(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-bottom: 1rem;
      "
    >
      Ctrl
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `);const Vr="videoAdPopupWrapper";async function x3(){if(Zt(Vr,"popups"),await Cp(),Kd){g("Looks like you're using an adblocker. Video ads will not work until you disable it.",0,{duration:6});return}if(await Sp(),Rr){g("Looks like you're using a cookie popup blocker. Video ads will not work without giving your consent through the popup.",0,{duration:7});return}Vt(Vr)||n("#videoAdPopupWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},125,()=>{window.dataLayer.push({event:"EG_Video"})})}function Qh(){Vt(Vr)&&n("#videoAdPopupWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},125,()=>{n("#videoAdPopupWrapper").addClass("hidden"),Et(Vr)})}function T3(e){const t=e.event;t==="started"||(t==="finished"?Qh():t==="empty"&&(g("Failed to load video ad. Please try again later",-1,{duration:3}),Qh()))}n(".pageTest #watchVideoAdButton").on("click",()=>{x3()});Ht(Vr);let as;async function z1(e=r.language){if(!as)return;const a=(await ci(e)).bcp47??"en-US";as.lang=a}async function R1(){as=new SpeechSynthesisUtterance,await z1()}function $3(){as=void 0}async function L3(e){window.speechSynthesis.cancel(),as===void 0&&await R1(),as!==void 0&&(as.text=e,window.speechSynthesis.speak(as))}Te((e,t)=>{e==="funbox"&&(t==="none"?$3():t==="tts"&&R1()),e==="language"&&r.funbox.split("#").includes("tts")&&z1()});_2(e=>{L3(e)});let hc=0,Zm,Ym,Yp=!0;const As=document.querySelector("#fpsCounter");function O1(e){if(Yp)return;const t=e-Ym;if(hc++,t>500){const a=Q(hc*1e3/t).toFixed(2);hc=0,Ym=e,A3(a)}window.requestAnimationFrame(O1)}function Y3(){Yp=!1,hc=0,Ym=performance.now(),Zm||(Zm=window.requestAnimationFrame(O1)),As.classList.remove("hidden")}function X3(){cancelAnimationFrame(Zm),Yp=!0,As.classList.add("hidden")}async function A3(e){As.innerHTML=`FPS ${e}`;const t=parseFloat(e);As.classList.remove("error"),As.classList.remove("main"),t<30?As.classList.add("error"):t>55&&As.classList.add("main")}const Wi=new Oo(n(".page.pageProfileSearch .search input"),{notFound:{icon:"fa-user-slash",level:-1},error:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:1}});function M3(){n(".page.pageProfileSearch .search button").addClass("disabled"),n(".page.pageProfileSearch .search input").attr("disabled","disabled")}function E3(){n(".page.pageProfileSearch .search button").removeClass("disabled"),n(".page.pageProfileSearch .search input").removeAttr("disabled")}function P3(){return n(".page.pageProfileSearch .search input").attr("disabled")!==void 0}function Zh(){n(".page.pageProfileSearch .search input").trigger("focus")}async function I3(){Wi.hide();const e=n(".page.pageProfileSearch .search input").val();if(e==="")return;Wi.show("checking"),M3(),await Ee(500);const t=await F.users.getProfile({params:{uidOrName:e}});if(E3(),t.status===404){Zh(),Wi.show("notFound","User not found");return}else if(t.status!==200){Zh(),Wi.show("error",`Error: ${t.body.message}`);return}Wi.hide(),ft(`/profile/${e}`,{data:t.body.data})}n(".page.pageProfileSearch form").on("submit",e=>{e.preventDefault(),!P3()&&I3()});Ht("pageProfileSearch");const _1=new jt({key:"lastSeenVersion",schema:o.string(),fallback:""});let Xm=null,nd=null;function q3(e){_1.set(e)}function B3(){return _1.get()}async function D3(){const e=await UM(),t=B3();Xm=e,nd=t===""?!1:t!==e,(nd||t==="")&&(q3(e),F3())}function F3(){caches.keys().then(function(e){for(const t of e)caches.delete(t)})}async function W3(){return(Xm===null||nd===null)&&await D3(),{version:Xm,isNew:nd}}function z3(e){n("footer .currentVersion .text").text(e)}function R3(e){e?n("#newVersionIndicator").removeClass("hidden"):n("#newVersionIndicator").addClass("hidden")}async function O3(){const{version:e,isNew:t}=await W3();z3(e),R3(t)}function _3(e){for(const[t,a]of Object.entries(e))window[t]=a}LM();O3();gs(!0,!0);_3({snapshot:$,config:r,toggleFilterDebug:sF,glarsesMode:OI,stats:GE,replay:k2,enableTimerDebug:VP,getTimerStats:oI,toggleUnsmoothedRaw:QI,egVideoListener:T3,toggleDebugLogs:d3});export{Rv as $,cs as A,Av as B,Pd as C,Q3 as D,Ev as E,Mo as F,Uv as G,dw as H,Iv as I,qv as J,cw as K,vr as L,br as M,Kv as N,Bv as O,_v as P,Hv as Q,Mv as R,V3 as S,y2 as T,Rg as U,Wv as V,pt as W,Ef as X,r as Y,zv as Z,Pf as _,dt as a,yd as a$,If as a0,yo as a1,ww as a2,_a as a3,Yv as a4,Dv as a5,Mf as a6,Zv as a7,Fv as a8,ew as a9,E0 as aA,qE as aB,T as aC,R as aD,JE as aE,p_ as aF,Bf as aG,Df as aH,nm as aI,kt as aJ,lw as aK,Zl as aL,$ as aM,gt as aN,X0 as aO,vl as aP,dC as aQ,wr as aR,DP as aS,Vc as aT,aW as aU,Jo as aV,Gu as aW,kd as aX,ro as aY,al as aZ,uP as a_,sw as aa,nw as ab,Ko as ac,qf as ad,Cd as ae,kw as af,na as ag,Sw as ah,Cw as ai,xw as aj,sl as ak,Nv as al,$M as am,ei as an,Po as ao,je as ap,r2 as aq,qe as ar,ib as as,Qt as at,re as au,K3 as av,ft as aw,Sd as ax,nl as ay,ze as az,be as b,mP as b0,Eo as b1,Cf as b2,yw as b3,uI as b4,mw as b5,p3 as b6,Z3 as b7,$o as b8,Us as b9,To as bA,GA as bB,Jr as bC,gs as bD,Bd as bE,Qo as ba,fe as bb,rn as bc,Of as bd,HM as be,Rf as bf,jM as bg,WP as bh,c1 as bi,iC as bj,Tw as bk,$w as bl,vd as bm,il as bn,TM as bo,x3 as bp,ri as bq,gM as br,Qn as bs,pr as bt,li as bu,GE as bv,Y3 as bw,X3 as bx,ce as by,eh as bz,Ga as c,ns as d,pw as e,ho as f,Af as g,ma as h,rw as i,uw as j,Gv as k,tw as l,aw as m,ow as n,Xv as o,iw as p,fw as q,le as r,Ea as s,Vv as t,Pv as u,Ov as v,gw as w,Jv as x,jv as y,Qv as z};
